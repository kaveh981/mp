function loadingStart() { $("#plzwait").removeClass("hidden"); $("#spinner").show() } function loadingEnd() { $("#spinner").removeClass("ui-state-active").hide(); $("#plzwait").addClass("hidden") } function BindProvinceCities(e, t, n, r) { var i = ""; if (e != null) i = $("#" + e); else if (t != null) i = $("[name=" + t + "]"); $.ajax({ type: "POST", async: false, url: "/Shopping/ProvinceCities", data: "{provinceCode:'" + n + "'}", contentType: "application/json; charset=utf-8", success: function (e) { if (e.isdone) { i.html("<option value=''>---</option>"); var t = e.options; for (var n = 0; n < t.length; n++) { var s = t[n]; i.append("<option value='" + s.value + "'>" + s.title + "</option>") } if (r != undefined && r != null) i.val(r) } }, error: function (e) { } }) } function getFullAcountList(e, t) { if (sortid == "" || sortid == null) sortid = "date desc"; var n = $("#" + e); if (t.page_index > 0) t.first = false; var r = $("#PageSize").val(); var i = "", s = "", o = "", u = "", a = "", f = "", l = "", c = "", h = ""; var p = n.find("#ddlSearchBy1").val(); if (p != "") { if (p == "Code") { code = n.find("#txtSearch1").val() } if (p == "EmployeeName") { s = n.find("#txtSearch1").val() } if (p == "InvoiceNumber") { i = n.find("#txtSearch1").val() } if (p == "shop") { o = n.find("#txtSearch1").val() } if (p == "productBarcode") { a = n.find("#txtSearch1").val() } } if (n.find("#txt_s_PriceFrom").length > 0) f = n.find("#txt_s_PriceFrom").val(); if (n.find("#txt_s_PriceTo").length > 0) l = n.find("#txt_s_PriceTo").val(); c = n.find("#txtInvoiceDateStart").val(); h = n.find("#txtInvoiceDateEnd").val(); var d = { sort: sortid, EmployeeName: s, shop: o, Barcode: a, InvoiceDateStart: c, InvoiceDateEnd: h, PriceFrom: f, PriceTo: l, InvoiceNumber: i }; t["DTO"] = d; pageselectCallback(0, t, { container: "", fname: t.fname, pagingContainer: e, first: true, isOrder: true }) } function buildFullAcountList(jq, container) { var $con = $("#shopBuy"); var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "تاریخ", width: "10%", sort: "Date" }); lsth.push({ title: "شماره فاکتور", width: "15%", sort: "InvoiceNO" }); lsth.push({ title: "شرح", width: "13%" }); lsth.push({ title: "بستانکار", width: "12%", sort: "Amount" }); lsth.push({ title: "بدهکار", width: "12%", sort: "Amount" }); lsth.push({ title: "باقیمانده", width: "12%", sort: "Amount" }); lsth.push({ title: "فروشگاه", width: "10%", sort: "inv_Shop.Name" }); if (!container.params.print) { lsth.push({ title: "جزئیات" }) } var List = typeof jq.results == "string" ? eval("(" + jq.results + ")") : jq.results; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; if (!container.params.print) trBody[0] = { trId: val.id, trName: val.detail }; trBody[1] = { name: "date", html: val.date, width: "15%" }; trBody[2] = { name: "InvoiceNO", html: val.InvoiceNO, width: "12%" }; trBody[3] = { name: "description", html: "<span>" + val.inOrderOf + "</span>", width: "15%" }; trBody[4] = { name: "Debtor", html: val.isSell == true ? val.amount : "", width: "10%" }; trBody[5] = { name: "Creditor", html: val.isSell == true ? "" : "<span>" + val.amount + "</span>", width: "10%" }; trBody[6] = { name: "balance", html: val.balance, width: "12%" }; trBody[7] = { name: "shop", html: val.shopName == null ? "---" : val.shopName, width: "7%" }; lstb.push(trBody) } table = { header: lsth, body: lstb, details: { detailsFunction: FullAcountDetails }, heigth: 300, container: "shopBuyTable", divName: "ordersInfo", hasFooter: false, servicename: "Account", methodname: "GetCurrentUserOrders", buildFunction: buildFullAcountList }; $("#sumDebtor").html(jq.sumDebtor != null ? jq.sumDebtor : 0); $("#sumCreditor").html(jq.sumCreditor != null ? jq.sumCreditor : 0); $("#sumBalance").html(jq.balance != null ? Math.round(jq.balance, 1) : 0); $("#sumPayment").html(jq.sumPayment != null ? jq.sumPayment : 0); $("#sumReceive").html(jq.sumReceive != null ? jq.sumReceive : 0); buildTable(table) } function buildOnlineOrdersList(jq, container) { var $con = $("#onlineBuy"); var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "تاریخ", width: "15%", sort: "Date" }); lsth.push({ title: "شماره فاکتور", width: "15%", sort: "InvoiceNO" }); lsth.push({ title: "شرح", width: "25%" }); lsth.push({ title: "مبلغ", width: "20%", sort: "Amount" }); lsth.push({ title: "فروشگاه", width: "15%", sort: "inv_Shop.Name" }); if (!container.params.print) { lsth.push({ title: "جزئیات" }) } var List = typeof jq.results == "string" ? eval("(" + jq.results + ")") : jq.results; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; if (!container.params.print) trBody[0] = { trId: val.id, trName: val.detail }; trBody[1] = { name: "date", html: val.date, width: "15%" }; trBody[2] = { name: "InvoiceNO", html: val.InvoiceNO, width: "12%" }; trBody[3] = { name: "description", html: "<span>" + val.inOrderOf + "</span>", width: "25%" }; trBody[5] = { name: "Creditor", html: val.isSell == true ? "" : "<span>" + val.amount + "</span>", width: "20%" }; trBody[7] = { name: "shop", html: val.shopName == null ? "---" : val.shopName, width: "15%" }; lstb.push(trBody) } table = { header: lsth, body: lstb, details: { detailsFunction: OnlineOrderDetails }, heigth: 300, container: "onlineBuyTable", divName: "nOrdersInfo", hasFooter: false, servicename: "Account", methodname: "GetCurrentUserOnlineOrders", buildFunction: buildOnlineOrdersList }; $("#sumNetCreditor").html(jq.sumDebtor); buildTable(table) } function FullAcountDetails(e, t) { $con = $("#" + t); $dis = $(e); $("#voucherDetailsList" + t + "," + "#DetailPaymentList" + t + "," + "#dialog" + t).dialog().dialog("close"); if ($dis.parents("tr").attr("name") == "payment") ListDetailPayment($dis.parents("tr").prop("id").replace("tr", ""), t); else if ($dis.parents("tr").attr("name") == "order") SelectDetailInvoice($dis.parents("tr").prop("id").replace("tr", ""), t); else if ($dis.parents("tr").attr("name") == "voucher") VoucherDetailsFullAccount($dis.parents("tr").prop("id").replace("tr", ""), t) } function OnlineOrderDetails(dis, container) { $con = $("#" + container); $dis = $(dis); var $invoiceDetail = $("#onlineOrderDetails"); var id = $dis.parents("tr").prop("id").replace("tr", ""); $.ajax({ type: "POST", url: "/Account/GetOnlineDetailInvoice", contentType: "application/json; charset=utf-8", data: "{id: '" + id + "'}", success: function (response) { $("#receiverName").html(response.receiverName); $("#postType").html(response.postType); $("#dateTime").html(response.dateTime); $("#isgiftDescription").html(response.isgiftDescription); $("#phoneMobile").html(response.phoneMobile); $("#paymentType").html(response.paymentType); $("#receiverAddress").html(response.receiverAddress); $("#referenceId").html(response.referenceId); jq = response.d; var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; val.appName = val.appName == null ? "/" : val.appName; ItemList += "<tr id='tr" + val.OrderDetailId + "'>" + "<td name='name' id='" + val.BarcodeId + "' width='17%'><span class='cursor' name='subTab' menuName='a_InventoryList' id='" + val.BarcodeId + "'>" + (val.Barcode == null ? "" : val.Barcode + "_") + (val.Name == null ? "" : val.Name) + (val.Description == null ? "" : "_" + val.Description) + (val.ItemCode == null ? "" : "_" + val.ItemCode) + "</span></td>" + "<td name='Color' width='10%'><div id='Color'>" + (val.Color == null ? "" : val.Color) + "</div></td>" + "<td name='Size' width='10%'><div id='Size'>" + (val.Size == null ? "" : val.Size) + "</div></td>" + "<td name='Quantity' width='7%'><div id='Quantity'>" + (val.Quantity == null ? "" : val.Quantity) + "  " + (val.UnitType == null ? "" : val.UnitType) + "</div></td>" + "<td name='Price' width='10%'><div id='Price'>" + (val.Price == null ? "" : val.Price) + "</div></td>" + "<td name='TotalPrice' width='10%'><div id='TotalPrice'>" + val.Quantity * val.Price + "</div></td>" + "<td name='Serial' width='10%'><div id='Serial'>" + (val.Serial == null ? "" : val.Serial) + "</div></td>" + "<td name='image' width='10%' ><img class='imagefortable' src='../../../Data/" + val.appName + "Photos/" + val.Barcode + "/tiny_1.jpg'></td>" + "<tr>" } $invoiceDetail.find("#onlineDetailListInvoice").html(ItemList); $invoiceDetail.removeClass("invisible"); $invoiceDetail.dialog({ width: 1e3 }).dialog("open") }, error: function (e) { alert(e.responseText) } }) } function ListDetailPayment(OrderHeaderId, container) { var $con = $("#" + container); $DetailPaymentList = $("#DetailPaymentList"); $.ajax({ data: $("form").serialize() + "&OrderHeaderId=" + OrderHeaderId, dataType: "json", type: "Post", url: "/Account/GetDetailPaymentList", success: function (response) { var List = typeof response == "string" ? eval("(" + response.dp[0] + ")") : response.dp[0]; var ItemCash = ""; for (var i = 0; i < List.cash.length; i++) { var val = List.cash[0, i]; if (val.Amount > 0) { ItemCash += "<tr id='tr" + val.CashId + "'>" + "<td width='50%' name='PaymentNO' >" + val.Amount + "  " + val.Currency + "</td>" + "<td width='40%'>" + val.Type + "</td></tr>" } } $DetailPaymentList.find("#CashList").html(ItemCash); if (ItemCash != "") { $DetailPaymentList.find("#tablecash").removeClass("invisible") } else { $DetailPaymentList.find("#tablecash").addClass("invisible") } ItemCheque = ""; for (var i = 0; i < List.cheque.length; i++) { var val = List.cheque[0, i]; if (val.Amount > 0) { ItemCheque += "<tr id='tr" + val.ChequeId + "'>" + "<td name='PaymentNO' width='20%'>" + val.Amount + "  " + val.Currency + "</td>" + "<td  width='20%'>" + val.Bank + "</td>" + "<td  width='15%'>" + val.Serial + "</td>" + "<td id='status'  width='15%'>" + val.Passed + "</td>" + "<td  width='20%'>" + val.Date + "</td></tr>" } } $DetailPaymentList.find("#ChequeList").html(ItemCheque); if (ItemCheque != "") { $DetailPaymentList.find("#tablecheque").removeClass("invisible") } else { $DetailPaymentList.find("#tablecheque").addClass("invisible") } $DetailPaymentList.dialog({ width: "300px" }).dialog("open") }, error: function (e) { alert(e.responseText) } }) } function SelectDetailInvoice(id, container) { var $con = $("#" + container); var $invoiceDetail = $("#dialog"); $.ajax({ type: "POST", url: "/Account/GetDetailInvoice", contentType: "application/json; charset=utf-8", data: "{id: '" + id + "'}", success: function (response) { jq = response.d; var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; val.appName = val.appName == null ? "/" : val.appName; ItemList += "<tr id='tr" + val.OrderDetailId + "'>" + "<td name='name' id='" + val.BarcodeId + "' width='17%'><span class='cursor' name='subTab' menuName='a_InventoryList' id='" + val.BarcodeId + "'>" + (val.Barcode == null ? "" : val.Barcode + "_") + (val.Name == null ? "" : val.Name) + (val.Description == null ? "" : "_" + val.Description) + (val.ItemCode == null ? "" : "_" + val.ItemCode) + "</span></td>" + "<td name='Color' width='10%'><div id='Color'>" + (val.Color == null ? "" : val.Color) + "</div></td>" + "<td name='Size' width='10%'><div id='Size'>" + (val.Size == null ? "" : val.Size) + "</div></td>" + "<td name='Quantity' width='7%'><div id='Quantity'>" + (val.Quantity == null ? "" : val.Quantity) + "  " + (val.UnitType == null ? "" : val.UnitType) + "</div></td>" + "<td name='Price' width='10%'><div id='Price'>" + (val.Price == null ? "" : val.Price) + "</div></td>" + "<td name='TotalPrice' width='10%'><div id='TotalPrice'>" + val.Quantity * val.Price + "</div></td>" + "<td name='Serial' width='10%'><div id='Serial'>" + (val.Serial == null ? "" : val.Serial) + "</div></td>" + "<td name='image' width='10%' ><img class='imagefortable' src='../../../Data/" + val.appName + "Photos/" + val.Barcode + "/tiny_1.jpg'></td>" + "<tr>" } $invoiceDetail.find("#DetailListInvoice").html(ItemList); $invoiceDetail.removeClass("invisible"); $invoiceDetail.dialog({ width: 1e3 }).dialog("open") }, error: function (e) { alert(e.responseText) } }) } function VoucherDetailsFullAccount(orderHeaderId, container) { $con = $("#" + container); var $dialog = $("#voucherDetailsList"); $.ajax({ type: "POST", url: "/Account/GetVoucherDetailsFullAccount", contentType: "application/json; charset=utf-8", data: "{orderHeaderId: '" + orderHeaderId + "'}", success: function (response) { jq = response.d; if (jq.msg != undefined && jq.msg == "empty") { $dialog.find("#DetailListVoucher").html(""); $dialog.dialog("close"); return } var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<tr id='tr" + val.OrderHeaderId + "'>" + "<td name='number' width='25%'>" + val.Number + "</td>" + "<td name='IsValid' width='20%'>" + "<span id='voucherStatus'>" + val.IsValid + "</span></td>" + "<td name='ExpieryDate' width='20%'><div id='ExpieryDate'>" + val.ExpieryDate + "</div></td>" + "<td name='Amount' width='20%'><div id='Amount'>" + val.Amount + "</div></td>" + "</tr>" } $dialog.find("#DetailListVoucher").html(ItemList); $dialog.removeClass("invisible"); $dialog.dialog({ width: 800 }).dialog("open") }, error: function (e) { alert(e.responseText) } }) } function getProperty(barcodeid) { var DTO = { barcodeid: barcodeid }; $.ajax({ type: "POST", data: JSON.stringify(DTO), url: "/Home/getProperty", contentType: "application/json; charset=utf-8", success: function (response) { var table = "<table class='TechnicalInfoTable' cellspacing='0' style='direction:ltr'><tbody>"; var group = typeof response == "string" ? eval("(" + response + ")") : response; for (var j = 0; j < group.length; j++) { var val = group[0, j]; table += "<tr class='Title'><td class='Group' colspan='2'>" + val.Property + "</td></tr>"; var Properties = typeof val.properties == "string" ? eval("(" + val.properties + ")") : val.properties; for (var p = 0; p < Properties.length; p++) { var val = Properties[0, p]; table += "<tr id='tr" + val.PropertyId + "' ><td style='direction:ltr' class='Value'>" + val.Value + "</td><td class='Filde'>" + val.Property + ": </td></tr>"; if (p < Properties.length * 1 - 1) table += "<tr><td colspan='2'><div class='split'></div></td></tr>" } } table += "</tbody></table>"; $("#itemProperty").html(table); $("[id=btnDelete]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).unbind().click(function () { var e = this; if (confirm("آیا از حذف مطمئن هستید؟")) deleteProperty($(this).attr("propId"), container + "dialogAddProperty", container); else return }) }, error: function (e) { alert(e.responseText) } }) } function SetItemDetailSizeAndQuantity(e) { var t = e.parents("tr").attr("id").replace("detail", ""); var n = { colorId: e.val(), itemdetailId: t }; $.ajax({ type: "POST", url: "/Home/GetSizesForColor", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (e) { if ($("tr[id=detail" + t + "]").find("select[name=sizes]").length > 0) $("tr[id=detail" + t + "]").find("select[name=sizes]").removeClass("hidden"); else { $("tr[id=detail" + t + "]").find("td[id=sizeDetails]").html("<select id='size' name='sizes'></select>"); $("[name=sizes]").unbind().change(function () { SetItemDetailQuantityForSize($(this)) }) } $("tr[id=detail" + t + "]").find("select[name=sizes]").html("<option value=''>---</option>"); $("tr[id=detail" + t + "]").find("select[name=quantity]").html("<option value='0'></option>"); if (e.size != "null" && e.size.length > 0) { for (var n = 0; n < e.size.length; n++) { var r = e.size[n]; for (var i = 0; i < r.size.length; i++) { var s = r.size[i]; if (s.quantity > 0) $("tr[id=detail" + t + "]").find("select[name=sizes]").append("<option value='" + s.SizeId + "'>" + s.Size + "</option>") } } } else if ((e.size == "null" || e.size.length == 0) && e.quantity != "null") { $("tr[id=detail" + t + "]").find("td[id=sizeDetails]").html("<span>---</span>"); $("tr[id=detail" + t + "]").find("select[name=quantity]").html("<option value='0'></option>"); for (var n = 1; n <= e.quantity; n++) { $("tr[id=detail" + t + "]").find("select[name=quantity]").append("<option>" + n + "</option>") } } else if ((e.size == "null" || e.size.length == 0) && e.quantity == "null") { $("tr[id=detail" + t + "]").find("td[id=sizeDetails]").html("<span>---</span>") } }, error: function (e) { alert(e.responseText) } }) } function SetItemDetailQuantityForSize(e) { var t = e.parents("tr").attr("id").replace("detail", ""); var n = { sizeId: e.val(), itemdetailId: t, colorId: $("tr[id=detail" + t + "]").find("select[name=colors]").val() }; $.ajax({ type: "POST", url: "/Home/GetQuantityForColorSize", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (e) { $("tr[id=detail" + t + "]").find("select[name=quantity]").html("<option value='0'></option>"); if (e.quantity != "null" && e.quantity > 0) { for (var n = 1; n <= e.quantity; n++) { $("tr[id=detail" + t + "]").find("select[name=quantity]").append("<option>" + n + "</option>") } } }, error: function (e) { alert(e.responseText) } }) } function StartCompleteRegisteration() { var e = { MemberCode: $("[name=MemberCode]").val() }; $.ajax({ type: "POST", url: "/Shopping/CheckMemberCode", contentType: "application/json; charset=utf-8", data: JSON.stringify(e), success: function (e) { if (!e.isdone) { alert(e.msg); return } else { $("[name=code]").val(e.userInfo.Code); $("[name=regName]").val(e.userInfo.Name != null ? e.userInfo.Name : ""); $("[name=regFamily]").val(e.userInfo.Family != null ? e.userInfo.Family : ""); $("[name=regAddressStr]").val(e.userInfo.Address != null ? e.userInfo.Address : ""); $("[name=BirthYear]").val(e.userInfo.BirthYear); $("[name=BirthMonth]").val(e.userInfo.BirthMonth); $("[name=BirthDay]").val(e.userInfo.BirthDay); $("[name=regGender]").val(e.userInfo.Gender.toString()); $("[name=regPostalCode]").val(e.userInfo.PostalCode != null ? e.userInfo.PostalCode : ""); $("[name=Combo]").val(e.userInfo.Combo); bindDropDownList({ controller: "Shopping", method: "GetProvinces", selectedval: e.userInfo.ParentAddressId, name: "regCity", defaultText: "---" }, "regProvince", null); BindProvinceCities(null, "regCity", e.userInfo.ParentAddressId, e.userInfo.AddressId); $("#regProvince").unbind().change(function () { BindProvinceCities("regCity", "regCity", $("#regProvince").val()) }); var t = e.userInfo.phonelst; for (var n = 0; n < t.length; n++) { $("#phones").append("<li class='ui-state-default ui-corner-top'>" + "<a id='delete' name='smsItems' style='float: right' class='ui-icon ui-icon-close'>حذف</a>" + "<label name='num' class='ui-tabs-anchor'>" + t[n] + "</label>" + "</li>") } var r = e.userInfo.moblst; for (var n = 0; n < r.length; n++) { $("#mobiles").append("<li class='ui-state-default ui-corner-top'>" + "<a id='delete' name='smsItems' style='float: right' class='ui-icon ui-icon-close'>حذف</a>" + "<label name='num' class='ui-tabs-anchor'>" + r[n] + "</label>" + "</li>") } $("[id=delete]").addClass("cursor").unbind().click(function () { $(this).parents("li").remove() }); $("#btn_register").val("تکمیل ثبت نام"); $("#login").addClass("hidden"); $("#registerForm").removeClass("hidden") } }, error: function (e) { alert(e.responseText) } }) } function RegisterFromShoppingCart() { $("[name=regName]").val($.trim($("[name=regName]").val())); $("[name=regFamily]").val($.trim($("[name=regFamily]").val())); $("[name=regAddressStr]").val($.trim($("[name=regAddressStr]").val())); $("[name=regEmail]").val($.trim($("[name=regEmail]").val())); if ($("#phones").find("li").length > 0) { $("[name=regPhone]").removeClass("required"); $("[name=regPhone]").removeClass("validate") } else { if ($("[name=regPhone]").hasClass("required")) $("[name=regPhone]").addClass("required"); if ($("[name=regPhone]").hasClass("validate")) $("[name=regPhone]").addClass("validate") } if ($("#mobiles").find("li").length > 0) { $("[name=regMobile]").removeClass("required"); $("[name=regMobile]").removeClass("validate") } else { if ($("[name=regMobile]").hasClass("required")) $("[name=regMobile]").addClass("required"); if ($("[name=regMobile]").hasClass("validate")) $("[name=regMobile]").addClass("validate") } if (!validateAll($("#registerForm"))) return; var e = true; $("[name=regPhone]").val($.trim($("[name=regPhone]").val())); if ($("#phones").find("li").length == 0 && $("[name=regPhone]").val() != "") { $("#phones").append("<li style='margin:3px;width:120px; float:right; ' class='ui-state-default ui-corner-top' ><a id=delete name='smsItems' style='float:right' class='ui-icon ui-icon-close'>حذف</a><label name='num' class='ui-tabs-anchor' >" + $("[name=regPhone]").val() + "</label></li>"); $("#phones").find("span[name=msg]").addClass("invisible") } $("[name=regMobile]").val($.trim($("[name=regMobile]").val())); if ($("#phones").find("li").length == 0) { if ($.trim($("input[name=regPhone]").val()) != "") { $("#addPhone").click() } else { if ($("#phones").find("span[name=msg]").length > 0) $("#phones").find("span[name=msg]").removeClass("invisible"); else $("#phones").append("<span name='msg' style='color: #FF0000'>ثبت شماره تلفن ضروری می باشد.</span>"); e = false } } if ($("#mobiles").find("li").length == 0) { if ($.trim($("input[name=regMobile]").val()) != "") { $("#addMobile").click() } else { if ($("#mobiles").find("span[name=msg]").length > 0) $("#mobiles").find("span[name=msg]").removeClass("invisible"); else $("#mobiles").append("<span name='msg' style='color: #FF0000'>ثبت شماره موبایل ضروری می باشد.</span>"); e = false } } if (!e) { $("#result").html("پر کردن موارد ستاره دار ضروری است. لطفاً اطلاعات خواسته شده را کامل و صحیح وارد کنید."); return } else $("#result").html(""); var t = []; var n = []; $("#phones").find("label[name=num]").each(function () { t.push($(this).html()) }); $("#mobiles").find("label[name=num]").each(function () { n.push($(this).html()) }); if ($("#btn_register").val() == "ثبت نام") { var r = { Email: $("[name=regEmail]").val(), Password: $("[name=regPassword]").val(), selectedValue: $("#regparent").find("[name=AddressId]").val(), Name: $("[name=regName]").val(), Family: $("[name=regFamily]").val(), BirthYear: $("[name=BirthYear]").val(), BirthMonth: $("[name=BirthMonth]").val(), BirthDay: $("[name=BirthDay]").val(), Gender: $("[name=regGender]").val(), AddressStr: $("[name=regAddressStr]").val(), PostalCode: $("[name=regPostalCode]").val(), Combo: $("#regparentJob").find("[name=Combo]").val(), phones: t, mobiles: n, FindBy: $("#FindBy").val(), regCity: $("#regCity").val() }; $.ajax({ type: "POST", url: "/Shopping/Register", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (e) { if (e.userInfo == undefined) { alert(e.msg); return } else { $("#registerForm").addClass("hidden"); $("#receiverInfo").removeClass("hidden"); $("#txt_name").val(e.userInfo.Name != null ? e.userInfo.Name : ""); $("#txt_family").val(e.userInfo.Family != null ? e.userInfo.Family : ""); $("#txt_address").val(e.userInfo.Address != null ? e.userInfo.Address : ""); $("#txt_tell").val(e.userInfo.phone); $("#txt_mobile").val(e.userInfo.mobile); $("#txt_postcode").val(e.userInfo.PostalCode != null ? e.userInfo.PostalCode : ""); $("#province").val(e.userInfo.ParentAddressId); BindProvinceCities(null, "city", e.userInfo.ParentAddressId, e.userInfo.AddressId) } }, error: function (e) { alert(e.responseText) } }) } else if ($("#btn_register").val() == "تکمیل ثبت نام") { var r = { Email: $("[name=regEmail]").val(), Password: $("[name=regPassword]").val(), selectedValue: $("#regparent").find("[name=AddressId]").val(), Name: $("[name=regName]").val(), Family: $("[name=regFamily]").val(), BirthYear: $("[name=BirthYear]").val(), BirthMonth: $("[name=BirthMonth]").val(), BirthDay: $("[name=BirthDay]").val(), Gender: $("[name=regGender]").val(), AddressStr: $("[name=regAddressStr]").val(), PostalCode: $("[name=regPostalCode]").val(), Combo: $("#regparentJob").find("[name=Combo]").val(), phones: t, mobiles: n, code: $("[name=code]").val(), FindBy: $("#FindBy").val(), regCity: $("#regCity").val() }; $.ajax({ type: "POST", url: "/Shopping/CompleteRegisteration", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (e) { if (e.userInfo == undefined) { alert(e.msg); return } else { $("#registerForm").addClass("hidden"); $("#receiverInfo").removeClass("hidden"); $("#txt_name").val(e.userInfo.Name != null ? e.userInfo.Name : ""); $("#txt_family").val(e.userInfo.Family != null ? e.userInfo.Family : ""); $("#txt_address").val(e.userInfo.Address != null ? e.userInfo.Address : ""); $("#txt_tell").val(e.userInfo.phone); $("#txt_mobile").val(e.userInfo.mobile); $("#txt_postcode").val(e.userInfo.PostalCode != null ? e.userInfo.PostalCode : ""); $("#province").val(e.userInfo.ParentAddressId); BindProvinceCities(null, "city", e.userInfo.ParentAddressId, e.userInfo.AddressId) } }, error: function (e) { alert(e.responseText) } }) } } function BackToPrvPage() { history.back() } function LoadShoppingCart() { bindDropDownList({ controller: "Shopping", method: "GetProvinces", selectedval: "2", name: "city", defaultText: "---" }, "province", null); $("#province").unbind().change(function () { BindProvinceCities("city", "city", $("#province").val()) }); BindProvinceCities(null, "city", "2"); $.ajax({ type: "POST", url: "/Home/GetCurrShamsiDatePlusDay", contentType: "application/json; charset=utf-8", success: function (e) { if (e.isdone) { $("#txt_dateSend").datepicker({ changeMonth: true, changeYear: true, onClose: function () { validateAll($("#newRecieverInfo")) } }); $("#txt_dateSend").datepicker("option", "minDate", e.currShamsi) } else alert(e.msg) }, error: function (e) { } }); $("#onlinePayment").attr("checked", true); $("#onlinePaymentDesc").removeClass("hidden"); $("input[name=paymenttype]").unbind().change(function () { if ($(this).attr("id") == "onlinePayment") { $("#onlinePaymentDesc").removeClass("hidden"); $("#payToCartDesc").addClass("hidden"); $("#payAfterReceiveDesc").addClass("hidden") } else if ($(this).attr("id") == "payToCart") { $("#onlinePaymentDesc").addClass("hidden"); $("#payToCartDesc").removeClass("hidden"); $("#payAfterReceiveDesc").addClass("hidden") } else if ($(this).attr("id") == "payAfterReceive") { $("#onlinePaymentDesc").addClass("hidden"); $("#payToCartDesc").addClass("hidden"); $("#payAfterReceiveDesc").removeClass("hidden") } }); $("#btn_confirmOrder").unbind().click(function () { if (validateAll($("#newRecieverInfo")) && $("#newSenderInfo").hasClass("hidden") || validateAll($("#newRecieverInfo")) && !$("#newSenderInfo").hasClass("hidden") && validateAll($("#newSenderInfo"))) { if ($("input[id=myself]").is(":checked")) { if ($("input[id=female]").is(":checked") == false && $("input[id=male]").is(":checked") == false) { alert("جنسیت را انتخاب کنید."); return } } else if ($("input[id=others]").is(":checked")) { if ($("input[id=sfemale]").is(":checked") == false && $("input[id=smale]").is(":checked") == false) { alert("جنسیت را انتخاب کنید."); return } } $("#btn_confirmOrder").parents("form").get(0).submit() } }); $("tr[name=shopDetailtr]").each(function () { if ($(this).find("select[name=colors]").length > 0 && $(this).find("select[name=colors]").attr("id").replace("color", "") != "") $(this).find("select[name=colors]").val($(this).find("select[name=colors]").attr("id").replace("color", "")); if ($(this).find("select[name=sizes]").length > 0 && $(this).find("select[name=sizes]").attr("id").replace("size", "") != "") $(this).find("select[name=sizes]").val($(this).find("select[name=sizes]").attr("id").replace("size", "")); if ($(this).find("select[name=quantity]").length > 0 && $(this).find("select[name=quantity]").html() != "") { $(this).find("select[name=quantity]").val($(this).find("select[name=quantity]").attr("id").replace("quantity", "")) } }); $("[name=colors]").unbind().change(function () { SetItemDetailSizeAndQuantity($(this)) }); $("[name=sizes]").unbind().change(function () { SetItemDetailQuantityForSize($(this)) }); $("[name=quantity]").unbind().change(function () { var e = $(this).parents("tr"); var t = $(this).parents("td").attr("id").replace("q", ""); var n = { shopdetailId: t, quantity: $(this).val(), colorId: e.find("select[name=colors]").val(), sizeId: e.find("select[name=sizes]").val() }; $.ajax({ type: "POST", url: "/Shopping/EditShoppingCartDetail", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (t) { if (t.isdone == true) { SetTotalQuantity(e) } else alert(t.msg) }, error: function (e) { alert(e.responseText) } }) }); $("#btn_fastSubmitShoppingCart").unbind().click(function () { var e = false; $("#myself").attr("checked", true); $("#txt_giftnote").val(""); $("#isGift").attr("checked", false); $("#gift").attr("checked", false); $("#giftInfoTr").addClass("hidden"); $("#recGender").removeClass("hidden"); $("#female").addClass("required"); $("#male").addClass("required"); $("[name=sendto]").unbind().change(function () { if ($(this).attr("id") == "myself") { $("#newSenderInfo").addClass("hidden"); $("#recGender").removeClass("hidden"); $("#srecGender").addClass("hidden"); $("#female").addClass("required"); $("#male").addClass("required"); $("#sfemale").removeClass("required"); $("#smale").removeClass("required"); $("#txt_giftnote").val(""); $("#isGift").attr("checked", false); $("#gift").attr("checked", false); $("#giftInfoTr").addClass("hidden") } else { $("#newSenderInfo").removeClass("hidden"); $("#recGender").addClass("hidden"); $("#srecGender").removeClass("hidden"); $("#sfemale").addClass("required"); $("#smale").addClass("required"); $("#female").removeClass("required"); $("#male").removeClass("required"); $("#giftInfoTr").removeClass("hidden") } }); $("tr[name=shopDetailtr]").each(function () { if ($(this).find("select[name=colors]").val() == "" && $(this).find("select[name=colors]").find("option").length > 1) { e = true; if (!$(this).hasClass("warning")) $(this).addClass("warning") } if ($(this).find("select[name=sizes]").val() == "" && $(this).find("select[name=sizes]").find("option").length > 1) { e = true; if (!$(this).hasClass("warning")) $(this).addClass("warning") } if ($(this).find("select[name=quantity]").val() == "0" && $(this).find("select[name=quantity]").find("option").length > 1) { e = true; if (!$(this).hasClass("warning")) $(this).addClass("warning") } if ($(this).find("select[name=quantity]").find("option").length <= 1 && $(this).find("#subscrQuantity").length == 0 && $(this).find("select[name=colors]").find("option").length <= 1 && $(this).find("select[name=sizes]").find("option").length <= 1) { var t = $(this).find("[name=delete]").attr("id"); DeleteShoppingDetail(t) } if (!e) $(this).removeClass("warning") }); if (e) { alert("تعداد کالا صحیح نمی باشد."); return } $("#btn_fastSubmitShoppingCart").addClass("hidden"); $("#btn_submitShoppingCart").addClass("hidden"); $("#login").addClass("hidden"); $("#notLoggedOptions").removeClass("hidden"); $("#receiverInfo").removeClass("hidden") }); $("#btn_submitShoppingCart").unbind().click(function () { var e = false; $("tr[name=shopDetailtr]").each(function () { if ($(this).find("select[name=colors]").val() == "" && $(this).find("select[name=colors]").find("option").length > 1) { e = true; if (!$(this).hasClass("warning")) $(this).addClass("warning") } if ($(this).find("select[name=sizes]").val() == "" && $(this).find("select[name=sizes]").find("option").length > 1) { e = true; if (!$(this).hasClass("warning")) $(this).addClass("warning") } if ($(this).find("select[name=quantity]").val() == "0" && $(this).find("select[name=quantity]").find("option").length > 1) { e = true; if (!$(this).hasClass("warning")) $(this).addClass("warning") } if ($(this).find("select[name=quantity]").find("option").length <= 1 && $(this).find("#subscrQuantity").length == 0 && $(this).find("select[name=colors]").find("option").length <= 1 && $(this).find("select[name=sizes]").find("option").length <= 1) { var t = $(this).find("[name=delete]").attr("id"); DeleteShoppingDetail(t) } if (!e) $(this).removeClass("warning") }); if (e) { alert("تعداد کالا صحیح نمی باشد."); return } $.ajax({ type: "POST", async: false, url: "/Shopping/CurrentUserInfo", contentType: "application/json; charset=utf-8", success: function (e) { if (e.islogin == true) { if (e.userInfo == undefined) { alert(msg); return } else { $("#btn_fastSubmitShoppingCart").addClass("hidden"); $("#btn_submitShoppingCart").addClass("hidden"); $("#receiverInfo").removeClass("hidden"); $("#login").addClass("hidden"); $("#receiverInfo").removeClass("hidden"); $("#txt_name").val(e.userInfo.Name != null ? e.userInfo.Name : ""); $("#txt_family").val(e.userInfo.Family != null ? e.userInfo.Family : ""); $("#txt_address").val(e.userInfo.Address != null ? e.userInfo.Address : ""); $("#txt_tell").val(e.userInfo.phone); $("#txt_mobile").val(e.userInfo.mobile); $("#txt_postcode").val(e.userInfo.PostalCode != null ? e.userInfo.PostalCode : ""); $("#province").val(e.userInfo.provinceId); BindProvinceCities(null, "city", e.userInfo.provinceId, e.userInfo.AddressId); $("#logonedSendToOthers").removeClass("hidden"); $("#userMyself").attr("checked", true); $("#giftInfoTr").addClass("hidden"); $("#logonedSendToOthers").find("[name=userSendto]").unbind().change(function () { if ($(this).attr("id") == "userMyself") { $("#giftInfoTr").addClass("hidden"); $.ajax({ type: "POST", async: false, url: "/Shopping/CurrentUserInfo", contentType: "application/json; charset=utf-8", success: function (e) { if (e.islogin == true) { if (e.userInfo == undefined) { alert(msg); return } else { $("#btn_fastSubmitShoppingCart").addClass("hidden"); $("#btn_submitShoppingCart").addClass("hidden"); $("#receiverInfo").removeClass("hidden"); $("#login").addClass("hidden"); $("#receiverInfo").removeClass("hidden"); $("#txt_name").val(e.userInfo.Name != null ? e.userInfo.Name : ""); $("#txt_family").val(e.userInfo.Family != null ? e.userInfo.Family : ""); $("#txt_address").val(e.userInfo.Address != null ? e.userInfo.Address : ""); $("#txt_tell").val(e.userInfo.phone); $("#txt_mobile").val(e.userInfo.mobile); $("#txt_postcode").val(e.userInfo.PostalCode != null ? e.userInfo.PostalCode : ""); $("#province").val(e.userInfo.provinceId); BindProvinceCities(null, "city", e.userInfo.provinceId, e.userInfo.AddressId); validateAll($("#newRecieverInfo")); $("#txt_giftnote").val(""); $("#isGift").attr("checked", false); $("#gift").attr("checked", false) } } } }) } else { $("#giftInfoTr").removeClass("hidden"); $("#newRecieverInfo").find("input[type=text]").each(function () { $(this).val("") }); $("#newRecieverInfo").find("input[type=checkbox]").each(function () { $(this).attr("checked", false) }); $("#newRecieverInfo").find("textarea").each(function () { $(this).val("") }) } }) } } else { $("#btn_fastSubmitShoppingCart").addClass("hidden"); $("#btn_submitShoppingCart").addClass("hidden"); $("#login").removeClass("hidden") } }, error: function (e) { alert(e.responseText) } }) }); $("#btnLogin").unbind().click(function () { var e = { username: $("[name=UserName]").val(), password: $("[name=Password]").val() }; $.ajax({ type: "POST", url: "/Shopping/Login", contentType: "application/json; charset=utf-8", data: JSON.stringify(e), success: function (e) { if (e.userInfo == undefined) { alert(e.msg); return } else { $("#login").addClass("hidden"); $("#receiverInfo").removeClass("hidden"); $("#txt_name").val(e.userInfo.Name != null ? e.userInfo.Name : ""); $("#txt_family").val(e.userInfo.Family != null ? e.userInfo.Family : ""); $("#txt_address").val(e.userInfo.Address != null ? e.userInfo.Address : ""); $("#txt_tell").val(e.userInfo.phone); $("#txt_mobile").val(e.userInfo.mobile); $("#txt_postcode").val(e.userInfo.PostalCode != null ? e.userInfo.PostalCode : ""); $("#province").val(e.userInfo.provinceId); BindProvinceCities(null, "city", e.userInfo.provinceId, e.userInfo.AddressId); $("#logonedSendToOthers").removeClass("hidden"); $("#userMyself").attr("checked", true); $("#giftInfoTr").addClass("hidden"); $("#logonedSendToOthers").find("[name=userSendto]").unbind().change(function () { if ($(this).attr("id") == "userMyself") { $("#giftInfoTr").addClass("hidden"); $.ajax({ type: "POST", async: false, url: "/Shopping/CurrentUserInfo", contentType: "application/json; charset=utf-8", success: function (e) { if (e.islogin == true) { if (e.userInfo == undefined) { alert(msg); return } else { $("#btn_fastSubmitShoppingCart").addClass("hidden"); $("#btn_submitShoppingCart").addClass("hidden"); $("#receiverInfo").removeClass("hidden"); $("#login").addClass("hidden"); $("#receiverInfo").removeClass("hidden"); $("#txt_name").val(e.userInfo.Name != null ? e.userInfo.Name : ""); $("#txt_family").val(e.userInfo.Family != null ? e.userInfo.Family : ""); $("#txt_address").val(e.userInfo.Address != null ? e.userInfo.Address : ""); $("#txt_tell").val(e.userInfo.phone); $("#txt_mobile").val(e.userInfo.mobile); $("#txt_postcode").val(e.userInfo.PostalCode != null ? e.userInfo.PostalCode : ""); $("#province").val(e.userInfo.provinceId); BindProvinceCities(null, "city", e.userInfo.provinceId, e.userInfo.AddressId); validateAll($("#newRecieverInfo")); $("#txt_giftnote").val(""); $("#isGift").attr("checked", false); $("#gift").attr("checked", false) } } } }) } else { $("#giftInfoTr").removeClass("hidden"); $("#newRecieverInfo").find("input[type=text]").each(function () { $(this).val("") }); $("#newRecieverInfo").find("input[type=checkbox]").each(function () { $(this).attr("checked", false) }); $("#newRecieverInfo").find("textarea").each(function () { $(this).val("") }) } }) } }, error: function (e) { alert(e.responseText) } }) }); $("[name=Register]").unbind().click(function () { bindDropDownList({ controller: "Shopping", method: "GetProvinces", selectedval: "2", name: "regCity", defaultText: "---" }, "regProvince", null); $("#regProvince").unbind().change(function () { BindProvinceCities("regCity", "regCity", $("#regProvince").val()) }); BindProvinceCities(null, "regCity", "2"); $("#registerForm").removeClass("hidden"); $("#login").addClass("hidden") }); $("[id=sendMemberCode]").unbind().click(function () { $("[name=mobileForsms]").val($.trim($("[name=mobileForsms]").val())); if ($("[name=mobileForsms]").val() == "") { $("#sendCodeResult").html("شماره موبایل را وارد کنید."); return } var e = { mobile: $("[name=mobileForsms]").val() }; $.ajax({ type: "POST", url: "/Account/sendMemberCodeToMobile", contentType: "application/json; charset=utf-8", data: JSON.stringify(e), success: function (e) { $("#sendCodeResult").html(e.msg) }, error: function (e) { alert(e.responseText) } }) }); $("[name=StartRegisterByCode]").unbind().click(function () { $("#login").addClass("hidden"); $("#completeRegisterationForm").removeClass("hidden") }); $("#StartRegisterByCode").unbind().click(function () { $("#completeRegisterationForm").addClass("hidden"); StartCompleteRegisteration() }); $("#addPhone").unbind().click(function () { if (validateAll($("[name=regPhone]").parent("td"))) { $("[name=regPhone]").val($.trim($("[name=regPhone]").val())); if ($("[name=regPhone]").val() != "") { $("#phones").append("<li style='margin:3px;width:120px; float:right; ' class='ui-state-default ui-corner-top' ><a id=delete name='smsItems' style='float:right' class='ui-icon ui-icon-close'>حذف</a><label name='num' class='ui-tabs-anchor' >" + $("[name=regPhone]").val() + "</label></li>"); $("#phones").find("span[name=msg]").addClass("invisible"); $("[id=delete]").addClass("cursor").unbind().click(function () { $(this).parents("li").remove() }) } } }); $("#addMobile").unbind().click(function () { if (validateAll($("[name=regMobile]").parent("td"))) { $("[name=regMobile]").val($.trim($("[name=regMobile]").val())); if ($("[name=regMobile]").val() != "") { $("#mobiles").append("<li style='margin:3px;width:120px; float:right; ' class='ui-state-default ui-corner-top' ><a id=delete name='smsItems' style='float:right' class='ui-icon ui-icon-close'>حذف</a><label name='num' class='ui-tabs-anchor' >" + $("[name=regMobile]").val() + "</label></li>"); $("#mobiles").find("span[name=msg]").addClass("invisible"); $("[id=delete]").addClass("cursor").unbind().click(function () { $(this).parents("li").remove() }) } } }); $("[id=delete]").addClass("cursor").unbind().click(function () { $(this).parents("li").remove() }); $("#btn_register").unbind().click(function () { RegisterFromShoppingCart() }); $("#onlinePayment").attr("checked", true) } function MenuClick(e) { $("#top_nav").find("li[name=menu]").find("a").each(function () { $(this).removeClass("selected") }); e.parents("li[name=menu]").first("a").addClass("selected") } var sortid; $(document).ajaxStart(function () { loadingStart() }); $(document).ajaxStop(function () { loadingEnd(); $("[name=delete]").unbind().click(function () { var e = $(this).attr("id"); DeleteShoppingDetail(e) }) }); $(document).ready(function () { $("#back-top").hide(); $(function () { $(window).scroll(function () { if ($(this).scrollTop() > 500) { $("#back-top").fadeIn() } else { $("#back-top").fadeOut() } }); $("#back-top a").click(function () { $("body,html").animate({ scrollTop: 0 }, 800); return false }) }); $(".box-category li").last().addClass("last"); $.ajax({ type: "POST", url: "/Home/TodayDate", contentType: "application/json; charset=utf-8", success: function (e) { if (e.isdone) { $("#date").find("span").html(e.date) } }, error: function (e) { } }); $("input[name=culture]").click(function () { $(this).parents("form").submit() }); $("input[name=culture]:checked").next().css("font-weight", "bold"); $(".nav-menu li").unbind().click(function () { var e = $(this).find("a").attr("id"); $(this).parents("ul").find("li").each(function () { if ($(this).find("a").attr("id") != e) $(this).find("a").removeClass("active") }); $(this).find("a").addClass("active") }); $("#shoppingCart").unbind().click(function () { ShowShoppingCartSummery() }); $("#continue").click(function () { $("#shoppingCartSumm").addClass("hidden") }); $("#isNew").unbind().change(function () { var e = getParameterByName("categoryId"); var t = getParameterByName("txtSearch"); var n = getParameterByName("isOffer"); var r = getParameterByName("isSale"); if ($(this).is(":checked")) window.location = "../Home/GetCategoryItems?categoryId=" + e + "&txtSearch=" + t + "&isNew=true&isOffer=" + n + "&isSale=" + r; else window.location = "../Home/GetCategoryItems?categoryId=" + e + "&txtSearch=" + t + "&isNew=false&isOffer=" + n + "&isSale=" + r }); $("#isSale").unbind().change(function () { var e = getParameterByName("categoryId"); var t = getParameterByName("txtSearch"); var n = getParameterByName("isOffer"); var r = getParameterByName("isNew"); if ($(this).is(":checked")) window.location = "../Home/GetCategoryItems?categoryId=" + e + "&txtSearch=" + t + "&isNew=" + r + "&isOffer=" + n + "&isSale=true"; else window.location = "../Home/GetCategoryItems?categoryId=" + e + "&txtSearch=" + t + "&isNew=" + r + "&isOffer=" + n + "&isSale=false" }); $("#isOffer").unbind().change(function () { var e = getParameterByName("categoryId"); var t = getParameterByName("txtSearch"); var n = getParameterByName("isSale"); var r = getParameterByName("isNew"); if ($(this).is(":checked")) window.location = "../Home/GetCategoryItems?categoryId=" + e + "&txtSearch=" + t + "&isNew=" + r + "&isOffer=true&isSale=" + n; else window.location = "../Home/GetCategoryItems?categoryId=" + e + "&txtSearch=" + t + "&isNew=" + r + "&isOffer=false&isSale=" + n }); $("#top_nav").find("li[name=menu]").each(function () { $(this).find("a").click(function () { MenuClick($(this)) }) }); $(".button-search").unbind().click(function () { $(this).parent("form").submit() }) }); var first = true
