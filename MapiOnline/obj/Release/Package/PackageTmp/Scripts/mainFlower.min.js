function AddToShoppingCart(e, t, n, r, i) { var s = { barcodeId: e, count: t, sizeId: n, colorId: r }; $.ajax({ type: "POST", url: "/Shopping/AddToShoppingCart", contentType: "application/json; charset=utf-8", data: JSON.stringify(s), success: function (t) { if (t.hascolorsize) { window.location = "../Home/ProductDetails?productId=" + e + "&technicalInfo=general" } else if (t.totalQuantity * 1 > 0) { var n = $("#shoppingCart"); var r = ""; if (i.parents("[name=itemContainer]").find("#img" + e).find(".productImg").length > 0) r = i.parents("[name=itemContainer]").find("#img" + e).find(".productImg").eq(0); else r = $(".addToCart").parents(".news_box_left").find("#zoom_03").eq(0); if (r) { var s = r.clone().offset({ top: r.offset().top, left: r.offset().left }).css({ opacity: "0.5", position: "absolute", height: "150px", width: "150px", "z-index": "100" }).appendTo($("body")).animate({ top: n.offset().top + 140, left: n.offset().left + 140, width: 75, height: 75 }, 1e3, "easeInOutExpo"); setTimeout(function () { n.effect("shake", { times: 2 }, 200) }, 1500); s.animate({ width: 0, height: 0 }, function () { $(this).detach() }) } ShowShoppingCartSummery(); setTimeout("window.scrollTo(0, " + 0 + ")", 800) } else alert("این تعداد از کالای انتخاب شده موجود نمی باشد.") }, error: function (e) { alert(e.responseText) } }) } function SetTotalQuantity(e) { $.ajax({ type: "POST", url: "/Shopping/GetTotalQuantity", contentType: "application/json; charset=utf-8", success: function (t) { $("#cart-total").html(t.quantity); $("#itemsCount").html(t.quantity + " کالا, " + t.finalAmount + " تومان"); if (e != undefined && e != null) e.find("[name=totalPrice]").html(e.find("[name=onePrice]").html() * 1 * e.find("[name=quantity]").val() * 1); if ($("[id=totalAmount]").length > 0) { $("#itemsCount").html(t.quantity + " کالا, " + t.finalAmount + " تومان"); $("[id=totalAmount]").html(t.totalAmount); $("[id=discount]").html(t.discount); $("[id=finalAmount]").html(t.finalAmount) } }, error: function (e) { alert("خطا در ذخیره تعداد کالا، لطفاً دوباره تلاش کنید.") } }) } function ShowShoppingCartSummery() { $.ajax({ type: "POST", url: "/Shopping/ShoppingCartSummary", success: function (e) { $("#cartBody").html(""); if (e.isdone) { if (e.details.length > 0) { for (var t = 0; t < e.details.length; t++) { var n = e.details[t]; $("#cartBody").append("<tr><td class='image'>" + "<a href='../Home/ProductDetails?productId=" + n.BarcodeId + "'>" + "<img src='../../../Data/" + (n.ApplicationName == "/" ? "" : n.ApplicationName) + "Photos/" + n.Barcode + "/tiny_1.jpg' alt='" + n.Name + "' title='" + n.Name + "' style='width:47px; height:47px;'></a></td>" + "<td class='name'>" + "<a href='#'>" + n.Name + "</a>" + "<div></div><span class='quantity'>x</span><span class='quantity'> " + n.Quantity + " " + n.UnitType + "</span><span class='total'> " + n.Price + "<span> تومان</span></span> </td>" + " <td class='remove'><span>" + "<img  title='Remove' name='delete' id='" + n.ShoppingCartDetailsId + "' alt='Remove' src='../../Content/Green/image/close.png'></span></td>" + "</tr>") } $("#cart-total").html(e.quantity); $("#itemsCount").html(e.quantity + " کالا, " + e.finalAmount + " تومان"); $("[id=totalAmount]").html(e.totalAmount); $("[id=discount]").html(e.discount); $("[id=finalAmount]").html(e.finalAmount); $(".linkShopBag").removeClass("hidden") } else { $("#shoppingCartDetails").append("سبد خرید خالی است."); $(".linkShopBag").addClass("hidden") } } else { $("#shoppingCartDetails").append(e.msg); $(".linkShopBag").addClass("hidden") } $("#shoppingCartSumm").removeClass("hidden") }, dataType: "json" }) } function CheckShoppingCart() { $.ajax({ type: "POST", url: "/Shopping/CheckShoppingCart", success: function (e) { if (e.result != undefined && e.result == true) $(".finishOrder").removeClass("hidden"); else $(".finishOrder").addClass("hidden") }, dataType: "json", error: function (e) { alert(e.responseText) } }) } function DeleteShoppingDetail(e) { var t = { shopdetailId: e }; $.ajax({ type: "POST", url: "/Shopping/DeleteShoppingCartDetail", contentType: "application/json; charset=utf-8", data: JSON.stringify(t), success: function (t) { if (t.isdone == true) { if (t.cartDeleted) window.location = "../Home/Index"; else { $("#" + e).parents("tr").remove(); SetTotalQuantity() } } else alert(t.msg) }, error: function (e) { alert(e.responseText) } }) } function SetCustomizedBouquetTotalPrice() { var e = 0; var t = ""; var n = ""; var r = ""; $("#decorationDiv").find("[name=proBox]").each(function () { if ($(this).find("input[name=decoration]").attr("checked")) { e = e * 1 + $(this).find("[name=decpriceSpan]").html() * 1; t = $(this).parents("td").find("#hDecName").html(); r = $(this).parents("td").find("#hDecName").html() } }); t += " ("; $("#flowersDiv").find("[name=proBox]").each(function () { e = e * 1 + $(this).find("[name=priceSpan]").html() * 1 * $(this).find("[name=countDdl]").val() * 1; if ($(this).find("[name=countDdl]").val() > 0) { t += " تعداد " + $(this).find("[name=countDdl]").val() + " شاخه " + $(this).parents("td").find("#hFlowerName").html() + "."; n += " تعداد " + $(this).find("[name=countDdl]").val() + " شاخه " + $(this).parents("td").find("#hFlowerName").html() + "." } }); t += " )"; $("[id=bouquetDesc]").html(t != " ( )" ? t : "موردی انتخاب نشده است."); $("[id=bouquetprice]").html(e); $("[id=selectedFlwSpan]").html(n != "" ? n : "موردی انتخاب نشده است."); $("[id=selectedDecSpan]").html(r != "" ? r : "موردی انتخاب نشده است.") } function addCustomizedBouquetToBasket() { var e = []; var t = ""; var n = ""; $("#flowersDiv").find("[name=proBox]").each(function () { var t = {}; if ($(this).find("[name=countDdl]").val() > 0) { n = "yes"; t["productId"] = $(this).find("[name=priceSpan]").attr("id").replace("qprice", ""); $("input[name=Qualities" + t["productId"] + "]").each(function () { if ($(this).attr("checked")) { t["quality"] = $(this).attr("id").replace("Quality", "") } }); t["count"] = $(this).find("[name=countDdl]").val(); t["price"] = $(this).find("[name=priceSpan]").html(); e.push(t) } }); $("[name=decoration]").each(function () { if ($(this).attr("checked")) { t = $(this).attr("id").replace("decoration", "") } }); if (n == "yes" && t != "") { var r = { flowerslist: e, decorationId: t }; $.ajax({ type: "POST", url: "/Flower/AddCustomizedBouquetToShopCart", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (e) { if (e.totalQuantity > 0) { ShowShoppingCartSummery(); $("[name=countDdl]").val("0"); $("input[name=decoration]").attr("checked", false); $("#bouquetprice").html("0"); $("#bouquetDesc").html(" ( )") } }, error: function (e) { alert(e.responseText) } }) } else { var i = ""; if (n != "yes" && t == "") i = "تزیین و شاخه گل های دسته گل را انتخاب کنید."; else if (n != "yes") i = "شاخه گل های دسته گل را انتخاب کنید."; else if (t == "") i = "تزیین دسته گل را انتخاب کنید."; alert(i) } } function loadFlowerSubscription() { $("input[id=Quality2]").each(function () { $(this).attr("checked", true); $(this).parents("div[name=proBox]").find("[name=itemprice]").html($(this).attr("value")) }); $("input[id*=Quality]").unbind().change(function () { if ($(this).is(":checked")) { $(this).parents("div[name=proBox]").find("[name=itemprice]").html($(this).attr("value")) } }); $.ajax({ type: "POST", url: "/Home/GetCurrShamsiDatePlusDay", contentType: "application/json; charset=utf-8", success: function (e) { if (e.isdone) { $("#txtDateFrom").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#txtDateTo").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"] + 1, t["selectedDay"])) }, onClose: function () { SetSubscriptionTotalPriceDesc() } }); $("#txtDateFrom").datepicker("option", "minDate", e.currShamsi); $("#txtDateTo").datepicker({ changeMonth: true, changeYear: true, onClose: function () { SetSubscriptionTotalPriceDesc() } }) } else alert(e.msg) }, error: function (e) { } }); $("#tblDays").find("input[type=checkbox]").unbind().change(function () { SetSubscriptionTotalPriceDesc() }); SetSubscriptionTotalPriceDesc(); $("[name=countDdl]").unbind().change(function () { SetSubscriptionTotalPriceDesc() }); $("#btnSave").unbind().click(function () { addFlowerSubscriptionToShoppingCart() }) } function SetSubscriptionTotalPriceDesc() { var e = 0; var t = ""; $("#flowersDiv").find("[name=proBox]").each(function () { if ($(this).find("[name=countDdl]").val() > 0) { e = e * 1 + $(this).find("[name=itemprice]").html() * $(this).find("[name=countDdl]").val() * 1 } if ($(this).find("[name=countDdl]").val() > 0) { t += " تعداد " + $(this).find("[name=countDdl]").val() + " شاخه " + $(this).parents("td").find("#hFlowerName").html(); $(this).parents("td").find("input[id*=Quality]").each(function () { if ($(this).is(":checked")) t += $(this).attr("id").replace("Quality", "") == 1 ? " درجه 1 " : $(this).attr("id").replace("Quality", "") == 2 ? " درجه 2 " : " درجه 3 " }); t += ". " } }); var n = SetFlowerSubscriptionTotalAmount(); e = e * 1 * n * 1; $("#subscriptionDesc").html(t); $("#subscriptionPrice").html(e); $("#daysCount").html(n) } function addFlowerSubscriptionToShoppingCart() { var e = []; var t = ""; $("#flowersDiv").find("[name=proBox]").each(function () { var n = {}; if ($(this).find("[name=countDdl]").val() > 0) { t = "yes"; n["productId"] = $(this).find("[name=itemprice]").attr("id").replace("qprice", ""); $("input[name=Qualities" + n["productId"] + "]").each(function () { if ($(this).attr("checked")) { n["sizeId"] = $(this).attr("sizeId").replace("sizeId", "") } }); n["count"] = $(this).find("[name=countDdl]").val(); n["price"] = $(this).find("[name=itemprice]").html(); e.push(n) } }); var n = []; $("#tblDays").find("input[type=checkbox]").each(function () { if ($(this).is(":checked")) { n.push($(this).attr("id")) } }); if (t == "yes" && $.trim($("#txtDateFrom").val()) != "" && $.trim($("#txtDateTo").val()) != "" && n.length > 0) { var r = { flowerslist: e, daysArr: n, startStr: $.trim($("#txtDateFrom").val()), endStr: $.trim($("#txtDateTo").val()) }; $.ajax({ type: "POST", url: "/Flower/AddFlowerSubscriptionToShoppingCart", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (e) { if (e.totalQuantity > 0) { ShowShoppingCartSummery(); $("#subscriptionDesc").html(""); $("#subscriptionPrice").html("0"); $("#daysCount").html("0"); $("[name=countDdl]").val("0"); $("#tblDays").find("input[type=checkbox]").attr("checked", false); $("#txtDateFrom").val(""); $("#txtDateTo").val("") } }, error: function (e) { alert(e.responseText) } }) } else { var i = ""; if (t != "yes" && $.trim($("#txtDateFrom").val()) == "" && $.trim($("#txtDateTo").val()) == "" && n.length == 0) i = "شاخه گل ها و تاریخ و روزهای اشتراک را انتخاب کنید."; else if (t != "yes" && $.trim($("#txtDateFrom").val()) != "" && $.trim($("#txtDateTo").val()) != "" && n.length > 0) i = "شاخه گل ها را انتخاب کنید."; else if (t == "yes" && ($.trim($("#txtDateFrom").val()) == "" || $.trim($("#txtDateTo").val()) == "" || n.length == 0)) i = "تاریخ و روزهای اشتراک را انتخاب کنید."; alert(i) } } function SetFlowerSubscriptionTotalAmount() { if ($.trim($("#txtDateFrom").val()) != "" && $.trim($("#txtDateTo").val()) != "") { var e = []; $("#tblDays").find("input[type=checkbox]").each(function () { if ($(this).is(":checked")) { e.push($(this).attr("id")) } }); if (e != undefined && e.length > 0) return CountDays(e, $.trim($("#txtDateFrom").val()), $.trim($("#txtDateTo").val())) } return 0 } function CountDays(e, t, n) { var r = { daysArr: e, startStr: t, endStr: n }; var i = 0; $.ajax({ type: "POST", async: false, url: "/Flower/CountDays", contentType: "application/json;", dataType: "json", data: JSON.stringify(r), success: function (e) { if (e.isdone) { i = e.count } else { i = 0 } }, error: function (e) { alert(e.responseText) } }); return i } function Register() { $("#Name").val($.trim($("#Name").val())); $("#Family").val($.trim($("#Family").val())); $("#AddressStr").val($.trim($("#AddressStr").val())); $("#Email").val($.trim($("#Email").val())); if ($("#phones").find("li").length > 0) { $("[name=Phone]").removeClass("required"); $("[name=Phone]").removeClass("validate") } else { if ($("[name=Phone]").hasClass("required")) $("[name=Phone]").addClass("required"); if ($("[name=Phone]").hasClass("validate")) $("[name=Phone]").addClass("validate") } if ($("#mobiles").find("li").length > 0) { $("[name=Mobile]").removeClass("required"); $("[name=Mobile]").removeClass("validate") } else { if ($("[name=Mobile]").hasClass("required")) $("[name=Mobile]").addClass("required"); if ($("[name=Mobile]").hasClass("validate")) $("[name=Mobile]").addClass("validate") } if (!validateAll($("#registerForm"))) return; var e = true; if ($("#phones").find("li").length == 0) { if ($.trim($("input[name=Phone]").val()) != "") { $("#addPhone").click() } else { if ($("#phones").find("span[name=msg]").length > 0) $("#phones").find("span[name=msg]").removeClass("invisible"); else $("#phones").append("<span name='msg' style='color: #FF0000'>ثبت شماره تلفن ضروری می باشد.</span>"); e = false } } if ($("#mobiles").find("li").length == 0) { if ($.trim($("input[name=Mobile]").val()) != "") { $("#addMobile").click() } else { if ($("#mobiles").find("span[name=msg]").length > 0) $("#mobiles").find("span[name=msg]").removeClass("invisible"); else $("#mobiles").append("<span name='msg' style='color: #FF0000'>ثبت شماره موبایل ضروری می باشد.</span>"); e = false } } if (!e) { $("#result").html("پر کردن موارد ستاره دار ضروری است. لطفاً اطلاعات خواسته شده را کامل و صحیح وارد کنید."); return } else $("#result").html(""); var t = []; var n = []; $("#phones").find("label[name=num]").each(function () { t.push($(this).html()) }); $("#mobiles").find("label[name=num]").each(function () { n.push($(this).html()) }); $.ajax({ type: "POST", url: "/Account/Register", data: $("form").serialize() + "&phones=" + t + "&mobiles=" + n, success: function (e) { if (e.logged) window.location.replace(e.link); else $("#result").html(e.msg) }, dataType: "json" }) } function AddMobile() { if (validateAll($("[name=Mobile]").parent("td"))) { $("[name=Mobile]").val($.trim($("[name=Mobile]").val())); if ($("[name=Mobile]").val() != "") { $("#mobiles").append("<li style='margin:3px;width:120px; float:right; ' class='ui-state-default ui-corner-top' ><a id=delete name='smsItems' style='float:right' class='ui-icon ui-icon-close'>حذف</a><label name='num' class='ui-tabs-anchor' >" + $("[name=Mobile]").val() + "</label></li>"); $("#mobiles").find("span[name=msg]").addClass("invisible"); $("[id=delete]").addClass("cursor").unbind().click(function () { $(this).parents("li").remove() }) } } }
