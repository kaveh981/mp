function getHelp() { var e = $("#mainTab").find(".top-nav").find(".ui-tabs-active").find("a").attr("mainTab"); var t = $("[aria-expanded='true']").find("[subTab]").find(".ui-tabs-active").find("a").attr("id"); if (t == undefined && (e == "a_FullAcountReport" || e == "a_Accounting")) t = "store"; else if (t == undefined && (e != "a_FullAcountReport" || e != "a_Accounting")) return alert("زیر منو انتخاب نشده است"); var n = { mainTab: e, subTab: t, lang: $lang.val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(n), type: "Post", url: "Management/getHelp", success: function (e) { if (e.canEdit) { $("#dialogHelp").find("#help").html("<textarea class='editor' name='text1'>" + (e.isDone ? e.result : "") + "</textarea></n><button id='btnSaveHelp'>save</button>"); $(".editor").tinymce({ script_url: "../../Scripts/tinymce/tiny_mce.js", width: "100%", height: "500px", directionality: "rtl", theme: "advanced", verify_html: false, plugins: "pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template,wordcount,advlist,autosave", theme_advanced_buttons1: "save,newdocument,|,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,styleselect,formatselect,fontselect,fontsizeselect", theme_advanced_buttons2: "cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,image,cleanup,help,code,|,insertdate,inserttime,preview,|,forecolor,backcolor", theme_advanced_buttons3: "tablecontrols,|,hr,removeformat,visualaid,|,sub,sup,|,charmap,emotions,iespell,media,advhr,|,print,|,ltr,rtl,|,fullscreen", theme_advanced_buttons4: "insertlayer,moveforward,movebackward,absolute,|,styleprops,|,cite,abbr,acronym,del,ins,attribs,|,visualchars,nonbreaking,template,pagebreak,restoredraft,codehighlighting,netadvimage", theme_advanced_toolbar_location: "top", theme_advanced_toolbar_align: "right", theme_advanced_statusbar_location: "bottom", theme_advanced_resizing: false, save_onsavecallback: function () { AddHelp() }, content_css: "../../Scripts/tinymce/css/content.css", convert_urls: false }); $("#btnSaveHelp").button().unbind("click").bind("click", function () { AddHelp() }) } else { $("#dialogHelp").html(e.isDone ? "<div style='padding-left:5em;'>" + e.result + "</div>" : "") } $("#dialogHelp").dialog({ width: 800, height: 500 }).dialog("open") }, error: function (e) { alert(e.responseText) } }) } function AddHelp() { var e = $("#mainTab").find(".top-nav").find(".ui-tabs-active").find("a").attr("mainTab"); var t = $("div:not([class='invisible'])").find("[subTab]").find("[tabIndex='0']").find("a:visible:first").attr("id"); if (t == undefined && (e == "a_FullAcountReport" || e == "a_Accounting")) t = "store"; var n = { mainTab: e, subTab: t, help: $("[name='text1']").val(), lang: $lang.val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(n), type: "Post", url: "Management/addHelp", success: function (e) { translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function masterLocalize() { $.each($("[mllk]"), function () { var e = $(this); if (e.find(".ui-button-text").length > 0) e.find(".ui-button-text").text(langs[e.attr("mllk")][$("#ddl_m_Language").val()]); else { if (langs[e.attr("mllk")] != undefined) e.text(langs[e.attr("mllk")][$("#ddl_m_Language").val()]) } }) } function isAuthenticated(e) { if (e != null && e.isExpired) { $("#loginBox").dialog({ modal: true, autoOpen: false, buttons: { "ورود": function () { userLogin("loginBox") } } }).dialog("open"); return false } return true } function newSort(e, t, n) { if (t != undefined && n.container != "dialog") $con = $("#" + t); if (n.container != undefined && n.container == "dialog") $con = $("#" + n.container + t); $con.find("a[rel=sort]").die("click").live("click", function () { $con.find("a[rel=sort]").removeClass("sorted"); $(this).addClass("sorted"); if (this.id == sortid.split(" ")[0].toString()) { if (sortid.split(" ")[1] == "DESC") sortid = this.id + " ASC"; else sortid = this.id + " DESC" } else { sortid = this.id + " DESC" } e(t, n) }) } function Sort(e, t, n) { if (t.container == undefined) $con = $("#" + t); else if (t.container != undefined && t.pagingContainer != undefined) $con = $("#" + t.container + t.pagingContainer); else $con = $("#" + t.container); $con.find("a[rel=sort]").die("click").live("click", function () { $con.find("a[rel=sort]").removeClass("sorted"); $(this).addClass("sorted"); if (this.id == sortid.split(" ")[0].toString()) { if (sortid.split(" ")[1] == "DESC") sortid = this.id + " ASC"; else sortid = this.id + " DESC" } else { sortid = this.id + " DESC" } e(t, n) }) } function getfocusOnEnter(e) { if (event.keyCode == 13) document.getElementById(e).focus() } function userLogin(e) { var t = $("#" + e); var n = { userName: t.find("#username").val(), password: t.find("#password").val() }; $.ajax({ type: "POST", url: "/Management/UserLogin", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (n) { if (n.logged && e == "loginBox") { $(".fixed_elem").css("background-color", "#E4FFCC"); if ($("#loginBox").dialog().dialog("isOpen")) $("#loginBox").dialog("close"); if ($("#empCode").val() != n.code) { $("#signin-form").hide(); $("#userDefault").removeClass("hidden"); $("#lbl_d_UserName").html(n.name + " " + n.family); var r = $("#userDefault").find("#ddl_s_Branch"); document.title = n.name + " " + n.family; if (!n.isAdmin) { bindItemsForSelectCombo({ servicename: "Management", methodname: "getShopNameByUser", headertext: "انتخاب شعبه", id: "ddl_s_Branch", container: "userDefault", selectedindex: 1, async: false }); r.change(function () { if ($(this).val() != "") bindItemsForSelectCombo({ servicename: "Management", methodname: "getCounterNameByUser", headertext: "انتخاب صندوق", id: "ddl_m_Counter", container: "userDefault" }, { arg: r.val() }) }); bindItemsForSelectCombo({ servicename: "Management", methodname: "getCounterNameByUser", headertext: "انتخاب صندوق", id: "ddl_m_Counter", container: "userDefault", selectedindex: 1 }, { arg: r.val() }); bindItemsForSelectCombo({ servicename: "Management", methodname: "getCurrencyName", headertext: "انتخاب ارز", id: "ddl_m_Currency", container: "userDefault", selectedindex: 1 }); t.find("#username").val(""); t.find("#password").val("") } location.reload(true) } return } if (n.logged) { $(".fixed_elem").css("background-color", "#E4FFCC"); $("#container").html(""); $("body").remove("#container"); $("#signin-form,#heading").hide(); $("#signin").css("background", "none"); $("#userDefault").removeClass("hidden"); $("#empCode").val(n.code); $("#lbl_d_UserName").html(n.name + " " + n.family); var r = $("#userDefault").find("#ddl_s_Branch"); document.title = n.name + " " + n.family; if (!n.isAdmin) { bindItemsForSelectCombo({ servicename: "Management", methodname: "getShopNameByUser", headertext: "انتخاب شعبه", id: "ddl_s_Branch", container: "userDefault", selectedindex: 1, async: false }); r.change(function () { if ($(this).val() != "") bindItemsForSelectCombo({ servicename: "Management", methodname: "getCounterNameByUser", headertext: "انتخاب صندوق", id: "ddl_m_Counter", container: "userDefault" }, { arg: r.val() }) }); bindItemsForSelectCombo({ servicename: "Management", methodname: "getCounterNameByUser", headertext: "انتخاب صندوق", id: "ddl_m_Counter", container: "userDefault", selectedindex: 1 }, { arg: r.val() }); bindItemsForSelectCombo({ servicename: "Management", methodname: "getCurrencyName", headertext: "انتخاب ارز", id: "ddl_m_Currency", container: "userDefault", selectedindex: 1 }) } GetMenuItems(); GetSubMenuItems(); SetHeight(); jQuery.fn.center = function () { this.css("top", 24 + "px"); this.animate({ left: ($(window).width() - this.outerWidth()) / 2 + $(window).scrollLeft() + "px" }, 100); return this }; $("#userDefault").find("#an_m_SignOut").die("click").live("click", function (t) { userSignOut(e) }); setInterval(function () { resetApp() }, 18e4) } else { if (n.isSignout) return; alert(n.errorMessage) } } }) } function userSignOut(e) { var t = $("#" + e); $.ajax({ type: "POST", url: "/Account/LogOff", contentType: "application/json; charset=utf-8", success: function (e) { $("#signin-form").show(); $("#userDefault").addClass("hidden"); $("#lbl_d_UserName").html(""); $("#lbl_d_UserName").html(""); t.find("#password").val(""); $("#mainTab").tabs("destroy").html(""); $("#rightMenuAccordion").html(""); location.reload(true) }, error: function (e) { alert(e.responseText) } }) } function tableStyle() { $(".tablescroll").addClass("red"); $(".tablescroll_body > tbody > tr").addClass("ui-state-default"); $(".tablescroll_body > tbody > tr").mouseover(function () { $(this).addClass("ui-state-hover") }); $(".tablescroll_body > tbody > tr").mouseout(function () { $(this).removeClass("ui-state-hover") }) } function SetHeight() { $(".mainbody").css("min-height", $(window).height() - 50) } function replaceNull() { $("table").find('td:contains("null")').each(function () { var e = $(this); e.html(e.html().replace("null", "-")) }) } function windowResize() { clearTimeout(resizeTimer); resizeTimer = setTimeout(setModalInfoHeight, 600) } function sliderClick(e) { var t = $("#pdToggleImage").attr("src") == "App_Themes/Default/Images/shevron_expand.gif" ? "App_Themes/Default/Images/shevron_collapse.gif" : "App_Themes/Default/Images/shevron_expand.gif"; $("#pdToggleImage").attr("src", t); $("#" + e).slideToggle("fast") } function onRowClick(e) { $('tr[id*="tr"]').removeClass("rowOnClick"); e.addClass("rowOnClick") } function bindSizeColor(e, t, n, r, i) { var s = "<table id='tbSizeColor_" + i.prop("id") + "' name='SieColor' class='QuantityTable' title='orderDetail' ></table>"; i.html(s); var o = document.getElementById("tbSizeColor_" + i.prop("id")); var u = document.createElement("tbody"); var a = document.createElement("tr"); var f = document.createElement("tr"); var l = document.createElement("td"); var c = document.createElement("td"); var h = document.createElement("td"); var p = document.createElement("td"); o.appendChild(u); u.appendChild(a); u.appendChild(f); a.appendChild(h); a.appendChild(p); f.appendChild(c); f.appendChild(l); var d = document.createElement("input"); d.setAttribute("name", "quantity"); d.setAttribute("id", "" + "-" + ""); d.setAttribute("title", "بدون سایز و رنگ"); l.appendChild(d); c.appendChild(document.createTextNode("   ")); h.appendChild(document.createTextNode("   ")); p.appendChild(document.createTextNode("   ")); var v = e.length; if (v > 0) { for (var m = 0; m < v; m++) { var g = e[0, m]; var y = g.Size; var b = g.SizeId == undefined ? "" : g.SizeId; var w = document.createElement("td"); var E = document.createElement("input"); E.setAttribute("name", "quantity"); E.setAttribute("title", "بدون رنگ" + "_" + y); E.setAttribute("id", "" + "-" + b); w.appendChild(E); a.appendChild(w); var S = document.createElement("td"); S.setAttribute("id", "cell"); var x = document.createElement("input"); x.setAttribute("value", y); x.setAttribute("name", b); x.setAttribute("title", y); x.setAttribute("id", "txtSize" + m * 1); S.appendChild(x); f.appendChild(S) } } if (t.length > 0) { var T = t.length; for (var m = 0; m < T; m++) { var g = t[0, m]; var y = g.Color; var b = g.ColorId == undefined ? "" : g.ColorId; var N = document.createElement("tr"); N.setAttribute("id", "row" + m * 1); u.appendChild(N); var C = document.createElement("td"); C.setAttribute("id", "cell" + m); var E = document.createElement("input"); E.setAttribute("name", "quantity"); E.setAttribute("title", y + "_" + "بدون سایز"); E.setAttribute("id", b + "-" + ""); C.appendChild(E); N.appendChild(C); var S = document.createElement("td"); S.setAttribute("id", "cell" + m); var k = document.createElement("input"); k.style.backgroundColor = y; k.setAttribute("id", "txtColor" + m * 1 + 1); k.setAttribute("value", y); k.setAttribute("name", b); k.setAttribute("title", y); S.appendChild(k); N.appendChild(S); for (var L = 0; L < e.length; L++) { var A = e[0, L]; var O = A.Size == undefined ? "" : A.Size; var M = A.SizeId == undefined ? "" : A.SizeId; var S = document.createElement("td"); S.setAttribute("id", "cell" + L); var E = document.createElement("input"); E.setAttribute("name", "quantity"); E.setAttribute("title", y + "_" + O); E.setAttribute("id", b + "-" + M); S.appendChild(E); N.appendChild(S) } } } } function readItemDetailQuantitys(e, t) { if (t != undefined) $con = $("#" + t).find("#" + e); else $con = $("#" + e); var n = []; $con.find("input[name=quantity]").each(function () { if (this.value != "") { var e = {}; var t = {}; e = this.id.split("-"); t["ColorID"] = e[0]; t["SizeID"] = e[1]; t["Quantity"] = this.value; n.push(t); t = null } }); return n } function getTotalQuantity(e, t) { if (t != undefined) $con = $("#" + t).find("#" + e); else $con = $("#" + e); var n = 0; $con.find("input[name='quantity']").each(function () { if (this.value != "") { n += this.value * 1 } }); return n } function loadOnlineCategories(e, t) { var n = $("#" + e); if (t) { n.find("#treeDemo").attr("id", "treeDemo" + e); var r = "treeDemo" + e; $.fn.zTree.init(n.find("#" + r), Categorysetting); CategoryzTree = $.fn.zTree.getZTreeObj(r); n.find("#btn_Refresh").off().on("click", function () { $.fn.zTree.init(n.find("#" + r), Categorysetting); CategoryzTree = $.fn.zTree.getZTreeObj(r) }); n.find("#btn_saveCategory").off().on("click", function () { }).button({ icons: { primary: "ui-icon-disk" }, text: true }); n.find("#editDialog").attr("id", "editDialog" + e); $("#toggle").button().click(function () { if ($("#accordion").accordion("option", "icons")) { $("#accordion").accordion("option", "icons", null) } else { $("#accordion").accordion("option", "icons", i) } }); var i = { header: "ui-icon-circle-arrow-e", activeHeader: "ui-icon-circle-arrow-s" }; n.find("#accordion").accordion({ icons: i, heightStyle: "content", collapsible: true, active: false, change: function (e, t) { if (t.newContent.length > 0 && t.newContent.html().length < 1) { var r = $(t.newHeader).attr("categoryId"); BuildCategoriesAccordion(r, n.find("#accContent" + r), n, false) } } }).sortable({ axis: "y", stop: function (e, t) { t.item.children("h3").triggerHandler("focusout"); SortCategories(t.item, n) } }); n.find("#frm_Category").ajaxForm({ success: function (e) { if (e.isdone) { if (e.isEdit) { CategoryEditTreeNode(e.name, e.isCheck, e.id) } else { var t = { name: e.name, id: e.id, isChecked: e.isCheck }; categoryaddNewTreeNode(t) } } else alert(e.msg) }, complete: function (e) { } }) } localize() } function CategorygetFont(e, t) { return t.font ? t.font : {} } function CategoryonAsyncSuccess(e, t, n, r) { var i = "frm_Category"; var s = $("#" + i); s.find(".zTreeDemoBackground li:even").css("background-color", "#FFFFFF"); s.find(".zTreeDemoBackground li:odd").css("background-color", "#E6F2FF") } function CategorybeforeDrag(e, t) { for (var n = 0, r = t.length; n < r; n++) { if (t[n].drag === false) { return false } } return true } function categoryOnDrop(e, t, n, r, i) { var s = []; for (var o = 0; o < n.length; o++) { s[o] = n[o].id } var u = []; var a; if (r) { if (r.children == undefined) if (r.getParentNode() != null) { a = r.getParentNode().children; $.each(a, function () { u.push(this.id) }) } else { var f = CategoryzTree.getNodesByFilter(filterzTree); $.each(f, function () { u.push(this.id) }) } else { a = r.children; $.each(a, function () { u.push(this.id) }) } } else { var f = CategoryzTree.getNodesByFilter(filterzTree); $.each(f, function () { u.push(this.id) }) } var l = { TableName: "category", TargetId: r == null ? null : i == "inner" ? r.id : r.getParentNode() == null ? null : r.getParentNode().id, treeNodes: s, children: u }; $.ajax({ type: "POST", async: false, url: "Management/TreeDaragDrop", contentType: "application/json; charset=utf-8", data: JSON.stringify(l), success: function (e) { if (e.isdone) alert(e.msg) }, error: function (e) { alert(e.responseText) } }) } function categoryonClick(e, t, n) { var r = "frm_Category"; var i = $("#" + r); i.find("#hi_isEdit").val(true); i.find("#hi_SelectedParentCatId").val(n.id); GetCategoryForEdit(n.id); i.find("#btn_saveCategory").button({ icons: { primary: "ui-icon-disk" }, text: true, label: "edit" }); localize() } function categorybeforeRemove(e, t) { var n = "frm_Category"; var r = $("#" + n); var i = false; if (confirm("Confirm delete node '" + t.name + "' it?")) { var s = t.id; var o = { TableName: "category", id: s }; $.ajax({ type: "POST", async: false, url: "Management/DeleteTree", contentType: "application/json; charset=utf-8", data: JSON.stringify(o), success: function (e) { i = e.isdone; r.find("#hi_isEdit").val(true); r.find("#hi_SelectedParentCatId").val(t.id); GetCategoryForEdit(t.id); r.find("#btn_saveCategory").button({ icons: { primary: "ui-icon-disk" }, text: true, label: "add" }) }, error: function (e) { alert(e.responseText) } }) } return i } function categorybeforeEditName(e, t, n, r) { var i = "frm_Category"; var s = $("#" + i); s.find("#hi_isEdit").val(true); s.find("#hi_SelectedParentCatId").val(t.id); GetCategoryForEdit(t.id); CategoryzTree.selectNode(t); return false } function categoryonRename(e, t, n, r) { var i = "frm_Category"; var s = $("#" + i); s.find("#hi_isEdit").val(true); s.find("#hi_SelectedParentCatId").val(n.id); GetCategoryForEdit(n.id) } function CategoryremoveHoverDom(e, t) { var n = "frm_Category"; var r = $("#" + n); r.find("#addBtn_" + t.tId).unbind().remove() } function CategoryaddHoverDom(e, t) { var n = "frm_Category"; var r = $("#" + n); var i = r.find("#" + t.tId + "_span"); if (t.editNameFlag || r.find("#addBtn_" + t.tId).length > 0) return; var s = "<span class='button add' id='addBtn_" + t.tId + "' title='add node' onfocus='this.blur();'></span>"; i.after(s); var o = r.find("#addBtn_" + t.tId); if (o) o.bind("click", function () { r.find("#btn_saveCategory").button({ icons: { primary: "ui-icon-disk" }, text: true, label: "add" }); localize(); r.find("#hi_isEdit").val(false); r.find("#hi_SelectedParentCatId").val(t.id); r.find("#txt_name").val(""); r.find("#txt_quantity").val(""); r.find("#txt_description").val(""); r.find("#chk_ShowCategory").attr("checked", false); CategoryzTree.selectNode(t); return false }) } function categoryonDblClick(e, t, n) { var r = "frm_Category"; var i = $("#" + r); i.find("#hi_isEdit").val(false); i.find("#hi_SelectedParentCatId").val("0"); i.find("#txt_name").val(""); i.find("#txt_quantity").val(""); i.find("#txt_description").val(""); i.find("#chk_ShowCategory").attr("checked", false); i.find("#btn_saveCategory").button({ icons: { primary: "ui-icon-disk" }, text: true, label: "addroot" }); CategoryzTree.cancelSelectedNode(n); localize() } function CategoryEditTreeNode(e, t, n) { var r = CategoryzTree.getSelectedNodes()[0]; r.name = e; r.isChecked = t; CategoryzTree.updateNode(r) } function categoryaddNewTreeNode(e) { if (CategoryzTree.getSelectedNodes()[0] && $("#hi_SelectedParentCatId").val() != "0" && $("#hi_SelectedParentCatId").val() != "") { $("#hi_SelectedParentCatId").val(CategoryzTree.getSelectedNodes()[0].id); e.checked = CategoryzTree.getSelectedNodes()[0].checked; CategoryzTree.addNodes(CategoryzTree.getSelectedNodes()[0], e) } else { CategoryzTree.addNodes(null, e) } } function categoryonCheck(e, t, n) { var r = n.id; var i = { tableName: "category", Id: r, show: n.isChecked }; $.ajax({ type: "POST", async: false, url: "Management/ChangeshowTreeNodeRec", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (e) { if (e.isdone) { alert(e.msg) } }, error: function (e) { alert(e.responseText) } }) } function GetCategoryForEdit(e) { var t = { TableName: "Category", Id: e }; var n = "div_Details"; var r = $("#" + n); $.ajax({ type: "POST", async: false, url: "Management/getTreeItem", contentType: "application/json; charset=utf-8", data: JSON.stringify(t), success: function (e) { var t = e.ShowOnline != null ? e.ShowOnline : false; $("#txt_name").val(e.Category); $("#txt_quantity").val(e.Quantity); $("#txt_description").val(e.Description); $("#hi_SelectedParentCatId").val(e.CategoryId); $("#chk_ShowCategory").attr("checked", e.ShowOnline) }, error: function (e) { alert(e.responseText) } }) } function loadOnlineMenu(e, t) { $con = $("#" + e); if (t) { $con.find("#treeDemo").attr("id", "treeDemo" + e); var n = "treeDemo" + e; $.fn.zTree.init($con.find("#" + n), OnlineMenusetting); onlineMenuzTree = $.fn.zTree.getZTreeObj(n); $con.find("#btn_Refresh").off().on("click", function () { $.fn.zTree.init($con.find("#" + n), OnlineMenusetting); onlineMenuzTree = $.fn.zTree.getZTreeObj(n) }); $con.find("#dialogAddMenu").attr("id", "dialogAddMenu" + e); var r = $con.find("#dialogAddMenu" + e); $con.find("#btn_new").button({ icons: { primary: "ui-icon-plusthick"} }).unbind().click(function () { r.find("#ddl_m_MenuLocation").val("side"); r.find("#btn_save").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { AddMenu(r, e, null) }); r.dialog(open).dialog({ width: 500 }) }); if (r.find("#ddl_m_IsLink").prop("checked")) r.find("#liTxtLinkTo").toggleClass("hidden"); r.find("#ddl_m_IsLink").change(function () { r.find("#liTxtLinkTo").toggleClass("hidden") }); $con.find("#btn_newBottom").button({ icons: { primary: "ui-icon-plusthick"} }).unbind().click(function () { r.find("#ddl_m_MenuLocation").val("bottom"); r.find("#btn_save").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { AddMenu(r, e, null) }); r.dialog(open).dialog({ width: 500 }) }); $con.find("#btn_saveOnlineMenu").off().on("click", function () { }).button({ icons: { primary: "ui-icon-disk" }, text: true }); $con.find("#chk_islink").unbind("change").change(function () { if (this.checked) $con.find("#txta_linkTo").prop("disabled", false); else { $con.find("#txta_linkTo").prop("disabled", true); $con.find("#txta_linkTo").val("") } }); $con.find("#frm_OnlineMenu").ajaxForm({ success: function (e) { if (e.isDone) { if (e.isEdit) { OnlineMenuEditTreeNode(e.name, e.isCheck, e.id) } else { var t = { name: e.name, id: e.id, isChecked: e.isCheck }; OnlineMenuaddNewTreeNode(t) } } else alert(e.msg) }, complete: function (e) { } }); localize() } } function onlineMenugetFont(e, t) { return t.font ? t.font : {} } function onlineMenuonAsyncSuccess(e, t, n, r) { var i = "frm_OnlineMenu"; var s = $("#" + i); s.find(".zTreeDemoBackground li:even").css("background-color", "#FFFFFF"); s.find(".zTreeDemoBackground li:odd").css("background-color", "#E6F2FF") } function OnlineMenubeforeDrag(e, t) { for (var n = 0, r = t.length; n < r; n++) { if (t[n].drag === false) { return false } } return true } function OnlineMenuaddHoverDom(e, t) { var n = "frm_OnlineMenu"; var r = $("#" + n); var i = r.find("#" + t.tId + "_span"); if (t.editNameFlag || r.find("#addBtn_" + t.tId).length > 0) return; var s = "<span class='button add' id='addBtn_" + t.tId + "' title='add node' onfocus='this.blur();'></span>"; i.after(s); var o = r.find("#addBtn_" + t.tId); if (o) o.bind("click", function () { r.find("#btn_saveOnlineMenu").button({ icons: { primary: "ui-icon-disk" }, text: true, label: "add" }); localize(); r.find("#hi_isEdit").val(false); r.find("#hi_SelectedParentMenuId").val(t.id); r.find("#txt_Menuname").val(""); r.find("#chk_islink").prop("checked", false); r.find("#txta_linkTo").val(""); r.find("#select_menuLocation").val(-1); r.find("#txt_order").val(""); r.find("#txt_lang").val(""); r.find("#chk_newPage").prop("checked", false); r.find("#chk_Show").prop("checked", false); onlineMenuzTree.selectNode(t); return false }) } function onlineMenuClick(e, t, n) { var r = "frm_OnlineMenu"; var i = $("#" + r); i.find("#hi_isEdit").val(true); i.find("#hi_SelectedParentMenuId").val(n.id); GetOnlineMenuForEdit(n.id); i.find("#btn_saveOnlineMenu").button({ icons: { primary: "ui-icon-disk" }, text: true, label: "edit" }); localize() } function GetOnlineMenuForEdit(e) { var t = "frm_OnlineMenu"; var n = $("#" + t); var r = { TableName: "onlineMenu", lang: "per", Id: e }; $.ajax({ type: "POST", async: false, url: "Management/getTreeItem", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (e) { if (!isAuthenticated(e)) return; n.find("#txt_Menuname").val(e.menuName); n.find("#chk_islink").prop("checked", e.isLink == "true" ? true : false); n.find("#chk_Show").prop("checked", e.show == "true" ? true : false); n.find("#txta_linkTo").html(e.linkTo); n.find("#chk_newPage").prop("checked", e.newPage == "true" ? true : false); n.find("#select_menuLocation").val(e.menuLocation == "side" ? 0 : 1); n.find("#txt_order").val(e.order); n.find("#txt_lang").val(e.lang); n.find("#hi_SelectedParentMenuId").val(e.id); if (!e.isRoot) { n.find("#select_menuLocation").html(""); n.find("#select_menuLocation").prop("disabled", true) } else { if (n.find("#select_menuLocation").html() == "") { n.find("#select_menuLocation").html('<option value="0">side</option><option value="1">bottom</option>'); n.find("#select_menuLocation").prop("disabled", false) } } }, error: function (e) { alert(e.responseText) } }) } function filterzTree(e) { return e.level == 0 } function OnlineMenuOnDrop(e, t, n, r, i) { var s = []; for (var o = 0; o < n.length; o++) { s[o] = n[o].id } var u = []; var a; if (r) { if (r.children == undefined) if (r.getParentNode() != null) { a = r.getParentNode().children; $.each(a, function () { u.push(this.id) }) } else { var f = onlineMenuzTree.getNodesByFilter(filterzTree); $.each(f, function () { u.push(this.id) }) } else { a = r.children; $.each(a, function () { u.push(this.id) }) } } else { var f = onlineMenuzTree.getNodesByFilter(filterzTree); $.each(f, function () { u.push(this.id) }) } var l = { TableName: "onlineMenu", TargetId: r == null ? null : i == "inner" ? r.id : r.getParentNode() == null ? null : r.getParentNode().id, treeNodes: s, children: u }; $.ajax({ type: "POST", async: false, url: "Management/TreeDaragDrop", contentType: "application/json; charset=utf-8", data: JSON.stringify(l), success: function (e) { if (e.isdone) alert(e.msg) }, error: function (e) { alert(e.responseText) } }) } function OnlineMenubeforeRemove(e, t) { var n = "frm_OnlineMenu"; var r = $("#" + n); var i = false; if (confirm("Confirm delete node '" + t.name + "' it?")) { var s = t.id; var o = { TableName: "onlineMenu", id: s }; $.ajax({ type: "POST", async: false, url: "Management/DeleteTree", contentType: "application/json; charset=utf-8", data: JSON.stringify(o), success: function (e) { i = e.isdone; r.find("#hi_isEdit").val(false); r.find("#hi_SelectedParentMenuId").val("0"); r.find("#btn_saveOnlineMenu").button({ icons: { primary: "ui-icon-disk" }, text: true, label: "add" }); alert(e.msg) }, error: function (e) { alert(e.responseText) } }) } return i } function OnlineMenubeforeEditName(e, t, n, r) { var i = "frm_OnlineMenu"; var s = $("#" + i); s.find("#hi_isEdit").val(true); s.find("#hi_SelectedParentMenuId").val(t.id); GetCategoryForEdit(t.id); onlineMenuzTree.selectNode(t); return false } function OnlineMenuonRename(e, t, n, r) { var i = "frm_OnlineMenu"; var s = $("#" + i); s.find("#hi_isEdit").val(true); s.find("#hi_SelectedParentMenuId").val(n.id); GetCategoryForEdit(n.id) } function OnlineMenuremoveHoverDom(e, t) { var n = "frm_OnlineMenu"; var r = $("#" + n); r.find("#addBtn_" + t.tId).unbind().remove() } function OnlineMenuonDblClick(e, t, n) { var r = "frm_OnlineMenu"; var i = $("#" + r); i.find("#hi_isEdit").val(false); i.find("#hi_SelectedParentMenuId").val("0"); i.find("#txt_Menuname").val(""); i.find("#chk_islink").prop("checked", false); i.find("#txta_linkTo").val(""); i.find("#select_menuLocation").val(-1); i.find("#txt_order").val(""); i.find("#txt_lang").val(""); i.find("#chk_newPage").prop("checked", false); i.find("#chk_Show").prop("checked", false); i.find("#btn_saveOnlineMenu").button({ icons: { primary: "ui-icon-disk" }, text: true, label: "addroot" }); onlineMenuzTree.cancelSelectedNode(n); localize() } function OnlineMenuEditTreeNode(e, t, n) { var r = onlineMenuzTree.getSelectedNodes()[0]; r.name = e; r.isChecked = t; onlineMenuzTree.updateNode(r) } function OnlineMenuaddNewTreeNode(e) { var t = "frm_OnlineMenu"; var n = $("#" + t); if (onlineMenuzTree.getSelectedNodes()[0] && n.find("#hi_SelectedParentMenuId").val() != "0" && n.find("#hi_SelectedParentMenuId").val() != "") { n.find("#hi_SelectedParentMenuId").val(onlineMenuzTree.getSelectedNodes()[0].id); e.checked = onlineMenuzTree.getSelectedNodes()[0].checked; onlineMenuzTree.addNodes(onlineMenuzTree.getSelectedNodes()[0], e) } else { onlineMenuzTree.addNodes(null, e) } } function OnlineMenuonCheck(e, t, n) { var r = n.id; var i = { tableName: "onlineMenu", Id: r, show: n.isChecked }; $.ajax({ type: "POST", async: false, url: "Management/ChangeshowTreeNodeRec", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (e) { if (e.isdone) { alert(e.msg) } }, error: function (e) { alert(e.responseText) } }) } function SortOnlineMenu(e, t) { var n = []; var r = 1; e.parent("div").children("h3").each(function () { var e = {}; e["id"] = $(this).attr("onlineMenuId"); e["Priority"] = r; r++; n.push(e) }); var i = { sortOnlineMenu: n }; $.ajax({ type: "POST", async: false, url: "Management/SortOnlineMenu", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (e) { }, error: function (e) { alert(e.responseText) } }) } function EditOnlineMenu(e, t, n) { var r = t; var i = { menuId: e, menuName: r.find("#txtMenuName").val(), isLink: r.find("#ddl_m_IsLink").prop("checked"), menuLocation: r.find("#ddl_m_MenuLocation").val(), linkTo: r.find("#txtLinkTo").val(), show: r.find("#ddl_m_Show").prop("checked"), lang: $lang.val(), newPage: r.find("#ddl_m_newPage").prop("checked") }; $.ajax({ type: "POST", data: JSON.stringify(i), url: "Management/EditMenu", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; if (e != null && e.isDone == "true") { alert(e.isDone); BuildOnlineMenuAccordion(null, $("#" + n).find("#accordion,#accordionBottom"), $("#" + n), true) } translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function AddMenu(e, t, n) { var r = e; var i = null; if (n != undefined) i = n.attr("onlineMenuId"); var s = { menuName: r.find("#txtMenuName").val(), isLink: r.find("#ddl_m_IsLink").prop("checked"), menuLocation: r.find("#ddl_m_MenuLocation").val(), linkTo: r.find("#txtLinkTo").val(), show: r.find("#ddl_m_Show").prop("checked"), lang: $lang.val(), newPage: r.find("#ddl_m_newPage").prop("checked"), parentId: i }; $.ajax({ type: "POST", data: JSON.stringify(s), url: "Management/AddMenu", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; if (e.isDone) { if (i != null) n.parents("h3").trigger("click"); else BuildOnlineMenuAccordion(null, $("#" + t).find("#accordion,#accordionBottom"), $("#" + t), true) } translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function DeleteMenu(e, t) { var n = $("#" + t); var r = { menuId: e.attr("onlineMenuId") }; $.ajax({ type: "POST", url: "Management/DeleteMenu", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (t) { if (!isAuthenticated(t)) return; if (t != null && t.isDone == true) e.parents("h3").remove(); translate(t.msg) }, error: function (e) { alert(e.responseText) } }) } function loadMenuPhotos(e, t, n) { var r = $("#" + t); if (n) { r.find("#fileInput").button(); r.find("#menuId").val(e); r.find("#btn_Submit").button().unbind("click").click(function () { ajaxFileUpload({ container: t, id: e, isMenu: true, size: r.find("#txt_m_Size").val() }) }); getMenuPhotos(e, t) } } function getMenuPhotos(menuId, container) { var $con = $("#" + container); var ItemList = ""; $.ajax({ type: "POST", url: "Management/getMenuPhotos", contentType: "application/json; charset=utf-8", data: "{ menuId:'" + menuId + "'}", success: function (response) { if (!isAuthenticated(response)) return; if (!response.hasPhoto) return response.msg; var List = typeof response.result == "string" ? eval("(" + response.result + ")") : response.result; var appName = response.appName; if (appName == "/") appName = ""; var ItemList = "<table id='sortable' >"; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<tr style='float:none; padding:0 0 30px;' class='cleaner' id='li" + i + "' ><td><div class='modalClose modalRemove'><a href='javascript:RemoveMenuPhoto(\"" + container + '","li' + i + '","' + menuId + "\");'/></div><img style='border:1px;'  title='" + val + "' alt='" + val + "' src='Data/" + appName + "MenuPhotos/" + val + "' /></td></tr><tr id='li" + i + "'><td><span source='" + "../../../Data/" + appName + "MenuPhotos/" + val + "' name='sourceName'></span></td></tr>" } ItemList += "</table>"; $con.find("#div_d_PhotoList").html(ItemList); $con.find("[name='sourceName']").each(function () { $(this).html($(this).attr("source")) }) }, error: function (e) { alert(e.responseText) } }) } function RemoveMenuPhoto(e, t, n) { var r = $("#" + e); var i = r.find("#" + t).find("img").attr("alt"); var s = { fileName: i, menuId: n }; var o = ""; $.ajax({ type: "POST", url: "Management/deleteMenuPhoto", contentType: "application/json; charset=utf-8", data: JSON.stringify(s), success: function (e) { if (!isAuthenticated(e)) return; if (e.isDone) { r.find("#sortable tr[id='" + t + "']").remove() } else alert(e.msg) }, error: function (e) { alert(e.responseText) } }) } function loadOnlineLogo(e, t) { var n = $("#" + e); if (t) { n.find("#fileInput").button(); n.find("#btn_Submit").button().unbind("click").click(function () { if (validateAll($("#" + e))) { ajaxFileUpload({ container: e, isMenu: false, isLogo: true }) } }); getOnlineLogo(e) } } function getOnlineLogo(container) { var $con = $("#" + container); var ItemList = ""; $.ajax({ type: "POST", url: "Management/getOnlineLogo", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; if (!response.hasPhoto) return response.msg; var List = typeof response.result == "string" ? eval("(" + response.result + ")") : response.result; var appName = response.appName; if (appName == "/") appName = ""; var ItemList = "<ul id='sortable' >"; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<li style='cursor:move; float:none;' id='li" + i + "' ><div class='modalClose modalRemove'><a href='javascript:RemoveOnlineLogo(\"" + container + '","li' + i + "\");'/></div><img style='border:1px;'  title='" + val + "' alt='" + val + "' src='Data/" + appName + "Logo/" + val + "' /></li>" } ItemList += "</ul>"; $con.find("#div_d_PhotoList").html(ItemList) }, error: function (e) { alert(e.responseText) } }) } function RemoveOnlineLogo(e, t) { var n = $("#" + e); var r = n.find("#" + t).children("img").prop("alt"); var i = ""; $.ajax({ type: "POST", url: "Management/deleteOnlineLogo", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; if (e.isDone) n.find("#sortable li[id='" + t + "']").remove(); else alert(e.msg) }, error: function (e) { alert(e.responseText) } }) } function loadPhotoStamp(e, t) { var n = $("#" + e); if (t) { n.find("#fileInput").button(); n.find("#btn_Submit").button().unbind("click").click(function () { if (validateAll($("#" + e))) { ajaxFileUpload({ container: e, isMenu: false, isStamp: true }) } }); getPhotoStamp(e) } } function getPhotoStamp(container) { var $con = $("#" + container); var ItemList = ""; $.ajax({ type: "POST", url: "Management/getPhotoStamp", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; if (!response.hasPhoto) return response.msg; var List = typeof response.result == "string" ? eval("(" + response.result + ")") : response.result; var appName = response.appName; if (appName == "/") appName = ""; var ItemList = "<ul id='sortable' >"; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<li style='cursor:move; float:none;' id='li" + i + "' ><div class='modalClose modalRemove'><a href='javascript:RemovePhotoStamp(\"" + container + '","li' + i + "\");'/></div><img style='border:1px;'  title='" + val + "' alt='" + val + "' src='Data/" + appName + "Stamp/" + val + "' /></li>" } ItemList += "</ul>"; $con.find("#div_d_PhotoList").html(ItemList) }, error: function (e) { alert(e.responseText) } }) } function RemovePhotoStamp(e, t) { var n = $("#" + e); var r = n.find("#" + t).children("img").prop("alt"); var i = ""; $.ajax({ type: "POST", url: "Management/deletePhotoStamp", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; if (e.isDone) n.find("#sortable li[id='" + t + "']").remove(); else alert(e.msg) }, error: function (e) { alert(e.responseText) } }) } function loadOnlineSliderShow(e, t) { var n = $("#" + e); if (t) { n.find("#editDialog").attr("id", "editDialog" + e); n.find("#fileInput").button(); n.find("#btn_Submit").button().unbind("click").click(function () { if (validateAll($("#" + e))) ajaxFileUpload({ container: e, isMenu: false, isLogo: false, isSlider: true }) }); BuildSliderShowAccordion(e) } } function BuildSliderShowAccordion(e) { var t = $("#" + e); $.ajax({ type: "POST", url: "Management/GetOnlineSliderShow", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; var n = { header: "ui-icon-circle-arrow-e", activeHeader: "ui-icon-circle-arrow-s" }; var r = t.find("#sortableSlider"); r.html(""); var i = e.appName; if (i == "/") i = ""; for (var s = 0; s < e.results.length; s++) { var o = e.results[s]; var u = o.id; r.append("<li style='cursor:move;margin: 0 3px 3px 3px; padding: 0.4em;' SliderShowId='" + o.id + "' class='ui-state-default'>" + "<span style='float:left;position:relative;top:42px;'  class='ui-icon ui-icon-arrowthick-2-n-s'></span><table width='98%' border='1 px' style='margin:5px;' cellpadding='2px'>" + "<tr><td width='15%'  scope='row'>عنوان:<span  id='accordion" + o.id + "'>" + o.title + " </span></td><td>توضیحات:<span>" + o.description + "</span></td>" + "<td width='22%' rowspan='2'><span><img  title='" + o.title + "' alt='" + o.title + "' src='Data/" + i + "SliderShow/tiny_" + o.file + ".jpg" + "' /></span></td><td class='red' width='5%'><span><button SliderShowId='" + o.file + o.id + "' id='btn_edit'>ویرایش</button></span></td></tr><tr>" + "<td  colspan='2' scope='row'>لینک به:<span>" + o.linkTo + "</span></td><td class='red' width='5%'><span><button SliderShowId='" + o.file + o.id + "' id='btn_delete'>deleteKey</button></span></td>" + "</tr></table>") } t.find("[id=btn_edit]").button({ icons: { primary: "ui-icon-pencil" }, text: true }).unbind("click").click(function () { GetOnlineSliderShowForEdit($(this), t); $("#editDialog" + t.attr("id")).dialog({ width: 300, height: 350 }).dialog("open"); $("#editDialog" + t.attr("id")).removeClass("invisible"); return false }); t.find("[id=btn_delete]").button({ icons: { primary: "ui-icon-closethick" }, text: true }).unbind("click").click(function () { DeleteOnlineSliderShow($(this), t); return false }); var n = { header: "ui-icon-circle-arrow-e", activeHeader: "ui-icon-circle-arrow-s" }; t.find("#sortableSlider").sortable({ stop: function (e, n) { n.item.children("li").triggerHandler("focusout"); SortSliderShow(n.item, t) } }) }, error: function (e) { alert(e.responseText) } }) } function SortSliderShow(e, t) { var n = []; var r = 1; e.parent("ul").children("li").each(function () { var e = {}; e["id"] = $(this).attr("SliderShowid"); e["Priority"] = r; r++; n.push(e) }); var i = { sortSliderShow: n }; $.ajax({ type: "POST", async: false, url: "Management/SortOnlineSliderShow", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (e) { }, error: function (e) { alert(e.responseText) } }) } function GetOnlineSliderShowForEdit(e, t) { var n = { SliderShowId: e.parents("li").attr("SliderShowId") }; $.ajax({ type: "POST", async: false, url: "Management/GetOnlineSliderShowForEdit", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (n) { $("#editDialog" + t.attr("id")).find("#txtTitle").val(n.title); $("#editDialog" + t.attr("id")).find("#txtLinkTo").val(n.linkTo); $("#editDialog" + t.attr("id")).find("#txtDescription").val(n.description); $("#editDialog" + t.attr("id")).find("#sliderInfo").val(n.sliderInfo); $("#editDialog" + t.attr("id")).find("#btn_save").button(); $("#editDialog" + t.attr("id")).find("#formSliderShow").ajaxForm({ data: { id: e.parents("li").attr("SliderShowId") }, success: function () { }, complete: function (e) { } }) }, error: function (e) { alert(e.responseText) } }) } function DeleteOnlineSliderShow(e, t) { var n = { SliderShowId: e.parents("li").attr("SliderShowId") }; $.ajax({ type: "POST", async: false, url: "Management/DeleteOnlineSliderShow", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (t) { if (t.isDone) e.parents("li").remove() }, error: function (e) { alert(e.responseText) } }) } function getOnlineSliderShow(container) { var $con = $("#" + container); var ItemList = ""; $.ajax({ type: "POST", url: "Management/GetOnlineSliderShow", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; if (!response.hasPhoto) return response.msg; var List = typeof response.lphotos == "string" ? eval("(" + response.lphotos + ")") : response.lphotos; var appName = response.appName; if (appName == "/") appName = ""; var ItemList = "<ul id='sortable'>"; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<li style='cursor:move;width:280px;' id='li" + i + "' class='ui-state-default'><div class='modalClose modalRemove'><a href='javascript:RemoveOnlineSliderShow(\"" + container + '","li' + i + "\");'/></div><img  title='" + val + "' alt='" + val + "' src='Data/" + appName + "SliderShow/" + val + "' /></li>" } ItemList += "</ul>"; $con.find("#div_d_PhotoList").html(ItemList); $("#sortable").sortable().sortable({ stop: function (e, t) { sortOnlineSliderShow(container) } }) }, error: function (e) { alert(e.responseText) } }) } function sortOnlineSliderShow(container) { var $con = $("#" + container); var photoList = []; $.each($("#sortable li").find("img"), function () { photoList.push(this.alt) }); var DTO = { photos: photoList }; var ItemList = ""; $.ajax({ type: "POST", url: "Management/SortOnlineSliderShow", contentType: "application/json; charset=utf-8", data: JSON.stringify(DTO), success: function (response) { if (!isAuthenticated(response)) return; var lis = $con.find("#sortable li"); var List = typeof response.lphotos == "string" ? eval("(" + response.lphotos + ")") : response.lphotos; for (var i = 0; i < List.length; i++) { var val = List[0, i]; $(lis[i]).find("img").attr("alt", val).attr("title", val) } }, error: function (e) { alert(e.responseText) } }) } function RemoveOnlineSliderShow(e, t) { var n = $("#" + e); var r = n.find("#" + t).children("img").prop("alt"); var i = { fileName: r }; var s = ""; $.ajax({ type: "POST", url: "Management/DeleteOnlineSliderShow", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (r) { if (!isAuthenticated(r)) return; n.find("#sortable li[id='" + t + "']").remove(); if (n.find("#sortable li").length > 1) sortOnlineSliderShow(e) }, error: function (e) { alert(e.responseText) } }) } function ajaxFileUpload(e) { var t = $("#" + e.container); if (e.isMenu) var n = "id=" + e.id + "&size=" + e.size + "&isMenu=True"; else if (e.isLogo) var n = "isLogo=True"; else if (e.isSlider) var n = "isSlider=True" + "&priorityId=" + ($("#" + e.container).find("#sortable li").length * 1 + 1); else var n = "barcode=" + e.barcode + "&priorityId=" + ($("#" + e.container).find("#sortable li").length * 1 + 1) + "&colorId=" + $("#" + e.container).find("#ddl_m_Color").val(); var r = $(".bar"); var i = $(".percent"); var s = $("#status"); t.find("#imageForm").ajaxForm({ data: { priorityId: $("#" + e.container).find("#sortable li").length * 1 + 1 }, beforeSend: function () { s.empty(); var e = "0%"; r.width(e); i.html(e) }, uploadProgress: function (e, t, n, s) { var o = s + "%"; r.width(o); i.html(o) }, success: function () { var t = "100%"; r.width(t); i.html(t); if (e.isMenu) getMenuPhotos(e.id, e.container); else if (e.isLogo) getOnlineLogo(e.container); else if (e.isSlider) BuildSliderShowAccordion(e.container); else getPhotos(e.barcode, e.container) }, complete: function (e) { s.html(e.responseText) } }) } function loadInvoiceList(e, t) { var n = $("#" + e); InvoiceListload(e, t); if (t) { sortid = "Date desc"; n.find("[id=btnSearch]").button({ icons: { primary: "ui-icon-search"} }).unbind("click").click(function () { sortid = "date desc"; getOnlineInvoiceList(e, { container: e, callbackmethod: getFullAcountList, fname: "", page_index: 0, build: buildOnlineInvoiceList, servicename: "Management", methodname: "GetOnlineOrderStatement", print: false }) }) } n.find("#PageSize").die().live("change", function () { getOnlineInvoiceList(e, { container: e, callbackmethod: getFullAcountList, fname: "", page_index: 0, build: buildOnlineInvoiceList, servicename: "Management", methodname: "GetOnlineOrderStatement", print: false }) }) } function getOnlineInvoiceList(e, t) { var n = $("#" + e); if (t.page_index > 0) t.first = false; var r = "", i = "", s = "", o = "", u = "", a = "", f = "", l = "", c = "", h = "", p = "", d = "", v = "", m = "", g = "", y = "", b = "", w = ""; s = n.find("#txt_customer").val(); search = n.find("#ddlSearchBy2").val(); if (search != "") { if (search == "EmployeeCode") { o = n.find("#txtSearch2").val() } if (search == "EmployeeName") { u = n.find("#txtSearch2").val() } if (search == "confirmerCode") { h = n.find("#txtSearch2").val() } if (search == "confirmerName") { p = n.find("#txtSearch2").val() } if (search == "InvoiceNumber") { f = n.find("#txtSearch2").val() } } g = n.find("#txtInvoiceDateStart").val(); y = n.find("#txtInvoiceDateEnd").val(); if (n.find("#moreFilter").is(":visible")) { l = n.find("#txt_s_PriceFrom").val(); c = n.find("#txt_s_PriceTo").val(); b = n.find("#selectStatus").val(); w = n.find("#selectAmountStatus").val(); d = getHierarchySelectedValue("hr_s_Category", e); v = n.find("#txt_s_ProductCode").val() } var E = { sort: sortid, supplierid: "", IsClient: "", SupplierName: r, code: s, customerName: i, EmployeeId: o, EmployeeName: u, Shop: a, InvoiceId: f, InvoiceDateStart: g, InvoiceDateEnd: y, PriceFrom: l, PriceTo: c, Order: n.find("#Checkbox7" + e).length > 0 ? n.find("#Checkbox7" + e).prop("checked") : "", shopid: $("#userDefault").find("#ddl_s_Branch").val(), counterId: $("#userDefault").find("#ddl_m_Counter").val(), sell: n.find("#Checkbox1" + e).length > 0 ? n.find("#Checkbox1" + e).prop("checked") : "", buy: n.find("#Checkbox2" + e).length > 0 ? n.find("#Checkbox2" + e).prop("checked") : "", voucher: n.find("#Checkbox5" + e).length > 0 ? n.find("#Checkbox5" + e).prop("checked") : "", payment: n.find("#Checkbox3" + e).length > 0 ? n.find("#Checkbox3" + e).prop("checked") : "", transfer: n.find("#Checkbox4" + e).length > 0 ? n.find("#Checkbox4" + e).prop("checked") : "", notTransfer: n.find("#Checkbox12" + e).length > 0 ? n.find("#Checkbox12" + e).prop("checked") : "", expense: n.find("#Checkbox6" + e).length > 0 ? n.find("#Checkbox6" + e).prop("checked") : "", passed: n.find("#Checkbox10" + e).length > 0 ? n.find("#Checkbox10" + e).prop("checked") : "", notPassed: n.find("#Checkbox11" + e).length > 0 ? n.find("#Checkbox11" + e).prop("checked") : "", confirmed: n.find("#Checkbox8" + e).length > 0 ? n.find("#Checkbox8" + e).prop("checked") : "", notConfirmed: n.find("#Checkbox9" + e).length > 0 ? n.find("#Checkbox9" + e).prop("checked") : "", isDebtor: w, categoryId: d, barcode: v }; t["DTO"] = E; pageselectCallback(0, t, { container: "", fname: t.fname, pagingContainer: e, first: true, isOrder: true }) } function buildOnlineInvoiceList(jq, container) { var $con = $("#" + container.pagingContainer); var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "employee", sort: "p_person.Family", width: "11%" }); lsth.push({ title: "customer", sort: "p_person1.Family", width: "11%" }); lsth.push({ title: "date", sort: "Date", width: "12%" }); lsth.push({ title: "accountDescription", width: "16%" }); lsth.push({ title: "debtor", sort: "Amount", footer: jq.sumDebtor, width: "8%" }); lsth.push({ title: "creditor", sort: "Amount", footer: jq.sumCreditor, width: "8%" }); lsth.push({ title: "balanceAmount", footer: Math.round(jq.sumDebtor * 1 - jq.sumCreditor * 1, 1), width: "8%" }); lsth.push({ title: "invoiceNumber", sort: "InvoiceNO", width: "8%" }); lsth.push({ title: "store", sort: "inv_Shop.Name", width: "6%" }); lsth.push({ title: "counter", sort: "counterid", width: "6%" }); if (!container.params.print) { lsth.push({ title: "edit" }); lsth.push({ title: "details" }) } var List = typeof jq.results == "string" ? eval("(" + jq.results + ")") : jq.results; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; if (!container.params.print) trBody[0] = { trId: val.id, trName: val.detail }; trBody[1] = { name: "employee", html: val.employee, width: "11%" }; trBody[2] = { name: "customer", html: "<span class='cursor' name='subTab'  menuName='a_CustomerList' id='" + val.ClientId + "'>" + val.client + "</span>" + " <input type='hidden' id='hd_code' value='" + val.clientCode + "'/><input type='hidden' id='hd_clientId' value='" + val.ClientId + "'/>", width: "11%" }; trBody[3] = { props: { date: val.date, name: "date", width: "12%", klass: "dateLong" }, html: val.date }; trBody[4] = { name: "description", html: "<span>" + val.inOrderOf + "</span>" + " <input type='hidden' id='hd_categoryId' value='" + val.categoryId + "'/><input type='hidden' id='hd_description' value='" + val.Description + "'/><input type='hidden' id='hd_salaryFromDate' value='" + val.salaryFromDate + "'/><input type='hidden' id='hd_salaryToDate' value='" + val.salaryToDate + "'/><input type='hidden' id='hd_monthId' value='" + val.Month + "'/><input type='hidden' id='hd_fixSalary' value='" + val.fixSalary + "'/><input type='hidden' id='hd_commission' value='" + val.commission + "'/>", width: "16%" }; trBody[5] = { name: "Debtor", html: val.isSell == true ? val.amount : "", width: "8%" }; trBody[6] = { name: "Creditor", html: val.isSell == true ? "" : "<span>" + val.amount + "</span>" + " <input type='hidden' id='hd_commission' value='" + val.commission + "'/>", width: "8%" }; trBody[7] = { name: "balance", html: val.balance, width: "8%" }; trBody[8] = { name: "InvoiceNO", html: "<span class='cursor' name='subTab'  menuName='a_InvoiceList' id='" + val.id + "'>" + val.InvoiceNO + "</span>" + " <input type='hidden' id='hd_code' value='" + val.InvoiceNO + "'/><input type='hidden' id='hd_clientId' value='" + val.id + "'/>", width: "8%" }; trBody[9] = { name: "shop", html: val.shopName, width: "6%" }; trBody[10] = { name: "counter", html: val.counterCode, width: "6%" }; lstb.push(trBody) } if (container.params.print) { table = { header: lsth, body: lstb, heigth: 300, container: container.pagingContainer, divName: "Div_Print", hasFooter: true }; buildPrintTable(table); container.params.print = false } else { table = { header: lsth, body: lstb, details: { detailsFunction: FullAcountDetails, editFunction: EditFullAccount, confirmFunction: ConfirmFullAccount }, heigth: 300, container: container.pagingContainer, divName: "invoicelist", hasFooter: true }; buildTable(table) } } function ConfirmFullAccount(e, t) { $con = $("#" + t); $dis = $(e); var n = { orderHeaderId: $dis.parents("tr").prop("id").replace("tr", "") }; $.ajax({ type: "POST", url: "Management/ConfirmFullAccount", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (e) { if (!isAuthenticated(e)) return; if (e != null && e.isdone == true) { getFullAcountList(t, { container: t, callbackmethod: getFullAcountList, fname: "", page_index: 0, build: buildFullAcountList, servicename: "Management", methodname: "GetFullOrderStatement", print: false }) } }, error: function (e) { alert(e.responseText) } }) } function FullAcountDetails(e, t) { $con = $("#" + t); $dis = $(e); $("#voucherDetailsList" + t + "," + "#DetailPaymentList" + t + "," + "#dialog" + t + "," + "#expense" + t).dialog().dialog("close"); if ($dis.parents("tr").attr("name") == "payment") ListDetailPayment($dis.parents("tr").prop("id").replace("tr", ""), t); else if ($dis.parents("tr").attr("name") == "order") SelectDetailInvoice($dis.parents("tr").prop("id").replace("tr", ""), "dialog" + t); else if ($dis.parents("tr").attr("name") == "voucher") VoucherDetailsFullAccount($dis.parents("tr").prop("id").replace("tr", ""), t); else if ($dis.parents("tr").attr("name") == "expense" || $dis.parents("tr").attr("name") == "salary" || $dis.parents("tr").attr("name") == "social") ExpenseDetailsFullAccount($dis, t) } function SelectColorForOrderEdit(e, t) { bindItemsForSelectCombo({ methodname: "GetSizeListByBarcodeIdColorIdForEdit", servicename: "Management", id: "ddl_m_Size_" + e, container: e, headertext: " سایز" }, { barcodeid: t, orderDetailid: e.replace("tr", ""), colorid: $("#" + e).find("#ddl_m_Color_" + e).val() }) } function InvoiceListload(e, t) { var n = $("#" + e); if (t) { bindHierarchyData({ id: "hr_s_Category", table: "category", container: e, styleclass: "PagingSelect " }); n.find("#moreFilter").slideUp("fast"); n.find(".toggle-more-filters").click(function () { $(this).toggleClass("open"); n.find("#moreFilter").slideToggle(function () { }) }); n.find(".icon_clear").unbind("click").click(function () { n.find("#customerOnSelect").html("") }); ChangeCheckBoxGroupName("Check", e); n.find("#txtInvoiceDateStart").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#txtInvoiceDateEnd").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); n.find("#btnPrint").die().live("click", function () { getFullAcountList(e, { container: e, callbackmethod: getFullAcountList, fname: "", page_index: 0, build: buildFullAcountList, servicename: "Management", methodname: "GetFullOrderStatement", print: true }) }).button({ icons: { primary: "ui-icon-print" }, text: true }); n.find("#txtInvoiceDateEnd").datepicker({ changeMonth: true, changeYear: true }); n.find("#DetailPaymentList" + e).dialog({ autoOpen: false }).dialog({ width: 750 }); n.find("#DetailPaymentList").attr("id", "DetailPaymentList" + e); n.find("#dialog").attr("id", "dialog" + e); n.find("#DialogEditAccount").attr("id", "editOrder" + e); n.find("#dialogAdd").attr("id", "dialogAdd" + e) } aComplete({ methodname: "GetCompletionListByCustomerName", servicename: "Management", id: "txt_customer", container: e, minlength: 2, autofocus: false, limit: 20, boxId: "txt_customer", fname: customerOnSelect }) } function loadConfirmSell(e, t, n) { var r = $("#" + t); r.find("#orderheaderId").val(e); if (n) { GetInvoiceDetails(e, t); r.find("#btnTransfer").button({ text: true, icons: { primary: "ui-icon-transferthick-e-w"} }).click(function () { ConfirmOnlineOrder(t, e) }); r.find("#cancelOrder").button({ text: true, icons: { primary: "ui-icon-transferthick-e-w"} }).click(function () { CancelOrder(t, e) }) } } function GetInvoiceDetails(e, t) { var n = $("#" + t); $.ajax({ type: "POST", url: "Management/GetInvoiceDetails", contentType: "application/json; charset=utf-8", data: "{id: '" + e + "'}", success: function (e) { if (!isAuthenticated(e)) return; jq = e.invoiceDetails; buildOnlineInvoiceDetail(jq, t); var r = e.receiverDetails[0]; if (r != undefined) { n.find("#lblAddress").html(r.Address); n.find("#lblCellPhone").html(r.CellPhone); n.find("#lblGiftNote").html(r.GiftNote); n.find("#lblIsGift").html(r.IsGift == null ? "خیر" : r.IsGift == "" ? "خیر" : r.IsGift.toString() == "true" ? "بلی" : "خیر"); n.find("#lblName").html(r.Name); n.find("#lblNeedWrap").html(r.NeedWrap == null ? "خیر" : r.IsGift == "" ? "خیر" : r.NeedWrap.toString() == "true" ? "بلی" : "خیر"); n.find("#lblPhone").html(r.Phone); n.find("#lblPostalCode").html(r.PostalCode); n.find("#lblSendDate").attr("date", r.SendDate); n.find("#lblSendDate").html(r.SendDate); n.find("#lblSendTime").html(r.SendTime); switch (r.SendType) { case 1: n.find("#lblSendType").html("ارسال با پیک"); break; case 2: n.find("#lblSendType").html("ارسال از طریق پست پیشتاز"); break; case 3: n.find("#lblSendType").html("ارسال از طریق پست تیپاکس"); break } switch (r.PaymentType) { case 1: n.find("#lblPaymentType").html("پرداخت آنلاین"); break; case 2: n.find("#lblPaymentType").html("پرداخت به شماره کارت اعتباری"); break; case 3: n.find("#lblPaymentType").html("پرداخت به پیک همزمان با تحویل کالا"); break } n.find("#lblFamily").html(r.Family); n.find("#lblDescription").html(r.Description); n.find("#lblAmount").html(r.Amount); n.find("#lblDate").attr("date", r.Date); n.find("#lblDate").html(r.Date); n.find("#lblDiscountAmount").html(r.DiscountAmount); n.find("#lblDeliveryExpense").html(r.DeliveryExpense); n.find("#lblPurchaser").html("<span class='cursor' name='subTab'  menuName='a_InvoiceList' id='" + r.PersonId + "'>" + r.CustomerName + " " + r.CustomerFamily + "</span>" + " <input type='hidden' id='hd_code' value='" + r.CustomerName + " " + r.CustomerFamily + "'/><input type='hidden' id='hd_clientId' value='" + r.PersonID + "'/>") } n.find("span[name='subTabBarcode']").unbind().click(function () { showQuantity(t, $(this).attr("Barcode")) }); n.find("span[name='subTab']").unbind().click(function () { createSubTab({ name: "a_CustomerList", id: r.PersonId, row: null, tabName: r.CustomerName + " " + r.CustomerFamily }) }); n.find("[name=tQuan]").spinner(); n.find("select[name=ddl_shops]").unbind().change(function () { if ($(this).val() == "") { n.find("input[name='" + e + "_avQuan']").html("0"); return } var e = $(this).parents("tr").attr("id").replace("tr", ""); $.ajax({ type: "POST", url: "Management/GetItemDetailCountForShop", contentType: "application/json; charset=utf-8", data: "{orderDetailId: '" + e + "', shopId: '" + $(this).val() + "'}", success: function (t) { n.find("span[name='" + e + "_avQuan']").html(t) }, error: function (e) { alert(e.responseText) } }) }) }, error: function (e) { alert(e.responseText) } }) } function showQuantity(e, t) { buildColorSizeTable(t, $("#userDefault").find("#ddl_s_Branch").val(), true, "GetItemDetailsByBarcodeAndShopID", "dialog_ItemQuantity"); $("#dialog_ItemQuantity").dialog().dialog("open") } function loadListColorSize(e, t, n) { getListColor_Size(e, t); if (n) { var r = $("#" + t); bindItemsForSelectCombo({ methodname: "GetColorList", servicename: "Management", id: "ddl_m_Color", container: t, headertext: "انتخاب رنگ" }); bindItemsForSelectCombo({ methodname: "GetSizeList", servicename: "Management", id: "ddl_m_Size", container: t, headertext: "انتخاب جزئیات" }); r.find("#btn_Submit").off().on("click", function () { if (validateAll($("#" + t))) EditColor_Size(e, t) }).button({ icons: { primary: "ui-icon-disk" }, text: true }) } } function buildColorSizeTable(e, t, n, r, i, s) { if (s != undefined) $con = $("#" + s).find("#" + i); else $con = $("#" + i); getItem(e, t, n, r, i, s) } function getItem(barcode, ShopId, withQuantity, methodname, id, Container) { if (Container != undefined) $con = $("#" + Container).find("#" + id); else $con = $("#" + id); $.ajax({ type: "POST", url: "Management/" + methodname, async: false, data: "{barcode: '" + barcode + "', shopId: '" + ShopId + "'}", contentType: "application/json; charset=utf-8", dataType: "json", success: function (response) { if (!isAuthenticated(response)) return; var Order = typeof response == "string" ? eval("(" + response + ")") : response; bindSizeColor(Order.Size, Order.Color, Order.Quantity, withQuantity, $con); if (withQuantity) BindQuantitys(Order.Quantity, $con); else { $con.find("input[name='quantity']").die("change").live("change", function () { SumWholesale(Container.split("_")[1]) }) } } }) } function BindQuantitys(e, t) { for (var n = 0; n < e.length; n++) { var r = e[0, n]; var i = r.Quantity; var s = (r.ColorId == null ? "" : r.ColorId) + "-" + (r.SizeId == null ? "" : r.SizeId); t.find("#" + s).val((i * 1).toFixed(0)) } } function buildOnlineInvoiceDetail(jq, container) { var $con = $("#" + container.pagingContainer); var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "description", width: "28%" }); lsth.push({ title: "color", width: "8%" }); lsth.push({ title: "size", width: "8%" }); lsth.push({ title: "count", width: "6%" }); lsth.push({ title: "price", width: "8%" }); lsth.push({ title: "sum", width: "7%" }); lsth.push({ title: "serial", width: "10%" }); lsth.push({ title: "store", width: "15%" }); lsth.push({ title: "transferQuantity", width: "10%" }); var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; var ItemList = "<select id='" + val.ItemDetailId + "' name='ddl_shops'><option value=''>---</option>"; for (var s = 0; s < val.shop.length; s++) { var shval = val.shop[s]; ItemList += "<option value='" + shval.ShopId + "'>" + shval.Name + ": " + shval.Quantity + "</option>" } ItemList += "</select><span name='" + val.OrderDetailId + "_avQuan'></span>"; trBody[0] = { trId: val.OrderDetailId }; trBody[1] = { name: "description", html: "<span barcode='" + val.Barcode + "' class='cursor' name='subTabBarcode' menuName='a_InventoryList' id='" + val.BarcodeId + "'>" + (val.Barcode == null ? "" : val.Barcode + "_") + (val.Name == null ? "" : val.Name) + (val.Description == null ? "" : "_" + val.Description) + (val.ItemCode == null ? "" : "_" + val.ItemCode) + "</span>", width: "28%" }; trBody[2] = { name: "color", html: "<div id='Color" + (val.ColorId == "0" ? "" : val.ColorId) + "'>" + (val.Color == null ? "" : val.Color) + "</div>", width: "8%" }; trBody[3] = { name: "size", html: "<div id='Size" + (val.SizeId == "0" ? "" : val.SizeId) + "'>" + (val.Size == null ? "" : val.Size) + "", width: "8%" }; trBody[4] = { name: "count", html: "<div id='Quantity'>" + (val.Quantity == null ? "" : val.Quantity) + "</div>  " + (val.UnitType == null ? "" : val.UnitType), width: "6%" }; trBody[5] = { name: "price", html: "<div id='Price'>" + (val.Amount == null ? "" : val.Amount) + "</div>", width: "8%" }; trBody[6] = { name: "sum", html: "<div id='TotalPrice'>" + val.Quantity * val.Amount + "</div>", width: "7%" }; trBody[7] = { name: "serial", html: "<input style='width:80px;' type='text' name='Serial' />", width: "10%" }; trBody[8] = { name: "store", html: ItemList, width: "15%" }; trBody[9] = { name: "transferQuantity", html: "<input style='width:20px;' name='tQuan' value='" + val.Quantity + "' type='text'/>", width: "10%" }; lstb.push(trBody) } table = { header: lsth, body: lstb, heigth: 300, container: container, divName: "InvoiceDetailsList", hasFooter: false, details: {} }; buildTable(table) } function ConfirmOnlineOrder(e, t) { var n = $("#" + e); var r = []; $.each(n.find("tr[id*=tr]"), function () { var e = {}; var t = $(this); var n = []; var i = {}; i["itemDetailId"] = t.find("select[name='ddl_shops']").attr("id"); i["quantity"] = t.find("input[name='tQuan']").val(); i["serial"] = t.find("input[name='Serial']").val(); i["shopidFrom"] = t.find("select[name='ddl_shops']").val(); r.push(i) }); var i = { itemDetails: r, OrderHeaderId: t, shopIdTo: $("#userDefault").find("#ddl_s_Branch").val(), counterId: $("#userDefault").find("#ddl_m_Counter").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(i), type: "Post", url: "Management/ConfirmOnlineOrder", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function CancelOrder(e, t) { var n = $("#" + e); var r = { OrderHeaderId: t }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(r), type: "Post", url: "MAnagement/CancelOrder", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function EditOrderFullAccount(e, t) { var n = $("#" + t); var r = $(e); var i = $("#editOrder" + t); i.find("#txtAmount").val(r.parents("tr").find("[name=Debtor]").html() != "" ? r.parents("tr").find("[name=Debtor]").html() : r.parents("tr").find("[name=Creditor]").find("span").html()); i.find("#btnEditAccount").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (UpdateOrderFullAccount(r.parents("tr").prop("id").replace("tr", ""), t)) { } }); i.dialog(open).dialog({ width: 400, modal: true }); localize() } function UpdateOrderFullAccount(e, t) { $con = $("#editOrder" + t); var n = { orderHeaderId: e, amount: $con.find("#txtAmount").val() }; $.ajax({ type: "POST", url: "Management/EditOrderFullAcount", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (e) { if (!isAuthenticated(e)) return; return e.msg }, error: function (e) { alert(e.responseText) } }) } function RemoveItemDetailInvoice(e, t) { var n = $("#" + t); $.ajax({ type: "POST", url: "Management/DeleteDetailInvoice", contentType: "application/json; charset=utf-8", data: "{id: '" + e + "'}", success: function (t) { if (!isAuthenticated(t)) return; translate(t.msg); if (t.isdone) n.find("#tr" + e).remove() }, error: function (e) { alert(e.responseText) } }) } function ClickDetailInvoice(e, t) { var n = $("#" + t); onRowClick(e); trid = e.prop("id"); if (e.hasClass("rowOnClick") && e.find("input:text").length < 2) { e.find("td[name=Color]").append("<select   id='ddl_m_Color_" + trid + "' disabled='disabled' class='inputDiv selectSmall required validate-address' ></select>"); e.find("div[id=Color]").addClass("invisible"); e.find("td[name=Size]").append("<select   id='ddl_m_Size_" + trid + "' disabled='disabled' class='inputDiv selectSmall required validate-address' ></select>"); e.find("div[id=Size]").addClass("invisible"); e.find("td[name=Quantity]").append("<input type='text' class='inputText inputW50 ' value='" + e.find("div[id=Quantity]").html().split(" ")[0] + "'/><Label id='Label'>" + e.find("div[id=Quantity]").html().split(" ")[1] + "</Label>"); e.find("div[id=Quantity]").addClass("invisible"); e.find("td[name=Price]").append("<input type='text' class='inputText inputW50 ' value='" + e.find("div[id=Price]").html() + "'/>"); e.find("div[id=Price]").addClass("invisible"); e.find("td[name=TotalPrice]").append("<input type='text' class='inputText inputW50 ' value='" + e.find("div[id=TotalPrice]").html() + "'/>"); e.find("div[id=TotalPrice]").addClass("invisible"); e.find("td[name=Serial]").append("<input type='text' class='inputText inputW50 ' value='" + e.find("div[id=Serial]").html() + "'/>"); e.find("div[id=Serial]").addClass("invisible"); e.find("div[id=delete]").addClass("invisible"); e.find("td[id=delete]").append("<div id='Edit'><a id='Edit_Button' href='#'>بروز </a></div>"); e.find("div[id=Broken]").addClass("invisible"); e.find("td[name=Quantity] input,td[name=Price] input").change(function () { SumPriceDetail(e) }); e.find("[id=Edit_Button]").click(function () { EditDetailInvoice(e, t) }).button(); bindItemsForSelectCombo({ methodname: "GetColorListForEdit", servicename: "Management", id: "ddl_m_Color_" + trid, container: trid, headertext: " رنگ", setcolor: true }, { barcodeid: e.find("td[name=name]").prop("id"), orderDetailid: trid.replace("tr", "") }); e.find("#ddl_m_Color_" + trid).change(function () { SelectColorForOrderEdit(trid, e.find("td[name=name]").prop("id")) }); ajDropDown.done(function () { if (e.find("#ddl_m_Color_" + trid + " option").length < 1) bindItemsForSelectCombo({ methodname: "GetSizeListByBarcodeIdColorIdForEdit", servicename: "Management", id: "ddl_m_Size_" + trid, container: trid, headertext: " سایز" }, { barcodeid: e.find("td[name=name]").prop("id"), orderDetailid: trid.replace("tr", ""), colorid: "" }) }); $.each(n.find("tr[id*=tr]"), function () { if (!$(this).hasClass("rowOnClick")) { $(this).find("input:text[id!=txt_m_QuantityReturn]").remove(); $(this).find("select").remove(); $(this).find("Label[id=Label]").remove(); $(this).find("#Edit").remove(); $(this).find("div[id=Broken]").removeClass("invisible"); $(this).find("div").removeClass("invisible") } }) } else { e.find("input:text[id!=txt_m_QuantityReturn]").remove(); e.find("select").remove(); e.find("Label[id=Label]").remove(); e.find("#Edit").remove(); e.find("div").removeClass("invisible") } } function loadInventoryHelp(e, t) { var n = $("#" + e); if (t) { n.find("#newItem").unbind("click").bind("click", function () { $("[id='a_InventoryAdd']").trigger("click") }); n.find("#management").unbind("click").bind("click", function () { $("[id='a_InventoryList']").trigger("click") }); n.find("#cardex").unbind("click").bind("click", function () { $("[id='a_InventoryReportList']").trigger("click") }); n.find("#setting").unbind("click").bind("click", function () { $("[id='a_InventorySetting']").trigger("click") }) } } function loadItemHelp(e, t, n) { var r = $("#" + t); if (n) { r.find("#edit").unbind("click").bind("click", function () { r.parent().find("[id='a_InventoryEdit']").trigger("click") }); r.find("#detailList").unbind("click").bind("click", function () { r.parent().find("[id='a_ListColorSize']").trigger("click") }); r.find("#newDetail").unbind("click").bind("click", function () { r.parent().find("[id='a_ColorSize']").trigger("click") }); r.find("#category").unbind("click").bind("click", function () { r.parent().find("[id='a_InventoryCategory']").trigger("click") }); r.find("#averagePrice").unbind("click").bind("click", function () { r.parent().find("[id='a_ItemAccountingDetails']").trigger("click") }); r.find("#periodicPrice").unbind("click").bind("click", function () { r.parent().find("[id='a_InventoryPrice']").trigger("click") }); r.find("#MeasureUnit").unbind("click").bind("click", function () { r.parent().find("[id='a_InventoryUnit']").trigger("click") }) } } function loadInventoryAdd(e, t) { if (t) { var n = $("#" + e); bindHierarchyData({ id: "hr_m_Category", container: e, canmodify: true, table: "account" }); bindHierarchyData({ id: "hr_m_Category2", container: e, canmodify: true, table: "category" }); bindItemsForSelectCombo({ methodname: "getMeasureUnit", servicename: "Management", id: "ddl_m_MeasureUnit", container: e, headertext: " واحد کالا", selectedindex: 1 }); bindItemsForSelectCombo({ methodname: "getAvailablity", servicename: "Management", id: "ddl_m_Availability", container: e, headertext: "وضعیت کالا", selectedindex: 1 }); n.find("#btn_Submit").off().on("click", function () { if (validateAll($("#" + e))) AddBarcode(e) }).button({ icons: { primary: "ui-icon-disk" }, text: true }) } } function AddBarcode(e) { var t = $("#" + e); var n = { barcode: t.find("#txt_m_Barcode").val(), name: t.find("#txt_m_Name").val(), itemcode: t.find("#txt_m_ItemCode").val(), availibilityid: t.find("#ddl_m_Availability").val(), measureunitid: t.find("#ddl_m_MeasureUnit").val(), categoryid: getHierarchySelectedValue("hr_m_Category", e), regularprice: t.find("#txt_m_RegularPrice").val(), frinendsprice: t.find("#txt_m_FrinendsPrice").val(), wholesaleprice: t.find("#txt_m_WholesalePrice").val(), onlineprice: t.find("#txt_m_OnlinePrice").val(), weight: t.find("#txt_m_Weight").val(), setColorSize: t.find("#cb_d_SizeColor").prop("checked"), showOnline: t.find("#ddl_m_ShowOnline").val(), date: $("#userDefault").find("#txt_s_Date").val() }; $.ajax({ type: "POST", url: "Management/AddBarcode", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (t) { if (!isAuthenticated(t)) return; if (t.isDone) { alert("بارکد کالا:" + t.barcode); ResetPage(e) } }, error: function (e) { alert(e.responseText) } }) } function loadInventoryList(e, t) { sortid = "BarcodeId desc"; if (t) { var n = $("#" + e); bindHierarchyData({ id: "hr_s_Category", table: "category", container: e, styleclass: "PagingSelect " }); bindItemsForSelectCombo({ methodname: "getAvailablity", servicename: "Management", id: "ddl_s_Availability", container: e, headertext: "وضعیت کالا" }); getBarcodeList(e); n.find("#btnPrint").die().live("click", function () { GetProductList(e, false) }).button({ icons: { primary: "ui-icon-print" }, text: true }); n.find("#btnPrintBarcode").unbind().bind("click", function () { GetProductList(e, true) }).button({ icons: { primary: "ui-icon-print" }, text: true }); n.find("#btnSearchInventory").unbind("click").click(function () { getBarcodeList(e) }).button({ icons: { primary: "ui-icon-search"} }); n.find("#PageSize").unbind("change").change(function () { getBarcodeList(e) }); n.find("#regdateFrom").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#regdateTo").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); n.find("#regdateTo").datepicker({ changeMonth: true, changeYear: true }) } } function getBarcodeListOrder(e, t) { var n = $("#" + e); var r = $("#" + t.container + e); var i = n.find("#txt_s_ProductBarcode").val(); if (i != "" && i != undefined) { t.fname(null, e, i); return } if (t.page_index > 0) { t.first = false } var s = { sort: sortid, barcode: n.find("#txt_s_ProductBarcode").val() == undefined ? "" : n.find("#txt_s_ProductBarcode").val(), name: n.find("#txt_s_ProductCode").val() == undefined ? "" : n.find("#txt_s_ProductCode").val(), code: "", price: "", categoryid: getHierarchySelectedValue("hr_s_Category", e), status: n.find("#ddl_m_Availability").val() == undefined ? "" : n.find("#ddl_m_Availability").val(), quantityfrom: "", quantityto: "", regdatefrom: "", regdateto: "", shopid: $("#userDefault").find("#ddl_s_Branch").val(), showOnline: n.find("#ddl_s_ShowOnline").val() == undefined ? "" : n.find("#ddl_s_ShowOnline").val(), selectData: "GetItemsList" }; t["DTO"] = s; pageselectCallback(0, t, { container: "dialog", fname: t.fname, pagingContainer: e, first: true, isOrder: true }) } function getBarcodeList(e) { var t = $("#" + e); var n = true; var r = t.find("#PageSize").val(); var i = 0; var s = 0; var o = "", u = "", a = "", f = ""; if (t.find("#divBarcodesearch").is(":visible")) { var l = t.find("#ddl_d_SearchBy").val(); if (l == "Barcode") { o = t.find("#txt_s_Inventory").val() } if (l == "Name") { u = t.find("#txt_s_Inventory").val() } if (l == "Code") { a = t.find("#txt_s_Inventory").val() } if (l == "Price") { f = t.find("#txt_s_Inventory").val() } var c = { skip: i, take: r, currentPage: s, first: n, sort: sortid, barcode: o, name: u, code: a, price: f, categoryid: getHierarchySelectedValue("hr_s_Category", e), status: t.find("#ddl_s_Availability").val(), quantityfrom: t.find("#quantityFrom").val(), quantityto: t.find("#quantityTo").val(), regdatefrom: t.find("#regdateFrom").val(), regdateto: t.find("#regdateTo").val(), shopid: $("#userDefault").find("#ddl_s_Branch").val(), showOnline: t.find("#ddl_s_ShowOnline").val() == undefined ? "" : t.find("#ddl_s_ShowOnline").val(), selectData: "GetItemsList"} } else { var c = { skip: i, take: r, currentPage: s, first: n, sort: sortid, barcode: o, name: u, code: a, price: f, categoryid: getHierarchySelectedValue("hr_s_Category", e), status: t.find("#ddl_s_Availability").val(), quantityfrom: t.find("#quantityFrom").val(), quantityto: t.find("#quantityTo").val(), regdatefrom: t.find("#regdateFrom").val(), regdateto: t.find("#regdateTo").val(), shopid: $("#userDefault").find("#ddl_s_Branch").val(), showOnline: t.find("#ddl_s_ShowOnline").val() == undefined ? "" : t.find("#ddl_s_ShowOnline").val(), selectData: "GetItemsList"} } $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(c), type: "Post", url: "Management/GetItemsList", success: function (r) { if (!isAuthenticated(r)) return; var i = InventorygetOptionsFrom(r.count, e); t.find("#paging").pagination(r.count, i); InventorypageselectCallback(0, r, e, n) }, error: function (e) { alert(e.responseText) } }) } function buildBarcodeListOrder(jq, pageoption) { var $con = $("#" + pageoption.container); jq = jq.results; var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "category", width: "12%" }); lsth.push({ title: "itemName", sort: "Name", width: "35%" }); lsth.push({ title: "itemCode", sort: "ItemCode", width: "14%" }); lsth.push({ title: "count", sort: "Quantity", width: "10%" }); lsth.push({ title: "price", sort: "Regular", width: "15%" }); lsth.push({ title: "barcode", sort: "Barcode", width: "14%" }); var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; trBody[0] = { trId: val.BarcodeId }; trBody[1] = { html: val.Category, width: "12%" }; trBody[2] = { name: "name", html: val.Name, width: "35%" }; trBody[3] = { name: "code", html: val.ItemCode, width: "14%" }; trBody[4] = { name: "quantity", html: val.Quantity + " " + val.UnitType, width: "10%" }; trBody[5] = { html: val.Regular, props: { name: "price", klass: "digit", width: "15%"} }; trBody[6] = { name: "barcode", html: val.Barcode, width: "14%" }; lstb.push(trBody) } details = { rowClick: pageoption.fname }; table = { header: lsth, body: lstb, details: details, heigth: 300, width: 620, container: pageoption.container + pageoption.pagingContainer, divName: "BarcodeList", rowClickParams: { fname: GetItemOrder} }; buildTable(table) } function InventorygetOptionsFrom(e, t) { var n = $("#" + t); var r = { callback: InventorypageselectCallback }; n.find("input:text").each(function () { r[this.name] = this.className.match(/numeric/) ? parseInt(this.value) : this.value }); r.prev_show_always = false; r.next_show_always = false; if (e < n.find("#PageSize").val()) n.find("#PageSize").css("display", "none"); else { n.find("#PageSize").css("display", "inline") } r.items_per_page = n.find("#PageSize").val(); r.prev_text = "قبلی"; r.next_text = "بعدی"; r.container = t; return r } function GetProductList(e, t) { var n = $("#" + e); var r = "", i = "", s = "", o = ""; if (n.find("#divBarcodesearch").is(":visible")) { var u = n.find("#ddl_d_SearchBy").val(); if (u == "Barcode") { r = n.find("#txt_s_Inventory").val() } if (u == "Name") { i = n.find("#txt_s_Inventory").val() } if (u == "Code") { s = n.find("#txt_s_Inventory").val() } if (u == "Price") { o = n.find("#txt_s_Inventory").val() } var a = { skip: 0, take: 0, currentPage: 0, first: false, sort: sortid, barcode: r, name: i, code: s, price: o, categoryid: getHierarchySelectedValue("hr_s_Category", e), status: n.find("#ddl_s_Availability").val(), quantityfrom: "", quantityto: "", regdatefrom: "", regdateto: "", shopid: $("#userDefault").find("#ddl_s_Branch").val(), showOnline: n.find("#ddl_s_ShowOnline").val() == undefined ? "" : n.find("#ddl_s_ShowOnline").val(), selectData: "GetProductList"} } else { var a = { skip: 0, take: 0, currentPage: 0, first: false, sort: sortid, barcode: r, name: i, code: s, price: o, categoryid: getHierarchySelectedValue("hr_s_Category", e), status: n.find("#ddl_s_Availability").val(), quantityfrom: "", quantityto: "", regdatefrom: "", regdateto: "", shopid: $("#userDefault").find("#ddl_s_Branch").val(), showOnline: n.find("#ddl_s_ShowOnline").val() == undefined ? "" : n.find("#ddl_s_ShowOnline").val(), selectData: "GetProductList"} } $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(a), type: "Post", url: "Management/GetItemsList", success: function (n) { if (!isAuthenticated(n)) return; if (!t) buildProductList(n, e); if (t) buildPrintBarcode({ result: n.results, container: e }) }, error: function (e) { alert(e.responseText) } }) } function buildPrintBarcode(options) { var $con = $("#" + options.container); jq = options.result; var ul = ""; var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; var c = 0; for (var i = 0; i < List.length; i++) { if (c == 24) c = 0; var val = List[0, i]; if (options.hasQuantity != undefined && options.hasQuantity) for (var Q = 0; Q < val.Quantity; Q++) { if (c == 24) c = 0; ul += "<div dir='rtl' style=' width:24%; margin:4px; float:left; text-align: center;'><div  name='barcode' id=" + val.Barcode + "></div>"; ul += val.Name + "</br>" + (val.ItemCode == null ? "" : val.ItemCode) + "</br>" + val.Regular + " تومان"; ul += "</div>"; if (c == 23) ul += "<div style='page-break-after:always;'>---------------------</div>"; c++ } else { ul += "<div dir='rtl' style=' width:24%; margin:4px; float:left; text-align: center;'><div  name='barcode' id=" + val.Barcode + "></div>"; ul += val.Name + "</br>" + (val.ItemCode == null ? "" : val.ItemCode) + "</br>" + val.Regular + " تومان"; ul += "</div>"; if (c == 23) ul += "<div style='page-break-after:always;'>-----------------------</div>"; c++ } } $con.append("<div id='divPrintBarcode' class='invisible'></div>"); $con.find("#divPrintBarcode").html(ul); $con.find("#divPrintBarcode").find("[name='barcode']").each(function () { var e = $(this); e.barcode(e.attr("id"), "code39", { showHRI: true, barWidth: 1, barHeight: 20 }) }); Popup($con.find("#divPrintBarcode").html()) } function buildProductList(jq, container) { var $con = $("#" + container); var table = {}; var lstb = []; var lsth = []; jq = jq.results; lsth.push({ title: "نام کالا", sort: "Name" }); lsth.push({ title: "کد کالا", sort: "ItemCode" }); lsth.push({ title: "بارکد ", sort: "Barcode" }); lsth.push({ title: "وضعیت" }); lsth.push({ title: "گروه کالا" }); lsth.push({ title: "موجودی" }); lsth.push({ title: "قیمت" }); var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; trBody[0] = { name: "name", html: val.Name }; trBody[1] = { name: "code", html: val.ItemCode + "_" + val.Barcode }; trBody[2] = { name: "barcode", html: val.Barcode }; trBody[3] = { name: "status", html: val.Status }; trBody[4] = { name: "Category", html: val.Category }; trBody[5] = { name: "quantity", html: val.Quantity + " " + val.UnitType }; trBody[6] = { name: "Regular", html: "<span>" + val.Regular + "</span>" }; lstb.push(trBody) } table = { header: lsth, body: lstb, container: container, hasFooter: false, divName: "Div_Print" }; buildPrintTable(table) } function InventorypageselectCallback(e, t, n, r) { var i = $("#" + n); var s = "", o = "", u = "", a = ""; if (r) { buildBarcodeList(t, n) } else { r = false; var f = i.find("#PageSize").val(); var l = ""; var c = f; var h = e == 0 ? 0 : e * c; if (i.find("#divBarcodesearch").is(":visible")) { var p = i.find("#ddl_d_SearchBy").val(); if (p == "Barcode") { s = i.find("#txt_s_Inventory").val() } if (p == "Name") { o = i.find("#txt_s_Inventory").val() } if (p == "Code") { u = i.find("#txt_s_Inventory").val() } if (p == "Price") { a = i.find("#txt_s_Inventory").val() } var d = { skip: h, take: c, currentPage: e, first: r, sort: sortid, barcode: s, name: o, code: u, price: a, categoryid: getHierarchySelectedValue("hr_s_Category", n), status: i.find("#ddl_s_Availability").val(), quantityfrom: i.find("#quantityFrom").val(), quantityto: i.find("#quantityTo").val(), regdatefrom: i.find("#regdateFrom").val(), regdateto: i.find("#regdateTo").val(), shopid: $("#userDefault").find("#ddl_s_Branch").val(), showOnline: i.find("#ddl_s_ShowOnline").val() == undefined ? "" : i.find("#ddl_s_ShowOnline").val(), selectData: "GetItemsList"} } else { var d = { skip: h, take: c, currentPage: e, first: r, sort: sortid, barcode: s, name: o, code: u, price: a, categoryid: getHierarchySelectedValue("hr_s_Category", n), status: i.find("#ddl_s_Availability").val(), quantityfrom: i.find("#quantityFrom").val(), quantityto: i.find("#quantityTo").val(), regdatefrom: i.find("#regdateFrom").val(), regdateto: i.find("#regdateTo").val(), shopid: $("#userDefault").find("#ddl_s_Branch").val(), showOnline: i.find("#ddl_s_ShowOnline").val() == undefined ? "" : i.find("#ddl_s_ShowOnline").val(), selectData: "GetItemsList"} } $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(d), type: "Post", url: "Management/GetItemsList", success: function (e) { if (!isAuthenticated(e)) return; buildBarcodeList(e, n) }, error: function (e) { alert(e.responseText) } }); return false } Sort(getBarcodeList, n) } function buildBarcodeList(jq, pagingContainer) { var $con = $("#" + pagingContainer); $con.find("#divFooter").removeClass("invisible"); var appName = jq.appName; var onlineHost = jq.onlineHost; var sumPrice = jq.sumPrice; var sumQuantity = jq.sumQuantity; var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "barcode", sort: "Barcode", width: "10%" }); lsth.push({ title: "itemCode", sort: "ItemCode", width: "9%" }); lsth.push({ title: "itemName", sort: "Name", width: "13%" }); lsth.push({ title: "price", sort: "Regular", width: "10%" }); lsth.push({ title: "status", sort: "AvailablityId", width: "7%" }); lsth.push({ title: "show", sort: "ShowOnline", width: "7%" }); lsth.push({ title: "category", sort: "Category", width: "10%" }); lsth.push({ title: "count", sort: "Quantity", width: "6%" }); lsth.push({ title: "registerDate", sort: "EnteryDate", width: "12%" }); lsth.push({ title: "image", width: "10%" }); lsth.push({ title: "deleteKey", width: "4%" }); jq = jq.results; var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; trBody[0] = { trId: val.BarcodeId }; trBody[1] = { name: "barcode", html: val.Barcode, width: "10%" }; trBody[2] = { name: "code", html: val.ItemCode, width: "9%" }; trBody[3] = { name: "name", html: val.Name, width: "13%" }; trBody[4] = { html: val.Regular, props: { name: "price", klass: "digit", width: "10%"} }; trBody[5] = { html: val.Status, width: "7%" }; trBody[6] = { name: "ShowOnline", html: val.ShowOnline, props: { width: "7%"} }; trBody[7] = { html: val.Category, props: { width: "10%"} }; trBody[8] = { html: val.Quantity + " " + val.UnitType, props: { width: "6%"} }; trBody[9] = { html: val.EnteryDate, props: { date: val.EnteryDate, width: "12%", klass: "date"} }; trBody[10] = { html: "<img class='imagefortable' src='Data/" + appName + "Photos/" + val.Barcode + "/tiny_1.jpg'>", props: { width: "10%"} }; lstb.push(trBody) } $con.find("#spTotalValue").html(sumPrice); $con.find("#spTotalQuantity").html(sumQuantity); table = { header: lsth, body: lstb, details: { rowClick: ClickBarcode }, heigth: 300, width: 500, container: pagingContainer, divName: "BarcodeList", hasFooter: false, rowClickParams: { textboxId: "CustomerIntroducerCode"} }; if (pagingContainer != "divdialogCustomer") { details = { deleteFunction: RemoveBarcodeElement, rowClick: ClickBarcode }; table = { header: lsth, body: lstb, details: details, heigth: 300, container: pagingContainer, hasFooter: false, divName: "BarcodeList"} } buildTable(table); if (pagingContainer == "divdialogCustomer") $con.dialog("open") } function RemoveBarcodeElement(e, t) { $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: "{barcodeid: '" + e + "'}", type: "Post", url: "Management/DeleteBarcode", success: function (e) { if (!isAuthenticated(e)) return; if (e.isDone) getBarcodeList(t, { container: t, callbackmethod: getBarcodeList, fname: "", page_index: 0, build: buildBarcodeList, servicename: "Management", methodname: "GetItemsList", print: false }); translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function ClickBarcode(e, t) { createSubTab({ row: e, name: "a_InventoryList" }); onRowClick(e) } function loadInventoryPhoto(e, t, n) { var r = $("#" + t); if (n) { var i = $("#tr" + e).find("td[name='barcode']").html(); r.find("#hdBarcode").val(i); bindItemsForSelectCombo({ methodname: "GetColorListByBarcodeIdAll", servicename: "Management", id: "ddl_m_Color", container: t, headertext: "انتخاب رنگ", setcolor: true, showAlert: false }, { arg: e }); r.find("#fileInput").button(); r.find("#btn_Submit").button().unbind("click").click(function () { if (validateAll($("#" + t))) ajaxFileUpload({ container: t, barcode: i, isMenu: false }) }); getPhotos(i, t) } } function getPhotos(barcode, container) { var $con = $("#" + container); var ItemList = ""; $.ajax({ type: "POST", url: "Management/getPhotos", contentType: "application/json; charset=utf-8", data: "{ barcode:'" + barcode + "'}", success: function (response) { if (!isAuthenticated(response)) return; if (!response.hasPhoto) return response.msg; var List = typeof response.lphotos == "string" ? eval("(" + response.lphotos + ")") : response.lphotos; var appName = response.appName; if (appName == "/") appName = ""; var ItemList = "<ul id='sortable'>"; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<li style='cursor:move;' id='li" + i + "' class='ui-state-default'><div class='modalClose modalRemove'><a href='javascript:RemovePhoto(\"" + container + '","li' + i + '","' + barcode + "\");'/></div><img  title='" + val + "' alt='" + val + "' src='Data/" + appName + "Photos/" + val + "' /></li>" } ItemList += "</ul>"; $con.find("#div_d_PhotoList").html(ItemList); $("#sortable").sortable().sortable({ stop: function (e, t) { sortPhotos(barcode, container) } }) }, error: function (e) { alert(e.responseText) } }) } function sortPhotos(barcode, container) { var $con = $("#" + container); var photoList = []; $.each($("#sortable li").find("img"), function () { photoList.push(this.alt) }); var DTO = { photos: photoList, barcode: barcode }; var ItemList = ""; $.ajax({ type: "POST", url: "Management/sortPhotos", contentType: "application/json; charset=utf-8", data: JSON.stringify(DTO), success: function (response) { if (!isAuthenticated(response)) return; var lis = $con.find("#sortable li"); var List = typeof response.lphotos == "string" ? eval("(" + response.lphotos + ")") : response.lphotos; for (var i = 0; i < List.length; i++) { var val = List[0, i]; $(lis[i]).find("img").attr("alt", val).attr("title", val) } }, error: function (e) { alert(e.responseText) } }) } function RemovePhoto(e, t, n) { var r = $("#" + e); var i = r.find("#" + t).children("img").prop("alt"); var s = { fileName: i, barcode: n }; var o = ""; $.ajax({ type: "POST", url: "Management/deletePhoto", contentType: "application/json; charset=utf-8", data: JSON.stringify(s), success: function (i) { if (!isAuthenticated(i)) return; r.find("#sortable li[id='" + t + "']").remove(); if (r.find("#sortable li").length > 1) sortPhotos(n, e) }, error: function (e) { alert(e.responseText) } }) } function loadInventoryRestriction(e, t, n) { var r = $("#" + t); if (n) { r.find("#hvBarcodeId").val(e); bindRawDropDownData({ id: "divRestriction", container: t, path: "restriction", canmodify: true, istext: false, headertext: "انتخاب گروه ", css: "selectsmall " }); r.find("#btnEditProfile").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (validateAll($("#" + t))) UpdateOnlineProfile(e, t) }); getItemRestrictionList(t, { container: t, callbackmethod: getItemRestrictionList, fname: "", page_index: 0, build: buildItemRestrictionList, servicename: "Management", methodname: "GetItemRestrictionList", print: false, barcodeId: e }); r.find("#btnAddRestriction").button({ icons: { primary: "ui-icon-cross"} }); r.find("#itemRestriction").ajaxForm({ data: { restrictionId: r.find("#divRestriction option:selected").val(), barcodeId: e }, success: function () { }, complete: function (n) { getItemRestrictionList(t, { container: t, callbackmethod: getItemRestrictionList, fname: "", page_index: 0, build: buildItemRestrictionList, servicename: "Management", methodname: "GetItemRestrictionList", print: false, barcodeId: e }) } }) } } function getItemRestrictionList(e, t) { var n = $("#" + e); if (t.page_index > 0) { t.first = false } var r = { barcodeId: t.barcodeId }; t["DTO"] = r; pageselectCallback(0, t, { container: "", fname: t.fname, pagingContainer: e, first: true, isOrder: false }) } function buildItemRestrictionList(jq, container) { var $con = $("#" + container.pagingContainer); var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "restriction", width: "80%" }); var List = typeof jq.restrictionList == "string" ? eval("(" + jq.restrictionList + ")") : jq.restrictionList; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; if (!container.params.print) trBody[0] = { trId: val.RestrictionId }; trBody[1] = { name: "restriction", id: val.RestrictionId, html: val.Restriction, width: "80%" }; lstb.push(trBody) } var details = { deleteFunction: DeleteItemRestriction }; table = { header: lsth, body: lstb, details: details, heigth: 300, container: container.pagingContainer, divName: "itemRestrictionList", hasFooter: false }; buildTable(table) } function DeleteItemRestriction(e, t) { var n = $("#" + t); var r = $("#tr" + e); var i = { barcodeId: n.find("#hvBarcodeId").val(), restrictionId: e }; $.ajax({ type: "POST", url: "/Management/DeleteItemRestriction", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (e) { if (!isAuthenticated(e)) return; if (e.isDone == false) { alert(e.msg); return } if (e != null && e.isDone == true) r.remove() }, error: function (e) { alert(e.responseText) } }) } function loadCommentList(e, t) { sortid = "CommentId desc"; if (t) { var n = $("#" + e); n.find("#dialog").attr("id", "dialog" + e); bindHierarchyData({ id: "hr_s_Category", table: "category", container: e, styleclass: "PagingSelect " }); bindItemsForSelectCombo({ methodname: "getAvailablity", servicename: "Management", id: "ddl_s_Availability", container: e, headertext: "وضعیت کالا" }); n.find("#btnSearchInventory").unbind("click").click(function () { getCommentList(e, { container: e, callbackmethod: getCommentList, fname: "", page_index: 0, build: buildCommentList, servicename: "Management", methodname: "GetCommentList", print: false }) }).button({ icons: { primary: "ui-icon-search"} }); n.find("#PageSize").unbind("change").change(function () { getCommentList(e, { container: e, callbackmethod: getCommentList, fname: "", page_index: 0, build: buildCommentList, servicename: "Management", methodname: "GetCommentList", print: false }) }); n.find("#regdateFrom").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#regdateTo").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); n.find("#regdateTo").datepicker({ changeMonth: true, changeYear: true }) } } function getCommentList(e, t) { var n = $("#" + e); var r = true; var i = n.find("#PageSize").val(); var s = 0; var o = 0; var u = "", a = "", f = "", l = ""; if (n.find("#divBarcodesearch").is(":visible")) { var c = n.find("#ddl_d_SearchBy").val(); if (c == "Barcode") { u = n.find("#txt_s_Inventory").val() } if (c == "Name") { a = n.find("#txt_s_Inventory").val() } if (c == "Code") { f = n.find("#txt_s_Inventory").val() } if (c == "Price") { l = n.find("#txt_s_Inventory").val() } var h = { skip: s, take: i, currentPage: o, first: r, sort: sortid, barcode: u, name: a, code: f, price: l, categoryid: getHierarchySelectedValue("hr_s_Category", e), status: n.find("#ddl_s_Availability").val(), quantityfrom: n.find("#quantityFrom").val(), quantityto: n.find("#quantityTo").val(), regdatefrom: n.find("#regdateFrom").val(), regdateto: n.find("#regdateTo").val(), shopid: $("#userDefault").find("#ddl_s_Branch").val(), showOnline: n.find("#ddl_s_ShowOnline").val() == undefined ? "" : n.find("#ddl_s_ShowOnline").val(), selectData: "GetItemsList"} } else { var h = { skip: s, take: i, currentPage: o, first: r, sort: sortid, barcode: u, name: a, code: f, price: l, categoryid: getHierarchySelectedValue("hr_s_Category", e), status: n.find("#ddl_s_Availability").val(), quantityfrom: n.find("#quantityFrom").val(), quantityto: n.find("#quantityTo").val(), regdatefrom: n.find("#regdateFrom").val(), regdateto: n.find("#regdateTo").val(), shopid: $("#userDefault").find("#ddl_s_Branch").val(), showOnline: n.find("#ddl_s_ShowOnline").val() == undefined ? "" : n.find("#ddl_s_ShowOnline").val(), selectData: "GetItemsList"} } t["DTO"] = h; pageselectCallback(0, t, { container: "", fname: t.fname, pagingContainer: e, first: true, isOrder: true }) } function buildCommentList(jq, container) { var $con = $("#" + container.pagingContainer); var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "نام کالا", sort: "inv_Barcode.Name", width: "15%" }); lsth.push({ title: "customerName", sort: "p_Customer.p_Person.Family", width: "15%" }); lsth.push({ title: "date", sort: "Date", width: "15%" }); lsth.push({ title: "comment ", sort: "Comment", width: "35%" }); lsth.push({ title: "isConfirmed ", sort: "IsConfirmed", width: "9%" }); if (!container.params.print) { lsth.push({ title: "edit" }); lsth.push({ title: "details" }) } var List = typeof jq.results == "string" ? eval("(" + jq.results + ")") : jq.results; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; if (!container.params.print) trBody[0] = { trId: val.CommentId }; trBody[1] = { name: "name", html: val.Name + "_" + val.ItemCode + "_" + val.Barcode, width: "15%" }; trBody[2] = { name: "family", html: val.CustomerName + " " + val.Family + "_" + val.Code, width: "15%" }; trBody[3] = { props: { date: val.Date, name: "date", width: "15%", klass: "dateLong" }, html: val.Date }; trBody[4] = { name: "comment", html: val.Comment, tooltip: 150, width: "35%" }; trBody[5] = { name: "isConfirmed", html: val.IsConfirmed == false ? "<input type='checkbox' id='checkConfirm' />" : "<input checked type='checkbox' id='checkConfirm' />", width: "9%" }; lstb.push(trBody) } table = { header: lsth, body: lstb, details: { deleteFunction: DeleteComment, editFunction: getComment, confirmFunction: ConfirmComment }, heigth: 300, container: container.pagingContainer, divName: "CommentList", hasFooter: true }; buildTable(table) } function DeleteComment(e, t) { var n = $("#" + t); var r = { commentId: e }; $.ajax({ type: "POST", url: "Management/DeleteComment", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (t) { if (!isAuthenticated(t)) return; if (t != null && t.isDone == true) n.find("#tr" + e).remove(); translate(t.msg) }, error: function (e) { alert(e.responseText) } }) } function getComment(e, t) { $con = $("#" + t); $dis = $(e); $dialog = $("#dialog" + t); $dialog.dialog(); $dialog.find("#txtComment").val($dis.parents("tr").find("[name='comment']").html()); $dialog.find("#btn_EditComment").button({ icons: { primary: "ui-icon-disk"} }).unbind("click").click(function () { EditComment($dis.parents("tr").prop("id").replace("tr", ""), t) }) } function EditComment(e, t) { $con = $("#" + t); var n = { commentId: e, comment: $("#dialog" + t).find("#txtComment").val() }; $.ajax({ type: "POST", url: "Management/EditComment", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (e) { if (!isAuthenticated(e)) return; if (e != null && e.isDone == true) translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function ConfirmComment(e, t) { $con = $("#" + t); $dis = $(e); var n = { commentId: $dis.parents("tr").prop("id").replace("tr", ""), isConfirmed: $dis.parents("tr").find("[id='checkConfirm']").prop("checked") }; $.ajax({ type: "POST", url: "Management/ConfirmComment", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (e) { if (!isAuthenticated(e)) return; if (e != null && e.isDone == true) translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function loadInventoryEdit(e, t, n) { if (n) { var r = $("#" + t); GetSingelBarcode(e, t); r.find("#btn_Submit").die().live("click", function () { if (validateAll($("#" + t))) EditBarcode(e, t) }).button({ icons: { primary: "ui-icon-disk" }, text: true }) } } function GetSingelBarcode(barcodeid, container) { var $con = $("#" + container); $.ajax({ type: "POST", url: "Management/GetSingleBarcode", contentType: "application/json; charset=utf-8", data: "{barcodeid: '" + barcodeid + "' }", success: function (response) { if (!isAuthenticated(response)) return; bindItemsForSelectCombo({ async: false, methodname: "getAvailablity", servicename: "Management", id: "ddl_m_Availability", container: container, headertext: "وضعیت کالا" }); var ItemVal = typeof response.result == "string" ? eval("(" + response.result + ")") : response.result; var item = ItemVal[0]; $con.find("#txt_m_Barcode").val(item.Barcode); $con.find("#txt_m_Name").val(item.Name); $con.find("#txt_m_ItemCode").val(item.ItemCode); $con.find("#ddl_m_Availability").val(item.AvailablityId); $con.find("#ddl_m_ShowOnline").val("" + item.ShowOnline + ""); $con.find("#ddl_m_IsNew").val("" + item.IsNew + ""); $con.find("#ddl_m_IsSale").val("" + item.IsSale + ""); $con.find("#ddl_m_IsOffer").val("" + item.IsOffer + ""); $con.find("#txt_m_Weight").val(item.Weight); $con.find("#txt_m_Description").val(item.Description) }, error: function (e) { alert(e.responseText) } }) } function EditBarcode(e, t) { var n = $("#" + t); var r = { barcodeid: e, barcode: n.find("#txt_m_Barcode").val(), name: n.find("#txt_m_Name").val(), itemcode: n.find("#txt_m_ItemCode").val(), availibilityid: n.find("#ddl_m_Availability").val(), discription: n.find("#txt_m_Description").val(), weight: n.find("#txt_m_Weight").val(), showOnline: n.find("#ddl_m_ShowOnline").val() }; $.ajax({ type: "POST", url: "Management/EditBarcode", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function loadItemDefinition(e, t, n) { var r = $("#" + t); if (n) { getItemDefinition(e, t) } } function getItemDefinition(e, t) { var n = $("#" + t); var r = { barcodeId: e }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(r), type: "Post", url: "Management/GetItemDefinition", success: function (r) { if (r.canEdit) { n.find("#divDefinition").html("<textarea class='editor' name='txtDefinition'>" + (r.isDone ? r.result == null ? "" : r.result : "") + "</textarea></n><button id='btnSaveDefintion'>save</button>"); n.find(".editor").tinymce({ script_url: "../../Scripts/tinymce/tiny_mce.js", width: "100%", height: "500px", directionality: "rtl", theme: "advanced", verify_html: false, plugins: "pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template,wordcount,advlist,autosave", theme_advanced_buttons1: "save,newdocument,|,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,styleselect,formatselect,fontselect,fontsizeselect", theme_advanced_buttons2: "cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,image,cleanup,help,code,|,insertdate,inserttime,preview,|,forecolor,backcolor", theme_advanced_buttons3: "tablecontrols,|,hr,removeformat,visualaid,|,sub,sup,|,charmap,emotions,iespell,media,advhr,|,print,|,ltr,rtl,|,fullscreen", theme_advanced_buttons4: "insertlayer,moveforward,movebackward,absolute,|,styleprops,|,cite,abbr,acronym,del,ins,attribs,|,visualchars,nonbreaking,template,pagebreak,restoredraft,codehighlighting,netadvimage", theme_advanced_toolbar_location: "top", theme_advanced_toolbar_align: "right", theme_advanced_statusbar_location: "bottom", theme_advanced_resizing: false, content_css: "../../Scripts/tinymce/css/content.css", convert_urls: false }); n.find("#btnSaveDefintion").button().unbind("click").bind("click", function () { AddItemDefinition(e, t) }) } else { n.find("#divDefinition").html(r.isDone ? "<div style='padding-left:5em;'>" + r.result + "</div>" : "") } }, error: function (e) { alert(e.responseText) } }) } function AddItemDefinition(e, t) { var n = $("#" + t); var r = { barcodeId: e, definition: n.find("[name='txtDefinition']").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(r), type: "Post", url: "Management/AddItemDefinition", success: function (e) { translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function loadItemProperty(e, t, n) { if (n) { var r = $("#" + t); var i = r.find("#dialogAddProperty").attr("id", t + "dialogAddProperty"); r.find("#barcodeid").val(e); getProperty(e, t + "dialogAddProperty", t); bindHierarchyData({ id: "divProperty", container: t, table: "property", canmodify: true }); r.find("#btn_properties").button({ icons: { primary: "ui-icon-plusthick"} }).unbind().click(function () { getAllProperties(e, t + "dialogAddProperty", t) }); r.find("#btn_updateProperties").button({ icons: { primary: "ui-icon-plusthick"} }).unbind().click(function () { updateProperties(e, t) }); r.find("#btn_new").button({ icons: { primary: "ui-icon-plusthick"} }).unbind().click(function () { i.find("input, select").val(""); i.find("#btn_save").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { AddProperty(e, t + "dialogAddProperty", t) }); bindHierarchyData({ id: "divPropertyAdd", container: t + "dialogAddProperty", table: "property", canmodify: true }); i.dialog(open).dialog({ width: 500 }) }); aComplete({ methodname: "GetCompletionListByProperty", servicename: "Management", id: "txtPropertyValueAdd", boxId: "txtPropertyValueAdd", container: t + "dialogAddProperty", minlength: 2, autofocus: false, limit: 20, data: { propertyId: "divPropertyAdd"} }) } } function getAllProperties(barcodeid, dialog, container) { var $con = $("#" + container); var DTO = { barcodeid: barcodeid, propertyId: getHierarchySelectedValue("divProperty", container) }; $.ajax({ type: "POST", data: JSON.stringify(DTO), url: "Management/getAllPropertys", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; var table = "<table class='table' ><tbody>"; var group = typeof response.properties == "string" ? eval("(" + response.properties + ")") : response.properties; for (var j = 0; j < group.length; j++) { var val = group[0, j]; table += "<tr ><td style=' font-weight: bold; background-color: #CCFFCC' colspan='3'>" + val.Property + "</td></tr>"; var Properties = typeof val.properties == "string" ? eval("(" + val.properties + ")") : val.properties; for (var p = 0; p < Properties.length; p++) { var val = Properties[0, p]; var subProperty = "<option value=''>انتخاب کنید</option>"; for (var sp = 0; sp < val.properties.length; sp++) { var sval = val.properties[0, sp]; subProperty += "<option " + ($.inArray(sval.PropertyId, response.propertyIds) != -1 ? "selected" : "") + " value='" + sval.PropertyId + "' >" + sval.Property + "</option>" } table += "<tr id='tr" + val.PropertyId + "'><td>" + val.Property + "</td>" + "<td><select propertyId='" + val.PropertyId + "' >" + subProperty + "</select ></td>" + "<td><input  />" + "</td></tr>" } } table += "</tbody></table>"; $con.find("#itemProperty").html(table); $con.find("#itemProperty").tableScroll({ height: 380, width: contentwidth, flush: false }); $con.find("[id=btnDelete]").button({}); $con.find("[id=btnDelete]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).unbind().click(function () { var e = this; if (confirm("آیا از حذف مطمئن هستید؟")) deleteProperty($(this).attr("propId"), barcodeid, container + "dialogAddProperty", container); else return }) }, error: function (e) { alert(e.responseText) } }) } function getProperty(barcodeid, dialog, container) { var $con = $("#" + container); var DTO = { barcodeid: barcodeid }; $.ajax({ type: "POST", data: JSON.stringify(DTO), url: "Management/getProperty", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; var table = "<table class='table' ><tbody>"; var group = typeof response == "string" ? eval("(" + response + ")") : response; for (var j = 0; j < group.length; j++) { var val = group[0, j]; table += "<tr ><td colspan='3'>" + val.Property + "</td></tr>"; var Properties = typeof val.properties == "string" ? eval("(" + val.properties + ")") : val.properties; for (var p = 0; p < Properties.length; p++) { var val = Properties[0, p]; table += "<tr id='tr" + val.PropertyId + "'><td>" + val.Property + "</td><td>" + val.Value + "</td><td id='delete'><button propId='" + val.PropertyId + "' id='btnDelete'>deleteKey</button></td></tr>" } } table += "</tbody></table>"; $con.find("#itemProperty").html(table); $con.find("#itemProperty").tableScroll({ height: 380, width: contentwidth, flush: false }); $con.find("[id=btnDelete]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).unbind().click(function () { var e = this; if (confirm("آیا از حذف مطمئن هستید؟")) deleteProperty($(this).attr("propId"), barcodeid, container + "dialogAddProperty", container); else return }) }, error: function (e) { alert(e.responseText) } }) } function AddProperty(e, t, n) { var r = $("#" + t); var i = { barcodeid: e, propertyId: getHierarchySelectedValue("divPropertyAdd", t), value: r.find("#txtPropertyValueAdd").val() }; $.ajax({ type: "POST", data: JSON.stringify(i), url: "Management/AddProperty", contentType: "application/json; charset=utf-8", success: function (t) { if (!isAuthenticated(t)) return; if (t.isDone) getProperty(e, n + "dialogAddProperty", n); translate(t.msg) }, error: function (e) { alert(e.responseText) } }) } function updateProperties(e, t) { var n = $("#" + t); var r = []; n.find("table[propertyId]").each(function () { var e = {}; e["value"] = $(this).parent().parent().find("input[property]:text").val(); e["main"] = $(this).parent().parent().find("input[main]:text").val(); e["id"] = $(this).attr("propertyId"); var t = []; n.find("input:checkbox:checked").each(function () { t.push($(this).val()) }); e["propertyId"] = t; r.push(e) }); var i = { barcodeid: e, propList: r }; $.ajax({ type: "POST", data: JSON.stringify(i), url: "Management/UpdateProperties", contentType: "application/json; charset=utf-8", success: function (n) { if (!isAuthenticated(n)) return; if (n.isDone) getAllProperties(e, t, t); translate(n.msg) }, error: function (e) { alert(e.responseText) } }) } function deleteProperty(e, t, n, r) { var i = $("#" + r); var s = { propertyId: e, barcodeId: t }; $.ajax({ type: "POST", data: JSON.stringify(s), url: "Management/deleteProperty", contentType: "application/json; charset=utf-8", success: function (t) { if (!isAuthenticated(t)) return; if (t.isDone) i.find("#tr" + e).remove(); translate(t.msg) }, error: function (e) { alert(e.responseText) } }) } function buildPropertyList(jq, container) { var $con = $("#" + container); var table = {}; var lstb = []; var lsth = []; lsth.push({ title: "واحد کالا", sort: "", width: "30%" }); lsth.push({ title: "تعداد", width: "30%" }); lsth.push({ title: "تخفیف واحد", width: "25%" }); lsth.push({ title: "ویرایش/حذف", width: "15%" }); var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; trBody[0] = { trId: val.MeasureUnitId }; trBody[1] = { name: "unit", html: val.UnitType, width: "30%" }; trBody[2] = { name: "quantity", html: val.Quantity, width: "30%" }; trBody[3] = { name: "discount", html: val.DiscountPercentage, width: "25%" }; lstb.push(trBody) } var details = { editFunction: BindItemsForEditUnit, deleteFunction: DeleteUnit }; table = { header: lsth, body: lstb, details: details, container: container, divName: "UnitTable" }; buildTable(table) } function loadItemMatchingBarcode(e, t, n) { var r = $("#" + t); if (n) { r.find("#hd_barcodeId").val(e); r.find("#btn_save").unbind().click(function () { addMatchingBarcode(e, t) }).button({ icons: { primary: "ui-icon-disk" }, text: true }); getMatchingBarcodes(e, t); aComplete({ methodname: "GetCompletionListByItemName", servicename: "Management", id: "txt_matchedBarcode", container: t, minlength: 2, autofocus: false, limit: 10, boxId: "txt_matchedBarcode", data: { Status: 1 }, selectBarcode: true }) } } function addMatchingBarcode(e, t) { var n = $("#" + t); var r = { barcodId: e, matchedBarcode: n.find("#txt_matchedBarcode").val(), discountPer: n.find("#txt_discountPer").val(), countBarcode: n.find("#txt_countBarcode").val(), countMatched: n.find("#txt_countMatched").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(r), type: "Post", url: "Management/addMatchingBarcode", success: function (n) { if (n.isdone) getMatchingBarcodes(e, t) }, error: function (e) { alert(e.responseText) } }) } function getMatchingBarcodes(e, t) { var n = $("#" + t); var r = { barcodeId: e }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(r), type: "Post", url: "Management/getMatchingBarcodes", success: function (e) { if (e.isdone) buildMatchingBarcodes(e, t) }, error: function (e) { alert(e.responseText) } }) } function buildMatchingBarcodes(jq, container) { var $con = $("#" + container.pagingContainer); var table = {}; var lstb = []; var lsth = []; jq = jq.results; lsth.push({ title: "matchingBarcode", width: "55%" }); lsth.push({ title: "countProduct", width: "10%" }); lsth.push({ title: "countMached", width: "10%" }); lsth.push({ title: "discountPer", width: "15%" }); lsth.push({ title: "delete", width: "10%" }); var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; var name = val.Name != null ? val.Name : ""; var code = val.ItemCode != null ? val.ItemCode : ""; var barcode = val.Barcode != null ? val.Barcode : ""; trBody[0] = { trId: val.MatchingItemId }; trBody[1] = { name: "matchingBarcode", html: name + " " + code + " " + barcode, width: "55%" }; trBody[2] = { name: "countProduct", html: val.Quantity, width: "10%" }; trBody[3] = { name: "countMached", html: val.MatchingQuantity, width: "10%" }; trBody[4] = { name: "discountPer", html: val.DiscountPercentage == true ? val.amount : "", width: "15%" }; lstb.push(trBody) } var details = { deleteFunction: DeleteMatchingBarcode }; table = { header: lsth, body: lstb, heigth: 300, container: container, divName: "MachingBarcodeslist", details: details, hasFooter: false }; buildTable(table) } function DeleteMatchingBarcode(e, t) { var n = $("#" + t); var r = { matchingItemId: e }; $.ajax({ type: "POST", url: "Management/DeleteMatchingBarcode", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (t) { if (!isAuthenticated(t)) return; if (t != null && t.isDone == true) { n.find("#tr" + e).remove(); return true } translate(t.msg) }, error: function (e) { alert(e.responseText) } }) } function loadColorSize(e, t, n) { if (n) { var r = $("#" + t); getColor(t); getSize(t); r.find("#btn_Submit").off().on("click", function () { if (validateAll($("#" + t))) addSizeColor(e, t) }).button({ icons: { primary: "ui-icon-disk" }, text: true }) } } function getColor(container) { var $con = $("#" + container); var ItemList = ""; $.ajax({ type: "POST", url: "Management/GetColorList", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; var List = typeof response == "string" ? eval("(" + response + ")") : response; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<div class='unit CheckBox' style='background-color:" + val.name + ";'><input name='cd_Color' id='" + val.id + "' type='checkbox' id='cb_d_SizeColor' value='" + val.id + "'   /></div>" } $con.find("#divColor").html(ItemList) }, error: function (e) { alert(e.responseText) } }) } function getSize(container) { var $con = $("#" + container); var ItemList = ""; $.ajax({ type: "POST", url: "Management/GetSizeParent", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; var List = typeof response == "string" ? eval("(" + response + ")") : response; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += " <h3><a href='#' >" + val.Size + "</a></h3><div id='div_" + val.SizeId + "'></div>" } $con.find("#divSizeAccordion").html(ItemList); $con.find("#divSizeAccordion").accordion({ heightStyle: "content", collapsible: true, active: false, activate: function (e, t) { if (t.newPanel.length > 0 && t.newPanel.html().length < 1) getSizeChild(t.newPanel.prop("id").replace("div_", ""), container) } }) }, error: function (e) { alert(e.responseText) } }) } function getSizeChild(sizeid, container) { var $con = $("#" + container); var ItemList = ""; $.ajax({ type: "POST", url: "Management/GetSizeChild", data: "{parentid: '" + sizeid + "'}", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; var List = typeof response == "string" ? eval("(" + response + ")") : response; var ItemList = "<div id='divSizeContent'>"; for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<div class='unit CheckBox' ><label for='size' class=' unit label label75'>" + val.Size + "</label><input name='cd_Size' id='" + val.SizeId + "' type='checkbox' id='cb_d_SizeColor' value='" + val.SizeId + "'  class='unit' /></div>" } ItemList += "</div>"; $con.find("#div_" + sizeid).html(ItemList); $con.find("#divSizeAccordion").accordion({ collapsible: true, heightStyle: "content" }) }, error: function (e) { alert(e.responseText) } }) } function addSizeColor(e, t) { var n = $("#" + t); var r = []; var i = []; $.each(n.find("input:checkbox[name=cd_Color]"), function () { if (this.checked) i.push(this.value) }); $.each(n.find("input:checkbox[name=cd_Size]"), function () { if (this.checked) r.push(this.value) }); var s = { barcodeid: e, colorlist: i, sizelist: r, price: n.find("#txt_Price").val(), noColorSize: n.find("input:checkbox[id=cb_d_SizeColor]").is(":checked") }; $.ajax({ type: "POST", data: JSON.stringify(s), url: "Management/AddSizeColor", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function getListColor_Size(barcodeid, container) { var $con = $("#" + container); var ItemList = ""; $.ajax({ type: "POST", data: "{barcodeid: '" + barcodeid + "'}", url: "Management/GetColor_Size", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; var List = typeof response == "string" ? eval("(" + response + ")") : response; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<tr id='tr" + val.ItemDetailId + "'>" + "<td id='Size_" + val.SizeId + "' width='20%'>" + val.Size + "</td>" + "<td width='15%' style='background-color:" + val.Color + ";'></td>" + "<td id='Color_" + val.ColorId + "' width='25%'>" + val.Color + "</td>" + "<td name='price' width='25%'>" + val.DetailPrice + "</td>" + "<td id='delete' width='15%'><div><button name='delete' id='a_Button'>deleteKey</button></td></tr>" } $con.find("#ListColor_Size").html(ItemList).parent().tableScroll({ height: 380, width: contentwidth, flush: false }); $con.find("button[id=a_Button]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) RemoveItemElement($(this).parents("tr").prop("id").replace("tr", ""), container, barcodeid); else return }); $con.find("tr[id*=tr]").find("td:not([id=delete])").click(function () { ClickColorSize($(this).parent("tr"), container) }).addClass("cursor") }, error: function (e) { alert(e.responseText) } }) } function RemoveItemElement(e, t, n) { var r = $("#" + t); $.ajax({ type: "POST", data: "{itemid: '" + e + "'}", url: "Management/DeleteItem", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; getListColor_Size(n, t); translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function ClickColorSize(e, t) { var n = $("#" + t); n.find("#ddl_m_Size").val(e.find("td[id*=Size_]").prop("id").replace("Size_", "")); n.find("#ddl_m_Color").val(e.find("td[id*=Color_]").prop("id").replace("Color_", "")); n.find("#txt_m_Price").val(e.find("td[name=price]").html() == "null" ? "" : e.find("td[name=price]").html()); n.find("#hd_m_itemid").val(e.prop("id").replace("tr", "")) } function EditColor_Size(e, t) { var n = $("#" + t); $.ajax({ type: "POST", data: "{itemid: '" + n.find("#hd_m_itemid").val() + "',sizeid:'" + (n.find("#ddl_m_Size").val() == null ? "" : n.find("#ddl_m_Size").val()) + "',colorid:'" + (n.find("#ddl_m_Color").val() == null ? "" : n.find("#ddl_m_Color").val()) + "',price:'" + n.find("#txt_m_Price").val() + "'}", url: "Management/EditColor_Size", contentType: "application/json; charset=utf-8", success: function (n) { if (!isAuthenticated(n)) return; getListColor_Size(e, t); translate(n.msg) }, error: function (e) { alert(e.responseText) } }) } function loadInventoryPrice(e, t, n) { if (n) { var r = $("#" + t); getListPrice(e, t); r.find("#txt_m_Date").attr("id", t + "txt_m_Date"); r.find("#" + t + "txt_m_Date").datepicker({ changeMonth: true, changeYear: true }); r.find("#btn_Submit").button().unbind("click").click(function () { if (validateAll($("#" + t))) AddPrice(e, t) }) } } function getListPrice(barcodeid, container) { var $con = $("#" + container); var ItemList = ""; $.ajax({ type: "POST", data: "{barcodeid: '" + barcodeid + "'}", url: "Management/GetPrice", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; var List = typeof response == "string" ? eval("(" + response + ")") : response; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<tr id='tr" + val.PriceId + "'>" + "<td name='Date'width='15%'>" + val.Date + "</td>" + "<td name='Regular' width='20%'>" + val.Regular + "</td>" + "<td name='Freinds' width='20%'>" + val.Freinds + "</td>" + "<td name='Wholesale' width='20%'>" + val.Wholesale + "</td>" + "<td name='Online' width='20%'>" + val.Online + "</td>" + "<td id='delete' width='5%'><button id='a_Button'>حذف</button></td></tr>" } $con.find("#ListPrice").html(ItemList).parent().tableScroll({ height: 380, width: contentwidth, flush: false }); $con.find("[id=a_Button]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) RemovePriceElement($(this).parents("tr").prop("id").replace("tr", ""), container, barcodeid); else return }); $con.find("tr[id*=tr]").find("td:not([id=delete])").click(function () { ClickPrice($(this).parent("tr"), container, barcodeid) }).addClass("cursor") }, error: function (e) { alert(e.responseText) } }) } function AddPrice(e, t) { var n = $("#" + t); $.ajax({ type: "POST", data: "{barcodeid:'" + e + "',date:'" + n.find("#" + t + "txt_m_Date").val() + "',regular:'" + n.find("#txt_m_RegularPrice").val() + "',Frinends:'" + n.find("#txt_m_FrinendsPrice").val() + "',wholesale:'" + n.find("#txt_m_WholesalePrice").val() + "',online:'" + n.find("#txt_m_OnlinePrice").val() + "'}", url: "Management/AddPrice", contentType: "application/json; charset=utf-8", success: function (n) { if (!isAuthenticated(n)) return; translate(n.msg); if (n.isDone) getListPrice(e, t) }, error: function (e) { alert(e.responseText) } }) } function EditPrice(e, t) { var n = $("#" + t); $.ajax({ type: "POST", data: "{priceid: '" + n.find("#hd_m_priceid").val() + "',date:'" + n.find("#" + t + "txt_m_Date").val() + "',regular:'" + n.find("#txt_m_RegularPrice").val() + "',Frinends:'" + n.find("#txt_m_FrinendsPrice").val() + "',wholesale:'" + n.find("#txt_m_WholesalePrice").val() + "',online:'" + n.find("#txt_m_OnlinePrice").val() + "'}", url: "Management/EditPrice", contentType: "application/json; charset=utf-8", success: function (r) { if (!isAuthenticated(r)) return; getListPrice(e, t); n.find("#btn_Submit").unbind().bind("click", function () { AddPrice(e, t) }); n.find("#" + t + "txt_m_Date").val(""); n.find("#txt_m_RegularPrice").val(""); n.find("#txt_m_FrinendsPrice").val(""); n.find("#txt_m_WholesalePrice").val(""); n.find("#txt_m_OnlinePrice").val(""); n.find("#hd_m_priceid").val() }, error: function (e) { alert(e.responseText) } }) } function ClickPrice(e, t, n) { var r = $("#" + t); r.find("#" + t + "txt_m_Date").val(e.find("td[name=Date]").html().split(" ")[1]); r.find("#txt_m_RegularPrice").val(e.find("td[name=Regular]").html() == "null" ? "" : e.find("td[name=Regular]").html()); r.find("#txt_m_FrinendsPrice").val(e.find("td[name=Freinds]").html() == "null" ? "" : e.find("td[name=Freinds]").html()); r.find("#txt_m_WholesalePrice").val(e.find("td[name=Wholesale]").html() == "null" ? "" : e.find("td[name=Wholesale]").html()); r.find("#txt_m_OnlinePrice").val(e.find("td[name=Online]").html() == "null" ? "" : e.find("td[name=Online]").html()); r.find("#hd_m_priceid").val(e.prop("id").replace("tr", "")); r.find("#btn_Submit").unbind().bind("click", function () { EditPrice(n, t) }) } function RemovePriceElement(e, t, n) { var r = $("#" + t); $.ajax({ type: "POST", data: "{priceid: '" + e + "'}", url: "Management/DeletePrice", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg); if (e.isDone) getListPrice(n, t) }, error: function (e) { alert(e.responseText) } }) } function loadInventoryCategory(e, t, n) { if (n) { var r = $("#" + t); getListCategory(e, t, n); r.find("#btn_Submit").button().unbind("click").click(function () { if (validateAll($("#" + t))) AddCategory(e, t) }) } } function getListCategory(barcodeid, container, first) { var $con = $("#" + container); var ItemList = ""; ajgetListCategory = $.ajax({ type: "POST", data: "{barcodeid: '" + barcodeid + "'}", url: "Management/GetCategoryList", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; var List = typeof response == "string" ? eval("(" + response + ")") : response; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<tr id='tr" + val.CategoryId + "'>" + "<td name='Category' width='80%'>" + val.Category + "</td>" + "<td id='delete' width='20%'><button id='a_Button'>حذف</button></td></tr>" } $con.find("#ListCategory").html(ItemList).parent().tableScroll({ height: 380, width: contentwidth, flush: false }); $con.find("[id=a_Button]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) RemoveCategoryElement($(this).parents("tr").prop("id").replace("tr", ""), container, barcodeid); else return }); if (first) bindHierarchyData({ id: "hr_m_Category", container: container, canmodify: true, table: "category" }) }, error: function (e) { alert(e.responseText) } }) } function AddCategory(e, t) { var n = $("#" + t); $.ajax({ type: "POST", data: "{barcodeid:'" + e + "',categoryid:'" + getHierarchySelectedValue("hr_m_Category", t) + "'}", url: "Management/AddCategory", contentType: "application/json; charset=utf-8", success: function (n) { if (!isAuthenticated(n)) return; if (n.isDone) getListCategory(e, t); translate(n.msg) }, error: function (e) { alert(e.responseText) } }) } function RemoveCategoryElement(e, t, n) { var r = $("#" + t); $.ajax({ type: "POST", data: "{barcodeid:'" + n + "',categoryid:'" + e + "'}", url: "Management/DeleteCategory", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; if (e.isDone) getListCategory(n, t); translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function loadInventoryUnit(e, t, n) { if (n) { var r = $("#" + t); r.find("#barcodeid").val(e); GetUnitList(e, t); r.find("#btn_new").button({ icons: { primary: "ui-icon-plusthick"} }).unbind().click(function () { $("#dialogAddUnit").find("input, select").val(""); $("#dialogAddUnit").find("#btn_save").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { AddUnit(e, "dialogAddUnit", t) }); bindHierarchyData({ id: "divUnitCategoryAdd", container: "dialogAddUnit", table: "MeasureUnit", canmodify: true }); $("#dialogAddUnit").dialog(open).dialog({ width: 500 }) }) } } function AddUnit(e, t, n) { var r = $("#" + t); var i = { barcodeid: e, MeasureUnitId: getHierarchySelectedValue("divUnitCategoryAdd", t), quantity: r.find("#txtQuantityAdd").val(), discount: r.find("#txtDiscountAdd").val() }; $.ajax({ type: "POST", data: JSON.stringify(i), url: "Management/AddUnit", contentType: "application/json; charset=utf-8", success: function (t) { if (!isAuthenticated(t)) return; if (t.isDone) GetUnitList(e, n); translate(t.msg) }, error: function (e) { alert(e.responseText) } }) } function buildUnitList(jq, container) { var $con = $("#" + container); var table = {}; var lstb = []; var lsth = []; lsth.push({ title: "واحد کالا", sort: "", width: "30%" }); lsth.push({ title: "تعداد", width: "30%" }); lsth.push({ title: "تخفیف واحد", width: "25%" }); lsth.push({ title: "ویرایش/حذف", width: "15%" }); var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; trBody[0] = { trId: val.MeasureUnitId }; trBody[1] = { name: "unit", html: val.UnitType, width: "30%" }; trBody[2] = { name: "quantity", html: val.Quantity, width: "30%" }; trBody[3] = { name: "discount", html: val.DiscountPercentage, width: "25%" }; lstb.push(trBody) } var details = { editFunction: BindItemsForEditUnit, deleteFunction: DeleteUnit }; table = { header: lsth, body: lstb, details: details, container: container, divName: "UnitTable" }; buildTable(table) } function GetUnitList(e, t) { var n = $("#" + t); var r = ""; var i = { barcodeid: e }; $.ajax({ type: "POST", data: JSON.stringify(i), url: "Management/GetUnitList", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; buildUnitList(e, t) }, error: function (e) { } }) } function BindItemsForEditUnit(e, t) { $("#dialogAddUnit").dialog().dialog("destroy"); var n = $(e).parents("tr"); var r = n.prop("id"); var i = $("#" + t); i.find("#divUnitCategoryAdd").html(""); i.find("#btn_save").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (validateAll(i.find("#dialogAddExpense"))) EditUnit(r.replace("tr", ""), "dialogAddUnit", t) }); bindHierarchyData({ id: "divUnitCategoryAdd", container: "dialogAddUnit", table: "MeasureUnit", canmodify: true, parentid: r.replace("tr", "") }); i.find("#txtQuantityAdd").val(n.find("[name=quantity]").html()); i.find("#txtDiscountAdd").val(n.find("[name=discount]").html()); i.find("#dialogAddUnit").dialog({ autoOpen: true }) } function EditUnit(e, t, n) { var r = $("#" + t); var i = { barcodeid: $("#" + n).find("#barcodeid").val(), oldMeasureUnitId: e, newMeasureUnitId: getHierarchySelectedValue("divUnitCategoryAdd", t), quantity: r.find("#txtQuantityAdd").val(), discount: r.find("#txtDiscountAdd").val() }; $.ajax({ type: "POST", data: JSON.stringify(i), url: "Management/EditUnit", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; if (e != null && e.isDone == true) { GetUnitList($("#" + n).find("#barcodeid").val(), n) } translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function DeleteUnit(e, t) { var n = $("#" + t); var r = e; var i = { barcodeid: $("#" + t).find("#barcodeid").val(), MeasureUnitId: r }; $.ajax({ type: "POST", url: "Management/DeleteUnit", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (t) { if (!isAuthenticated(t)) return; if (t != null && t.isDone == true) $("#tr" + e).remove(); translate(t.msg) }, error: function (e) { alert(e.responseText) } }) } function loadVisitorStatistic(e, t) { var n = $("#" + e); if (t) { getVisitorStatisticList(e, { container: e, callbackmethod: getVisitorStatisticList, fname: "", page_index: 0, build: buildVisitorStaticList, servicename: "Management", methodname: "GetVisitorStatistic", print: false }); n.find("[id=btnSearchVisitorStatistic]").button({ icons: { primary: "ui-icon-search"} }).unbind("click").click(function () { getVisitorStatisticList(e, { container: e, callbackmethod: getVisitorStatisticList, fname: "", page_index: 0, build: buildVisitorStaticList, servicename: "Management", methodname: "GetVisitorStatistic", print: false }) }) } } function loadVisitorStatisticManagement(e, t) { var n = $("#" + e); if (t) { getVisitorStatisticList(e, { container: e, callbackmethod: getVisitorStatisticList, fname: "", page_index: 0, build: buildVisitorStaticList, servicename: "Management", methodname: "GetVisitorStatisticForManagement", print: false }); n.find("[id=btnSearchVisitorStatistic]").button({ icons: { primary: "ui-icon-search"} }).unbind("click").click(function () { getVisitorStatisticList(e, { container: e, callbackmethod: getVisitorStatisticList, fname: "", page_index: 0, build: buildVisitorStaticList, servicename: "Management", methodname: "GetVisitorStatisticForManagement", print: false }) }) } } function getVisitorStatisticList(e, t) { var n = $("#" + e); if (t.page_index > 0) { t.first = false } var r = { sort: sortid }; t["DTO"] = r; pageselectCallback(0, t, { container: "", fname: t.fname, pagingContainer: e, first: true, isOrder: false }) } function buildVisitorStaticList(jq, container) { var $con = $("#" + container.pagingContainer); var table = {}; var lstb = []; var lsth = []; jq = jq.results; lsth.push({ title: "ip", width: "20%" }); lsth.push({ title: "countryName", width: "15%" }); lsth.push({ title: "cityName ", width: "10%" }); lsth.push({ title: "date", width: "20%" }); lsth.push({ title: "timeZone ", width: "5%" }); lsth.push({ title: "browser", width: "10%" }); lsth.push({ title: "appName", width: "10%" }); lsth.push({ title: "user", width: "10%" }); var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; trBody[0] = { name: "ip", html: val.ip, width: "20%" }; trBody[1] = { name: "countryName", html: val.countryName, width: "15%" }; trBody[2] = { name: "cityName", html: val.cityName, width: "10%" }; trBody[3] = { name: "date", html: val.dateTime, width: "20%" }; trBody[4] = { name: "timeZone", html: val.timeZone, width: "5%" }; trBody[5] = { name: "browser", html: val.browser, width: "10%" }; trBody[6] = { name: "appName", html: val.appName, width: "10%" }; trBody[7] = { name: "user", html: val.user, width: "10%" }; lstb.push(trBody) } table = { header: lsth, details: {}, body: lstb, container: container.pagingContainer, divName: "visitorStatistic" }; buildTable(table) } function loadAddFaq(e, t) { $con = $("#" + e); if (t) { getFaq("", e, true); $con.find("#btn_saveFaq").button({ icons: { primary: "ui-icon-plusthick"} }).unbind().click(function () { AddFaq(e) }); BuildFaqAccordion(e) } } function AddFaq(e) { var t = $("#" + e); var n = { question: t.find("#txtQuestion").val(), faq: $("[name='txtFaq']").val(), lang: $lang.val() }; $.ajax({ type: "POST", data: JSON.stringify(n), url: "Management/AddFaq", contentType: "application/json; charset=utf-8", success: function (t) { if (!isAuthenticated(t)) return; if (t.isDone) { BuildFaqAccordion(e) } translate(t.msg) }, error: function (e) { alert(e.responseText) } }) } function BuildFaqAccordion(e) { var t = $("#" + e); var n = { lang: $lang.val() }; $.ajax({ type: "POST", async: false, url: "Management/getFaqQuestions", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (n) { if (!isAuthenticated(n)) return; var r = { header: "ui-icon-circle-arrow-e", activeHeader: "ui-icon-circle-arrow-s" }; var i = t.find("#accordion"); i.accordion().accordion("destroy").html(""); for (var s = 0; s < n.length; s++) { var o = n[s]; var u = ""; u = "<li order='" + o.order + "' id='" + o.id + "' class='ui-state-default'>" + "<span name='question' >" + o.question + "</span>" + "<button OnlineMenuId='" + o.id + "' id='btn_edit'>ویرایش</button><button OnlineMenuId='" + o.id + "' id='btn_delete'>delete</button></li>"; i.append(u) } i.find("[id=btn_edit]").button({ icons: { primary: "ui-icon-pencil" }, text: true }).unbind("click").click(function () { getFaqForEdit($(this).parents("li").attr("id"), e); return false }); i.find("[id=btn_delete]").button({ icons: { primary: "ui-icon-pencil" }, text: true }).unbind("click").click(function () { deleteFaq($(this).parents("li").attr("id"), e); return false }); i.sortable({ axis: "y", stop: function (t, n) { n.item.children("h3").triggerHandler("focusout"); SortFaqQuestions(e) } }) }, error: function (e) { alert(e.responseText) } }) } function SortFaqQuestions(e) { var t = $("#" + e); var n = []; var r = 1; t.find("#accordion").children("li").each(function () { var e = {}; e["id"] = $(this).attr("id"); e["Priority"] = r; r++; n.push(e) }); var i = { sortFaq: n }; $.ajax({ type: "POST", async: false, url: "Management/sortFaqQuestions", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (e) { }, error: function (e) { alert(e.responseText) } }) } function getFaqForEdit(e, t) { var n = $("#" + t); var r = { id: e }; $.ajax({ type: "POST", async: false, url: "Management/getFaqForEdit", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (e) { if (!isAuthenticated(e)) return; n.find("#txtQuestion").val(e.result.question); n.find("[name='txtFaq']").val(e.result.answer) }, error: function (e) { alert(e.responseText) } }) } function deleteFaq(e, t) { var n = $("#" + t); var r = { id: e }; $.ajax({ type: "POST", async: false, url: "Management/deleteFaq", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (t) { if (!isAuthenticated(t)) return; if (t.isDone) { n.find("#accordion").find("#" + e).remove() } else alert(t.msg) }, error: function (e) { alert(e.responseText) } }) } function getFaq(e, t) { var n = $("#" + t); n.find("#divFaq").html("<textarea class='editor' name='txtFaq'></textarea></n><button id='btnSaveDefintion'>save</button>"); n.find(".editor").tinymce({ script_url: "../../Scripts/tinymce/tiny_mce.js", width: "100%", height: "500px", directionality: "rtl", theme: "advanced", verify_html: false, plugins: "pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template,wordcount,advlist,autosave", theme_advanced_buttons1: "save,newdocument,|,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,styleselect,formatselect,fontselect,fontsizeselect", theme_advanced_buttons2: "cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,image,cleanup,help,code,|,insertdate,inserttime,preview,|,forecolor,backcolor", theme_advanced_buttons3: "tablecontrols,|,hr,removeformat,visualaid,|,sub,sup,|,charmap,emotions,iespell,media,advhr,|,print,|,ltr,rtl,|,fullscreen", theme_advanced_buttons4: "insertlayer,moveforward,movebackward,absolute,|,styleprops,|,cite,abbr,acronym,del,ins,attribs,|,visualchars,nonbreaking,template,pagebreak,restoredraft,codehighlighting,netadvimage", theme_advanced_toolbar_location: "top", theme_advanced_toolbar_align: "right", theme_advanced_statusbar_location: "bottom", theme_advanced_resizing: false, save_onsavecallback: function () { AddFaq(t) }, content_css: "../../Scripts/tinymce/css/content.css", convert_urls: false }); n.find("#btnSaveDefintion").button().unbind("click").bind("click", function () { AddFaq(t) }) } function loadFaq(e, t) { $con = $("#" + e); if (t) { BuildFaqContent(e) } } function BuildFaqContent(e) { var t = $("#" + e); var n = { lang: $("#ddl_m_Language").val() }; $.ajax({ type: "POST", async: false, url: "Management/getFaqQuestions", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (n) { if (!isAuthenticated(n)) return; var r = { header: "ui-icon-circle-arrow-e", activeHeader: "ui-icon-circle-arrow-s" }; var i = t.find("#faqContent"); i.accordion().accordion("destroy").html(""); for (var s = 0; s < n.length; s++) { var o = n[s]; var u = ""; u = "<h3 id='" + o.id + "'>" + o.question + "</h3>" + "<div><p id='p" + o.id + "'></p></div>"; i.append(u) } i.accordion({ collapsible: true, heightStyle: "content", active: false, change: function (t, n) { if (n.newContent.length > 0 && n.newContent.html().length < 16) getFaqAnswer(n.newHeader.attr("id"), e) } }) }, error: function (e) { alert(e.responseText) } }) } function getFaqAnswer(e, t) { var n = $("#" + t); var r = { id: e }; $.ajax({ type: "POST", async: false, url: "Management/getFaqForEdit", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (t) { if (!isAuthenticated(t)) return; n.find("#faqContent").find("#p" + e).html(t.result.answer) }, error: function (e) { alert(e.responseText) } }) } function loadDashCharts(e, t) { var n = $("#" + e); if (t) { n.find("#sale7,#sale14,#sale30").unbind("click").click(function () { n.find("#sale7,#sale14,#sale30").removeClass("selected"); $(this).addClass("selected"); GetDashboardSaleChart(e, true, $(this).attr("data-days")) }); n.find("#top7,#top14,#top30,#top182,#top365").unbind("click").click(function () { n.find("#top7,#top14,#top30,#top182,#top365").removeClass("selected"); $(this).addClass("selected"); GetTopProductChart(e, true, $(this).attr("data-days")) }); n.find("#newSale").unbind("click").click(function () { $("[maintab='a_FullAcountReport']").trigger("click") }); n.find("#newProduct").unbind("click").click(function () { $("[maintab='InventoryAdd']").trigger("click"); $("[id='a_InventoryAdd']").trigger("click") }); GetDashboardSaleChart(e, true, 7); GetTopProductChart(e, true, 7) } } function GetDashboardSaleChart(e, t, n) { var r = $("#" + e); var i = "", s = "", o = "", u = "", a = "", f = "", l = "", c = "", h = ""; var p = "", d = "", v = ""; if (r.find("#moreFilter").is(":visible")) { var m = r.find("#ddl_d_SearchBy1").val(); if (m != "") { if (m == "Code") { s = r.find("#txtSearch1").val() } if (m == "Name") { i = r.find("#txtSearch1").val() } if (m == "EmployeeId") { o = r.find("#txtSearch1").val() } if (m == "EmployeeName") { u = r.find("#txtSearch1").val() } if (m == "Shop") { a = r.find("#txtSearch1").val() } } var m = r.find("#ddl_d_SearchBy2").val(); if (m != "") { if (m == "InvoiceId") { f = r.find("#txtSearch2").val() } if (m == "ProductId") { l = r.find("#txtSearch2").val() } if (m == "ProductName") { c = r.find("#txtSearch2").val() } if (m == "Barcode") { h = r.find("#txtSearch2").val() } } p = r.find("#txt_s_PriceFrom").val(); d = r.find("#txt_s_PriceTo").val(); v = getHierarchySelectedValue("hr_s_Category", e) } var g = ""; if (r.find("#Checkbox1" + e).prop("checked") && r.find("#Checkbox2" + e).prop("checked")) g = ""; else if (!r.find("#Checkbox1" + e).prop("checked") && r.find("#Checkbox2" + e).prop("checked")) g = false; else if (r.find("#Checkbox1" + e).prop("checked") && !r.find("#Checkbox2" + e).prop("checked")) g = true; var y = { Datetype: "DayDashboard", supplierid: "", IsClient: true, SupplierName: i, code: s, EmployeeId: o, EmployeeName: u, Shop: a, InvoiceId: f, ProductId: l, ProductName: c, Barcode: h, InvoiceDateStart: n, InvoiceDateEnd: "", InvoiceYearStart: "", InvoiceYearEnd: "", PriceFrom: p, PriceTo: d, Order: g, PreOrder: r.find("#Checkbox3" + e).length > 0 ? r.find("#Checkbox3" + e).prop("checked") : "", Broken: r.find("#Checkbox4" + e).length > 0 ? r.find("#Checkbox4" + e).prop("checked") : "", CategoryId: v, shopid: $("#userDefault").find("#ddl_s_Branch").val(), counterid: $("#userDefault").find("#ddl_m_Counter").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(y), type: "Post", url: "Management/GetSaleChart", success: function (e) { if (!isAuthenticated(e)) return; if (e != null) { var t = "0"; var i = "right"; var s = 0; var o = 0; var u = 0; var a = 0; var f = []; var l = []; var c = []; $.each(e, function () { f.push(ToPersianDate(this.date)); if (t == "Amount" || t == "0") { l.push(Math.ceil(this.amount * 10) / 10); c.push(Math.ceil(this.quantity * 10) / 10); s += Math.ceil(this.amount * 10) / 10; a += Math.ceil(this.quantity * 10) / 10 } }); if (e.length > 0) { r.find("#spTotalSale").html(Math.ceil(s * 10) / 10); r.find("#spAvSale").html(Math.ceil(s / n * 1 * 10) / 10); r.find("#spAvValue").html(Math.ceil(s / a * 10) / 10); $("#saleChart").highcharts({ credits: { enabled: false }, colors: ["#058DC7", "#50B432", "#ED561B", "#DDDF00", "#24CBE5", "#64E572", "#FF9655", "#FFF263", "#6AF9C4"], chart: { backgroundColor: { linearGradient: { x1: 0, y1: 0, x2: 1, y2: 1 }, stops: [[0, "rgb(255, 255, 255)"], [1, "rgb(240, 240, 255)"]] }, plotBackgroundColor: "rgba(255, 255, 255, .9)", plotShadow: true, plotBorderWidth: 1 }, title: { text: "" }, xAxis: { categories: f, labels: { rotation: -35, align: "right", style: { fontSize: "13px", fontFamily: "Verdana, sans-serif"}} }, yAxis: { title: { text: "مبلغ فروش"} }, tooltip: { valueSuffix: "تومان" }, plotOptions: { line: { dataLabels: { enabled: true }, enableMouseTracking: false} }, series: [{ name: "مبلغ ", color: "green", type: "spline", data: l, tooltip: { valueSuffix: " تومان"}}] }) } } }, error: function (e) { alert(e.responseText) } }); return false } function GetTopProductChart(e, t, n) { var r = $("#" + e); var i = { Datetype: "DayTopProduct", InvoiceDateStart: n, shopid: $("#userDefault").find("#ddl_s_Branch").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(i), type: "Post", url: "Management/GetTopProductChart", success: function (e) { if (!isAuthenticated(e)) return; if (e != null) { var t = []; var n = []; var r = []; $.each(e, function () { r.push(Math.ceil(this.quantity * 10) / 10); t.push(this.Name) }); if (e.length > 0) { $("#popular-products-chart").highcharts({ credits: { enabled: false }, chart: { backgroundColor: { linearGradient: { x1: 0, y1: 0, x2: 1, y2: 1 }, stops: [[0, "rgb(255, 255, 255)"], [1, "rgb(240, 240, 255)"]] }, plotBackgroundColor: "rgba(255, 255, 255, .9)", plotShadow: true, plotBorderWidth: 1 }, title: { text: "" }, yAxis: { title: { text: "تعداد فروش"} }, xAxis: { categories: t, labels: { rotation: -35, align: "right", style: { fontSize: "13px", fontFamily: "Verdana, sans-serif"}} }, tooltip: { formatter: function () { return '<div lang="fa" dir="rtl"> ' + this.x + " : " + this.y + " عدد"; "</div>" } }, plotOptions: { line: { dataLabels: { enabled: true }, enableMouseTracking: false} }, series: [{ name: "تعداد ", color: "#33CC33", type: "column", data: r, align: "right", tooltip: { valueSuffix: " عدد"}}] }) } } }, error: function (e) { alert(e.responseText) } }); return false } function loadSellChart(e, t) { if (t) { loadChart(t, e, true, { onLoad: true }) } } function loadBuyChart(e, t) { if (t) { loadChart(t, e, false, { onLoad: true }) } } function loadChart(e, t, n, r) { function l(e, t) { var n = $("#" + e); var r = "", i = "", s = "", o = "", u = "", a = "", f = "", l = "", c = ""; var h = "", p = "", d = ""; if (n.find("#moreFilter").is(":visible")) { var v = n.find("#ddl_d_SearchBy1").val(); if (v != "") { if (v == "Code") { i = n.find("#txtSearch1").val() } if (v == "Name") { r = n.find("#txtSearch1").val() } if (v == "EmployeeId") { s = n.find("#txtSearch1").val() } if (v == "EmployeeName") { o = n.find("#txtSearch1").val() } if (v == "Shop") { u = n.find("#txtSearch1").val() } } var v = n.find("#ddl_d_SearchBy2").val(); if (v != "") { if (v == "InvoiceId") { a = n.find("#txtSearch2").val() } if (v == "ProductId") { f = n.find("#txtSearch2").val() } if (v == "ProductName") { l = n.find("#txtSearch2").val() } if (v == "Barcode") { c = n.find("#txtSearch2").val() } } h = n.find("#txt_s_PriceFrom").val(); p = n.find("#txt_s_PriceTo").val(); d = getHierarchySelectedValue("hr_s_Category", e) } var m = ""; if (n.find("#Checkbox1" + e).prop("checked") && n.find("#Checkbox2" + e).prop("checked")) m = ""; else if (!n.find("#Checkbox1" + e).prop("checked") && n.find("#Checkbox2" + e).prop("checked")) m = false; else if (n.find("#Checkbox1" + e).prop("checked") && !n.find("#Checkbox2" + e).prop("checked")) m = true; var g = { Datetype: n.find("#ddl_d_GroupBy").val(), supplierid: n.find("#hd_d_PersonId").val(), IsClient: t, SupplierName: r, code: i, EmployeeId: s, EmployeeName: o, Shop: u, InvoiceId: a, ProductId: f, ProductName: l, Barcode: c, InvoiceDateStart: n.find("#txt_s_InvoiceMonthStart").val() + "/" + n.find("#txt_s_InvoiceDayStart").val(), InvoiceDateEnd: n.find("#txt_s_InvoiceMonthEnd").val() + "/" + n.find("#txt_s_InvoiceDayEnd").val(), InvoiceYearStart: n.find("#txt_s_InvoiceYearStart").val(), InvoiceYearEnd: n.find("#txt_s_InvoiceYearEnd").val(), PriceFrom: h, PriceTo: p, Order: m, PreOrder: n.find("#Checkbox3" + e).length > 0 ? n.find("#Checkbox3" + e).prop("checked") : "", Broken: n.find("#Checkbox4" + e).length > 0 ? n.find("#Checkbox4" + e).prop("checked") : "", CategoryId: d, shopid: $("#userDefault").find("#ddl_s_Branch").val(), counterid: $("#userDefault").find("#ddl_m_Counter").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(g), type: "Post", url: "Management/GetSaleChart", success: function (e) { var t = [7, 6, 9, 14, 18, 21, 25, 26, 23, 18, 13, 9]; if (!isAuthenticated(e)) return; if (e != null) { var r = n.find("#ddl_d_DisplayBy").val(); var i = "right"; var s = []; var o = []; var u = []; var a = []; if (e.name == "Month") o = PERSIAN_MONTHS; else if (e.name == "Season") o = ["بهار", "تابستان", "پاییز", "زمستان"]; $.each(e.data, function () { u.push(this.amount); if (e.name != "Month" && e.name != "Season" && e.name != "Week" && e.name != "Day") { o.push(this.name) } if (e.name == "Year") { o = this.name } a.push(this.quantity); var t = { name: this.name + " مبلغ", type: "column", data: this.amount }; var r = { name: this.name + " تعداد", type: "spline", yAxis: 1, data: this.quantity }; if (n.find("#ddl_d_DisplayBy").val() == "Amount") s.push(t); else if (n.find("#ddl_d_DisplayBy").val() == "Count") s.push(r); else { s.push(t); s.push(r) } }); if (s.length > 0) { n.find("#Div_SaleChart").highcharts({ title: { text: " ", x: -20 }, credits: { enabled: false }, colors: ["#058DC7", "#50B432", "#ED561B", "#DDDF00", "#24CBE5", "#64E572", "#FF9655", "#FFF263", "#6AF9C4"], chart: { backgroundColor: { linearGradient: { x1: 0, y1: 0, x2: 1, y2: 1 }, stops: [[0, "rgb(255, 255, 255)"], [1, "rgb(240, 240, 255)"]] }, plotBackgroundColor: "rgba(255, 255, 255, .9)", plotShadow: true, plotBorderWidth: 1 }, yAxis: [{ labels: { style: { color: "#89A54E"} }, title: { text: "مبلغ", style: { color: "#89A54E"}} }, { title: { text: "تعداد", style: { color: "#4572A7"} }, labels: { style: { color: "#4572A7"} }, opposite: true}], xAxis: { categories: o, labels: { rotation: -35, align: "right", style: { fontSize: "13px", fontFamily: "Verdana, sans-serif"}} }, series: s }) } else { $.plot(n.find("#Div_SaleChart"), [[0, 0]], { xaxis: { tickDecimals: "number" }, yaxes: [{ min: 0 }, { alignTicksWithAxis: i == "right" ? 1 : null, position: i}], legend: { position: "sw"} }) } } else { $.plot(n.find("#Div_SaleChart"), [[0, 0]], { bars: { show: false, barWidth: .5 }, xaxis: { tickDecimals: "number"} }) } }, error: function (e) { alert(e.responseText) } }); return false } var i = $("#" + t); if (e) { i.find("#moreFilter").slideUp("fast"); i.find(".toggle-more-filters").click(function () { $(this).toggleClass("open"); i.find("#moreFilter").slideToggle(function () { }) }); ChangeCheckBoxGroupName("Check", t); var s = " <option value=''>روز </option>", o = "<option value=''>ماه </option>", u = " <option value=''>سال </option>"; var a = new Date; a = a.getFullYear() * 1 - 621 + 1; for (var f = 1; f < 32; f++) { s += " <option value='" + f + "'>" + f + "</option>"; if (f < 13) o += " <option value='" + f + "'>" + f + "</option>" } for (var f = 1388; f < a; f++) { u += " <option value='" + f + "'>" + f + "</option>" } i.find("#txt_s_InvoiceDayStart").html(s); i.find("#txt_s_InvoiceDayStart").val("1"); i.find("#txt_s_InvoiceMonthStart").html(o); i.find("#txt_s_InvoiceMonthStart").val("1"); i.find("#txt_s_InvoiceYearStart").html(u); i.find("#txt_s_InvoiceYearStart").val("1388"); i.find("#txt_s_InvoiceDayEnd").html(s); i.find("#txt_s_InvoiceDayEnd").val("29"); i.find("#txt_s_InvoiceMonthEnd").html(o); i.find("#txt_s_InvoiceMonthEnd").val("12"); i.find("#txt_s_InvoiceYearEnd").html(u); i.find("#txt_s_InvoiceYearEnd").val(a * 1 - 1); i.find("#ddl_d_GroupBy").val("Month"); bindHierarchyData({ id: "hr_s_Category", table: "category", container: t }); i.find("#btnSearch").button({ icons: { primary: "ui-icon-search"} }).unbind("click").click(function () { l(t, n) }); if (r.onLoad) { l(t, n) } } } function loadOrderType(e, t) { var n = $("#" + e); if (t) { n.find("#treeDemo").attr("id", "treeDemo" + e); var r = "treeDemo" + e; $.fn.zTree.init(n.find("#" + r), setting); zTree = $.fn.zTree.getZTreeObj(r); n.find("#btn_Refresh").off().on("click", function () { $.fn.zTree.init(n.find("#" + r), setting); zTree = $.fn.zTree.getZTreeObj(r) }); n.find("#addTableAccount").off().on("click", function () { addTableAccount(e) }).button({ icons: {}, text: true }); n.find("#btn_saveOrderType").off().on("click", function () { }).button({ icons: { primary: "ui-icon-disk" }, text: true }); n.find("#btn_addRelatedAcc").off().on("click", function () { var t = zTree.getSelectedNodes()[0].id; var n = getHierarchySelectedValue("hr_m_Category", e); addrelatedAcc(t, n); getRelatedAcc(t) }).button({ icons: { primary: "ui-icon-disk" }, text: true }); bindLoadAddOrder(); n.find("#frm_AddAccount").ajaxForm({ success: function (e) { if (e.isdone) { if (e.isEdit) { EditTreeNode(e.name) } else { var t = { name: e.name, id: e.id }; addNewTreeNode(t) } translate(e.msg) } }, complete: function (e) { } }); localize() } } function bindLoadAddOrder() { var e = "frm_AddAccount"; $("#Level").unbind("change").bind("change", function (t) { if ($(this).val() == "0") { bindItemsForSelectCombo({ methodname: "GetComboItems", servicename: "XmlDropDown", headertext: "انتخاب ماهیت حساب", id: "AccountNature", container: e }, { path: "XmlData/AccountNatureTitleGroup" }); bindItemsForSelectCombo({ methodname: "GetComboItems", servicename: "XmlDropDown", headertext: "انتخاب گروه", id: "GroupType", container: e }, { path: "XmlData/GroupTypeTitle" }) } if ($(this).val() == "1") { bindItemsForSelectCombo({ methodname: "GetComboItems", servicename: "XmlDropDown", headertext: "انتخاب ماهیت حساب", id: "AccountNature", container: e }, { path: "XmlData/AccountNatureTitleGeneral" }); $con.find("#GroupType").html(""); $con.find("#GroupType").attr("disabled", true) } if ($(this).val() == "2") { bindItemsForSelectCombo({ methodname: "GetComboItems", servicename: "XmlDropDown", headertext: "انتخاب ماهیت حساب", id: "AccountNature", container: e }, { path: "XmlData/AccountNatureTitleLegen" }); $con.find("#GroupType").html(""); $con.find("#GroupType").attr("disabled", true) } if ($(this).val() == "3") { $con.find("#AccountNature").html(""); $con.find("#GroupType").html(""); $con.find("#AccountNature").attr("disabled", true); $con.find("#GroupType").attr("disabled", true) } }); bindItemsForSelectCombo({ methodname: "GetComboItems", servicename: "XmlDropDown", headertext: "انتخاب نوع حساب", id: "tableAccount", container: e }, { path: "XmlData/TableAccount" }); bindHierarchyData({ id: "hr_m_Category", container: e, canmodify: false, table: "account" }); bindRawDropDownData({ id: "divOrderType", container: e, path: "orderType", canmodify: true, istext: false, headertext: "orderType", css: "selectsmall " }); bindHierarchyData({ id: "divAccount", container: e, table: "account", isAccount: true, canmodify: true, css: "selectsmall1 required validate" }) } function AccountgetFont(e, t) { return t.font ? t.font : {} } function AccountremoveHoverDom(e, t) { var n = "frm_AddAccount"; var r = $("#" + n); r.find("#addBtn_" + t.tId).unbind().remove() } function AccoountaddHoverDom(e, t) { var n = "frm_AddAccount"; var r = $("#" + n); var i = r.find("#" + t.tId + "_span"); if (t.editNameFlag || r.find("#addBtn_" + t.tId).length > 0) return; var s = "<span class='button add' id='addBtn_" + t.tId + "' title='add node' onfocus='this.blur();'></span>"; i.after(s); var o = r.find("#addBtn_" + t.tId); if (o) o.bind("click", function () { r.find("#btn_saveOrderType").button({ icons: { primary: "ui-icon-disk" }, text: true, label: "add" }); localize(); r.find("#GroupType").html(""); r.find("#txt_name").val(""); r.find("#tableAccount").val(""); r.find("#txt_code").val(""); r.find("#lbl_balanceAmount").text("0"); r.find("#hi_isEdit").val(false); r.find("#hi_SelectedParentAccId").val(t.id); bindLoadAddOrder(); zTree.selectNode(t); return false }) } function AccountbeforeEditName(e, t, n, r) { var i = "frm_AddAccount"; var s = $("#" + i); s.find("#hi_isEdit").val(true); s.find("#hi_SelectedParentAccId").val(t.id); getRelatedAcc(t.id); zTree.selectNode(t); return false } function AccountbeforeRemove(e, t) { var n = false; if (confirm("Confirm delete node '" + t.name + "' it?")) { var r = t.id; var i = { TableName: "Account", id: r }; $.ajax({ type: "POST", async: false, url: "Management/DeleteTree", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (e) { n = e.isdone; var t = "frm_AddAccount"; var r = $("#" + t); r.find("#hi_isEdit").val(false); r.find("#hi_SelectedParentAccId").val("0"); $("#btn_saveOrderType").button({ icons: { primary: "ui-icon-disk" }, text: true, label: "add" }) }, error: function (e) { alert(e.responseText) } }) } return n } function AccountonRename(e, t, n, r) { var i = "frm_AddAccount"; var s = $("#" + i); s.find("#hi_isEdit").val(true); s.find("#hi_SelectedParentAccId").val(n.id); getRelatedAcc(n.id) } function AccountonAsyncSuccess(e, t, n, r) { var i = "frm_AddAccount"; var s = $("#" + i); s.find(".zTreeDemoBackground li:even").css("background-color", "#FFFFFF"); s.find(".zTreeDemoBackground li:odd").css("background-color", "#E6F2FF") } function AccountbeforeDrag(e, t) { for (var n = 0, r = t.length; n < r; n++) { if (t[n].drag === false) { return false } } return true } function AccountOnDrop(e, t, n, r, i) { var s = []; for (var o = 0; o < n.length; o++) { s[o] = n[o].id } var u = { TableName: "Account", TargetId: r == null ? null : i == "inner" ? r.id : r.getParentNode() == null ? null : r.getParentNode().id, treeNodes: s, children: null }; $.ajax({ type: "POST", async: false, url: "Management/TreeDaragDrop", contentType: "application/json; charset=utf-8", data: JSON.stringify(u), success: function (e) { if (e.isdone) alert(e.msg) }, error: function (e) { alert(e.responseText) } }) } function ajaxDataFilter(e, t, n) { if (n) { for (var r = 0; r < n.length; r++) { n[r].name += n[r].code } } } function AccountonClick(e, t, n) { var r = "frm_AddAccount"; var i = $("#" + r); i.find("#hi_isEdit").val(true); i.find("#hi_SelectedParentAccId").val(n.id); getRelatedAcc(n.id); i.find("#btn_saveOrderType").button({ icons: { primary: "ui-icon-disk" }, text: true, label: "edit" }); localize() } function getRelatedAcc(e) { $("#ul_RelatedAcc").html(""); var t = { TableName: "Account", Id: e }; var n = "div_Details"; var r = $("#" + n); $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(t), type: "Post", url: "Management/getTreeItem", async: false, success: function (e) { if (e.isDone) { if (e.level != null) { if (e.level == "0") { bindItemsForSelectCombo({ async: false, methodname: "GetComboItems", servicename: "XmlDropDown", headertext: "انتخاب ماهیت حساب", id: "AccountNature", container: n }, { path: "XmlData/AccountNatureTitleGroup" }); bindItemsForSelectCombo({ async: false, methodname: "GetComboItems", servicename: "XmlDropDown", headertext: "انتخاب گروه", id: "GroupType", container: n }, { path: "XmlData/GroupTypeTitle" }) } if (e.level == "1") { bindItemsForSelectCombo({ async: false, methodname: "GetComboItems", servicename: "XmlDropDown", headertext: "انتخاب ماهیت حساب", id: "AccountNature", container: n }, { path: "XmlData/AccountNatureTitleGeneral" }); r.find("#GroupType").html(""); r.find("#GroupType").attr("disabled", true) } if (e.level == "2") { bindItemsForSelectCombo({ async: false, methodname: "GetComboItems", servicename: "XmlDropDown", headertext: "انتخاب ماهیت حساب", id: "AccountNature", container: n }, { path: "XmlData/AccountNatureTitleLegen" }); r.find("#GroupType").html(""); r.find("#GroupType").attr("disabled", true) } if (e.level == "3") { r.find("#AccountNature").html(""); r.find("#GroupType").html(""); r.find("#AccountNature").attr("disabled", true); r.find("#GroupType").attr("disabled", true) } } $("#txt_name").val(e.name); $("#Level").val(e.level); $("#AccountNature").val(e.accNature); $("#GroupType").val(e.groupType); if (e.tableAccount != "") $("#tableAccount").val(e.tableAccount); else $("#tableAccount").val(""); $("#txt_code").val(e.Code); $("#lbl_balanceAmount").text(e.Amount); if (e.relatedacc.length == 0) r.find("#hr_m_Category").addClass("hidden"); else r.find("#hr_m_Category").removeClass("hidden"); for (var t = 0; t < e.relatedacc.length; t++) { var i = e.relatedacc[t]; var s = i.split(" "); var o = ""; for (var u = 1; u < s.length; u++) { o += " " + s[u] } var a = '<li id="' + s[0] + '" ><div class="bg-info"><br class="cleaner"><table style="font-family: tahoma; font-size: small" ><tr><td width="5%"></td><td width="60%">' + o + "</td>" + '<td width="10%" align="center" valign="middle"><span id="delete" id="delete" class="cursor ui-icon ui-icon-closethick"> </td>' + "</tr></table><br class='cleaner'></div><br class='cleaner'></li>"; $("#ul_RelatedAcc").append(a) } $("[id=delete]").unbind().click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) { var e = $(this).parents("li").first().prop("id"); if (deleterelateAcc(zTree.getSelectedNodes()[0].id, e)) $("#" + e).remove() } else return }) } else { $("#hi_isEdit").val(false); r.find("#hr_m_Category").addClass("hidden"); alert(e.msg) } }, error: function (e) { alert(e.responseText) } }) } function deleterelateAcc(e, t) { var n = { parentAccId: e, relatedAccId: t }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(n), type: "Post", url: "Management/deleteRelatedAcc", success: function (t) { if (t.isdone) { alert(t.msg); getRelatedAcc(e); return true } else { alert("not allow"); return false } }, error: function (e) { alert(e.responseText) } }) } function AccountonDblClick(e, t, n) { var r = "frm_AddAccount"; var i = $("#" + r); i.find("#hi_isEdit").val(false); i.find("#hi_SelectedParentAccId").val("0"); zTree.cancelSelectedNode(n) } function addNewTreeNode(e) { if (zTree.getSelectedNodes()[0]) { $("#hi_SelectedParentAccId").val(zTree.getSelectedNodes()[0].id); e.checked = zTree.getSelectedNodes()[0].checked; zTree.addNodes(zTree.getSelectedNodes()[0], e) } else { zTree.addNodes(null, e) } } function EditTreeNode(e, t) { var n = zTree.getSelectedNodes()[0]; n.name = e; zTree.updateNode(n) } function addrelatedAcc(e, t) { var n = { parentAccId: e, relatedAccId: t }; $.ajax({ type: "POST", url: "Management/addRelatedAcc", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (e) { if (e.isdone) return true; else return false; alert(e.msg) }, error: function (e) { alert(e.responseText) } }) } function addTableAccount(e) { var t = $("#" + e); var n = { accountId: getHierarchySelectedValue("divAccount", e), table: t.find("#ddl_Table").val() }; $.ajax({ type: "POST", url: "Management/AddTableAccount", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function loadEmployeeHelp(e, t) { var n = $("#" + e); if (t) { n.find("#newEmployee").unbind("click").bind("click", function () { $("[id='a_EmployeeAdd']").trigger("click") }); n.find("#management").unbind("click").bind("click", function () { $("[id='a_EmployeeList']").trigger("click") }) } } function loadEmployeeAdd(e, t) { if (t) { var n = $("#" + e); n.find("#text_empbdate").datepicker({ changeMonth: true, changeYear: true }); n.find("#text_empregdate").datepicker({ changeMonth: true, changeYear: true, onClose: function () { validateAll($("#" + e)) } }); n.find("#addemployee").button({ icons: { primary: "ui-icon-disk" }, text: true }).unbind("click").click(function () { if (validateAll($("#" + e))) addEmployee(e) }); n.find("#text_empregdate").datepicker({ changeMonth: true, changeYear: true, onClose: function () { validateAll($("#" + e)) } }); aComplete({ methodname: "GetCompletionListByEmployeeName", servicename: "Management", id: "text_empmaneger", container: e, minlength: 2, autofocus: false, limit: 20, boxId: "text_empmaneger" }); bindHierarchyData({ id: "divEmployeeAddress", container: e, table: "address", canmodify: true, css: "selectsmall1 required validate" }) } } function addEmployee(e) { var t = $("#" + e); $.ajax({ type: "POST", url: "Management/AddEmployee", contentType: "application/json; charset=utf-8", data: "{username: '" + t.find("#text_username").val() + "', pass: '" + t.find("#text_password").val() + "', email: '" + t.find("#text_empemail").val() + "', name: '" + t.find("#text_empName").val() + "', famil: '" + t.find("#text_empfamily").val() + "', male: '" + t.find("#ddl_m_Gender").val() + "', bdate: '" + t.find("#text_empbdate").val() + "', rdate: '" + t.find("#text_empregdate").val() + "', tell: '" + t.find("#text_emptell").val() + "', mobile: '" + t.find("#text_empmobile").val() + "', meli: '" + t.find("#text_empmelicode").val() + "', acc: '" + t.find("#text_empaccount").val() + "', maneg: '" + t.find("#text_empmaneger").val() + "', addressId: '" + getHierarchySelectedValue("divEmployeeAddress", e) + "'}", success: function (e) { if (!isAuthenticated(e)) return; if (e.isdone && e.isAdmin) location.reload(true); else if (e.isdone && !e.isAdmin) translate(e.msg); else if (!e.isdone) translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function loadEmployeeList(e, t) { if (t) { sortid = "AccountId desc"; var n = $("#" + e); n.find("#refreshEmployeeList").button({ icons: { primary: "ui-icon-refresh" }, text: false }).unbind("click").click(function () { getEmployeeList(e, { container: e, callbackmethod: getEmployeeList, fname: "", page_index: 0, build: buildEmployeeList, servicename: "Management", methodname: "EmployeeList", print: false }) }); getEmployeeList(e, { container: e, callbackmethod: getEmployeeList, fname: "", page_index: 0, build: buildEmployeeList, servicename: "Management", methodname: "EmployeeList", print: false }) } } function buildEmployeeList(jq, container) { var $con = $("#" + container.pagingContainer); var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "name", width: "15%" }); lsth.push({ title: "code", width: "10%" }); lsth.push({ title: "dateOfEmployment", width: "20%" }); lsth.push({ title: "phone", width: "15%" }); lsth.push({ title: "manager", footer: jq.sumDebtor, width: "16%" }); lsth.push({ title: "image", width: "20%" }); if (!container.params.print) { lsth.push({ title: "deleteKey", width: "4%" }) } var List = typeof jq.results == "string" ? eval("(" + jq.results + ")") : jq.results; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; if (!container.params.print) trBody[0] = { trId: val.id }; trBody[1] = { name: "name", html: val.name, width: "15%" }; trBody[2] = { name: "code", html: val.code, width: "10%" }; trBody[3] = { props: { date: val.regdate, name: "date", width: "20%", klass: "dateLong" }, html: val.regdate }; trBody[4] = { name: "tell", html: val.tell, width: "15%" }; trBody[5] = { name: "manager", html: val.manager, width: "16%" }; trBody[6] = { name: "image", html: "<img class='imagefortable' src='ImageHandler/EmployeeLargePhoto.ashx?EmployeeCode=" + val.code + "' />", width: "20%" }; lstb.push(trBody) } table = { header: lsth, body: lstb, details: { deleteFunction: DeleteEmployee, rowClick: ClickEmployee }, heigth: 300, container: container.pagingContainer, divName: "employeeList" }; buildTable(table) } function getEmployeeList(e, t) { var n = $("#" + e); pageselectCallback(0, t, { container: "", noPaging: true, fname: t.fname, pagingContainer: e, first: true, isOrder: false }) } function ClickEmployee(e, t) { createSubTab({ row: e, name: "a_EmployeeList" }); itemId = e.prop("id").replace("tr", ""); employeeid = itemId; onRowClick(e) } function DeleteEmployee(e, t) { $.ajax({ type: "POST", url: "Management/Deleteemployee", contentType: "application/json; charset=utf-8", data: "{id: '" + e + "' }", success: function (e) { if (!isAuthenticated(e)) return; if (e.isDone) getEmployeeList(t, { container: t, callbackmethod: getEmployeeList, fname: "", page_index: 0, build: buildEmployeeList, servicename: "Management", methodname: "EmployeeList", print: false }); translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function getEmployee(employeeid, container) { $.ajax({ type: "POST", url: "Management/getEmployee", contentType: "application/json; charset=utf-8", data: "{id: '" + employeeid + "' }", success: function (response) { if (!isAuthenticated(response)) return; var Employee = typeof response == "string" ? eval("(" + response + ")") : response; var empval = Employee[0]; var con = $("#" + container); bindHierarchyData({ id: "divEmployeeAddress", table: "address", container: container, parentid: empval.AddressId, css: "selectsmall required validate" }); con.find("#hid_empid").val(empval.AccountId); con.find("#text_empemail").val(empval.Email); con.find("#text_empName").val(empval.Name); con.find("#text_empfamily").val(empval.Family); con.find("#text_empbdate").val(empval.DateOfBirth); con.find("#text_empregdateEdit").val(ToPersianDateDigitYearRight(empval.RegDate)); con.find("#text_emphdate").val(ToPersianDateDigitYearRight(empval.HierDate)); con.find("#text_empmelicode").val(empval.IdCart); con.find("#text_empaccount").val(empval.AccountNumber); con.find("#text_empmaneger").val(empval.managere); con.find("#ddl_m_Gender").val("" + empval.Gender + "") }, error: function (e) { alert(e.responseText) } }) } function loadSubEmployeeHelp(e, t, n) { var r = $("#" + t); if (n) { r.find("#edit").unbind("click").bind("click", function () { r.parent().find("[id='a_EmployeeEdit']").trigger("click") }); r.find("#accessDetail").unbind("click").bind("click", function () { r.parent().find("[id='a_EmployeeAccessDetails']").trigger("click") }); r.find("#roles").unbind("click").bind("click", function () { r.parent().find("[id='a_EmployeeRole']").trigger("click") }); r.find("#branches").unbind("click").bind("click", function () { r.parent().find("[id='a_EmployeeShop']").trigger("click") }); r.find("#counters").unbind("click").bind("click", function () { r.parent().find("[id='a_EmployeeCounter']").trigger("click") }) } } function loadEmployeeEdit(e, t, n) { getEmployee(e, t); if (n) { var r = $("#" + t); r.find("#butn_Editemployee").button({ icons: { primary: "ui-icon-disk" }, text: true }).unbind("click").click(function () { if (validateAll($("#" + t))) EditEmployee(t) }); r.find("#text_empregdateEdit").datepicker({ changeMonth: true, changeYear: true, onClose: function () { validateAll($("#" + t)) } }); r.find("#text_emphdate").datepicker({ changeMonth: true, changeYear: true, onClose: function () { validateAll($("#" + t)) } }); aComplete({ methodname: "GetCompletionListByEmployeeName", servicename: "Management", id: "text_empmaneger", container: t, minlength: 2, autofocus: false, limit: 20, boxId: "text_empmaneger" }) } } function EditEmployee(e) { var t = $("#" + e); $.ajax({ type: "POST", url: "Management/EditEmployee", contentType: "application/json; charset=utf-8", data: "{id: '" + t.find("#hid_empid").val() + "', name: '" + t.find("#text_empName").val() + "', famil: '" + t.find("#text_empfamily").val() + "', gender: '" + t.find("#ddl_m_Gender").val() + "', bdate: '" + t.find("#text_empbdate").val() + "', regdate: '" + t.find("#text_empregdateEdit").val() + "', hdate: '" + t.find("#text_emphdate").val() + "', meli: '" + t.find("#text_empmelicode").val() + "', acc: '" + t.find("#text_empaccount").val() + "', manage: '" + t.find("#text_empmaneger").val() + "', addressId: '" + getHierarchySelectedValue("divEmployeeAddress", e) + "'}", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function loadEmployeeAccessDetails(e, t, n) { if (n) { var r = $("#" + t); r.find("#btn_ChangeEmail").off().on("click", function (n) { ChangeUserName(t, e) }); r.find("#btn_changePassword").button({ icons: { primary: "ui-icon-disk" }, text: true }).off().on("click", function (n) { if (validateAll(r.find("#div_pass"))) ChangePassword(t, e) }); r.find("#btn_editEmail").button({ icons: { primary: "ui-icon-disk" }, text: true }).off().on("click", function (n) { if (validateAll(r.find("#div_email"))) ChangeEmail(t, e) }); ChangeCheckBoxName("cb_userStatus", t); r.find("#cb_userStatus" + t).button(); getEmployeeEmail(t, e); r.find("#cb_userStatus" + t).unbind("change").change(function () { SetUserStatus(e, this.checked); if (this.checked) $(this).button("option", "label", "غیرفعال"); else $(this).button("option", "label", "فعال") }) } } function SetUserStatus(e, t) { $.ajax({ type: "POST", url: "Management/SetUserStatus", contentType: "application/json; charset=utf-8", data: "{id: '" + e + "', status: '" + t + "'}", error: function (e) { translate("error") }, success: function (e) { if (!isAuthenticated(e)) return; return e.msg } }) } function getEmployeeEmail(e, t) { var n = $("#" + e); $.ajax({ type: "POST", url: "Management/GetEmployeeEmail", contentType: "application/json; charset=utf-8", data: "{id: '" + t + "'}", error: function (e) { translate("error") }, success: function (t) { if (!isAuthenticated(t)) return; if (t.isdone) { n.find("#text_empemailEdit").val(t.msg); if (t.status) { n.find("#cb_userStatus" + e).attr("checked", true); n.find("#cb_userStatus" + e).button("option", "label", "غیرفعال") } else { n.find("#cb_userStatus" + e).attr("checked", false); n.find("#cb_userStatus" + e).button("option", "label", "فعال") } } else translate(t.msg) } }) } function ChangeEmail(e, t) { var n = $("#" + e); $.ajax({ type: "POST", url: "Management/ChangeEmail", contentType: "application/json; charset=utf-8", data: "{email: '" + n.find("#text_empemailEdit").val() + "', id: '" + t + "'}", error: function (e) { translate("error") }, success: function (e) { if (!isAuthenticated(e)) return; if (e.isdone) alert("ایمیل با موفقیت ثبت شد."); else translate(e.msg) } }) } function ChangePassword(e, t) { var n = $("#" + e); $.ajax({ type: "POST", url: "Management/ChangePassword", contentType: "application/json; charset=utf-8", data: "{oldPassword: '" + n.find("#txt_s_OldPassword").val() + "', newPassword: '" + n.find("#txt_s_NewPassword").val() + "', passwordConfirm: '" + n.find("#txt_s_PasswordConfirm").val() + "', id: '" + t + "'}", error: function (e) { translate("error") }, success: function (e) { if (!isAuthenticated(e)) return; if (e == "different") alert("تکرار کلمه عبور با کلمه عبور برابر نیست."); else if (e == "done") alert("کلمه عبور ا موفقیت ثبت شد."); else if (e == "incorrect") alert("کلمه عبور صحیح نیست.") } }) } function ChangeUserName(e, t) { var n = $("#" + e); $.ajax({ type: "POST", url: "Management/ChangeUserName", contentType: "application/json; charset=utf-8", data: "{password: '" + n.find("#txt_s_CurrentPassword").val() + "', newUser: '" + n.find("#txt_s_NewUserName").val() + "', userConfirm: '" + n.find("#txt_s_UserNameConfirm").val() + "', id: '" + t + "'}", error: function (e) { translate("error") }, success: function (e) { if (!isAuthenticated(e)) return; if (e == "exist") alert("نام کاربری مجاز نیست."); else if (e == "different") alert("ایمیل با تکرار ایمیل برابر نیست."); else document.getElementById("userEmail").innerHTML = "<strong>نام کاربری فعلی شما </strong>" + e + "<strong> می باشد.</strong>" } }) } function loadEmployeeRole(e, t, n) { if (n) { var r = $("#" + t); var i = "treeDemo" + t; r.find("#treeDemo").attr("id", "treeDemo" + t); Rolesetting.async.otherParam = { empId: e }; $.fn.zTree.init(r.find("#" + i), Rolesetting); RolezTree = $.fn.zTree.getZTreeObj(i); r.find("#btn_Refresh").off().on("click", function () { $.fn.zTree.init(r.find("#" + i), Rolesetting); RolezTree = $.fn.zTree.getZTreeObj(i) }); r.find("#frm_EmployeeRole").ajaxForm({ success: function (e) { if (e.isdone) { if (e.isEdit) { CategoryEditTreeNode(e.name, e.isCheck, e.id) } else { var t = { name: e.name, id: e.id, isChecked: e.isCheck }; categoryaddNewTreeNode(t) } } else alert(e.msg) }, complete: function (e) { } }) } } function RolegetFont(e, t) { return t.font ? t.font : {} } function RoleonAsyncSuccess(e, t, n, r) { var i = "frm_EmployeeRole"; var s = $("#" + i); s.find(".zTreeDemoBackground li:even").css("background-color", "#FFFFFF"); s.find(".zTreeDemoBackground li:odd").css("background-color", "#E6F2FF") } function RoleonCheck(e, t, n) { $.ajax({ type: "POST", url: "Management/AddroleforUser", contentType: "application/json; charset=utf-8", data: "{id: '" + n.empId + "', role: '" + n.name + "', ischecked: '" + n.isChecked + "' }", success: function (e) { if (!isAuthenticated(e)) return; if (e.isdone) alert("نقش ها با موفقیت ثبت شد."); else { translate(e.msg) } }, error: function (e) { alert(e.responseText) } }); return false } function loadEmployeeShop(e, t, n) { getEmployeeShopList(e, t); if (n) { var r = $("#" + t); bindItemsForSelectCombo({ methodname: "getShopNameByUser", servicename: "Management", headertext: "انتخاب شعبه", id: "ParentEmployeeShop", container: t }); r.find("#addEmployeeShop").button({ icons: { primary: "ui-icon-disk" }, text: true }).off().on("click", function (n) { addEmployeeShop(e, t) }); $("#" + t).find("#refreshEmployeeShopList").button({ icons: { primary: "ui-icon-refresh" }, text: false }).unbind("click").click(function () { getEmployeeShopList(e, t); bindItemsForSelectCombo({ methodname: "getShopNameByUser", servicename: "Management", headertext: "انتخاب شعبه", id: "ParentEmployeeShop", container: t }) }) } } function addEmployeeShop(e, t) { var n = $("#" + t); $.ajax({ type: "POST", url: "Management/AddEmployeeShop", contentType: "application/json; charset=utf-8", data: "{shopid: '" + n.find("#ParentEmployeeShop").val() + "', personid: '" + e + "'}", success: function (n) { if (!isAuthenticated(n)) return; translate(n.msg); getEmployeeShopList(e, t) }, error: function (e) { alert(e.responseText) } }) } function getEmployeeShopList(id, container) { var $con = $("#" + container); $.ajax({ type: "POST", url: "Management/getEmployeeShopList", contentType: "application/json; charset=utf-8", data: "{ personid: '" + id + "'}", success: function (response) { if (!isAuthenticated(response)) return; var shop = typeof response == "string" ? eval("(" + response + ")") : response; var shopItem = ""; for (var j = 0; j < shop.length; j++) { var val = shop[0, j]; shopItem += "<tr id='tr" + val.ShopId + "' ><td width='80%'>" + val.Name + val.Code + "</td>" + "<td id='delete' width='20%'><button id='a_Button'>حذف</button></td></tr>" } $con.find("#EmployeeShopList").html(shopItem).parent().tableScroll({ height: 380, width: contentwidth, flush: false }); $con.find("[id=a_Button]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) RemoveEmplyeeShop($(this).parents("tr").prop("id").replace("tr", ""), id, container); else return }) }, error: function (e) { alert(e.responseText) } }) } function RemoveEmplyeeShop(e, t, n) { var r = $("#" + n); $.ajax({ type: "POST", url: "Management/DeleteEmployeeShop", contentType: "application/json; charset=utf-8", data: "{shopid: '" + e + "', personid: '" + t + "'}", success: function (e) { if (!isAuthenticated(e)) return; translate(e); getEmployeeShopList(t, n) }, error: function (e) { alert(e.responseText) } }) } function loadEmployeeCounter(e, t, n) { if (n) { var r = $("#" + t); bindItemsForSelectCombo({ methodname: "getCounterNameForUser", servicename: "Management", headertext: "انتخاب صندوق", id: "ParentEmployeeCounter", container: t }); r.find("#addEmployeeCounter").button({ icons: { primary: "ui-icon-disk" }, text: true }).off().on("click", function (n) { addEmployeeCounter(e, t) }); $("#" + t).find("#refreshEmployeeCounterList").button({ icons: { primary: "ui-icon-refresh" }, text: false }).unbind("click").click(function () { getEmployeeCounterList(e, t); bindItemsForSelectCombo({ methodname: "getCounterNameForUser", servicename: "Management", headertext: "انتخاب صندوق", id: "ParentEmployeeCounter", container: t }) }) } getEmployeeCounterList(e, t) } function addEmployeeCounter(e, t) { var n = $("#" + t); $.ajax({ type: "POST", url: "Management/AddEmployeeCounter", contentType: "application/json; charset=utf-8", data: "{counterid: '" + n.find("#ParentEmployeeCounter").val() + "', personid: '" + e + "'}", success: function (n) { if (!isAuthenticated(n)) return; translate(n.msg); getEmployeeCounterList(e, t) }, error: function (e) { alert(e.responseText) } }) } function getEmployeeCounterList(id, container) { var $con = $("#" + container); $.ajax({ type: "POST", url: "Management/getEmployeeCounterList", contentType: "application/json; charset=utf-8", data: "{ personid: '" + id + "'}", success: function (response) { if (!isAuthenticated(response)) return; var shop = typeof response == "string" ? eval("(" + response + ")") : response; var shopItem = ""; for (var j = 0; j < shop.length; j++) { var val = shop[0, j]; shopItem += "<tr id='tr" + val.AccountId + "'>" + "<td width='80%'>" + val.Code + "</td>" + "<td id='delete' width='80%'><button id='a_Button'>حذف</button></td></tr>" } $con.find("#EmployeeCounterList").html(shopItem).parent().tableScroll({ height: 380, width: contentwidth, flush: false }); $con.find("[id=a_Button]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) RemoveEmplyeeCounter($(this).parents("tr").prop("id").replace("tr", ""), id, container); else return }) }, error: function (e) { alert(e.responseText) } }) } function RemoveEmplyeeCounter(e, t, n) { var r = $("#" + n); $.ajax({ type: "POST", url: "Management/DeleteEmployeeCounter", contentType: "application/json; charset=utf-8", data: "{counterid: '" + e + "', personid: '" + t + "'}", success: function (e) { if (!isAuthenticated(e)) return; if (e.isDone) getEmployeeCounterList(t, n); translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function loadShopHelp(e, t) { var n = $("#" + e); if (t) { n.find("#newBranch").unbind("click").bind("click", function () { $("[id='a_ShopAdd']").trigger("click") }); n.find("#management").unbind("click").bind("click", function () { $("[id='a_ShopList']").trigger("click") }) } } function loadShopAdd(e, t) { if (t) { var n = $("#" + e); n.find("#text_shopDateStart").datepicker({ changeMonth: true, changeYear: true, onClose: function () { validateAll($("#" + e)) } }); bindHierarchyData({ id: "divShopAddress", container: e, table: "address", canmodify: true, css: "selectsmall1 required validate" }); bindItemsForSelectCombo({ methodname: "getShopName", servicename: "Management", headertext: "انتخاب شعبه", id: "ParentShopName", container: e }); n.find("#addShop").button({ icons: { primary: "ui-icon-disk" }, text: true }).unbind("click").click(function () { if (validateAll($("#" + e))) addShop(e) }) } } function loadShopList(e, t) { if (t) { $("#" + e).find("#refreshShopList").button({ icons: { primary: "ui-icon-refresh" }, text: false }).unbind("click").click(function () { getShopList(e, { container: e, callbackmethod: getEmployeeList, fname: "", page_index: 0, build: buildShopList, servicename: "Management", methodname: "GetListShop", print: false }) }); getShopList(e, { container: e, callbackmethod: getEmployeeList, fname: "", page_index: 0, build: buildShopList, servicename: "Management", methodname: "GetListShop", print: false }) } } function loadShopEdit(e, t, n) { if (n) { var r = $("#" + t); r.find("#text_shopDateStart").attr("id", "text_shopDateStart" + t); r.find("#text_shopDateStart" + t).datepicker({ changeMonth: true, changeYear: true, onClose: function () { validateAll($("#" + t)) } }); bindItemsForSelectCombo({ servicename: "Management", methodname: "getShopName", headertext: "شعبه اصلی", id: "ParentShopName", container: t }); ajDropDown.done(function () { getShop(e, t) }); r.find("#addShop").button({ icons: { primary: "ui-icon-disk" }, text: true }).unbind("click").click(function () { if (validateAll($("#" + t))) EditShop(e, t) }) } } function getShop(idShop, container) { $.ajax({ type: "POST", url: "Management/getShop", contentType: "application/json; charset=utf-8", data: "{id: '" + idShop + "' }", success: function (response) { if (!isAuthenticated(response)) return; var Item = typeof response == "string" ? eval("(" + response + ")") : response; var ItmVal = Item[0]; var $con = $("#" + container); $con.find("#text_shopCode").val(ItmVal.Code); $con.find("#text_shopFax").val(ItmVal.Fax); bindHierarchyData({ id: "divShopAddress", table: "address", container: container, parentid: ItmVal.AddressId, css: "selectsmall required validate" }); $con.find("#text_shopDateStart" + container).val(ItmVal.startdate); $con.find("#text_shopEmail").val(ItmVal.Email); $con.find("#text_shopName").val(ItmVal.Name); $con.find("#ParentShopName").val(ItmVal.ParentShopId) }, error: function (e) { alert(e.responseText) } }) } function addShop(e) { var t = $("#" + e); var n = { code: t.find("#text_shopCode").val(), fax: t.find("#text_shopFax").val(), address: getHierarchySelectedValue("divShopAddress", e), startdate: t.find("#text_shopDateStart").val(), email: t.find("#text_shopEmail").val(), name: t.find("#text_shopName").val(), parent: t.find("#ParentShopName").val() }; $.ajax({ type: "POST", url: "Management/AddShop", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (e) { if (!isAuthenticated(e)) return; if (e.isdone) $("#ddl_s_Branch").append("<option value='" + e.shopId + "'>" + e.shopName + "</option>"); translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function EditShop(e, t) { var n = $("#" + t); $.ajax({ type: "POST", url: "Management/EditShop", contentType: "application/json; charset=utf-8", data: "{id:'" + e + "',code: '" + n.find("#text_shopCode").val() + "', fax: '" + n.find("#text_shopFax").val() + "', address: '" + getHierarchySelectedValue("divShopAddress", t) + "', startdate: '" + n.find("#text_shopDateStart" + t).val() + "', email: '" + n.find("#text_shopEmail").val() + "', name: '" + n.find("#text_shopName").val() + "', parent: '" + n.find("#ParentShopName").val() + "'}", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function deleteShop() { $.ajax({ type: "POST", url: "Management/DeleteShop", contentType: "application/json; charset=utf-8", data: "{id: '" + 0 + "'}", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function buildShopList(jq, container) { var $con = $("#" + container.pagingContainer); var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "code", width: "10%" }); lsth.push({ title: "fax", width: "15%" }); lsth.push({ title: "address", width: "15%" }); lsth.push({ title: "dateStart", width: "15%" }); lsth.push({ title: "email", footer: jq.sumDebtor, width: "16%" }); lsth.push({ title: "name", width: "15%" }); lsth.push({ title: "mainBranch", width: "15%" }); if (!container.params.print) { lsth.push({ title: "deleteKey", width: "4%" }) } var List = typeof jq.results == "string" ? eval("(" + jq.results + ")") : jq.results; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; if (!container.params.print) trBody[0] = { trId: val.ShopId }; trBody[1] = { name: "code", html: val.Code, width: "10%" }; trBody[2] = { name: "fax", html: val.Fax, width: "15%" }; trBody[3] = { name: "address", html: val.Address, width: "15%" }; trBody[4] = { props: { date: val.StartingDate, name: "date", width: "16%", klass: "dateLong" }, html: val.StartingDate }; trBody[5] = { name: "email", html: val.Email, width: "15%" }; trBody[6] = { name: "name", html: val.Name, width: "15%" }; trBody[7] = { name: "name", html: val.parent, width: "15%" }; lstb.push(trBody) } table = { header: lsth, body: lstb, details: { deleteFunction: RemoveShopElement, rowClick: ClickShop }, heigth: 300, container: container.pagingContainer, divName: "shopList" }; buildTable(table) } function RemoveShopElement(e, t) { t; $.ajax({ type: "POST", url: "Management/DeleteShop", contentType: "application/json; charset=utf-8", data: "{id: '" + e + "' }", success: function (e) { if (!isAuthenticated(e)) return; if (e.isDone) getShopList(t, { container: t, callbackmethod: getEmployeeList, fname: "", page_index: 0, build: buildShopList, servicename: "Management", methodname: "GetListShop", print: false }); translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function getShopList(e, t) { var n = $("#" + e); pageselectCallback(0, t, { container: "", noPaging: true, fname: t.fname, pagingContainer: e, first: true, isOrder: false }) } function ClickShop(e, t) { createSubTab({ row: e, name: "a_ShopList" }); itemId = e.prop("id").replace("tr", ""); onRowClick(e) } function loadCounterHelp(e, t) { var n = $("#" + e); if (t) { n.find("#newCounter").unbind("click").bind("click", function () { n.parent().find("[id='a_CounterAdd']").trigger("click") }); n.find("#banks").unbind("click").bind("click", function () { n.parent().find("[id='a_Bank']").trigger("click") }); n.find("#management").unbind("click").bind("click", function () { n.parent().find("[id='a_CounterList']").trigger("click") }) } } function loadCounterAdd(e, t) { var n = $("#" + e); bindItemsForSelectCombo({ servicename: "Management", methodname: "getShopName", headertext: "شعبه اصلی", id: "ParentShopCounter", container: e }); if (t) { n.find("#addCounter").button({ icons: { primary: "ui-icon-disk" }, text: true }).unbind("click").click(function () { if (n.find("#ParentShopCounter").val() == "") { alert("شعبه را انتخاب کنید."); return } if (validateAll($("#" + e))) addCounter(e) }) } } function loadCounterList(e, t) { if (t) { var n = $("#" + e); n.find("#refreshCounterList").button({ icons: { primary: "ui-icon-refresh" }, text: false }).off().on("click", function (t) { getCounterList(e, { container: e, callbackmethod: getCounterList, fname: "", page_index: 0, build: buildCounterList, servicename: "Management", methodname: "GetCounterlist", print: false }) }); getCounterList(e, { container: e, callbackmethod: getCounterList, fname: "", page_index: 0, build: buildCounterList, servicename: "Management", methodname: "GetCounterlist", print: false }) } } function loadCounterEdit(e, t, n) { if (n) { var r = $("#" + t); bindItemsForSelectCombo({ servicename: "Management", methodname: "getShopName", headertext: "شعبه اصلی", id: "ParentShopCounter", container: t }); r.find("#addCounter").button({ icons: { primary: "ui-icon-disk" }, text: true }).unbind("click").click(function () { if (r.find("#ParentShopCounter").val() == "") { alert("شعبه را انتخاب کنید."); return } if (validateAll($("#" + t))) EditCounter(e, t) }); ajDropDown.done(function () { r.find("#ParentShopCounter").val($("#tr" + e).find("td[name=branchName]").prop("id")); r.find("#text_Code").val($("#tr" + e).find("td[name=name]").attr("code")) }) } } function addCounter(e) { var t = $("#" + e); $.ajax({ type: "POST", url: "Management/AddCounter", contentType: "application/json; charset=utf-8", data: "{code: '" + t.find("#text_Code").val() + "', shopid: '" + t.find("#ParentShopCounter").val() + "'}", success: function (e) { if (!isAuthenticated(e)) return; if (e.isdone) { $("#ddl_m_Counter").append("<option value='" + e.counterId + "'>" + e.counterName + "</option>"); $("#ddl_m_Counter").attr("disabled", false) } translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function EditCounter(e, t) { var n = $("#" + t); $.ajax({ type: "POST", url: "Management/EditCounter", contentType: "application/json; charset=utf-8", data: "{id: '" + e + "', code: '" + n.find("#text_Code").val() + "', shopid: '" + n.find("#ParentShopCounter").val() + "'}", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function buildCounterList(jq, container) { var $con = $("#" + container.pagingContainer); var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "code", width: "46%" }); lsth.push({ title: "branchName", width: "50%" }); if (!container.params.print) { lsth.push({ title: "deleteKey", width: "4%" }) } var List = typeof jq.results == "string" ? eval("(" + jq.results + ")") : jq.results; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; if (!container.params.print) trBody[0] = { trId: val.AccountId }; trBody[1] = { props: { name: "name", width: "46%", code: val.Code }, html: "<span>counter</span> " + val.Code }; trBody[2] = { props: { id: val.ShopId, name: "branchName", width: "50%" }, html: val.Name + "  " + val.ShopCode }; lstb.push(trBody) } table = { header: lsth, body: lstb, details: { deleteFunction: RemoveCounterElement, rowClick: clickCounter }, heigth: 300, container: container.pagingContainer, divName: "CounterList" }; buildTable(table) } function getCounterList(e, t) { var n = $("#" + e); pageselectCallback(0, t, { container: "", noPaging: true, fname: t.fname, pagingContainer: e, first: true, isOrder: false }) } function clickCounter(e, t) { createSubTab({ row: e, name: "a_CounterList" }); itemId = e.prop("id").replace("tr", ""); onRowClick(e) } function RemoveCounterElement(e, t) { var n = $("#" + t); $.ajax({ type: "POST", url: "Management/DeleteCounter", contentType: "application/json; charset=utf-8", data: "{Cid: '" + e + "'}", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg); if (e.isDone) getCounterList(t, { container: t, callbackmethod: getCounterList, fname: "", page_index: 0, build: buildCounterList, servicename: "Management", methodname: "GetCounterlist", print: false }) }, error: function (e) { alert(e.responseText) } }) } function loadBank(e, t) { if (t) { bindXmlDropDownData({ id: "Bank_Name", container: e, path: "Data/BankTitle", canmodify: true, istext: false, headertext: "انتخاب بانک ", css: "selectsmall " }) } } function loadSupplierHelp(e, t) { var n = $("#" + e); if (t) { n.find("#newSupplier").unbind("click").bind("click", function () { $("[id='a_SupplierAdd']").trigger("click") }); n.find("#management").unbind("click").bind("click", function () { $("[id='a_SupplierList']").trigger("click") }); n.find("#accountDetail").unbind("click").bind("click", function () { $("[id='a_SupplierAccounting']").trigger("click") }); n.find("#changeQuantity").unbind("click").bind("click", function () { $("[id='a_EditQuantityOrder']").trigger("click") }) } } function loadSupplierAdd(e, t) { if (t) { var n = $("#" + e); bindHierarchyData({ id: "divSupplierAddress", container: e, table: "address", canmodify: true }); n.find("#AddSupplier").off().on("click", function () { if (validateAll($("#" + e))) addSupplier(e) }).button({ icons: { primary: "ui-icon-disk" }, text: true }) } } function addSupplier(e) { var t = $("#" + e); var n = { name: t.find("#SupplierName").val(), family: t.find("#SupplierFamily").val(), age: t.find("#SupplierAge").val(), gender: t.find("#ddl_m_Gender").val(), fax: t.find("#SupplierFax").val(), mobile: t.find("#SupplierMobile").val(), phone: t.find("#Supplierphone").val(), addressid: getHierarchySelectedValue("divSupplierAddress", e), email: t.find("#SupplierEmail").val(), date: $("#userDefault").find("#txt_s_Date").val() }; $.ajax({ type: "POST", url: "Management/AddSupplier", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (t) { if (!isAuthenticated(t)) return; if (t.count > 0) ResetPage(e); translate(t.alert) }, error: function (e) { alert(e.responseText) } }) } function loadEditQuantityOrder(e, t) { var n = $("#" + e); if (t) { n.find("[name='changeQuantity']").remove(); n.find("[name='setPayment']").removeClass("invisible"); n.find("#spClient").html("supplier"); n.find("#txt_s_Person").attr("placeholder", "supplier"); n.find("#cbSetPayment").unbind("change").change(function () { if (this.checked) $(this).button("option", "label", "setPayment"); else $(this).button("option", "label", "noPayment"); localize() }).button(); loadOrder(0, e, GetItemOrder, false, true, t, { isfastorder: true, isChangeQuantity: true }) } } function loadSupplierList(e, t) { var n = $("#" + e); if (t) { n.find("#moreFilter").slideUp("fast"); n.find(".toggle-more-filters").click(function () { $(this).toggleClass("open"); n.find("#divBasic").toggleClass("hidden"); n.find("#moreFilter").removeClass("invisible"); n.find("#moreFilter").slideToggle(function () { }) }); sortid = "AccountId desc"; n.find("#SearchBy").val("Name"); getSupplierList(e, { container: e, callbackmethod: getSupplierList, fname: "", page_index: 0, build: buildSupplierList, servicename: "Management", methodname: "GetSupplierList", print: false }); n.find("#SupplierSearchRegDateStart").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#SupplierSearchRegDateEnd").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); n.find("#SupplierSearchRegDateEnd").datepicker({ changeMonth: true, changeYear: true }); n.find("#DialogBarcode").dialog({ autoOpen: false }).dialog({ width: 750 }); n.find("#btnSearchSupplier").unbind("click").click(function () { getSupplierList(e, { container: e, callbackmethod: getSupplierList, fname: "", page_index: 0, build: buildSupplierList, servicename: "Management", methodname: "GetSupplierList", print: false }) }).button({ icons: { primary: "ui-icon-search"} }); n.find("#SupplierAdvanceSearchbt").unbind("click").click(function () { getSupplierList(e) }).button() } } function getSupplierList(e, t) { var n = $("#" + e); var r = true; var i = n.find("#PageSize").val(); var s = 0; var o = 0; var u = "", a = "", f = "", l = ""; var c = []; if (!n.find("#moreFilter").is(":visible")) { var h = n.find("#SearchBy").val(); if (h == "Code") { u = n.find("#SuppliertxtSearch").val() } if (h == "Name") { a = n.find("#SuppliertxtSearch").val() } if (h == "RegName") { f = n.find("#SuppliertxtSearch").val() } if (e == "selectSupplierContent") { a = n("#selectSupplierName").val(); f = n("#selectSupplierRegisterer").val() } c = { skip: s, take: i, currentPage: o, first: r, sort: sortid, code: u, namefamily: a, registerername: f, agefrom: "", ageto: "", regdatefrom: "", regdateto: ""} } else { c = { skip: s, take: i, currentPage: o, first: r, sort: sortid, code: n.find("#SupplierSearchCode").val(), namefamily: n.find("#SupplierSearchName").val(), registerername: n.find("#SupplierSearchRegName").val(), agefrom: n.find("#SupplierSearchAgeStart").val(), ageto: n.find("#SupplierSearchAgeEnd").val(), regdatefrom: n.find("#SupplierSearchRegDateStart").val(), regdateto: n.find("#SupplierSearchRegDateEnd").val()} } t["DTO"] = c; pageselectCallback(0, t, { container: "", fname: t.fname, pagingContainer: e, first: true, isOrder: false }) } function buildSupplierList(jq, params) { var $con = $("#" + params.pagingContainer); jq = jq.results; var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "usernameCode", sort: "p_Person.Code", width: "8%" }); lsth.push({ title: "nameAndFamily", sort: "p_Person.Family", width: "21%" }); if (container != "divdialogCustomer") { lsth.push({ title: "age", sort: "p_Person.DateOfBirth", width: "4%" }); lsth.push({ title: "dateOfRegistration", sort: "p_Person.RegDate", width: "10%" }); lsth.push({ title: "gender", sort: "p_Person.Gender", width: "5%" }); lsth.push({ title: "registrator", sort: "p_Person1.Family", width: "14%" }); lsth.push({ title: "deleteKey", width: "4%" }) } var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; trBody[0] = { trId: val.AccountId }; trBody[1] = { name: "code", html: val.Code, width: "8%" }; trBody[2] = { name: "name", html: val.Name + "  " + val.Family, width: "21%" }; if (container != "divdialogCustomer") { trBody[3] = { html: val.age == 0 ? "__" : val.age, width: "4%" }; trBody[4] = { html: val.regdate, props: { date: val.regdate, width: "10%", klass: "date"} }; trBody[5] = { html: val.Gender == true ? "مرد" : "زن", width: "5%" }; trBody[6] = { html: val.regName + "  " + val.regFamily, width: "14%"} } lstb.push(trBody) } table = { header: lsth, body: lstb, details: { rowClick: ClickSupplier }, heigth: 300, width: 500, container: params.pagingContainer, divName: "SupplierList", rowClickParams: { textboxId: "CustomerIntroducerCode"} }; if (params.pagingContainer != "divdialogCustomer") { details = { deleteFunction: RemoveSupplierElement, rowClick: ClickSupplier }; table = { header: lsth, body: lstb, details: details, heigth: 300, container: params.pagingContainer, divName: "SupplierList"} } buildTable(table); if (params.pagingContainer == "divdialogCustomer") $con.dialog("open") } function ClickSupplier(e, t) { var n = $("#" + t); if (t == "diva_selectSupplierList") { n("#SupplierContent").find("#SuppliertxtSearch").val(n.find("#" + e.prop("id")).children("td[name='code']").html()); n("#SupplierContent").find("#SupplierSearchIndtroducerName").val(n.find("#" + e.prop("id")).children("td[name='code']").html()) } else { createSubTab({ row: e, name: "a_SupplierList" }); onRowClick(e) } } function RemoveSupplierElement(e, t) { var n = $("#" + t); $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: "{personid: '" + e + "'}", type: "Post", url: "Management/DeleteSupplier", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg); getSupplierList(t) }, error: function (e) { alert(e.responseText) } }) } function loadSubSupplierHelp(e, t, n) { var r = $("#" + t); if (n) { r.find("#submitInvoice").unbind("click").bind("click", function () { r.parent().find("[id='a_SupplierOrder']").trigger("click") }); r.find("#submitWholesaleInvoice").unbind("click").bind("click", function () { r.parent().find("[id='a_SupplierWholesaleOrder']").trigger("click") }); r.find("#edit").unbind("click").bind("click", function () { r.parent().find("[id='a_SupplierEdit']").trigger("click") }); r.find("#editPhone").unbind("click").bind("click", function () { r.parent().find("[id='a_CustomerPhoneEdit']").trigger("click") }); r.find("#supplierPayment").unbind("click").bind("click", function () { r.parent().find("[id='a_SupplierPayment']").trigger("click") }); r.find("#management").unbind("click").bind("click", function () { r.parent().find("[id='a_SupplierInvoiceList']").trigger("click") }); r.find("#accountDetail").unbind("click").bind("click", function () { r.parent().find("[id='a_AccountDetailsSupplier']").trigger("click") }) } } function loadSupplierOrder(e, t, n) { loadOrder(e, t, GetItemOrder, false, false, n) } function loadSupplierWholesaleOrder(e, t, n) { loadOrder(e, t, GetItemOrderWholesale, true, false, n) } function AddPayment(e, t) { var n = $("#" + t); if (n.find("#txt_SumPeyment").val() == "0") return; var r = []; var i = []; var s = []; if (n.find("#ddl_CounterTo").val() == $("#userDefault").find("#ddl_m_Counter").val()) { alert("صندوق مبدا و مقصد یکسان است."); return } $.each($("#" + t).find("tr[id*=Cash_]"), function () { var e = {}; e["CurrencyId"] = $("#ddl_m_Currency_" + this.id).val(); e["Amount"] = $(this).find("#txt_m_Amount").val(); e["Type"] = getRadioSelectedValue("radioPayment" + this.id); r.push(e) }); $.each($("#" + t).find("tr[id*=Cheque_]"), function () { var e = {}; if ($(this).find("#ddl_m_Bank_" + this.id).val() == "" || $(this).find("#txt_m_Serial").val() == "" || $(this).find("[name='txt_m_DueDate']").val() == "" || $(this).find("#txt_m_Amount").val() == "") return; e["Bank"] = $(this).find("#ddl_m_Bank_" + this.id).val(); e["Serial"] = $(this).find("#txt_m_Serial").val(); e["DueDate"] = $(this).find("[name='txt_m_DueDate']").val(); e["CurrencyId"] = $("#ddl_m_Currency_" + this.id).val(); e["Amount"] = $(this).find("#txt_m_Amount").val(); i.push(e) }); $.each($("#" + t).find("tr[id*=voucher_]"), function () { s.push($(this).find("[name=voucherNumber]").html()) }); var o = { cash: r, cheque: i, voucher: s, supplierid: e, payerCode: n.find("#txt_payer").val(), counterid: $("#userDefault").find("#ddl_m_Counter").val(), pay: getRadioSelectedValue("radio" + t, t), tocounterid: n.find("#ddl_CounterTo").val(), description: n.find("#txt_description").val(), date: $("#userDefault").find("#txt_s_Date").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(o), type: "Post", url: "Management/AddPayment", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function loadAccountDetailsSupplier(e, t, n) { AccountDetailsSupplier(e, t) } function AccountDetailsSupplier(e, t) { var n = $("#" + t); DTO = { shopid: $("#userDefault").find("#ddl_s_Branch").val(), Scoup: "", clientid: e, employeeid: "", dateFrom: "", dateTo: "", isSale: "", clientCode: "" }; $.ajax({ type: "POST", url: "Management/GetAccountDetailsShop", contentType: "application/json; charset=utf-8", data: JSON.stringify(DTO), success: function (e) { if (!isAuthenticated(e)) return; n.find("#txt_d_Sale").val(e.SellAmount * 1 - e.BuyAmount * 1); n.find("#txt_d_PaymentSale").val(e.PaidCash * 1 + e.PaidCheque * 1 + e.paidVoucher * 1 - (e.ReceivedCash * 1 + e.ReceivedCheque * 1 + e.ReceivedVoucher * 1)); n.find("#txt_d_BalanceTotal").val(e.SellAmount * 1 - e.BuyAmount * 1 - (e.PaidCash * 1 + e.PaidCheque * 1 + e.paidVoucher * 1 - (e.ReceivedCash * 1 + e.ReceivedCheque * 1 + e.ReceivedVoucher * 1))); n.find("#txt_d_SaleTotal").val(e.SellAmount); n.find("#txt_d_Return").val(e.BuyAmount); n.find("#txt_d_TotalPayment").val(e.PaidCash * 1 + e.PaidCheque * 1 + e.paidVoucher * 1); n.find("#txt_d_TotalReceive").val(e.ReceivedCash * 1 + e.ReceivedCheque * 1 + e.ReceivedVoucher * 1); n.find("#txt_d_ChequePeyment").val(e.PaidCheque); n.find("#txt_d_ChequeReceive").val(e.ReceivedCheque); n.find("#txt_d_CashPayment").val(e.PaidCash); n.find("#txt_d_CashReceive").val(e.ReceivedCash); n.find("#txt_d_TotalOff").val(e.OffBuy * 1 - e.SellAmount * 1); n.find("#txt_d_profit").val(e.profit); n.find("#txt_d_BuyQuantity").val(e.BuyQuantity); n.find("#txt_d_SellQuantity").val(e.SellQuantity); n.find("#txt_d_NetQuantity").val(e.BuyQuantity * 1 - e.SellQuantity * 1) }, error: function (e) { alert(e.responseText) } }) } function loadSupplierInvoiceList(e, t, n) { var r = $("#" + t); if (n) { r.find("#blCode").remove(); r.find("#hd_d_PersonId").val(e); r.find("#hd_d_IsClient").val(false); AccountFullAcc(t, n, { print: false, selectCase: "GetItemList", onLoad: true }) } } function loadCustomerHelp(e, t) { var n = $("#" + e); if (t) { n.find("#newCustomer").unbind("click").bind("click", function () { $("[id='a_CustomerAdd']").trigger("click") }); n.find("#management").unbind("click").bind("click", function () { $("[id='a_CustomerList']").trigger("click") }); n.find("#accountDetail").unbind("click").bind("click", function () { $("[id='a_CustomerAccounting']").trigger("click") }); n.find("#invoiceProfit").unbind("click").bind("click", function () { $("[id='a_CustomerOrderProfit']").trigger("click") }) } } function loadSubCustomerHelp(e, t, n) { var r = $("#" + t); if (n) { r.find("#submitInvoice").unbind("click").bind("click", function () { r.parent().find("[id='a_CustomerOrder']").trigger("click") }); r.find("#submitWholesaleInvoice").unbind("click").bind("click", function () { r.parent().find("[id='a_CustomerWholesaleOrder']").trigger("click") }); r.find("#edit").unbind("click").bind("click", function () { r.parent().find("[id='a_CustomerEdit']").trigger("click") }); r.find("#editPhone").unbind("click").bind("click", function () { r.parent().find("[id='a_CustomerPhoneEdit']").trigger("click") }); r.find("#customerPayment").unbind("click").bind("click", function () { r.parent().find("[id='a_CustomerPayment']").trigger("click") }); r.find("#management").unbind("click").bind("click", function () { r.parent().find("[id='a_CustomerInvoiceList']").trigger("click") }); r.find("#accountDetail").unbind("click").bind("click", function () { r.parent().find("[id='a_AccountDetails']").trigger("click") }); r.find("#chart").unbind("click").bind("click", function () { r.parent().find("[id='a_CustomerChart']").trigger("click") }) } } function loadCustomerAdd(e, t) { customerAdd(e, t) } function loadCustomerAddToolbar(e, t) { customerAdd(e, t) } function customerAdd(e, t) { var n = $("#" + e); if (t) { aComplete({ methodname: "GetCompletionListByCustomerName", servicename: "Management", id: "CustomerIntroducerCode", container: e, minlength: 2, autofocus: false, limit: 20, boxId: "CustomerIntroducerCode" }); bindHierarchyData({ id: "divCustomerAddress", container: e, table: "address", canmodify: true }); bindXmlDropDownData({ id: "CustomerJob", container: e, path: "Customer/jobTitle", canmodify: true, istext: false, headertext: "انتخاب شغل" }); n.find("#divdialogCustomer").dialog({ autoOpen: false }).dialog({ width: 600 }); n.find("#AddCustomer").button({ icons: { primary: "ui-icon-disk"} }).unbind("click").click(function () { if (validateAll($("#" + e))) addCustomer(e) }) } } function loadCustomerEdit(e, t, n) { if (n) { var r = $("#" + t); aComplete({ methodname: "GetCompletionListByCustomerName", servicename: "Management", id: "CustomerIntroducerCode", container: t, minlength: 2, autofocus: false, limit: 20, boxId: "CustomerIntroducerCode" }); bindXmlDropDownData({ id: "CustomerJobEdit", container: t, path: "Customer/jobTitle", canmodify: true, istext: true, headertext: "انتخاب شغل" }); r.find("#divdialogCustomer").dialog({ autoOpen: false }).dialog({ width: 600 }); r.find("#EditCustomer").off().on("click", function () { if (validateAll($("#" + t))) EditCustomer(e, t) }).button({ icons: { primary: "ui-icon-disk" }, text: true }); r.find("#a_CustomerIntroducerCode").off().on("click", function () { opendialog({ container: "divdialogCustomer", containerpage: t }) }); getCustomer(e, t) } } function loadCustomerList(e, t) { sortid = "AccountId desc"; var n = $("#" + e); if (t) { n.find("#moreFilter").slideUp("fast"); n.find(".toggle-more-filters").click(function () { $(this).toggleClass("open"); n.find("#simpleSearch").toggleClass("hidden"); n.find("#moreFilter").removeClass("invisible"); n.find("#moreFilter").slideToggle(function () { }) }); $container = n.find("#customerContent"); n.find("#SearchBy").val("Name"); getCustomerList(e, { container: e, callbackmethod: getCustomerList, fname: "", page_index: 0, build: buildCustomerList, servicename: "Management", methodname: "GetCustomerList", print: false }); n.find("#CustomerSearchRegDateStart").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { n.find("#CustomerSearchRegDateEnd").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); n.find("#CustomerSearchRegDateEnd").datepicker({ changeMonth: true, changeYear: true }); n.find("#divdialogCustomer").dialog({ autoOpen: false }).dialog({ width: 600 }); n.find("#PageSize").off().on("change", function () { getCustomerList(e, { container: e, callbackmethod: getCustomerList, fname: "", page_index: 0, build: buildCustomerList, servicename: "Management", methodname: "GetCustomerList", print: false }) }); n.find("#divslider").unbind("click").click(function () { sliderClick("divCustomersearch"); sliderClick("CustomerAdvanceSearch") }); n.find("#btnSearchCustomer").button({ icons: { primary: "ui-icon-search" }, text: true }).unbind("click").click(function () { sortid = "AccountId desc"; getCustomerList(e, { container: e, callbackmethod: getCustomerList, fname: "", page_index: 0, build: buildCustomerList, servicename: "Management", methodname: "GetCustomerList", print: false }) }) } n.find("#CustomertxtSearch").val("").focus() } function loadListCustomerSelect(e, t) { sortid = "AccountId desc"; if (t) { var n = $("#" + e); n.find("#PageSize").off().on("change", function () { getCustomerList(e, { container: e, callbackmethod: getCustomerList, fname: "", page_index: 0, build: buildCustomerList, servicename: "Management", methodname: "GetCustomerList", print: false }) }); n.find("#btnSearchCustomer").unbind("click").click(function () { getCustomerList(e, { container: e, callbackmethod: getCustomerList, fname: "", page_index: 0, build: buildCustomerList, servicename: "Management", methodname: "GetCustomerList", print: false }) }); n.find("#CustomertxtSearch").focus() } } function loadCustomerAddressEdit(e, t, n) { var r = $("#" + t); if (n) { getCustomerAddress(e, t); r.find("#EditAddress").off().on("click", function () { EditAddressCustomer(e, t) }).button({ icons: { primary: "ui-icon-disk" }, text: true }) } } function loadCustomerPhoneEdit(e, t, n) { if (n) { var r = $("#" + t); getCustomerPhone(e, t); r.find("#EditPhone").unbind().bind("click", function () { AddPhoneCustomer(e, t) }).button({ icons: { primary: "ui-icon-disk" }, text: true }) } } function addCustomer(e) { var t = $("#" + e); var n = { name: t.find("#CustomerName").val(), family: t.find("#CustomerFamily").val(), age: t.find("#CustomerAge").val(), gender: t.find("#ddl_m_Gender").val(), job: t.find("#CustomerJob option:selected").text(), mobile: t.find("#CustomerMobile").val(), phone: t.find("#Customerphone").val(), addressid: getHierarchySelectedValue("divCustomerAddress", e), address: t.find("#CustomerFullAddressEdit").val(), intoducercode: t.find("#CustomerIntroducerCode").val(), date: $("#userDefault").find("#txt_s_Date").val() }; $.ajax({ type: "POST", url: "Management/AddCustomer", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (t) { if (!isAuthenticated(t)) return; if (t.count > 0) { ResetPage(e); $("#tabFullAcountReport").find("#txt_customer").val(t.code) } translate(t.alert) }, error: function (e) { alert(e.responseText) } }) } function EditCustomer(e, t) { var n = $("#" + t); var r = { personid: e, code: n.find("#CustomerCodeEdit").val(), name: n.find("#CustomerNameEdit").val(), family: n.find("#CustomerFamilyEdit").val(), age: n.find("#CustomerAgeEdit").val(), gender: n.find("#ddl_m_Gender").val(), job: n.find("#CustomerJobEdit option:selected").text(), introducercode: n.find("#CustomerIntroducerCode").val() }; $.ajax({ type: "POST", url: "Management/EditCustomer", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function getCustomerList(e, t) { var n = $("#" + t.container); var r = true; var i = n.find("#PageSize").val(); var s = 0; var o = 0; var u = []; var a = "", f = "", l = "", c = "", h = "", p = "", d = ""; if (!n.find("#moreFilter").is(":visible")) { var v = n.find("#SearchBy").val(); if (v == "Code") { a = n.find("#CustomertxtSearch").val() } if (v == "Name") { f = n.find("#CustomertxtSearch").val() } if (v == "RegName") { l = n.find("#CustomertxtSearch").val() } if (v == "IntroducerName") { c = n.find("#CustomertxtSearch").val() } if (v == "Mobile") { p = n.find("#CustomertxtSearch").val() } if (v == "Phone") { h = n.find("#CustomertxtSearch").val() } if (v == "Email") { d = n.find("#CustomertxtSearch").val() } if (t.container == "divdialogCustomer") { f = n.find("#selectCustomerName").val(); l = n.find("#selectCustomerRegisterer").val() } u = { skip: s, take: i, currentPage: o, first: r, sort: sortid, namefamily: f, introducer: c, registerername: l, agefrom: "", ageto: "", regdatefrom: "", regdateto: "", mobile: p, phone: h, email: d} } else { u = { skip: s, take: i, currentPage: o, first: r, sort: sortid, namefamily: n.find("#CustomerSearchName").val(), introducer: n.find("#CustomerIntroducerCode").val(), registerername: n.find("#CustomerSearchRegName").val(), agefrom: n.find("#CustomerSearchAgeStart").val(), ageto: n.find("#CustomerSearchAgeEnd").val(), regdatefrom: n.find("#CustomerSearchRegDateStart").val(), regdateto: n.find("#CustomerSearchRegDateEnd").val(), mobile: p, phone: h, email: d} } t["DTO"] = u; pageselectCallback(0, t, { container: "", fname: t.fname, pagingContainer: e, first: true, isOrder: false }) } function buildCustomerList(jq, pageoption) { var $con = $("#" + pageoption.pagingContainer); jq = jq.results; var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "usernameCode", sort: "p_Person.Code", width: "8%" }); lsth.push({ title: "nameAndFamily", sort: "p_Person.Family", width: "21%" }); lsth.push({ title: "introducer", sort: "p_Customer2.p_Person.Family", width: "14%" }); if (pageoption.pagingContainer != "divdialogCustomer") { lsth.push({ title: "email", sort: "aspnet_Membership.Email", width: "20%" }); lsth.push({ title: "age", sort: "p_Person.DateOfBirth", width: "4%" }); lsth.push({ title: "dateOfRegistration", sort: "p_Person.RegDate", width: "10%" }); lsth.push({ title: "gender", sort: "p_Person.Gender", width: "5%" }); lsth.push({ title: "registrator", sort: "p_Person1.Family", width: "14%" }); lsth.push({ title: "deleteKey", width: "4%" }) } var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; trBody[0] = { trId: val.AccountId }; trBody[1] = { name: "code", html: val.Code, width: "8%" }; trBody[2] = { name: "name", html: val.Name + "  " + val.Family, width: "21%" }; trBody[3] = { html: val.introducerName + "  " + val.introducerFamily, width: "14%" }; if (pageoption.pagingContainer != "divdialogCustomer") { trBody[4] = { html: val.email == 0 ? "__" : val.email, width: "20%" }; trBody[5] = { html: val.age == 0 ? "__" : val.age, width: "4%" }; trBody[6] = { html: val.regdate, props: { date: val.regdate, width: "10%", klass: "date"} }; trBody[7] = { html: val.Gender == true ? "مرد" : "زن", width: "5%" }; trBody[8] = { html: val.regName + "  " + val.regFamily, width: "14%"} } lstb.push(trBody) } table = { header: lsth, body: lstb, details: { rowClick: ClickCustomer }, heigth: 300, width: 500, container: pageoption.pagingContainer, divName: "CustomerList", rowClickParams: { textboxId: "CustomerIntroducerCode"} }; if (pageoption.pagingContainer != "divdialogCustomer") { details = { deleteFunction: RemoveCustomerElement, rowClick: ClickCustomerList }; table = { header: lsth, body: lstb, details: details, heigth: 300, container: pageoption.pagingContainer, divName: "CustomerList"} } buildTable(table); if (pageoption.pagingContainer == "divdialogCustomer") $con.dialog("open") } function ClickCustomer(e, t, n) { var r = $("#" + t); $("#" + n.textboxId).val($("#" + e.prop("id")).children("td[name='code']").html()); r.dialog("close") } function ClickCustomerList(e, t, n, r) { var i = $("#" + t); if (n != undefined) $("#" + textin).val(n); else $("#" + textin).val($("#" + e.prop("id")).children("td[name='code']").html()); if (r != undefined) createSubTab({ name: "a_CustomerList", id: r, row: e }); else { createSubTab({ name: "a_CustomerList", row: e }) } onRowClick(e) } function RemoveCustomerElement(e, t) { var n = $("#" + t); $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: "{personid: '" + e + "'}", type: "Post", url: "Management/DeleteCustomer", success: function (t) { if (!isAuthenticated(t)) return; if (!t.isdone) { alert(t.msg); return } else if (t.isdone) $("#tr" + e).remove() }, error: function (e) { alert(e.responseText) } }) } function getCustomer(customerid, container) { var $con = $("#" + container); $.ajax({ type: "POST", url: "Management/GetCustomerById", contentType: "application/json; charset=utf-8", data: "{customerid: '" + customerid + "' }", success: function (response) { if (!isAuthenticated(response)) return; var Customer = typeof response == "string" ? eval("(" + response + ")") : response; var cusval = Customer[0]; var $con = $("#" + container); $con.find("#CustomerCodeEdit").val(cusval.Code); $con.find("#CustomerNameEdit").val(cusval.Name); $con.find("#CustomerFamilyEdit").val(cusval.Family); $con.find("#CustomerAgeEdit").val(cusval.Age == 0 ? "" : cusval.Age); $con.find("#CustomerIntroducerCodeEdit").val(cusval.IntroducerCode); $con.find("#CustomerJobEdit select").val("" + cusval.Job + ""); $con.find("#ddl_m_Gender").val("" + cusval.Gender + "") }, error: function (e) { alert(e.responseText) } }) } function evente(e, t) { var n = $("#" + t); if (n.find("#SearchBy").val() == "IntroducerName") { n.find("#a_CustomertxtSearch").addClass("searchText") } else n.find("#a_CustomertxtSearch").removeClass("searchText") } function getCustomerAddress(customerid, container) { var $con = $("#" + container); $.ajax({ type: "POST", url: "Management/GetAddressById", contentType: "application/json; charset=utf-8", data: "{customerid: '" + customerid + "' }", success: function (response) { if (!isAuthenticated(response)) return; var Customer = typeof response == "string" ? eval("(" + response + ")") : response; var cusval = Customer[0]; bindHierarchyData({ id: "divCustomerAddressEdit", table: "address", container: container, parentid: cusval.AddressId }); $con.find("#CustomerFullAddressEdit").val(cusval.Address) }, error: function (e) { alert(e.responseText) } }) } function EditAddressCustomer(e, t) { var n = $("#" + t); $.ajax({ type: "POST", url: "Management/EditAddressCustomer", contentType: "application/json; charset=utf-8", data: "{personid: '" + e + "',addressid: '" + getHierarchySelectedValue("divCustomerAddressEdit", t) + "',address: '" + n.find("#CustomerFullAddressEdit").val() + "' }", success: function (n) { if (!isAuthenticated(n)) return; translate(n.msg); loadCustomerAddressEdit(e, t) }, error: function (e) { alert(e.responseText) } }) } function getCustomerPhone(customerid, container) { var $con = $("#" + container); $.ajax({ type: "POST", url: "Management/GetPhoneById", contentType: "application/json; charset=utf-8", data: "{personid: '" + customerid + "'}", success: function (response) { if (!isAuthenticated(response)) return; jq = response; var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<tr id='tr" + val.PhoneId + "'>" + "<td width='40%' name='number'>" + val.Number + "</td>" + "<td width='40%' name='cell'>" + (val.Cell == true ? "موبایل" : "تـلفن") + "</td>" + "<td width='20%' id='delete'><button id='a_Button'>حذف</button></td></tr>" } $con.find("#CustomerPhoneList").html(ItemList).parent().tableScroll({ height: 380, width: contentwidth, flush: false }); $con.find("[id=a_Button]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) RemoveCustomerPhone($(this).parents("tr").prop("id").replace("tr", ""), customerid, container); else return }); $con.find("tr[id*=tr]").find("td:not([id=delete])").click(function () { ClickCustomerPhone($(this).parent("tr"), customerid, container) }).addClass("cursor") }, error: function (e) { alert(e.responseText) } }) } function ClickCustomerPhone(e, t, n) { var r = $("#" + n); r.find("#text_CustomerNumber").val(r.find("#" + e.prop("id")).children("td[name='number']").html()); r.find("#ddl_m_CellType").val(r.find("#" + e.prop("id")).children("td[name='cell']").html() == "تـلفن" ? "false" : "true"); r.find("#EditPhone").button().unbind("click").click(function () { EditPhoneCustomer(e.prop("id").replace("tr", ""), t, n) }) } function RemoveCustomerPhone(e, t, n) { $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: "{phoneid: '" + e + "'}", type: "Post", url: "Management/DeleteCustomerPhone", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg); if (e.isDone) getCustomerPhone(t, n) }, error: function (e) { alert(e.responseText) } }) } function AddPhoneCustomer(e, t) { var n = $("#" + t); $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: "{personid: '" + e + "',number: '" + n.find("#text_CustomerNumber").val() + "',cell: '" + n.find("#ddl_m_CellType").val() + "'}", type: "Post", url: "Management/AddCustomerPhone", success: function (n) { if (!isAuthenticated(n)) return; translate(n.msg); if (n.isDone) getCustomerPhone(e, t) }, error: function (e) { alert(e.responseText) } }) } function EditPhoneCustomer(e, t, n) { var r = $("#" + n); $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: "{phoneid: '" + e + "',personid: '" + t + "',number: '" + r.find("#text_CustomerNumber").val() + "',cell: '" + r.find("#ddl_m_CellType").val() + "'}", type: "Post", url: "Management/EditCustomerPhone", success: function (e) { if (!isAuthenticated(e)) return; getCustomerPhone(t, n); r.find("#text_CustomerNumber").val(""); r.find("#ddl_m_CellType").val("true"); r.find("#EditPhone").button().unbind("click").click(function () { if (validateAll($("#" + n))) { AddPhoneCustomer(t, n) } }); translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function opendialog(e) { var t = $("#" + e.container); sortid = "AccountId desc"; t.find("#PageSize").off().on("change", function () { sortid = "AccountId"; getCustomerList(e.container, { container: e.container, callbackmethod: getCustomerList, fname: "", page_index: 0, build: buildCustomerList, servicename: "Management", methodname: "GetCustomerList", print: false }) }); t.find("#btn_searchCustomer").unbind().bind("click", function () { sortid = "AccountId"; getCustomerList(e) }); getCustomerList(e.container, { container: e.container, callbackmethod: getCustomerList, fname: "", page_index: 0, build: buildCustomerList, servicename: "Management", methodname: "GetCustomerList", print: false }) } function loadOnlineProfile(e, t, n) { var r = $("#" + t); if (n) { r.find("#hvCustomerId").val(e); GetOnlineProfile(e, t); bindRawDropDownData({ id: "divRestriction", container: t, path: "restriction", canmodify: true, istext: false, headertext: "انتخاب گروه ", css: "selectsmall " }); r.find("#btnEditProfile").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (validateAll($("#" + t))) UpdateOnlineProfile(e, t) }); getCustomerRestrictionList(t, { container: t, callbackmethod: getCustomerRestrictionList, fname: "", page_index: 0, build: buildCustomerRestrictionList, servicename: "Management", methodname: "GetCustomerRestrictionList", print: false, customerId: e }); r.find("#btnAddRestriction").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (validateAll($("#RestrictionList"))) AddCustomerRestriction(e, t) }) } } function getCustomerRestrictionList(e, t) { var n = $("#" + e); if (t.page_index > 0) { t.first = false } var r = { customerId: t.customerId }; t["DTO"] = r; pageselectCallback(0, t, { container: "", fname: t.fname, pagingContainer: e, first: true, isOrder: false }) } function buildCustomerRestrictionList(jq, container) { var $con = $("#" + container.pagingContainer); var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "restriction", width: "80%" }); var List = typeof jq.results == "string" ? eval("(" + jq.results + ")") : jq.results; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; if (!container.params.print) trBody[0] = { trId: val.RestrictionId }; trBody[1] = { name: "restriction", html: val.Restriction, width: "80%" }; lstb.push(trBody) } var details = { deleteFunction: DeleteCustomerRestriction }; table = { header: lsth, body: lstb, details: details, heigth: 300, container: container.pagingContainer, divName: "restrictionList", hasFooter: true }; buildTable(table) } function DeleteCustomerRestriction(e, t) { var n = $("#" + t); var r = $("#tr" + e); var i = { customerId: n.find("#hvCustomerId").val(), restrictionId: e }; $.ajax({ type: "POST", url: "Management/DeleteCustomerRestriction", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (e) { if (!isAuthenticated(e)) return; if (e.isDone == false) { alert(e.msg); return } if (e != null && e.isDone == true) r.remove() }, error: function (e) { alert(e.responseText) } }) } function AddCustomerRestriction(e, t) { var n = $("#" + t); var r = { customerId: e, restrictionId: n.find("#divRestriction option:selected").val() }; $.ajax({ type: "POST", url: "Management/AddCustomerRestriction", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (n) { if (!isAuthenticated(n)) return; if (n.isDone == false) { alert(n.msg); return } if (n != null && n.isDone == true) getCustomerRestrictionList(t, { container: t, callbackmethod: getCustomerRestrictionList, fname: "", page_index: 0, build: buildCustomerRestrictionList, servicename: "Management", methodname: "GetCustomerRestrictionList", print: false, customerId: e }) }, error: function (e) { alert(e.responseText) } }) } function GetOnlineProfile(e, t) { var n = $("#" + t); var r = { customerId: e }; $.ajax({ type: "POST", url: "Management/GetOnlineProfile", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (e) { if (!isAuthenticated(e)) return; if (e.isDone) { n.find("#txtEmail").val(e.email); n.find("#cbIsWholesaleBuyer").prop("checked", e.isWholesaleBuyer); n.find("#cbCanGetCredit").prop("checked", e.canGetCredit); n.find("#cbIsFriend").prop("checked", e.isFriend) } }, error: function (e) { alert(e.responseText) } }) } function UpdateOnlineProfile(e, t) { var n = $("#" + t); var r = { customerId: e, email: n.find("#txtEmail").val(), isWholesaleBuyer: n.find("#cbIsWholesaleBuyer").prop("checked"), canGetCredit: n.find("#cbCanGetCredit").prop("checked"), isFriend: n.find("#cbIsFriend").prop("checked") }; $.ajax({ type: "POST", url: "Management/UpdateOnlineProfile", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function loadCustomerFastOrder(e, t) { loadOrder(0, e, GetItemOrder, false, true, t, { isfastorder: true }) } function loadCurrencyNameList(e, t) { var n = $("#" + e); getCurrency(e); n.find("#addCurrency").button({ icons: { primary: "ui-icon-disk" }, text: true }).unbind("click").click(function () { if (validateAll($("#" + e))) addCurrency(e) }); n.find("#editCurrency").button({ icons: { primary: "ui-icon-disk" }, text: true }).unbind("click").click(function () { if (validateAll($("#" + e))) { if (n.find(".table tbody tr").length == 0) alert("داده ای برای ویرایش وجود ندارد"); else { if (validateAll($(this))) editCurrency(e) } } }); n.find("#deleteCurrency").button({ icons: { primary: "ui-icon-closethick" }, text: true }).unbind("click").click(function () { if (validateAll($("#" + e))) { if (n.find(".table tbody tr").length == 0) { n.find("#currency_Name").val(""); n.find("#currency_Symbol").val(""); n.find("#CurrencyID").val(""); alert("داده ای برای حذف وجود ندارد") } else deleteCurrency(e) } }) } function loadCurrencyList(e, t) { sortid = "CurrencyRateId desc"; var n = $("#" + e); bindItemsForSelectCombo({ servicename: "Management", methodname: "CurrensyList", headertext: "انتخاب ارز", id: "currencyNameAdd", container: e }); bindItemsForSelectCombo({ servicename: "Management", methodname: "CurrensyList", headertext: "انتخاب ارز", id: "search_select", container: e }); if (t) { n.find("#moreFilter").slideUp("fast"); n.find(".toggle-more-filters").click(function () { $(this).toggleClass("open"); n.find("#divBasic").toggleClass("hidden"); n.find("#moreFilter").removeClass("invisible"); n.find("#moreFilter").slideToggle(function () { }) }); n.find("#datefrom").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#dateto").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); n.find("#dateto").datepicker({ changeMonth: true, changeYear: true }); n.find("#rate_date").datepicker({ changeMonth: true, changeYear: true, onClose: function () { validateAll($("#" + e)) } }); getCurrencyRate(e, { container: e, callbackmethod: getCurrencyRate, fname: "", page_index: 0, build: buildCurrencyRateList, servicename: "Management", methodname: "GetCurrencyRate", print: false }); n.find("#addCurrencyRate").button({ icons: { primary: "ui-icon-disk" }, text: true }).unbind("click").click(function () { if (n.find("#currencyNameAdd").val() == "") { alert("نام ارز را انتخاب کنید."); return } if (validateAll($("#" + e))) addCurrencyRate(e) }); n.find("#editCurrencyRate").button({ icons: { primary: "ui-icon-disk" }, text: true }).unbind("click").click(function () { if (n.find("#currencyNameAdd").val() == "") { alert("نام ارز را انتخاب کنید."); return } if (validateAll($("#" + e))) editCurrencyRate(e) }); n.find("#deleteCurrencyRate").button({ icons: { primary: "ui-icon-closethick" }, text: true }).unbind("click").click(function () { deleteCurrencyRate(e) }); n.find("#Reset").click(function () { n.find("#currencyNameAdd").val(0); n.find("#rate_date").val(""); n.find("#text_buyrate").val(""); n.find("#text_sellrate").val("") }).button({ icons: { primary: "ui-icon-plus" }, text: true }); n.find("#divslider").unbind("click").click(function () { sliderClick("moreFilter"); sliderClick("ul_add") }); n.find("#Button_advanceSearch").button().click(function () { getCurrencyRate(e, { container: e, callbackmethod: getCurrencyRate, fname: "", page_index: 0, build: buildCurrencyRateList, servicename: "Management", methodname: "GetCurrencyRate", print: false }) }); n.find("#Button_search").button({ icons: { primary: "ui-icon-search" }, text: true }).click(function () { getCurrencyRate(e, { container: e, callbackmethod: getCurrencyRate, fname: "", page_index: 0, build: buildCurrencyRateList, servicename: "Management", methodname: "GetCurrencyRate", print: false }) }) } } function deleteCurrency(e) { var t = $("#" + e); $.ajax({ type: "POST", url: "Management/DeleteCurrency", contentType: "application/json; charset=utf-8", data: "{id: '" + t.find("#CurrencyID").val() + "'}", success: function (t) { if (!isAuthenticated(t)) return; translate(t); getCurrency(e) }, error: function (e) { alert(e.responseText) } }) } function addCurrency(e) { var t = $("#" + e); $.ajax({ type: "POST", url: "Management/AddCurrency", contentType: "application/json; charset=utf-8", data: "{name: '" + t.find("#currency_Name").val() + "', symbol: '" + t.find("#currency_Symbol").val() + "'}", success: function (t) { if (!isAuthenticated(t)) return; translate(t); getCurrency(e) }, error: function (e) { alert(e.responseText) } }) } function editCurrency(e) { var t = $("#" + e); $.ajax({ type: "POST", url: "Management/EditCurrency", contentType: "application/json; charset=utf-8", data: "{id: '" + t.find("#CurrencyID").val() + "', name: '" + t.find("#currency_Name").val() + "', symbol: '" + t.find("#currency_Symbol").val() + "'}", success: function (t) { if (!isAuthenticated(t)) return; translate(t); getCurrency(e) }, error: function (e) { alert(e.responseText) } }) } function setIndexCurrency(e, t) { $.ajax({ type: "POST", url: "Management/setIndexCurrency", contentType: "application/json; charset=utf-8", data: "{id: '" + e + "'}", success: function (e) { if (!isAuthenticated(e)) return; getCurrency(t); translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function ClickCurrency(e, t) { var n = $("#" + t); n.find("#currency_Name").val($("#" + e.prop("id") + " td[name=currency]").html()); n.find("#currency_Symbol").val($("#" + e.prop("id") + " td[name=symbol]").html()); n.find("#CurrencyID").val(e.prop("id").toString().replace("tr", "")) } function getCurrency(container) { var $con = $("#" + container); $.ajax({ type: "POST", url: "Management/CurrensyList", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; var Currency = typeof response == "string" ? eval("(" + response + ")") : response; var CurrencyItems = ""; for (var j = 0; j < Currency.length; j++) { var val = Currency[0, j]; CurrencyItems += "<tr id='tr" + val.id + "'><td  width='40%' name='currency'>" + val.name + "</td><td width='30%' name='symbol'>" + val.symbol + "</td>" + "<td width='30%' name='symbol'><input value=' ' name='isIndex' currencyId='" + val.id + "' type='checkbox'  " + (val.isIndex ? "checked" : "") + "/></td>"; "</tr>" } $con.find("#currencylist").html(CurrencyItems).parent().tableScroll({ height: 380, width: contentwidth, flush: false }); $con.find("tr[id*=tr]").find("td:not([id=delete])").click(function () { ClickCurrency($(this).parent("tr"), container) }).addClass("cursor"); $con.find("[name='isIndex']").click(function () { setIndexCurrency($(this).attr("currencyId"), container) }) }, error: function (e) { alert(e.responseText) } }) } function buildCurrencyRateList(jq, params) { var $con = $("#" + params.pagingContainer); jq = jq.results; var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "name", sort: "ac_Currency.CurrencyId", width: "24%" }); lsth.push({ title: "date", sort: "Date", width: "30%" }); lsth.push({ title: "buyPrice", sort: "Buy", width: "21%" }); lsth.push({ title: "sellPrice", sort: "Sell", width: "21%" }); lsth.push({ title: "deleteKey", width: "4%" }); var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; trBody[0] = { trId: val.CurrencyRateId }; trBody[1] = { props: { currencyId: val.CurrencyId, name: "name", id: val.CurrencyId, width: "24%" }, html: val.Currency + " " + val.Symbol }; trBody[2] = { html: val.Date, props: { name: "date", persianDate: val.date.split(" ")[1], date: val.Date, width: "30%", klass: "dateLong"} }; trBody[3] = { props: { name: "buyPrice", buy: val.Buy, width: "21%" }, name: "buyPrice", html: val.Buy }; trBody[4] = { props: { name: "sellPrice", sell: val.Sell, width: "21%" }, name: "sellPrice", html: val.Sell }; lstb.push(trBody) } table = { header: lsth, body: lstb, details: { rowClick: ClickCurrencyRate, deleteFunction: deleteCurrencyRate }, heigth: 300, container: params.pagingContainer, divName: "currencyRateList", rowClickParams: { textboxId: "CustomerIntroducerCode"} }; buildTable(table) } function getCurrencyRate(e, t) { var n = $("#" + e); var r = true; var i = n.find("#PageSize").val(); var s = 0; var o = 0; var u; var a = []; var f = n.find("#moreFilter:visible").length > 0 ? true : false; if (f) { a = { skip: s, take: i, currentPage: o, datefrom: n.find("#datefrom").val(), dateto: n.find("#dateto").val(), buyratefrom: n.find("#buyfrom").val(), buyrateto: n.find("#buyto").val(), sellratefrom: n.find("#sellfrom").val(), sellrateto: n.find("#sellto").val(), currencyid: n.find("#search_select").val(), first: r, sort: sortid, advance: f} } else { n.find("#datefrom").val(""); n.find("#dateto").val(""); n.find("#buyfrom").val(""); n.find("#buyto").val(""); n.find("#sellfrom").val(""); n.find("#sellto").val(""); a = { skip: s, take: i, currentPage: o, datefrom: n.find("#rate_date").val(), dateto: n.find("#dateto").val(), buyratefrom: n.find("#text_buyrate").val(), buyrateto: n.find("#buyto").val(), sellratefrom: n.find("#text_sellrate").val(), sellrateto: n.find("#sellto").val(), currencyid: n.find("#currencyNameAdd").val(), first: r, sort: sortid, advance: f} } t["DTO"] = a; pageselectCallback(0, t, { container: "", fname: t.fname, pagingContainer: e, first: true, isOrder: false }) } function ClickCurrencyRate(e, t) { var n = $("#" + t); n.find("#text_buyrate").val(e.find("td[name=buyPrice]").attr("buy")); n.find("#text_sellrate").val(e.find("td[name=sellPrice]").attr("sell")); n.find("#rate_date").val(e.find("td[name=date]").attr("persianDate")); n.find("#currencyNameAdd").val(e.find("td[name='name']").attr("currencyId")); n.find("#currencyid").val(e.prop("id").replace("tr", "")); var r = n.find("#moreFilter:visible").length > 0 ? true : false; if (r) { sliderClick("moreFilter"); sliderClick("ul_add") } onRowClick(e) } function getCurrencyForSelect(id, container) { var $con = $("#" + container); $.ajax({ type: "POST", url: "Management/CurrensyList", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; var Currency = typeof response == "string" ? eval("(" + response + ")") : response; var CurrencyItems = " <li> <a  href='javascript:void(0);' ><input type='radio' name='" + id + "' class='offright' value='0'/><span> -</span></a></li>"; for (var j = 0; j < Currency.length; j++) { var val = Currency[0, j]; CurrencyItems += " <li>" + " <a  href='javascript:void(0);' ><input type='radio' name='" + id + "' class='offright' value='" + val["CurrencyId"] + "'/><span>" + val["Currency"] + "</span></a>" + "</li>" } $con.find("#" + id).find("div.selectChildCont > ul").html(CurrencyItems); $con.find("#search_select").find("div.selectChildCont > ul").html(CurrencyItems); ChangeNameOfComboBox("search_select", id) }, error: function (e) { alert(e.responseText) } }) } function addCurrencyRate(e) { var t = $("#" + e); $.ajax({ type: "POST", url: "Management/AddCurrencyRate", contentType: "application/json; charset=utf-8", data: "{idcurrency: '" + t.find("#currencyNameAdd").val() + "', buy: '" + t.find("#text_buyrate").val() + "', sell: '" + t.find("#text_sellrate").val() + "', date: '" + t.find("#rate_date").val() + "'}", success: function (n) { if (!isAuthenticated(n)) return; t.find("#currencyNameAdd").val(0); t.find("#rate_date").val(""); t.find("#text_buyrate").val(""); t.find("#text_sellrate").val(""); getCurrencyRate(e, { container: e, callbackmethod: getCurrencyRate, fname: "", page_index: 0, build: buildCurrencyRateList, servicename: "Management", methodname: "GetCurrencyRate", print: false }); translate(n) }, error: function (e) { alert(e.responseText) } }) } function editCurrencyRate(e) { var t = $("#" + e); var n = { id: t.find("#currencyid").val(), currencyid: t.find("#currencyNameAdd").val(), buy: t.find("#text_buyrate").val(), sell: t.find("#text_sellrate").val(), date: t.find("#rate_date").val() }; $.ajax({ type: "POST", url: "Management/EditCurrencyRate", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (n) { if (!isAuthenticated(n)) return; translate(n); t.find("currencyNameAdd").val(0); t.find("#rate_date").val(""); t.find("#text_buyrate").val(""); t.find("#text_sellrate").val(""); getCurrencyRate(e, { container: e, callbackmethod: getCurrencyRate, fname: "", page_index: 0, build: buildCurrencyRateList, servicename: "Management", methodname: "GetCurrencyRate", print: false }) }, error: function (e) { alert(e.responseText) } }) } function deleteCurrencyRate(e, t) { var n = $("#" + t); $.ajax({ type: "POST", url: "Management/DeleteCurrencyRate", contentType: "application/json; charset=utf-8", data: "{id: '" + e + "'}", success: function (e) { if (!isAuthenticated(e)) return; translate(e); n.find("#currencyNameAdd").val(0); n.find("#rate_date").val(""); n.find("#text_buyrate").val(""); n.find("#text_sellrate").val(""); getCurrencyRate(t, { container: t, callbackmethod: getCurrencyRate, fname: "", page_index: 0, build: buildCurrencyRateList, servicename: "Management", methodname: "GetCurrencyRate", print: false }) }, error: function (e) { alert(e.responseText) } }) } function loadSupplierPayment(e, t, n) { if (n) { var r = $("#" + t); r.find("#div_customer").addClass("invisible"); r.find("#txt_payer").removeClass("required"); r.find("#ddl_CounterTo").addClass("invisible"); r.find("#lbl_CounterTo").addClass("hidden"); r.find("#lbl_payer").addClass("hidden"); ChangeCheckBoxGroupName("radio", t); setRadioValue("radio" + t, "true", t); r.find("#radio" + t).buttonset(); r.find("#btn_Cash").off().on("click", function () { GetItemCash(t) }).button({ icons: { primary: "ui-icon-plus" }, text: true }); r.find("#btn_Cheque").off().on("click", function () { if (n) { r.find("#divslider2").removeClass("invisible"); r.find("#table_cheque").removeClass("invisible") } GetItemCheque(t) }).button({ icons: { primary: "ui-icon-plus" }, text: true }); r.find("#btn_Add_Payment").off().on("click", function () { if (validateAll(r) && r.find("#txt_SumPeyment").val() != "0") AddPayment(e, t) }).button({ icons: { primary: "ui-icon-disk" }, text: true }); r.find("#btnPrint").die().live("click", function () { PrintPaymentDetails(t, r.find("#hi_paymentId").val()) }).button({ icons: { primary: "ui-icon-print" }, text: true }); GetItemCash(t) } } function loadPayment(e, t) { var n = $("#" + e); if ($("#txt_customer").val() != "") n.find("#txt_payer").val($("#txt_customer").val()); n.find("#div_counterTo").addClass("invisible"); aComplete({ methodname: "GetCompletionListByCustomerName", servicename: "Management", id: "txt_payer", container: e, minlength: 2, autofocus: false, limit: 20, boxId: "txt_payer", fname: customerOnSelect }); loadCustomerPayment(null, e, t) } function loadCounterPayment(e, t) { var n = $("#" + e); n.find("#voucherDiv").addClass("invisible"); n.find("#div_customer").addClass("invisible"); n.find("#txt_payer").removeClass("required"); n.find("#div_counterTo").addClass("invisible"); n.find("#div_voucherTxt").addClass("hidden"); n.find("#spanVoucher").addClass("invisible"); loadCustomerPayment(null, e, t) } function loadTransferMoney(e, t) { var n = $("#" + e); n.find("#radio").addClass("invisible"); n.find("#voucherDiv").addClass("invisible"); n.find("#div_customer").addClass("invisible"); n.find("#txt_payer").removeClass("required"); n.find("#div_voucherTxt").addClass("hidden"); n.find("#spanVoucher").addClass("invisible"); bindItemsForSelectCombo({ methodname: "getCounterName", servicename: "Management", headertext: "انتخاب صندوق", id: "ddl_CounterTo", container: e }); loadCustomerPayment(null, e, t) } function loadCustomerPayment(e, t, n) { sortid = "OrderHeaderId desc"; var r = $("#" + t); if (n) { if (e != null) { r.find("#div_counterTo").addClass("invisible"); r.find("#div_customer").addClass("invisible"); r.find("#txt_payer").removeClass("required") } ChangeCheckBoxGroupName("radio", t); r.find("#hd_d_PersonId").val(e); setRadioValue("radio" + t, "false", t); r.find("#radio" + t).buttonset(); $("#dialog" + t).remove(); r.find("#dialog").attr("id", "dialog" + t); r.find("#btn_Cash").off().on("click", function () { GetItemCash(t); tableStyle() }).button({ icons: { primary: "ui-icon-plus" }, text: true }); r.find("#btn_Cheque").off().on("click", function () { if (n) { r.find("#divslider2").removeClass("invisible"); r.find("#table_cheque").removeClass("invisible") } GetItemCheque(t) }).button({ icons: { primary: "ui-icon-plus" }, text: true }); r.find("#txtVoucherNumber").bind("keydown", function (e) { if (e.keyCode == 13 || e.keyCode == 9) { GetVoucherItem(n, t) } }); r.find("#btn_voucher").off().on("click", function () { sortid = "OrderHeaderId Desc"; getCustomerVoucherList(t, { container: "dialog", callbackmethod: getCustomerVoucherList, fname: VoucherRowClick, page_index: 0, build: buildPayVoucherList, servicename: "Management", methodname: "getCustomerVoucherList" }) }); r.find("#btn_Add_Payment").off().on("click", function () { if (validateAll(r)) AddPayment(e, t) }).button({ icons: { primary: "ui-icon-disk" }, text: true }); r.find("#btnPrint").die().live("click", function () { PrintPaymentDetails(t, r.find("#hi_paymentId").val()) }).button({ icons: { primary: "ui-icon-print" }, text: true }); localize() } } function AddPayment(e, t) { var n = $("#" + t); if (n.find("#txt_SumPeyment").val() == "0") return; var r = []; var i = []; var s = []; if (n.find("#ddl_CounterTo").val() == $("#userDefault").find("#ddl_m_Counter").val()) { alert("صندوق مبدا و مقصد یکسان است."); return } $.each($("#" + t).find("tr[id*=Cash_]"), function () { var e = {}; e["CurrencyId"] = $("#ddl_m_Currency_" + this.id).val(); e["Amount"] = $(this).find("#txt_m_Amount").val(); e["Type"] = getRadioSelectedValue("radioPayment" + this.id); r.push(e) }); $.each($("#" + t).find("tr[id*=Cheque_]"), function () { var e = {}; if ($(this).find("#ddl_m_Bank_" + this.id).val() == "" || $(this).find("#txt_m_Serial").val() == "" || $(this).find("[name='txt_m_DueDate']").val() == "" || $(this).find("#txt_m_Amount").val() == "") return; e["Bank"] = $(this).find("#ddl_m_Bank_" + this.id).val(); e["Serial"] = $(this).find("#txt_m_Serial").val(); e["DueDate"] = $(this).find("[name='txt_m_DueDate']").val(); e["CurrencyId"] = $("#ddl_m_Currency_" + this.id).val(); e["Amount"] = $(this).find("#txt_m_Amount").val(); i.push(e) }); $.each($("#" + t).find("tr[id*=voucher_]"), function () { s.push($(this).find("[name=voucherNumber]").html()) }); var o = { cash: r, cheque: i, voucher: s, supplierid: e, payerCode: n.find("#txt_payer").val(), counterid: $("#userDefault").find("#ddl_m_Counter").val(), pay: getRadioSelectedValue("radio" + t, t), tocounterid: n.find("#ddl_CounterTo").val(), description: n.find("#txt_description").val(), date: $("#userDefault").find("#txt_s_Date").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(o), type: "Post", url: "Management/AddPayment", success: function (e) { if (!isAuthenticated(e)) { return } if (e.isDone) n.find("#hi_paymentId").val(e.OrderHeaderId); translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function PrintPaymentDetails(e, t) { var n = $("#" + e); if (n.find("#Div_Print").html().length < 10) { n.find("#Div_Print").load("Report/PrintPayment.htm", function () { getPaymentPrint(e, t) }) } else getPaymentPrint(e, t) } function getPaymentPrint(e, t) { var n = $("#" + e); var r = { OrderHeaderId: t }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(r), type: "Post", url: "Management/GetDetailPaymentList", success: function (t) { if (!isAuthenticated(t)) return; if (t.isdone) { if (!t.pay) { SetPaymentData(e, t) } else { SetPaymentData(e, t) } Popup(n.find("#Div_Print").html()) } else alert("noData") }, error: function (e) { alert(e.responseText) } }) } function SetPaymentData(e, t) { var n = $("#" + e); var r = ""; var i = 0; n.find("#lb_recieveFrom").html("&nbsp;" + t.recieveFrorm); n.find("#lb_Description").html("&nbsp;" + t.description); n.find("#lb_date").html("&nbsp;" + ToPersianDate(t.Date)); n.find("#lb_InvoiceNO").html("&nbsp;" + t.InvoiceNO); $("table#tbl_printPayment tr.newRows").each(function (e) { $(this).remove() }); var s = n.find("#tr-first"); if (t.dp.cheque.length == 0) s.html(""); else if (s.html() == "") { var o = '<td colspan="2" valign="top" style="text-align: center;">' + " ردیف" + "</td>" + ' <td colspan="2" valign="top" style="text-align: center;">' + "نوع سند" + "  </td>" + '<td colspan="2" valign="top" style="text-align: center;">' + " سر رسید" + "</td>" + '<td colspan="2" valign="top" style="text-align: center;">' + " شماره چک" + " </td>" + ' <td colspan="2" valign="top" style="text-align: center;">' + " مشخصات بانک" + " </td>" + '<td colspan="12" valign="top" style="text-align: center;">' + "  مبلغ به تومان &nbsp;" + " </td>"; s.html(o) } var u = 0; for (var a = 0; a < t.dp.cash.length; a++) { u += Math.abs(t.dp.cash[a].Amount) } var f = u.toString(); n.find("#lb_PaymentMoney").text(convertNumberToString(f)); var l = '<td colspan="10" valign="top" style="border-top:hidden;border-right:hidden;">مبلغ نقد :&nbsp;' + convertNumberToString(f) + "تومان</td>" + '<td valign="top" width="1%">' + (f.length > 0 ? f.substring(f.length - 1, f.length) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (f.length - 1 > 0 ? f.substring(f.length - 2, f.length - 1) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (f.length - 2 > 0 ? f.substring(f.length - 3, f.length - 2) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (f.length - 3 > 0 ? f.substring(f.length - 4, f.length - 3) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (f.length - 4 > 0 ? f.substring(f.length - 5, f.length - 4) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (f.length - 5 > 0 ? f.substring(f.length - 6, f.length - 5) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (f.length - 6 > 0 ? f.substring(f.length - 7, f.length - 6) : "&nbsp;") + "</td>" + '<td valign="top" width="1%"> ' + (f.length - 7 > 0 ? f.substring(f.length - 8, f.length - 7) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (f.length - 8 > 0 ? f.substring(f.length - 9, f.length - 8) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (f.length - 9 > 0 ? f.substring(f.length - 10, f.length - 9) : "&nbsp;") + "</td>" + ' <td colspan="2" valign="top" width="1%">' + (f.length - 10 > 0 ? f.substring(f.length - 11, f.length - 10) : "&nbsp;") + " </td>"; n.find("#tr_paymentMoney").html(l); for (var a = 0; a < t.dp.cheque.length; a++) { var c = t.dp.cheque[a]; var h = Math.abs(c.Amount).toString(); i += Math.abs(c.Amount); r += '<tr class="newRows">' + '<td colspan="2" valign="top" width="4%">' + (a + 1) + "</td>" + '<td colspan="2" valign="top" width="5%">چک</td>' + '<td colspan="2" valign="top" width="7%">' + ToPersianDate(c.Date) + "</td>" + '<td colspan="2" valign="top" width="7%">' + c.Serial + "</td>" + ' <td colspan="2" valign="top" width="65%">' + c.Bank + "</td>" + '<td valign="top" width="1%">' + (h.length > 0 ? h.substring(h.length - 1, h.length) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 1 > 0 ? h.substring(h.length - 2, h.length - 1) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 2 > 0 ? h.substring(h.length - 3, h.length - 2) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 3 > 0 ? h.substring(h.length - 4, h.length - 3) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 4 > 0 ? h.substring(h.length - 5, h.length - 4) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 5 > 0 ? h.substring(h.length - 6, h.length - 5) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 6 > 0 ? h.substring(h.length - 7, h.length - 6) : "&nbsp;") + "</td>" + '<td valign="top" width="1%"> ' + (h.length - 7 > 0 ? h.substring(h.length - 8, h.length - 7) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 8 > 0 ? h.substring(h.length - 9, h.length - 8) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 9 > 0 ? h.substring(h.length - 10, h.length - 9) : "&nbsp;") + "</td>" + ' <td colspan="2" valign="top" width="1%">' + (h.length - 10 > 0 ? h.substring(h.length - 11, h.length - 10) : "&nbsp;") + " </td>" + "</tr>" } var h = Math.abs(i).toString(); r += '<tr class="newRows">' + '<td colspan="10" valign="top" > جمع اسناد :&nbsp;' + convertNumberToString(h) + "تومان</td>" + '<td valign="top" width="1%">' + (h.length > 0 ? h.substring(h.length - 1, h.length) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 1 > 0 ? h.substring(h.length - 2, h.length - 1) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 2 > 0 ? h.substring(h.length - 3, h.length - 2) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 3 > 0 ? h.substring(h.length - 4, h.length - 3) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 4 > 0 ? h.substring(h.length - 5, h.length - 4) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 5 > 0 ? h.substring(h.length - 6, h.length - 5) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 6 > 0 ? h.substring(h.length - 7, h.length - 6) : "&nbsp;") + "</td>" + '<td valign="top" width="1%"> ' + (h.length - 7 > 0 ? h.substring(h.length - 8, h.length - 7) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 8 > 0 ? h.substring(h.length - 9, h.length - 8) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 9 > 0 ? h.substring(h.length - 10, h.length - 9) : "&nbsp;") + "</td>" + ' <td colspan="2" valign="top" width="1%">' + (h.length - 10 > 0 ? h.substring(h.length - 11, h.length - 10) : "&nbsp;") + " </td>" + "</tr>"; h = (+i + +f).toString(); r += '<tr class="newRows">' + '<td colspan="10" valign="top" > مبلغ کل نقد و اسناد :&nbsp;' + convertNumberToString(h) + "تومان</td>" + '<td valign="top" width="1%">' + (h.length > 0 ? h.substring(h.length - 1, h.length) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 1 > 0 ? h.substring(h.length - 2, h.length - 1) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 2 > 0 ? h.substring(h.length - 3, h.length - 2) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 3 > 0 ? h.substring(h.length - 4, h.length - 3) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 4 > 0 ? h.substring(h.length - 5, h.length - 4) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 5 > 0 ? h.substring(h.length - 6, h.length - 5) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 6 > 0 ? h.substring(h.length - 7, h.length - 6) : "&nbsp;") + "</td>" + '<td valign="top" width="1%"> ' + (h.length - 7 > 0 ? h.substring(h.length - 8, h.length - 7) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 8 > 0 ? h.substring(h.length - 9, h.length - 8) : "&nbsp;") + "</td>" + '<td valign="top" width="1%">' + (h.length - 9 > 0 ? h.substring(h.length - 10, h.length - 9) : "&nbsp;") + "</td>" + ' <td colspan="2" valign="top" width="1%">' + (h.length - 10 > 0 ? h.substring(h.length - 11, h.length - 10) : "&nbsp;") + " </td>" + "</tr>"; if (!t.pay) { n.find("#lb_header").text("رسید وجه"); n.find("#lb_typeRecPay").text("دریافت از :"); r += '<tr class="newRows">' + ' <td style="border: medium hidden; text-align: center;" colspan="8" valign="top"  width="50%"><br/><br/>' + "  نام و امضای مدیر عامل" + " </td>" + ' <td style="border: medium hidden; text-align: center;" colspan="14" valign="top"  width="50%"><br/><br/>' + " نام و امضای دریافت کننده" + "   </td>" + " </tr>" } else { n.find("#lb_header").text("پرداخت وجه"); n.find("#lb_typeRecPay").text("پرداخت به :"); r += '<tr class="newRows">' + ' <td style="border: medium hidden; text-align: center;" colspan="8" valign="top"  width="50%"><br/><br/>' + " نام و امضای پرداخت کننده چک" + " </td>" + ' <td style="border: medium hidden; text-align: center;" colspan="14" valign="top"  width="50%"><br/><br/>' + " نام و امضای دریافت کننده" + "   </td>" + " </tr>" } s.append(r) } function setReciveData(e, t) { } function GetItemCash(e) { var t = $("#" + e); var n = ""; var r = "Cash_" + cout_tr + "_" + e; cout_tr += 1; n += "<tr id= '" + r + "'>" + "<td id='Currency'>" + " <select class='selectLarg' id='ddl_m_Currency_" + r + "'></select>" + "</td>" + "<td><input type='text' class=' inputText  ' id='txt_m_Amount' placeholder='amount' onchange='return SumPayment(\"" + e + "\");'/></td>" + "<td>" + "<div id='radioPayment" + r + "'>" + "<input type='radio' id='radio1" + r + "' name='radioPayment" + r + "' checked='checked' value='نقدی'/><label for='radio1" + r + "'>cash</label>" + "<input type='radio' id='radio2" + r + "' name='radioPayment" + r + "'  value='کارت' /><label for='radio2" + r + "'>creditCard</label>" + "<input type='radio' id='radio3" + r + "' name='radioPayment" + r + "' value='حواله' /><label for='radio3" + r + "'>remittance</label>" + "</div></td>" + "<td id='delete'><button name='btn_Delete' >حذف</button></td></tr>"; t.find("#CashList").append(n).parent().tableScroll({ height: 380, width: t.width() - 130, flush: false }); t.find("[name=btn_Delete]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).unbind().click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) RemoveItemCashElement($(this).parents("tr").attr("id"), e); else return }); localize(); tableStyle(); $("#" + r).find("#radioPayment" + r).buttonset(); t.find("#ddl_m_Currency_" + r).html($("#userDefault").find("#ddl_m_Currency").html()).find("option:eq(1)").prop("selected", "selected") } function RemoveItemCashElement(e, t) { var n = $("#" + t); n.find("#" + e).remove(); SumPayment(t) } function GetItemCheque(e) { var t = $("#" + e); var n = ""; var r = "Cheque_" + cout_tr + "_" + e; cout_tr += 1; n += "<tr id= '" + r + "'>" + "<td id='Currency'>" + " <select class='selectLarg' id='ddl_m_Currency_" + r + "'></select>" + "</td>" + "<td><input type='text'  class=' inputText  ' id='txt_m_Amount' placeholder='chequeAmount' onchange='return SumPayment(\"" + e + "\");'/></td>" + "<td><input type='text'  class=' inputText  ' id='txt_m_Serial' placeholder='chequeSerial' /></td>" + "<td id='Bank'>" + " <select class='selectLarg' id='ddl_m_Bank_" + r + "'>" + "</select>" + "</td>" + "<td><input type='text'  class=' inputText  id='" + cout_tr + "_txt_m_DueDate'  name='txt_m_DueDate' placeholder='chequeDate'/></td>" + "<td id='delete'><button name='btn_Delete' >حذف</button></td></tr>"; t.find("#ChequeList").append(n).parent().tableScroll({ height: 380, width: t.width() - 85, flush: false }); $("[name='txt_m_DueDate']").datepicker({ changeMonth: true, changeYear: true }); localize(); tableStyle(); t.find("[name=btn_Delete]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).unbind().click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) RemoveItemCashElement($(this).parents("tr").attr("id"), e); else return }); if (getRadioSelectedValue("radio" + e, e) == "false") { bindItemsForSelectCombo({ methodname: "GetComboItems", servicename: "XmlDropDown", headertext: "انتخاب بانک", id: "ddl_m_Bank_" + r, container: e }, { path: "Counter/BankTitle" }) } else bindItemsForSelectCombo({ data: { ParentName: "bankPaidDocument" }, methodname: "GetChildAccountNameWithParent", servicename: "Management", headertext: "انتخاب بانک", id: "ddl_m_Bank_" + r, container: e }); t.find("#ddl_m_Currency_" + r).html($("#userDefault").find("#ddl_m_Currency").html()).find("option:eq(1)").prop("selected", "selected") } function SumPayment(e) { var t = $("#" + e); var n = 0; $.each(t.find("tr[id*=Cheque_]"), function () { n += $(this).find("#txt_m_Amount").val() * 1 }); t.find("#txt_m_SumCheque").val(n); n = 0; $.each(t.find("tr[id*=Cash_]"), function () { n += $(this).find("#txt_m_Amount").val() * 1 }); t.find("#txt_m_SumCash").val(n); n = 0; $.each(t.find("tr[id*=voucher_]"), function () { n += $(this).find("[name=voucherAmount]").html() * 1 }); t.find("#txt_m_SumVoucher").val(n); $("#" + e).find("#txt_SumPeyment").val($("#" + e).find("#txt_m_SumCheque").val() * 1 + $("#" + e).find("#txt_m_SumCash").val() * 1 + $("#" + e).find("#txt_m_SumVoucher").val() * 1) } function getPaymentList(e) { var t = $("#" + e); var n = true; var r = t.find("#PageSize").val(); var i = 0; var s = 0; var o = "", u = "", a = "", f = "", l = "", c = "", h = "", p = "", d = "", v = "", m = "", g = "", y = ""; if (t.find("#moreFilter").is(":visible")) { var b = t.find("#ddl_d_SearchBy1").val(); if (b != "") { if (b == "Code") { u = t.find("#txtSearch1").val() } if (b == "Name") { o = t.find("#txtSearch1").val() } if (b == "EmployeeId") { a = t.find("#txtSearch1").val() } if (b == "EmployeeName") { f = t.find("#txtSearch1").val() } if (b == "Counter") { l = t.find("#txtSearch1").val() } } c = t.find("#ddlBank").val(); h = t.find("#txtSerial").val(); if (t.find("#txt_s_InvoiceDateStart").length > 0) p = t.find("#txt_s_InvoiceDateStart").val(); if (t.find("#txt_s_InvoiceDateEnd").length > 0) d = t.find("#txt_s_InvoiceDateEnd").val(); if (t.find("#txt_s_PaymentDateStart").length > 0) v = t.find("#txt_s_PaymentDateStart").val(); if (t.find("#txt_s_PaymentDateEnd").length > 0) m = t.find("#txt_s_PaymentDateEnd").val(); if (t.find("#txt_s_PriceFrom").length > 0) g = t.find("#txt_s_PriceFrom").val(); if (t.find("#txt_s_PriceTo").length > 0) y = t.find("#txt_s_PriceTo").val() } var w = { skip: i, take: r, currentPage: s, first: n, sort: sortid, supplierid: t.find("#hd_d_PersonId").val(), IsClient: t.find("#hd_d_IsClient").val(), SupplierName: o, code: u, EmployeeId: a, EmployeeName: f, Counter: l, BankName: c, Serial: h, InvoiceDateStart: p, InvoiceDateEnd: d, PaymentDateStart: v, PaymentDateEnd: m, PriceFrom: g, PriceTo: y, pay: t.find("#Checkbox1" + e).length > 0 ? t.find("#Checkbox1" + e).prop("checked") : "", receive: t.find("#Checkbox2" + e).length > 0 ? t.find("#Checkbox2" + e).prop("checked") : "", cash: t.find("#Checkbox3" + e).length > 0 ? t.find("#Checkbox3" + e).prop("checked") : "", cheque: t.find("#Checkbox4" + e).length > 0 ? t.find("#Checkbox4" + e).prop("checked") : "", voucher: t.find("#Checkbox5" + e).length > 0 ? t.find("#Checkbox5" + e).prop("checked") : "", passed: t.find("#Checkbox6" + e).length > 0 ? t.find("#Checkbox6" + e).prop("checked") : "", notpass: t.find("#Checkbox7" + e).length > 0 ? t.find("#Checkbox7" + e).prop("checked") : "", shopid: $("#userDefault").find("#ddl_s_Branch").val(), counterid: $("#userDefault").find("#ddl_m_Counter").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(w), type: "Post", url: "Management/GetPaymentList", success: function (r) { if (!isAuthenticated(r)) return; var i = PaymentgetOptionsFrom(r.count, e); t.find("#paging").pagination(r.count, i); PaymentpageselectCallback(0, r, e, n) }, error: function (e) { alert(e.responseText) } }) } function PaymentgetOptionsFrom(e, t) { var n = $("#" + t); var r = { callback: PaymentpageselectCallback }; n.find("input:text").each(function () { r[this.name] = this.className.match(/numeric/) ? parseInt(this.value) : this.value }); r.prev_show_always = false; r.next_show_always = false; if (e < n.find("#PageSize").val()) n.find("#PageSize").css("display", "none"); else { n.find("#PageSize").css("display", "inline") } r.items_per_page = n.find("#PageSize").val(); r.prev_text = "قبلی"; r.next_text = "بعدی"; r.container = t; return r } function buildPaymentList(jq, container) { var $con = $("#" + container); jq = jq.results; var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; if (List != null) { for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<tr id='tr" + val.OrderHeaderId + "'>" + "<td width='15%' name='Clinet' id='" + val.ClientId + "'>" + val.ClientName + " " + val.ClientFamily + "</td> " + "<td width='15%' name='PaymentNO' >" + val.Name + " " + val.Family + "</td>" + "<td width='15%' name='Date' >" + val.Date + "</td>" + "<td width='15%' name='Pay'>" + (val.Sell == false ? "واریز" : "برداشت") + "</td>" + "<td width='15%' name='Code' >" + val.Code + "</td> " + "<td width='15%' name='Price'>" + val.Price + "</td> " + "<td width='10%'name='detail'><button id='a_Button' >جزئیات فاکتور</button></td>"; "</tr>" } } $con.find("#PaymentList").html(ItemList); $con.find("#PaymentList").parent().tableScroll({ height: 380, width: contentwidth, flush: false }); $con.find("[id=a_Button]").button({ icons: { primary: "ui-icon-plus" }, text: false }).click(function () { ListDetailPayment($(this).parents("tr").prop("id").replace("tr", ""), container) }) } function PaymentpageselectCallback(e, t, n, r) { var i = $("#" + n); if (r) { buildPaymentList(t, n) } else { r = false; var s = i.find("#PageSize").val(); var o = ""; var u = s; var a = e == 0 ? 0 : e * u; var f = "", l = "", c = "", h = "", p = "", d = "", v = ""; var m = i.find("#ddl_d_SearchBy1").val(); if (m != "") { if (m == "Code") { l = i.find("#txtSearch1").val() } if (m == "Name") { f = i.find("#txtSearch1").val() } if (m == "EmployeeId") { c = i.find("#txtSearch1").val() } if (m == "EmployeeName") { h = i.find("#txtSearch1").val() } if (m == "Counter") { p = i.find("#txtSearch1").val() } } var m = i.find("#ddl_d_SearchBy2").val(); if (m != "") { if (m == "BankName") { d = i.find("#txtSearch2").val() } if (m == "Serial") { v = i.find("#txtSearch2").val() } } var g = { skip: a, take: u, currentPage: e, first: r, sort: sortid, supplierid: i.find("#hd_d_PersonId").val(), IsClient: i.find("#hd_d_IsClient").val(), SupplierName: f, code: l, EmployeeId: c, EmployeeName: h, Counter: p, BankName: d, Serial: v, InvoiceDateStart: i.find("#txt_s_InvoiceDateStart").length > 0 ? i.find("#txt_s_InvoiceDateStart").val() : "", InvoiceDateEnd: i.find("#txt_s_InvoiceDateEnd").length > 0 ? i.find("#txt_s_InvoiceDateEnd").val() : "", PaymentDateStart: i.find("#txt_s_PaymentDateStart").length > 0 ? i.find("#txt_s_PaymentDateStart").val() : "", PaymentDateEnd: i.find("#txt_s_PaymentDateEnd").length > 0 ? i.find("#txt_s_PaymentDateEnd").val() : "", PriceFrom: i.find("#txt_s_PriceFrom").length > 0 ? i.find("#txt_s_PriceFrom").val() : "", PriceTo: i.find("#txt_s_PriceTo").length > 0 ? i.find("#txt_s_PriceTo").val() : "", pay: i.find("#Checkbox1" + n).length > 0 ? i.find("#Checkbox1" + n).prop("checked") : "", receive: i.find("#Checkbox2" + n).length > 0 ? i.find("#Checkbox2" + n).prop("checked") : "", cash: i.find("#Checkbox3" + n).length > 0 ? i.find("#Checkbox3" + n).prop("checked") : "", cheque: i.find("#Checkbox4" + n).length > 0 ? i.find("#Checkbox4" + n).prop("checked") : "", voucher: i.find("#Checkbox5" + n).length > 0 ? i.find("#Checkbox5" + n).prop("checked") : "", passed: i.find("#Checkbox6" + n).length > 0 ? i.find("#Checkbox6" + n).prop("checked") : "", notpass: i.find("#Checkbox7" + n).length > 0 ? i.find("#Checkbox7" + n).prop("checked") : "", shopid: $("#userDefault").find("#ddl_s_Branch").val(), counterid: $("#userDefault").find("#ddl_m_Counter").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(g), type: "Post", url: "Management/GetPaymentList", success: function (e) { if (!isAuthenticated(e)) return; buildPaymentList(e, n) }, error: function (e) { alert(e.responseText) } }); return false } Sort(getPaymentList, n) } function ListDetailPayment(id, container) { var $con = $("#" + container); $("#DetailPaymentList").attr("id", "DetailPaymentList" + container); $DetailPaymentList = $("#DetailPaymentList" + container); var DTO = { OrderHeaderId: id }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(DTO), type: "Post", url: "Management/GetDetailPaymentList", success: function (response) { if (!isAuthenticated(response)) return; var List = typeof response == "string" ? eval("(" + response + ")") : response; var ItemCash = ""; if (List.dp) { for (var i = 0; i < List.dp.cash.length; i++) { var val = List.dp.cash[0, i]; ItemCash += "<tr id='tr" + val.AccountDetailId + "'>" + "<td width='50%' name='PaymentNO' >" + val.Amount + "  " + val.Currency + "</td>" + "<td width='40%'>" + val.Type + "</td>" + "<td width='10%' id='delete'><button id='deleteCash'>حذف</button></td></tr>" } } $DetailPaymentList.find("#CashList").html(ItemCash).parent().tableScroll({ height: 380, width: 500, flush: false }); if (ItemCash != "") { $DetailPaymentList.find("#tablecash").removeClass("invisible"); $DetailPaymentList.find("[id=deleteCash]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) RemoveItemDetailCash($(this).parents("tr").prop("id").replace("tr", "")); else return }) } else { $DetailPaymentList.find("#tablecash").addClass("invisible") } ItemCheque = ""; if (List.dp) { for (var i = 0; i < List.dp.cheque.length; i++) { var val = List.dp.cheque[0, i]; ItemCheque += "<tr id='tr" + val.AccountDetailId + "'>" + "<td name='PaymentNO' width='18%'>" + val.Amount + "  " + val.Currency + "</td>" + "<td  width='18%'>" + val.Bank + "</td>" + "<td  width='20%'><input style='width:100px; height:20px;' name='serial' value='" + val.Serial + "'/></td>" + "<td id='status'  width='15%'>" + (val.Passed == "پاس شده" ? val.Passed : "<button id='btn_pass'>تایید</button>") + "</td>" + "<td   width='15%'><input style='width:70px; height:20px;' name='date' value='" + ToPersianDateDigitYearRight(val.Date) + "'/></td>" + "<td id='delete' width='7%'><button id='deleteCheque'>delete</button></td><td width='7%'><button id='editCheque'>edit</button></td></tr>" } } $DetailPaymentList.find("#ChequeList").html(ItemCheque).parent().tableScroll({ height: 380, width: 600, flush: false }); $DetailPaymentList.find("[name='date']").datepicker(); if (ItemCheque != "") { $DetailPaymentList.find("#tablecheque").removeClass("invisible"); $DetailPaymentList.find("[id=deleteCheque]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) RemoveItemDetailCheque($(this).parents("tr").prop("id").replace("tr", "")); else return }); $DetailPaymentList.find("[id=editCheque]").button({ icons: { primary: "ui-icon-pencil" }, text: false }).click(function () { editItemDetailCheque($(this).parents("tr").prop("id").replace("tr", ""), $(this).parents("tr").find("[name='date']").val(), $(this).parents("tr").find("[name='serial']").val()) }); $DetailPaymentList.find("[id=btn_pass]").button({ text: true }).click(function () { ChequePassed($(this).parents("tr").prop("id").replace("tr", ""), this) }) } else { $DetailPaymentList.find("#tablecheque").addClass("invisible") } $DetailPaymentList.dialog("open").dialog({ width: 650 }) }, error: function (e) { alert(e.responseText) } }) } function ChequePassed(e, t) { $.ajax({ type: "POST", data: "{id: '" + e + "',counterId: '" + $("#userDefault").find("#ddl_m_Counter").val() + "'}", url: "Management/ChequePassed", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; if (e.isdone) $(t).parents("td").html("پاس شده"); else translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function RemoveItemDetailCash(e) { var t = $("#tr" + e); $.ajax({ type: "POST", url: "Management/DeleteCash", contentType: "application/json; charset=utf-8", data: "{id: '" + e + "'}", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg); if (e.isDone) t.remove() }, error: function (e) { alert(e.responseText) } }) } function RemoveItemDetailCheque(e) { var t = $("#tr" + e); $.ajax({ type: "POST", url: "Management/DeleteCheque", contentType: "application/json; charset=utf-8", data: "{accDetailId: '" + e + "',isRecieved: '" + true + "'}", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg); if (e.isDone) t.remove() }, error: function (e) { alert(e.responseText) } }) } function editItemDetailCheque(e, t, n) { var r = $("#tr" + e); var i = { id: e, date: t, serial: n }; $.ajax({ type: "POST", url: "Management/EditCheque", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function loadVoucherList(e, t) { sortid = "OrderHeaderId desc"; var n = $("#" + e); if (t) { n.find("#moreFilter").slideUp("fast"); n.find(".toggle-more-filters").click(function () { $(this).toggleClass("open"); n.find("#moreFilter").slideToggle(function () { }) }); n.find("#VoucherFromValidationDate").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#VoucherToValidationDate").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); n.find("#VoucherToValidationDate").datepicker({ changeMonth: true, changeYear: true }); n.find("#VoucherRegDateFrom").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#VoucherRegDateTo").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); n.find("#VoucherRegDateTo").datepicker({ changeMonth: true, changeYear: true }); n.find("#VoucherPayDateFrom").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#VoucherPayDateTo").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); n.find("#VoucherPayDateTo").datepicker({ changeMonth: true, changeYear: true }); n.find("#btnSearchVoucher").button({ icons: { primary: "ui-icon-search"} }).unbind("click").click(function () { sortid = "OrderHeaderId desc"; getVoucherList(e, { container: e, callbackmethod: getVoucherList, fname: "", page_index: 0, build: buildVoucherList, servicename: "Management", methodname: "GetVoucherList", print: false }) }); n.find("#PageSize").off().on("change", function () { getVoucherList(e, { container: e, callbackmethod: getVoucherList, fname: "", page_index: 0, build: buildVoucherList, servicename: "Management", methodname: "GetVoucherList", print: false }) }); getVoucherList(e, { container: e, callbackmethod: getVoucherList, fname: "", page_index: 0, build: buildVoucherList, servicename: "Management", methodname: "GetVoucherList", print: false }) } n.find("#voucherDetailsDialog").attr("id", "dialog" + e); n.find("#dialog" + e).dialog({ autoOpen: false }).dialog({ width: 800 }) } function getVoucherList(e, t) { var n = $("#" + e); if (t.page_index > 0) { t.first = false } var r = "", i = "", s = "", o = "", u = "", a = "", f = "", l = "", c = "", h = "", p = "", d = ""; var v = n.find("#SearchBy").val(); if (v != "") { if (v == "registerer") { r = n.find("#voucherTxtSearch").val() } if (v == "customer") { i = n.find("#voucherTxtSearch").val() } if (v == "number") { s = n.find("#voucherTxtSearch").val() } if (v == "payer") { o = n.find("#voucherTxtSearch").val() } } if (n.find("#moreFilter").is(":visible")) { p = n.find("#VoucherAmountFrom").val(); d = n.find("#VoucherAmountTo").val(); c = n.find("#VoucherBuyAmountFrom").val(); h = n.find("#VoucherBuyAmountTo").val(); u = n.find("#VoucherRegDateFrom").val(); a = n.find("#VoucherRegDateTo").val(); f = n.find("#VoucherPayDateFrom").val(); l = n.find("#VoucherPayDateTo").val() } var m = { sort: sortid, customerId: n.find("#hd_d_PersonId").val(), registerer: r, customer: i, number: s, payer: o, FromValidationDate: n.find("#VoucherFromValidationDate").val(), ToValidationDate: n.find("#VoucherToValidationDate").val(), voucherStatus: n.find("#voucherStatus").val(), amountFrom: p, amountTo: d, buyAmountFrom: c, buyAmountTo: h, regDateFrom: u, regDateTo: a, payDateFrom: f, payDateTo: l }; t["DTO"] = m; pageselectCallback(0, t, { container: "", fname: t.fname, pagingContainer: e, first: true, isOrder: false }) } function buildVoucherList(jq, container) { var $con = $("#" + container.pagingContainer); var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "کارمند (صادر کننده)", sort: "ac_OrderHeader1.p_Person.Family", width: "10%" }); lsth.push({ title: "مشتری (واریز کننده)", sort: "ac_OrderHeader1.p_Person1.Family", width: "10%" }); lsth.push({ title: "issueDate", sort: "ac_OrderHeader1.Date", width: "13%" }); lsth.push({ title: "buyPrice", sort: "ac_OrderHeader1.Amount", width: "9%" }); lsth.push({ title: "ارزش کارت", sort: "Amount", footer: jq.sumDebtor, width: "9%" }); lsth.push({ title: "شماره کارت", sort: "Number", footer: jq.sumCreditor, width: "10%" }); lsth.push({ title: "expieryDate", sort: "ExpieryDate", width: "13%" }); lsth.push({ title: "Shop", sort: "ac_OrderHeader1.inv_Shop.Name", width: "10%" }); lsth.push({ title: "status", sort: "IsValid", width: "8%" }); lsth.push({ title: "deleteKey", width: "4%" }); lsth.push({ title: "details", width: "4%" }); var List = typeof jq.results == "string" ? eval("(" + jq.results + ")") : jq.results; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; if (!container.params.print) trBody[0] = { trId: val.OrderHeaderId }; trBody[1] = { name: "employee", html: val.registerer, width: "10%" }; trBody[2] = { name: "customer", html: val.customer, width: "10%" }; trBody[3] = { html: val.Date, props: { name: "date", date: val.Date, width: "13%", klass: "date"} }; trBody[4] = { name: "payAmount", html: val.buyAmount, width: "9%" }; trBody[5] = { name: "amount", html: val.Amount, width: "9%" }; trBody[6] = { name: "number", html: val.Number, width: "10%" }; trBody[7] = { html: val.ExpieryDate, props: { name: "validationDate", date: val.ExpieryDate, width: "13%", klass: "date"} }; trBody[8] = { name: "shop", html: val.shop, width: "10%" }; trBody[9] = { name: "status", html: "<span id='voucherStatus'>" + (val.IsValid == true ? "معتبر" : "نامعتبر") + "</span>&nbsp;&nbsp;&nbsp;<button id='btnConfirm'>تغییر وضعیت</button>", width: "8%" }; lstb.push(trBody) } var details = { deleteFunction: DeleteVoucher, confirmFunction: ChangeVoucherStatus, detailsFunction: VoucherDetails }; table = { header: lsth, body: lstb, details: details, heigth: 300, container: container.pagingContainer, divName: "VoucherList", hasFooter: true }; buildTable(table) } function DeleteVoucher(e, t) { var n = $("#" + t); var r = $("#tr" + e); var i = { voucherNumber: r.find("[name=number]").html() }; $.ajax({ type: "POST", url: "Management/DeleteVoucher", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (e) { if (!isAuthenticated(e)) return; if (e.isdone == false) { alert(e.msg); return } if (e != null && e.isdone == true) r.remove() }, error: function (e) { alert(e.responseText) } }) } function ChangeVoucherStatus(e, t) { var n = $("#" + t); var r = $(e); var i = { voucherNumber: r.parents("tr").find("[name=number]").html() }; $.ajax({ type: "POST", url: "Management/ChangeVoucherStatus", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (e) { if (!isAuthenticated(e)) return; if (e != null && e.isdone == false) { alert(e.msg); return } if (e != null && e.isdone == true) { var t = r.parent(); if (e.status) t.find("#voucherStatus").html("معتبر"); else t.find("#voucherStatus").html("نامعتبر") } }, error: function (e) { alert(e.responseText) } }) } function VoucherDetails(e, t) { var n = $("#" + t); var r = $(e); var i = $("#dialog" + t); $.ajax({ type: "POST", url: "Management/GetVoucherDetails", contentType: "application/json; charset=utf-8", data: "{voucherNumber: '" + r.parents("tr").find("[name=number]").html() + "'}", success: function (e) { if (!isAuthenticated(e)) return; jq = e; if (jq.OrderHeaderId == undefined) { alert("کارت هدیه خرج نشده است."); return } if (jq.msg != undefined && jq.msg == "empty") { i.find("#VoucherDetailList").html(""); i.dialog("close"); return } var t = ""; t += "<tr id='tr" + jq.OrderHeaderId + "'>" + "<td name='customer' width='20%'>" + jq.employer + "</td>" + "<td name='payer' width='20%'>" + jq.payer + "</td>" + "<td name='Date' width='20%'>" + jq.Date + "</td>" + "<td name='shop' width='20%'>" + jq.shop + "</td>" + "<td name='counter' width='20%'>" + jq.counter + "</td>" + "</tr>"; i.find("#VoucherDetailList").html(t).parent().tableScroll({ height: 380, width: 750, flush: false }); i.dialog({ width: 800 }).dialog("open") }, error: function (e) { alert(e.responseText) } }) } function AddVoucher(e, t) { var n = $("#" + t.pagingContainer); var r = { customerId: e, voucherAmount: 1e5, minimumBuy: 200, currencyId: $("#userDefault").find("#ddl_m_Currency").val(), shopId: $("#userDefault").find("#ddl_s_Branch").val(), expieryDate: "1391/10/30" }; $.ajax({ url: "Management/AddVoucher", data: JSON.stringify(r), dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (e) { }, error: function (e) { alert(e.responseText) } }) } function loadCustomerVoucherList(e, t, n) { sortid = "OrderHeaderId desc"; var r = $("#" + t); r.find("#hd_d_PersonId").val(e); if (n) { r.find("#moreFilter").slideUp("fast"); r.find(".toggle-more-filters").click(function () { $(this).toggleClass("open"); r.find("#moreFilter").slideToggle(function () { }) }); r.find("#txtFromValidationDate").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#txtToValidationDate").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); r.find("#txtToValidationDate").datepicker({ changeMonth: true, changeYear: true }); r.find("#VoucherRegDateFrom").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#VoucherRegDateTo").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); r.find("#VoucherRegDateTo").datepicker({ changeMonth: true, changeYear: true }); r.find("#VoucherPayDateFrom").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#VoucherPayDateTo").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); r.find("#VoucherPayDateTo").datepicker({ changeMonth: true, changeYear: true }); r.find("#btnSearchVoucher").button({ icons: { primary: "ui-icon-search"} }).unbind("click").click(function () { sortid = "OrderHeaderId desc"; getVoucherList(t, { container: t, callbackmethod: getVoucherList, fname: "", page_index: 0, build: buildVoucherList, servicename: "Management", methodname: "GetVoucherList", print: false }) }); r.find("#PageSize").off().on("change", function () { getVoucherList(t, { container: t, callbackmethod: getVoucherList, fname: "", page_index: 0, build: buildVoucherList, servicename: "Management", methodname: "GetVoucherList", print: false }) }); getVoucherList(t, { container: t, callbackmethod: getVoucherList, fname: "", page_index: 0, build: buildVoucherList, servicename: "Management", methodname: "GetVoucherList", print: false }); r.find("#SearchBy option[value='customer']").remove() } r.find("#voucherDetailsDialog").attr("id", "dialog" + t); r.find("#dialog" + t).dialog({ autoOpen: false }).dialog({ width: 750 }) } function getCustomerVoucherList(e, t) { var n = $("#" + e); if (n.find("#txt_payer").val() == "" && n.find("#hd_d_PersonId").val() == "") { alert("کد مشتری را انتخاب کنید."); return } if (t.page_index > 0) { t.first = false } var r = { sort: sortid, customerId: n.find("#hd_d_PersonId").val(), customerCode: n.find("#txt_payer").val() }; t["DTO"] = r; pageselectCallback(0, t, { container: "dialog", fname: t.fname, pagingContainer: e, first: true, isOrder: false }) } function VoucherRowClick(e, t) { var n = $("#" + t); n.find("#txtVoucherNumber").val(e.find("[name=number]").html()); GetVoucherItem(true, t) } function GetVoucherItem(e, t) { var n = $("#" + t); var r = $("#" + t); var i = ""; var s = false; var o = { voucherNumber: n.find("#txtVoucherNumber").val() }; $.ajax({ url: "Management/GetVoucherItem", data: JSON.stringify(o), dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; if (e.msg == undefined) { n.find("#divslider2").removeClass("invisible"); n.find("#table_voucher").removeClass("invisible"); buildPayVoucherItem(e, t) } }, error: function (e) { alert(e.responseText) } }) } function buildPayVoucherList(jq, pageoption) { var $con = $("#" + pageoption.container); jq = jq.results; var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "voucherOwner", width: "12%" }); lsth.push({ title: "number", sort: "Number", width: "35%" }); lsth.push({ title: "cost", sort: "Amount", width: "14%" }); lsth.push({ title: "expieryDate", sort: "ExpieryDate", width: "10%" }); lsth.push({ title: "buyAmount", sort: "buyAmount", width: "15%" }); lsth.push({ title: "registerer", width: "14%" }); var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; trBody[0] = { trId: val.OrderHeaderId }; trBody[1] = { name: "customer", html: val.customer, width: "12%" }; trBody[2] = { name: "number", html: val.Number, width: "35%" }; trBody[3] = { name: "Amount", html: val.Amount, width: "14%" }; trBody[4] = { name: "ExpieryDate", html: val.ExpieryDate, width: "10%" }; trBody[5] = { name: "buyAmount", html: val.buyAmount, width: "15%" }; trBody[6] = { name: "registerer", html: val.registerer, width: "14%" }; lstb.push(trBody) } details = { rowClick: pageoption.fname }; table = { header: lsth, body: lstb, details: details, heigth: 300, width: 620, container: pageoption.container + pageoption.pagingContainer, divName: "VoucherList", rowClickParams: { fname: VoucherRowClick} }; buildTable(table) } function buildPayVoucherItem(e, t) { var n = $("#" + t); var r = 0; e = e; n.find("#VoucherItem").find("td[name=voucherNumber]").each(function () { if ($(this).html() == e.Number) r++ }); if (r == 0) { var i = "voucher_" + e.OrderHeaderId; var s = ""; s += "<tr id= '" + i + "'>" + "<td width='12%'>" + e.customer + "</td>" + "<td name='voucherNumber' width='10%'>" + e.Number + "</td>" + "<td name='voucherAmount' width='13%'>" + e.Amount + "</td>" + "<td width='10%'>" + e.ExpieryDate + "</td>" + "<td width='13%'>" + e.buyAmount + "</td>" + "<td width='12%'>" + e.registerer + "</td>" + "<td width='10%'>" + e.Date + "</td>" + "<td width='14%'>" + e.shop + "</td>" + "<td id='delete' width='6%'><button name='btn_Delete' ></button></td></tr>"; "</tr >"; n.find("#VoucherItem").append(s).parent().tableScroll({ height: 380, width: n.width() - 85, flush: false }); tableStyle(); SumPayment(t); n.find("[name=btn_Delete]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).unbind().click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) RemoveItemVoucherElement($(this).parents("tr").attr("id"), t); else return }) } } function RemoveItemVoucherElement(e, t) { var n = $("#" + t); n.find("#" + e).remove(); SumPayment(t) } function loadSellVoucher(e, t) { var n = $("#" + e); if ($("#txt_customer").val() != "") n.find("#txt_payer").val($("#txt_customer").val()); n.find("#btn_newVoucher").button({ icons: { primary: "ui-icon-plus" }, text: true }).click(function () { BuildVoucherItem(e) }); n.find("#btn_Add_Voucher").button({ icons: { primary: "ui-icon-disk" }, text: true }).click(function () { if (validateAll(n)) AddSellVoucher(n.find("#txt_payer").val(), e) }); aComplete({ methodname: "GetCompletionListByCustomerName", servicename: "Management", id: "txt_payer", container: e, minlength: 2, autofocus: false, limit: 20, boxId: "txt_payer", fname: customerOnSelect }); n.find("#txt_PaymentAmount").dblclick(function () { n.find("#txt_PaymentAmount").val(n.find("#txt_TotalAmount").val()) }) } function BuildVoucherItem(e) { var t = $("#" + e); t.find("#table_voucher").removeClass("invisible"); var n = ""; n += "<tr name='sellVoucher'>" + "<td width='45%'><input type='text' class=' inputText inputW136 required validate' name='Digit' id='txt_amount' onchange='return SumVoucherAmount(\"" + e + "\");'/></td>" + "<td width='45%'><input type='text' class=' inputText inputW136 required validate' name='Date' id='txt_date'/></td>" + "<td width='10%'><button id='btn_delete'>حذف</button></td>" + "</tr>"; t.find("#table_voucher").append(n).parent().tableScroll({ height: 380, width: 600, flush: false }); SumVoucherAmount(e); t.find("[id=btn_delete]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).click(function () { $(this).parents("tr").remove(); SumVoucherAmount(e) }) } function SumVoucherAmount(e) { var t = $("#" + e); var n = 0; t.find("tr[name=sellVoucher]").each(function () { n += $(this).find("#txt_amount").val() * 1 }); t.find("#txt_TotalAmount").val(n) } function AddSellVoucher(e, t) { var n = $("#" + t); var r = []; n.find("tr[name=sellVoucher]").each(function () { var e = {}; e["ExpieryDate"] = $(this).find("#txt_date").val(); e["Amount"] = $(this).find("#txt_amount").val(); r.push(e) }); var i = { customerCode: e, currencyId: $("#userDefault").find("#ddl_m_Currency").val(), shopId: $("#userDefault").find("#ddl_s_Branch").val(), vouchers: r, counterId: $("#userDefault").find("#ddl_m_Counter").val(), amount: n.find("#txt_TotalAmount").val(), payAmount: n.find("#txt_PaymentAmount").val(), description: n.find("#txt_description").val() }; $.ajax({ url: "Management/AddSellVoucher", data: JSON.stringify(i), dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function loadOrder(e, t, n, r, i, s, o) { var u = $("#" + t); sortid = "BarcodeId Desc"; u.find("#div_OrderDate").addClass("hidden"); u.find("#div_payamount").removeClass("hidden"); if (s) { u.find("#moreFilter").slideUp("fast"); u.find(".toggle-more-filters").click(function () { $(this).toggleClass("open"); u.find("#moreFilter").removeClass("invisible"); u.find("#moreFilter").slideToggle(function () { }) }); if ($("#txt_customer").val() != "" && t == "dialogAddAccounting") { u.find("#txt_s_Person").val($("#txt_customer").val()); u.find("#customerOnSelect").html($("#customerOnSelect").html()) } u.find("#Div_Print").load("Report/PrintInvoice.htm", function () { }); $("#dialog" + t).remove(); u.find("#dialog").attr("id", "dialog" + t); bindItemsForSelectCombo({ methodname: "getAvailablity", servicename: "Management", id: "ddl_m_Availability", container: t, headertext: "وضعیت کالا", selectedindex: 1 }); u.find("#txt_s_ProductCode,#txt_s_ProductBarcode").bind("keydown", function (e) { if (e.keyCode == 13 || e.keyCode == 9) { getBarcodeListOrder(t, { container: "dialog", callbackmethod: getBarcodeListOrder, fname: n, page_index: 0, build: buildBarcodeListOrder, servicename: "Management", methodname: "GetItemsList" }) } }); if (o != undefined && o.isChangeQuantity != undefined && o.isChangeQuantity == true) { u.append("<input type='checkbox' id='cbIsChangeQuantity' class='hidden' checked />") } u.find("#txt_m_PaymentAmount").dblclick(function () { u.find("#txt_m_PaymentAmount").val(u.find("#txt_m_TotalPrice").val()) }); if (r) { u.find("#simpleOrder").remove() } else { u.find("#wholesaleOrder").remove() } ChangeCheckBoxName("cb_d_PreOrder", t); ChangeCheckBoxName("cb_d_Sale", t); if (i) { u.find("#cb_d_Sale" + t).unbind("change").change(function () { if (this.checked) $(this).button("option", "label", "فروش"); else $(this).button("option", "label", "مرجوعی") }) } else { u.find("#cb_d_Sale" + t).prop("checked", "checked").trigger("change").unbind("change").change(function () { if (this.checked) $(this).button("option", "label", "مرجوعی"); else $(this).button("option", "label", "خرید") }) } u.find("#cb_d_PreOrder" + t).unbind("change").change(function () { if (this.checked) $(this).button("option", "label", "فاکتور"); else $(this).button("option", "label", "پیش فاکتور") }); u.find("#dialog_ItemQuantity").dialog({ autoOpen: false }); bindHierarchyData({ id: "hr_s_Category", table: "category", container: t }); u.find("#btn_SearchProduct").button({ icons: { primary: "ui-icon-search"} }).unbind().bind("click", function () { sortid = "BarcodeId Desc"; getBarcodeListOrder(t, { container: "dialog", callbackmethod: getBarcodeListOrder, fname: n, page_index: 0, build: buildBarcodeListOrder, servicename: "Management", methodname: "GetItemsList" }) }).button(); u.find("#btn_AddOrder").off().on("click", function () { if (validateAll(u)) { if (!u.find("#hi_orderHeaderId").val()) { if (r) { AddOrderWholesale(e, t) } else { AddOrder(e, t) } } else { EditOrder(e, t) } } }).button({ icons: { primary: "ui-icon-disk" }, text: true }); u.find("#btn_Print").off().on("click", function () { Popup(u.find("#Div_Print").html()) }).button().addClass("invisible"); aComplete({ methodname: "GetCompletionListByItemName", servicename: "Management", id: "txt_s_ProductCode", container: t, minlength: 2, autofocus: false, limit: 10, boxId: "txt_s_ProductCode" }, { Status: "ddl_m_Availability" }); if (o != undefined && o.isfastorder == true) { if (o != undefined && o.isChangeQuantity != undefined && o.isChangeQuantity == true) { aComplete({ methodname: "GetCompletionListBySupplierName", servicename: "Management", id: "txt_s_Person", container: t, minlength: 2, autofocus: false, limit: 20, boxId: "txt_s_Person", fname: customerOnSelect }) } else aComplete({ methodname: "GetCompletionListByCustomerName", servicename: "Management", id: "txt_s_Person", container: t, minlength: 2, autofocus: false, limit: 20, boxId: "txt_s_Person", fname: customerOnSelect }) } } } function customerOnSelect(e, t, n) { var r = $("#" + n); r.find("#customerOnSelect").html(t.item.label).addClass("ui-state-highlight"); r.find("#hd_s_Person").val(t.item.id) } function getDataPrint(e, t) { var n = $("#" + t); var r = { id: e }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(r), type: "Post", url: "Management/GetInvoiceById", success: function (e) { if (!isAuthenticated(e)) return; if (e.isdone) { SetInvoiceData(t, e); Popup(n.find("#Div_PrintFactor").html()) } else alert("noData") }, error: function (e) { alert(e.responseText) } }) } function SetInvoiceData(container, response) { var $con = $("#" + container); var List = typeof response == "string" ? eval("(" + response + ")") : response; var ItemList = ""; for (var i = 0; i < List.detail.length; i++) { var val = List.detail[i]; ItemList += "<tr><td align='Center'>" + (i * 1 + 1) + "</td>" + "<td align='Right'  nowrap='nowrap'><h6>" + val.Name + "</h6></td>" + "<td align='Center' nowrap='nowrap'><h6>" + val.Quantity + "</h6></td>" + "<td align='Center' nowrap='nowrap'>" + val.Price + "</td>" + "<td align='Center' nowrap='nowrap'>" + val.Price * val.Quantity + "</td></tr>" } $con.find("#LShop").html(List.ShopName); if (List.PreOrder) $con.find("#LInvoice").html("پیش فاکتور"); else $con.find("#LInvoice").html(List.Sell ? " فاکتور فروش " : " فاکتور مرجوعی "); $con.find("#LInvoiceNo").html(List.InvoiceNO); $con.find("#LClinet").html((List.Gender ? "آقای " : "خانم ") + " " + List.Family); $con.find("#LCustomer").html((List.ClientGender ? "آقای " : "خانم ") + " " + List.ClientFamily); $con.find("#LDate").html(List.Date); $con.find("#LAmount").html(List.Amount); $con.find("#LCurrency").html(List.Currency); $con.find("#DetailInvoiceList").html(ItemList) } function Popup(e) { var t = window.open("", "Div_Print"); t.document.write("<html><head><title>my div</title>"); t.document.write('<link rel="stylesheet" href="Content/Default/StylePrint.css" type="text/css" />'); t.document.write("</head><body dir='rtl'>"); t.document.write(e); t.document.write("</body></html>"); t.document.close(); t.print(); return true } function loadSupplierOrder(e, t, n) { loadOrder(e, t, GetItemOrder, false, false, n) } function loadCustomerOrder(e, t, n) { loadOrder(e, t, GetItemOrder, false, true, n) } function loadCustomerFastOrder(e, t) { loadOrder(0, e, GetItemOrder, false, true, t, { isfastorder: true }) } function loadEditQuantityOrder(e, t) { var n = $("#" + e); if (t) { n.find("[name='changeQuantity']").remove(); n.find("[name='setPayment']").removeClass("invisible"); n.find("#spClient").html("supplier"); n.find("#txt_s_Person").attr("placeholder", "supplier"); n.find("#cbSetPayment").unbind("change").change(function () { if (this.checked) $(this).button("option", "label", "setPayment"); else $(this).button("option", "label", "noPayment"); localize() }).button(); loadOrder(0, e, GetItemOrder, false, true, t, { isfastorder: true, isChangeQuantity: true }) } } function AddOrder(e, t) { var n = $("#" + t); var r = []; var i = {}; $.each($("#" + t).find("#OrderList").find("tr[id*=tr]"), function () { var e = {}; var t = $(this); var i = t.find("#ddl_m_Color_" + this.id).val(); var s = t.find("#ddl_m_Size_" + this.id).val(); e["barcodeid"] = this.id.split("_")[2]; e["colorid"] = i == null ? "" : i; e["sizeid"] = s == null ? "" : s; e["quantity"] = t.find("#txt_m_TotalQuantity").val(); e["price"] = t.find("#txt_m_Price").val(); e["description"] = ""; e["serial"] = t.find("#txt_m_Serial").val(); e["broken"] = false; if (n.find("#cbIsChangeQuantity").prop("checked")) { e["status"] = t.find("#ddl_m_Availability").val(); e["broken"] = t.find("#cb_d_Broken_" + this.id).prop("checked") } r.push(e) }); i["shopid"] = $("#userDefault").find("#ddl_s_Branch").val(); i["date"] = $("#userDefault").find("#txt_s_Date").val(); i["currenyid"] = $("#userDefault").find("#ddl_m_Currency").val(); if (n.find("#cbIsChangeQuantity").length < 1) { i["totalamount"] = n.find("#txt_m_TotalPrice").val().replace(/,/g, ""); i["PaymentAmount"] = n.find("#txt_m_PaymentAmount").val().replace(/,/g, "") } else { i["setPayment"] = n.find("#cbSetPayment").prop("checked") } i["description"] = n.find("#txt_m_Description").val(); i["invoicenumber"] = n.find("#txt_m_InvoiceNumber").val(); i["clientCode"] = n.find("#txt_s_Person").val(); if (n.find("#hd_s_Person").val() != undefined) e = n.find("#hd_s_Person").val(); i["customerid"] = e; i["issell"] = !n.find("#cb_d_Sale" + t).prop("checked"); i["ispreorder"] = n.find("#cb_d_PreOrder" + t).prop("checked"); var s = { header: i, itemDetails: r, counterId: $("#userDefault").find("#ddl_m_Counter").val(), vat: n.find("#txt_vat").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(s), type: "Post", url: n.find("#cbIsChangeQuantity").length > 0 ? "Management/ChangeQuantity" : "Management/AddOrder", success: function (e) { if (!isAuthenticated(e)) return; if (e.alert != undefined) { SetInvoiceData(t, e); translate(e.alert); if (e.InvoiceNO != undefined) { n.find("#OrderList").html(""); n.find("#btn_Print").removeClass("invisible"); n.find("#btn_AddOrder").addClass("invisible"); n.find("#txt_m_InvoiceNumber").val(e.InvoiceNO) } } else translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function GetItemOrder($dis, container, barcode, isChangeQuantity) { if (barcode == undefined) { var b = $dis.closest("tr").attr("id"); barcode = b.substring(2, b.length) } var $con = $("#" + container); var ItemList = ""; var isReturn = false; if ($con.find("#cb_d_Sale" + container).prop("checked") != undefined) isReturn = $con.find("#cb_d_Sale" + container).prop("checked"); var isChangeQuantity = false; if ($con.find("#cbIsChangeQuantity").prop("checked") != undefined) { isChangeQuantity = $con.find("#cbIsChangeQuantity").prop("checked"); isReturn = true } var DTO = { barcode: barcode, shopId: $("#userDefault").find("#ddl_s_Branch").val(), isReturn: isReturn }; $.ajax({ type: "POST", data: JSON.stringify(DTO), url: "Management/GetProductForOrderByBarcode", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; $con.find("#txt_s_ProductBarcode").val(""); if (response.length < 1) return; if ($con.find("#OrderList").html() == "") { $con.find("#txt_m_InvoiceNumber").val(""); $con.find("#txt_m_PaymentAmount").val("") } var count = $con.find("tr[id*='tr_" + container + "']").length; var List = typeof response == "string" ? eval("(" + response + ")") : response; var ItemList = ""; var val = List[0, 0]; var trid = "tr_" + container + "_" + val.barcodeid + "_" + count; var priceType = ""; obj = val.price; for (var name in obj) { var value = obj[name]; var p = 0; if (value == null) p = val.price.basePrice; else p = value; priceType += "<option value='" + p + "'>" + p + " " + name + "</option>" } ItemList += "<tr id='" + trid + "'>" + "<td width='3%' id='rownumber'></td>" + "<td width='20%'><a href='javascript:showQuantity(\"" + container + '","' + val.barcode + "\");'>" + val.name + " " + val.code + " " + val.barcode + "</a></td>" + "<td width='6%' id='Color_'>" + " <select   id='ddl_m_Color_" + trid + "' disabled='disabled' class='select55 ' ></select>" + "</td>" + "<td width='6%' id='Color_'>" + "<select   id='ddl_m_Size_" + trid + "' disabled='disabled' class='select55 '></select>" + "</td>" + "<td width='6%' id='Color_'>" + " <select   id='ddl_m_measureunit_" + trid + "' disabled='disabled' class='select55 '></select>" + "</td>" + "<td width='10%' id='Color_'> <select   id='ddl_m_priceType_" + trid + "'  class='select95'>" + priceType + "</select></td>" + "<td width='7%'><input type='text'  id='txt_m_Quantity' VALUE='1' class='inputW34 fontSize15'  /></td>" + "<td width='11.5%'><input type='text'  id='txt_m_Price' class='inputW80 fontSize15' value='" + val.price.basePrice + "' /></td>" + "<td width='7%'><input type='text' id='txt_m_TotalQuantity' class='inputW50 fontSize15'   disabled='disabled'/></td>" + "<td width='9%'><input  class='inputW80 fontSize15 digit' type='text' id='txt_m_TotalItemPrice' disabled='disabled'/></td>" + "<td width='11%' id='Color_'>" + (isChangeQuantity ? "<select class=' selectsmall1 ' id='ddl_m_Availability'></select>" : " <input class='inputW100 fontSize15' type='text' id='txt_m_Serial' />") + "</td>" + "<td width='2.5%' id='delete'><span title='حذف' name='deleteOrder' class='cursor ui-icon ui-icon-closethick'></span></td></tr>"; $con.find("#OrderList").append(ItemList).parent().tableScroll({ height: 380, width: $con.width() - 85, flush: false }); $con.find("#btn_AddOrder").removeClass("invisible"); if (isChangeQuantity) { $con.find("#tdSerial").html("itemStatus"); bindItemsForSelectCombo({ methodname: "getAvailablity", servicename: "Management", id: "ddl_m_Availability", container: trid, headertext: "وضعیت کالا", selectedindex: val.status }); $con.find("#cb_d_Broken_" + trid).button().prop("checked", "checked").trigger("change").unbind("change").change(function () { if (this.checked) { $(this).button("option", "label", "سالم") } else { $(this).button("option", "label", "خراب") } }) } $con.find("[name=deleteOrder]").unbind().click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) RemoveItemOrderElement($(this).parents("tr").first().prop("id"), container); else return }); $("#" + trid).find("[id=txt_m_Quantity]").spinner({ change: function () { SumPrice($(this).parents("tr").attr("id"), container) }, stop: function () { SumPrice($(this).parents("tr").attr("id"), container) } }); $("#" + trid).find("[id=txt_m_Price]").spinner({ step: 1e3, change: function () { SumPrice($(this).parents("tr").attr("id"), container) }, stop: function () { SumPrice($(this).parents("tr").attr("id"), container) } }); $con.find("#Footer").removeClass("invisible"); $("#" + trid).find("#txt_m_Price").unbind("keydown").bind("keydown", function (e) { if (e.keyCode == 40) { $(this).parent().parent().next().find("#txt_m_Price").focus().focus(function () { this.select() }) } if (e.keyCode == 38) { $(this).parent().parent().prev().find("#txt_m_Price").focus().focus(function () { this.select() }) } }); $("#" + trid).find("#txt_m_Quantity").unbind("keydown").bind("keydown", function (e) { if (e.keyCode == 40) { $("#" + trid).next().find("#txt_m_Quantity").focus().focus(function () { this.select() }) } if (e.keyCode == 38) { $("#" + trid).prev().find("#txt_m_Quantity").focus().focus(function () { this.select() }) } }); bindComboData({ id: "ddl_m_measureunit_" + trid, container: trid, isMeasureUnit: true }, val.measureUnits); $("#ddl_m_measureunit_" + trid).change(function () { SumPrice(trid, container) }); bindComboData({ id: "ddl_m_Color_" + trid, container: trid, headertext: " رنگ", setcolor: true }, val.colors); $("#ddl_m_Color_" + trid).change(function () { SelectColorForOrder(trid, this, val.barcodeid, isReturn) }); $("#ddl_m_priceType_" + trid).change(function () { $("#" + trid).find("#txt_m_Price").val($(this).val()); SumPrice(trid, container) }); ajDropDown.done(function () { if ($con.find("#ddl_m_Color_" + trid + " option").length < 1) bindItemsForSelectCombo({ methodname: "GetSizeListByBarcodeIdColorId", servicename: "Management", id: "ddl_m_Size_" + trid, container: trid, headertext: " جزئیات" }, { arg: trid.split("_")[2], sarg: $("#userDefault").find("#ddl_s_Branch").val(), targ: "", isReturn: isReturn }) }); SumPrice(trid, container) }, error: function (e) { alert(e.responseText) } }) } function SelectColorForOrder(e, t, n, r) { var i = $("#" + e); bindItemsForSelectCombo({ methodname: "GetSizeListByBarcodeIdColorId", servicename: "Management", id: "ddl_m_Size_" + e, container: e, headertext: " جزئیات" }, { arg: n, sarg: $("#userDefault").find("#ddl_s_Branch").val(), targ: $(t).val(), isReturn: r }) } function showQuantity(e, t) { buildColorSizeTable(t, $("#userDefault").find("#ddl_s_Branch").val(), true, "GetItemDetailsByBarcodeAndShopID", "dialog_ItemQuantity"); $("#dialog_ItemQuantity").dialog().dialog("open") } function RemoveItemOrderElement(e, t, n) { $("#" + e).remove(); SumPrice(e, t, n) } function SumPrice(e, t, n) { $("#" + e).find("input[id=txt_m_TotalQuantity]").val($("#" + e).find("input[id=txt_m_Quantity]").val() * ($("#" + e).find("[id*=ddl_m_measureunit]").val() != null ? $("#" + e).find("[id*=ddl_m_measureunit]").val().split("_")[0] : 1)); var r = $("#" + e).find("input[id=txt_m_TotalQuantity]").val() * $("#" + e).find("input[id=txt_m_Price]").val(); $("#" + e).find("input[id=txt_m_TotalItemPrice]").val(r); $("#" + e).find("input[id=txt_m_TotalItemPrice]").attr("price", r); var i = 0; var s = 0; $.each($("#" + t).find("tr[id*=tr]"), function () { i += $(this).find("input[id=txt_m_TotalItemPrice]").attr("price") * 1; s++; $(this).find("[id=rownumber]").html(s) }); if (n == undefined) n = false; if (s <= 0 && !n) { $("#" + t).find("#Footer").addClass("invisible"); $("#" + t).find("#header").addClass("invisible") } else { $("#" + t).find("#Footer").removeClass("invisible"); $("#" + t).find("#header").removeClass("invisible") } $("#" + t).find("input[id=txt_m_TotalPrice]").val(i); if (!$.browser.msie) { $(".digit").digits() } } function loadAcountReport(e, t) { sortid = "Date desc"; var n = $("#" + e); if (t) { n.find("#moreFilter").slideUp("fast"); n.find(".toggle-more-filters").click(function () { $(this).toggleClass("open"); n.find("#moreFilter").slideToggle(function () { }) }); bindItemsForSelectCombo({ methodname: "GetComboItems", servicename: "XmlDropDown", headertext: "انتخاب بانک", id: "ddlBank", container: e }, { path: "Counter/BankTitle" }); ChangeCheckBoxGroupName("Check", e); n.find("#txtInvoiceDateStart" + e).datepicker({ changeMonth: true, changeYear: true, onSelect: function (t, n) { $("#txtInvoiceDateEnd" + e).datepicker("option", "minDate", new JalaliDate(n["selectedYear"], n["selectedMonth"], n["selectedDay"])) } }); n.find("#txtInvoiceDateEnd" + e).datepicker({ changeMonth: true, changeYear: true }); n.find("#btnPrint").off().on("click", function () { getAcountList(e, { container: e, callbackmethod: getAcountList, fname: "", page_index: 0, build: buildAcountList, servicename: "Management", methodname: "GetInvoiceStatement", print: true }) }).button({ icons: { primary: "ui-icon-print" }, text: true }); n.find("#txtDueDateFrom").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#txtDueDateTo").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); n.find("#txtDueDateTo").datepicker({ changeMonth: true, changeYear: true }); bindHierarchyData({ id: "hr_s_Category", table: "category", container: e }); n.find("[id=btnSearch]").button({ icons: { primary: "ui-icon-search"} }).unbind("click").click(function () { sortid = "date desc"; getAcountList(e, { container: e, callbackmethod: getAcountList, fname: "", page_index: 0, build: buildAcountList, servicename: "Management", methodname: "GetInvoiceStatement", print: false }) }) } getAcountList(e, { container: e, callbackmethod: getAcountList, fname: "", page_index: 0, build: buildAcountList, servicename: "Management", methodname: "GetInvoiceStatement", print: false }); n.find("#PageSize").off().on("change", function () { getAcountList(e, { container: e, callbackmethod: getAcountList, fname: "", page_index: 0, build: buildAcountList, servicename: "Management", methodname: "GetInvoiceStatement", print: false }) }); n.find("#DetailPaymentList").dialog({ autoOpen: false }).dialog({ width: 750 }); n.find("#dialog").attr("id", "dialog" + e) } function AccountFullAcc(e, t, n) { sortid = "date desc"; var r = $("#" + e); if (t) { r.find("#txtInvoiceDateStart").attr("id", "txtInvoiceDateStart" + e); r.find("#txtInvoiceDateEnd").attr("id", "txtInvoiceDateEnd" + e); r.find("[id=btnSearch]").button({ icons: { primary: "ui-icon-search"} }).unbind("click").click(function () { sortid = "date desc"; getFullAcountList(e, { container: e, callbackmethod: getFullAcountList, fname: "", page_index: 0, build: buildFullAcountList, servicename: "Management", methodname: "GetFullOrderStatement", print: n.print, selectCase: n.selectCase }) }); if (n.onLoad) { sortid = "date desc"; getFullAcountList(e, { container: e, callbackmethod: getFullAcountList, fname: "", page_index: 0, build: buildFullAcountList, servicename: "Management", methodname: "GetFullOrderStatement", print: n.print, selectCase: n.selectCase }) } bindHierarchyData({ id: "hr_s_Category", table: "category", container: e, styleclass: "PagingSelect " }); r.find("#moreFilter").slideUp("fast"); r.find(".toggle-more-filters").click(function () { $(this).toggleClass("open"); r.find("#moreFilter").slideToggle(function () { }) }); r.find(".icon_clear").unbind("click").click(function () { r.find("#customerOnSelect").html("") }); ChangeCheckBoxGroupName("Check", e); r.find("#txtInvoiceDateStart" + e).datepicker({ changeMonth: true, changeYear: true, onSelect: function (t, n) { $("#txtInvoiceDateEnd" + e).datepicker("option", "minDate", new JalaliDate(n["selectedYear"], n["selectedMonth"], n["selectedDay"])) } }); r.find("#btnPrint").off().on("click", function () { PrintAccountingDetails(e, "daybookClientPrint") }).button({ icons: { primary: "ui-icon-print" }, text: true }); r.find("#txtInvoiceDateEnd" + e).datepicker({ changeMonth: true, changeYear: true }); r.find("#DetailPaymentList" + e).dialog({ autoOpen: false }).dialog({ width: 750 }); r.find("#DetailPaymentList").attr("id", "DetailPaymentList" + e); r.find("#transferMoney").attr("id", "transferMoney" + e); r.find("#dialog").attr("id", "dialog" + e); r.find("#voucherDetailsList").attr("id", "voucherDetailsList" + e); r.find("#voucherDetailsList" + e).dialog({ autoOpen: false }).dialog({ width: 750 }); r.find("#DialogEditVoucherAmount").attr("id", "editvoucher" + e); r.find("#expense").attr("id", "expense" + e); r.find("#DialogEditAccount").attr("id", "editOrder" + e); r.find("#dialogAddExpense").attr("id", "editExpense" + e); r.find("#dialogAddSalary").attr("id", "editSalary" + e); r.find("#dialogAddSocial").attr("id", "editSocial" + e); r.find("#dialogAdd").attr("id", "dialogAdd" + e) } } function loadAccounting(e, t) { var n = $("#" + e); if (t) { bindItemsForSelectCombo({ async: false, methodname: "getAccountType", servicename: "Management", id: "ddl_AccountType", container: e, headertext: "انتخاب کارمند" }) } AccountFullAcc(e, t, { print: false, selectCase: "Accounting" }) } function loadFullAcountReport(e, t) { AccountFullAcc(e, t, { print: false, selectCase: "GetItemList" }); if (t) { aComplete({ methodname: "GetCompletionListByCustomerName", servicename: "Management", id: "txt_customer", container: e, minlength: 2, autofocus: false, limit: 20, boxId: "txt_customer", fname: customerOnSelect }) } } function getAcountList(e, t) { var n = $("#" + e); if (t.page_index > 0) { t.first = false } var r = "", i = "", s = "", o = "", u = "", a = "", f = "", l = "", c = "", h = "", p = "", d = "", v = "", m = "", g = "", y = "", b = "", w = "", E = "", S = "", x = ""; T = n.find("#ddlSearchBy2").val(); if (T != "") { if (T == "InvoiceId") { a = n.find("#txtSearch2").val() } if (T == "ProductId") { f = n.find("#txtSearch2").val() } if (T == "ProductName") { l = n.find("#txtSearch2").val() } if (T == "Barcode") { c = n.find("#txtSearch2").val() } } if (n.find("#Checkbox1" + e).prop("checked") && n.find("#Checkbox2" + e).prop("checked")) m = ""; else if (!n.find("#Checkbox1" + e).prop("checked") && n.find("#Checkbox2" + e).prop("checked")) m = false; else if (n.find("#Checkbox1" + e).prop("checked") && !n.find("#Checkbox2" + e).prop("checked")) m = true; if (n.find("#Checkbox3" + e).length > 0) g = n.find("#Checkbox3" + e).prop("checked"); if (n.find("#Checkbox4" + e).length > 0) y = n.find("#Checkbox4" + e).prop("checked"); var T = n.find("#ddlSearchBy1").val(); if (n.find("#moreFilter").is(":visible")) { alert("here"); d = getHierarchySelectedValue("hr_s_Category", e); if (T != "") { if (T == "Code") { i = n.find("#txtSearch1").val() } if (T == "Name") { r = n.find("#txtSearch1").val() } if (T == "EmployeeId") { s = n.find("#txtSearch1").val() } if (T == "EmployeeName") { o = n.find("#txtSearch1").val() } } E = n.find("#ddlBank").val(); v = n.find("#txtSerial").val(); b = n.find("#txtInvoiceDateStart" + e).val(); w = n.find("#txtInvoiceDateEnd" + e).val(); S = n.find("#txtDueDateFrom").val(); x = n.find("#txtDueDateTo").val(); h = n.find("#txt_s_PriceFrom").val(); p = n.find("#txt_s_PriceTo").val() } var N = { sort: sortid, supplierid: n.find("#hd_d_PersonId").val(), IsClient: n.find("#hd_d_IsClient").val(), SupplierName: r, code: i, EmployeeId: s, EmployeeName: o, Shop: u, InvoiceId: a, ProductId: f, ProductName: l, Barcode: c, InvoiceDateStart: b, InvoiceDateEnd: w, PriceFrom: h, PriceTo: p, Order: m, PreOrder: g, Broken: y, CategoryId: d, shopid: $("#userDefault").find("#ddl_s_Branch").val(), counterId: $("#userDefault").find("#ddl_m_Counter").val(), BankName: E, Serial: v, dueDateFrom: S, dueDateTo: x, pay: n.find("#Checkbox5" + e).length > 0 ? n.find("#Checkbox5" + e).prop("checked") : "", receive: n.find("#Checkbox6" + e).length > 0 ? n.find("#Checkbox6" + e).prop("checked") : "", cash: n.find("#Checkbox7" + e).length > 0 ? n.find("#Checkbox7" + e).prop("checked") : "", cheque: n.find("#Checkbox8" + e).length > 0 ? n.find("#Checkbox8" + e).prop("checked") : "", voucher: n.find("#Checkbox9" + e).length > 0 ? n.find("#Checkbox9" + e).prop("checked") : "", passed: n.find("#Checkbox10" + e).length > 0 ? n.find("#Checkbox10" + e).prop("checked") : "", notpass: n.find("#Checkbox11" + e).length > 0 ? n.find("#Checkbox11" + e).prop("checked") : "" }; t["DTO"] = N; pageselectCallback(0, t, { container: "", fname: t.fname, pagingContainer: e, first: true, isOrder: true }) } function getFullAcountList(e, t) { var n = $("#" + e); if (t.page_index > 0) t.first = false; var r = "", i = "", s = "", o = "", u = "", a = "", f = "", l = "", c = "", h = "", p = "", d = "", v = "", m = "", g = "", y = "", b = "", w = "", E = ""; s = n.find("#txt_customer").length > 0 ? n.find("#txt_customer").val() : ""; search = n.find("#ddlSearchBy2").val(); if (search != "") { if (search == "EmployeeCode") { o = n.find("#txtSearch2").val() } if (search == "EmployeeName") { u = n.find("#txtSearch2").val() } if (search == "confirmerCode") { h = n.find("#txtSearch2").val() } if (search == "confirmerName") { p = n.find("#txtSearch2").val() } if (search == "InvoiceNumber") { f = n.find("#txtSearch2").val() } } g = n.find("#txtInvoiceDateStart" + e).val(); y = n.find("#txtInvoiceDateEnd" + e).val(); if (n.find("#moreFilter").is(":visible")) { l = n.find("#txt_s_PriceFrom").val(); c = n.find("#txt_s_PriceTo").val(); b = n.find("#selectStatus").val(); w = n.find("#selectAmountStatus").val(); E = n.find("#ddl_AccountType").length > 0 ? n.find("#ddl_AccountType").val() : ""; d = getHierarchySelectedValue("hr_s_Category", e); v = n.find("#txt_s_ProductCode").val() } var S = { sort: sortid, supplierid: n.find("#hd_d_PersonId").val(), IsClient: n.find("#hd_d_IsClient").val(), SupplierName: r, code: s, customerName: i, EmployeeId: o, EmployeeName: u, Shop: a, InvoiceId: f, InvoiceDateStart: g, InvoiceDateEnd: y, PriceFrom: l, PriceTo: c, Order: n.find("#Checkbox7" + e).length > 0 ? n.find("#Checkbox7" + e).prop("checked") : "", shopid: $("#userDefault").find("#ddl_s_Branch").val(), counterId: $("#userDefault").find("#ddl_m_Counter").val(), sell: n.find("#Checkbox1" + e).length > 0 ? n.find("#Checkbox1" + e).prop("checked") : "", buy: n.find("#Checkbox2" + e).length > 0 ? n.find("#Checkbox2" + e).prop("checked") : "", voucher: n.find("#Checkbox5" + e).length > 0 ? n.find("#Checkbox5" + e).prop("checked") : "", payment: n.find("#Checkbox3" + e).length > 0 ? n.find("#Checkbox3" + e).prop("checked") : "", transfer: n.find("#Checkbox4" + e).length > 0 ? n.find("#Checkbox4" + e).prop("checked") : "", notTransfer: n.find("#Checkbox12" + e).length > 0 ? n.find("#Checkbox12" + e).prop("checked") : "", expense: n.find("#Checkbox6" + e).length > 0 ? n.find("#Checkbox6" + e).prop("checked") : "", passed: n.find("#Checkbox10" + e).length > 0 ? n.find("#Checkbox10" + e).prop("checked") : "", notPassed: n.find("#Checkbox11" + e).length > 0 ? n.find("#Checkbox11" + e).prop("checked") : "", confirmed: n.find("#Checkbox8" + e).length > 0 ? n.find("#Checkbox8" + e).prop("checked") : "", notConfirmed: n.find("#Checkbox9" + e).length > 0 ? n.find("#Checkbox9" + e).prop("checked") : "", isDebtor: w, categoryId: d, barcode: v, accountType: E }; t["DTO"] = S; pageselectCallback(0, t, { container: "", fname: t.fname, pagingContainer: e, first: true, isOrder: true }) } function buildAcountList(jq, container) { var $con = $("#" + container.pagingContainer); var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "employee", sort: "p_person.Family", width: "10%" }); lsth.push({ title: "customer", sort: "p_person1.Family", width: "10%" }); lsth.push({ title: "date", sort: "Date", width: "10%" }); lsth.push({ title: "accountDescription", width: "10%" }); lsth.push({ title: "debtor", sort: "Amount", footer: jq.sumDebtor, width: "10%" }); lsth.push({ title: "creditor", sort: "Amount", footer: jq.sumCreditor, width: "10%" }); lsth.push({ title: "balanceAmount", footer: jq.sumDebtor * 1 - jq.sumCreditor * 1, width: "10%" }); lsth.push({ title: "store", sort: "inv_Shop.Name", width: "10%" }); lsth.push({ title: "counter", sort: "counterid", width: "10%" }); if (!container.params.print) lsth.push({ title: "details", width: "10%" }); var List = typeof jq.results == "string" ? eval("(" + jq.results + ")") : jq.results; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; if (!container.params.print) trBody[0] = { trId: val.id }; trBody[1] = { name: "employee", html: val.employee, width: "10%" }; trBody[2] = { name: "customer", html: val.client, width: "10%" }; trBody[3] = { name: "date", html: val.date, width: "10%" }; trBody[4] = { name: "description", html: val.inOrderOf, width: "10%" }; trBody[5] = { name: "Debtor", html: val.isSell == true ? val.amount : "", width: "10%" }; trBody[6] = { name: "Creditor", html: val.isSell == true ? "" : val.amount, width: "10%" }; trBody[7] = { name: "balance", html: val.balance, width: "10%" }; trBody[8] = { name: "shop", html: val.shopName, width: "10%" }; trBody[9] = { name: "counter", html: val.counterCode, width: "10%" }; lstb.push(trBody) } if (container.params.print) { table = { header: lsth, body: lstb, details: { detailsFunction: AcountDetails }, heigth: 300, container: container.pagingContainer, divName: "Div_Print", hasFooter: true }; buildPrintTable(table); container.params.print = false } else { table = { header: lsth, body: lstb, details: { detailsFunction: AcountDetails }, heigth: 300, container: container.pagingContainer, divName: "acountReportlist", hasFooter: true }; buildTable(table) } } function buildFullAcountList(jq, container) { var $con = $("#" + container.pagingContainer); $con.find("#divFooter").removeClass("invisible"); var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "employee", sort: "p_person.Family", width: "7%" }); lsth.push({ title: "customer", sort: "p_person1.Family", width: "7%" }); lsth.push({ title: "date", sort: "Date", width: "8%" }); lsth.push({ title: "accountDescription", width: "7%" }); lsth.push({ title: "debtor", sort: "Amount", width: "10%" }); lsth.push({ title: "creditor", sort: "Amount", width: "10%" }); lsth.push({ title: "balanceAmount", width: "12%" }); lsth.push({ title: "invoiceNumber", sort: "InvoiceNO", width: "8%" }); lsth.push({ title: "confirm", sort: "p_Employee.p_Person.Family", width: "7%" }); lsth.push({ title: "store", sort: "inv_Shop.Name", width: "6%" }); lsth.push({ title: "counter", sort: "counterid", width: "6%" }); if (!container.params.print) { lsth.push({ title: "print", width: "4%" }); lsth.push({ title: "edit", width: "4%" }); lsth.push({ title: "details", width: "4%" }) } var List = typeof jq.results == "string" ? eval("(" + jq.results + ")") : jq.results; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; if (!container.params.print) trBody[0] = { trId: val.id, trName: val.detail }; trBody[1] = { name: "employee", html: val.employee, width: "7%" }; trBody[2] = { name: "customer", html: " <span class='cursor' name='subTab'  menuName='a_CustomerList' id='" + val.ClientId + "'>" + val.client + "</span>" + " <input type='hidden' id='hd_code' value='" + val.clientCode + "'/><input type='hidden' id='hd_clientId' value='" + val.ClientId + "'/>", width: "7%" }; trBody[3] = { props: { datedigit: ToPersianDateDigitYearRight(val.date), date: val.date, name: "date", width: "8%", klass: "dateLong" }, html: val.date }; trBody[4] = { name: "description", html: "<span>" + val.inOrderOf + "</span>" + " <input type='hidden' id='hd_categoryId' value='" + val.categoryId + "'/><input type='hidden' id='hd_description' value='" + val.Description + "'/><input type='hidden' id='hd_salaryFromDate' value='" + val.salaryFromDate + "'/><input type='hidden' id='hd_salaryToDate' value='" + val.salaryToDate + "'/><input type='hidden' id='hd_monthId' value='" + val.Month + "'/><input type='hidden' id='hd_fixSalary' value='" + val.fixSalary + "'/><input type='hidden' id='hd_commission' value='" + val.commission + "'/>", width: "7%" }; trBody[5] = { html: val.isSell == true ? val.amount : "", props: { name: "Debtor", klass: "digit", style: "font-size:1em;", width: "10%"} }; trBody[6] = { html: val.isSell == true ? "" : "<span>" + val.amount + "</span>" + " <input type='hidden' id='hd_commission' value='" + val.commission + "'/>", props: { name: "Creditor", style: "font-size:1em;", klass: "digit", width: "10%"} }; trBody[7] = { name: "balance", html: val.balance, width: "12%" }; trBody[8] = { name: "InvoiceNO", html: val.InvoiceNO, width: "8%" }; trBody[9] = { name: "confirmer", html: val.ConfirmerId == null ? "<button id='btnConfirm'>تایید</button>" : val.confirmer, width: "7%" }; trBody[10] = { name: "shop", html: val.shopName, width: "6%" }; trBody[11] = { name: "counter", html: val.counterCode, width: "6%" }; lstb.push(trBody) } $con.find("#spDeptor").html(jq.sumDebtor); $con.find("#spCreditor").html(jq.sumCreditor); $con.find("#spBalance").html(Math.round(jq.sumDebtor * 1 - jq.sumCreditor * 1, 1)); $con.find("#spNotPassedCheque").html(jq.sumNotPassed); $con.find("#spNetBalance").html(Math.round(jq.sumDebtor * 1 - jq.sumCreditor * 1 - jq.sumNotPassed * 1, 1)); if (container.params.print) { table = { header: lsth, body: lstb, heigth: 300, container: container.pagingContainer, divName: "Div_Print", hasFooter: false }; buildPrintTable(table); container.params.print = false } else { table = { header: lsth, body: lstb, details: { detailsFunction: FullAcountDetails, editFunction: EditFullAccount, confirmFunction: ConfirmFullAccount, printFunction: PrintFullAccount }, heigth: 300, container: container.pagingContainer, divName: "acountReportlist", hasFooter: false }; buildTable(table) } } function PrintFullAccount(e, t) { var n = $("#" + t); if ($(e).parents("tr").attr("name") == "payment") PrintPaymentDetails(t, $(e).parents("tr").prop("id").replace("tr", "")); else { if (n.find("#Div_PrintFactor").html().length < 10) { n.find("#Div_PrintFactor").load("Report/PrintInvoice.htm", function () { getDataPrint($(e).parents("tr").prop("id").replace("tr", ""), t) }) } else getDataPrint($(e).parents("tr").prop("id").replace("tr", ""), t) } } function ConfirmFullAccount(e, t) { $con = $("#" + t); $dis = $(e); var n = { orderHeaderId: $dis.parents("tr").prop("id").replace("tr", "") }; $.ajax({ type: "POST", url: "Management/ConfirmFullAccount", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (e) { if (!isAuthenticated(e)) return; if (e != null && e.isdone == true) { getFullAcountList(t, { container: t, callbackmethod: getFullAcountList, fname: "", page_index: 0, build: buildFullAcountList, servicename: "Management", methodname: "GetFullOrderStatement", print: false }) } }, error: function (e) { alert(e.responseText) } }) } function EditFullAccount(e, t) { if ($(e).parents("tr").attr("name") == "order") { var n = $(e).closest("tr").attr("id"); var r = $(e).closest("tr").find("[name=InvoiceNO]").text(); var i = n.substring(2, n.length); var s = $("#" + t); createSubTab({ name: "a_EditOrder", tabName: r, id: i }) } } function loadEditFastOrder(e, t, n) { loadOrder(0, t, GetItemOrder, false, false, n, { isfastorder: true }); GetItemEditFastOrder(t, e) } function GetItemEditFastOrder(e, t) { var n = $("#" + e); n.find("#div_OrderDate").removeClass("hidden"); n.find("#div_payamount").addClass("hidden"); n.find("#OrderList").html(""); n.find("#txt_m_OrderDate").attr("id", e + "txt_m_OrderDate"); n.find("#" + e + "txt_m_OrderDate").datepicker({ changeMonth: true, changeYear: true }); n.find("#hi_orderHeaderId").val(t); var r = { id: t }; $.ajax({ type: "POST", data: JSON.stringify(r), url: "Management/GetEditDetailInvoice", contentType: "application/json; charset=utf-8", success: function (t) { if (!isAuthenticated(t)) return; n.find("#" + e + "txt_m_OrderDate").val(ToPersianDateDigitYearRight(t.Date)); n.find("#txt_s_ProductBarcode").val(""); if (t.length < 1) return; if (t.iscustomer == true) { aComplete({ methodname: "GetCompletionListByCustomerName", servicename: "Management", id: "txt_s_Person", container: e, minlength: 2, autofocus: false, limit: 20, boxId: "txt_s_Person", fname: customerOnSelect }) } else { aComplete({ methodname: "GetCompletionListBySupplierName", servicename: "Management", id: "txt_s_Person", container: e, minlength: 2, autofocus: false, limit: 20, boxId: "txt_s_Person", fname: customerOnSelect }) } n.find("#txt_vat").val(t.VatAmount); n.find("#txt_m_InvoiceNumber").val(t.InvoiceNO); n.find("#txt_m_TotalPrice").val(t.Amount); n.find("#txt_m_Description").val(t.Description); n.find("#txt_m_PaymentAmount").addClass("invisible"); for (var r = 0; r < t.result.length; r++) { var i = t.result[r]; var s = ""; var o = ""; obj = i.priceType; for (var u in obj) { var a = obj[u]; var f = 0; if (a == null) f = i.priceType.basePrice; else f = a; o += "<option value='" + f + "'>" + f + " " + u + "</option>" } var l = "tr" + r + "_" + e + "_" + i.BarcodeId + "_" + i.Quantity; s += "<tr id='" + l + "'>" + "<td width='3%' id='rownumber'></td>" + "<td width='20%'><a href='javascript:showQuantity(\"" + e + '","' + i.barcode + "\");'>" + i.Name + " " + i.code + " " + i.barcode + "</a></td>" + "<td width='6%' id='Color_'>" + " <select   id='ddl_m_Color_" + l + "' disabled='disabled' class='select55 ' ></select>" + "</td>" + "<td width='6%' id='Color_'>" + "<select   id='ddl_m_Size_" + l + "' disabled='disabled' class='select55 '></select>" + "</td>" + "<td width='6%' id='Color_'>" + " <select   id='ddl_m_measureunit_" + l + "' disabled='disabled' class='select55 '></select>" + "</td>" + "<td width='10%' id='Color_'> <select   id='ddl_m_priceType_" + l + "'  class='select95'>" + o + "</select></td>" + "<td width='7%'><input type='text'  id='txt_m_Quantity' VALUE='" + i.Quantity + "' class='inputW34 fontSize15'  /></td>" + "<td width='11.5%'><input type='text'  id='txt_m_Price' class='inputW80 fontSize15' value='" + Math.abs(i.Price) + "' /></td>" + "<td width='7%'><input type='text'  id='txt_m_TotalQuantity' VALUE='" + i.Quantity + "' class='inputW50 fontSize15'   disabled='disabled'/></td>" + "<td width='9%'><input  class='inputW80 fontSize15 digit' VALUE='" + i.Quantity * Math.abs(i.Price) + "' price='" + i.Quantity * Math.abs(i.Price) + "' type='text' id='txt_m_TotalItemPrice' disabled='disabled'/></td>" + "<td width='11%'> <input class='inputW100 fontSize15' type='text' id='txt_m_Serial'/></td>" + "<td width='2.5%' id='delete'><span title='حذف' name='deleteOrder' class='cursor ui-icon ui-icon-closethick'></span></td></tr>"; n.find("#OrderList").append(s).parent().tableScroll({ height: 380, width: n.width() - 85, flush: false }); n.find("[name=deleteOrder]").unbind().click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) RemoveItemOrderElement($(this).parents("tr").first().prop("id"), e, true); else return }); $("#" + l).find("[id=txt_m_Quantity]").spinner({ change: function () { SumPrice($(this).parents("tr").attr("id"), e) }, stop: function () { SumPrice($(this).parents("tr").attr("id"), e) } }); $("#" + l).find("[id=txt_m_Price]").spinner({ step: 1e3, change: function () { SumPrice($(this).parents("tr").attr("id"), e) }, stop: function () { SumPrice($(this).parents("tr").attr("id"), e) } }); $("#" + l).find("#txt_m_Price").unbind("keydown").bind("keydown", function (e) { if (e.keyCode == 40) { $(this).parent().parent().next().find("#txt_m_Price").focus().focus(function () { this.select() }) } if (e.keyCode == 38) { $(this).parent().parent().prev().find("#txt_m_Price").focus().focus(function () { this.select() }) } }); $("#" + l).find("#txt_m_Quantity").unbind("keydown").bind("keydown", function (e) { if (e.keyCode == 40) { $("#" + l).next().find("#txt_m_Quantity").focus().focus(function () { this.select() }) } if (e.keyCode == 38) { $("#" + l).prev().find("#txt_m_Quantity").focus().focus(function () { this.select() }) } }); bindComboData({ id: "ddl_m_measureunit_" + l, container: l, isMeasureUnit: true }, i.measureUnits); $("#ddl_m_measureunit_" + l).change(function () { SumPrice(l, e) }); bindComboData({ id: "ddl_m_Color_" + l, container: l, headertext: " رنگ", setcolor: true }, i.colors); $("#ddl_m_Color_" + l).change(function () { SelectColorForOrder(l, this, i.BarcodeId) }); bindComboData({ id: "ddl_m_Size_" + l, container: l, headertext: " جزئیات" }, i.sizes); $("#ddl_m_Size_" + l).change(function () { SelectColorForOrder(l, this, i.BarcodeId) }); $("#ddl_m_Color_" + l).val(i.Color); $("#ddl_m_Size_" + l).val(i.Size); $("#ddl_m_priceType_" + l).change(function () { $("#" + l).find("#txt_m_Price").val($(this).val()); SumPrice(l, e) }) } n.find("#customerOnSelect").text(t.person); n.find("#txt_s_Person").val(t.code); n.find("#btn_Print").removeClass("invisible"); n.find("#btn_AddOrder").removeClass("invisible"); n.find("#Footer").removeClass("invisible"); n.find("#header").removeClass("invisible") }, error: function (e) { alert(e.responseText) } }) } function EditOrder(e, t) { var n = $("#" + t); var r = []; var i = {}; $.each($("#" + t).find("#OrderList").find("tr[id*=tr]"), function () { var e = {}; var t = $(this); var i = t.find("#ddl_m_Color_" + this.id).val(); var s = t.find("#ddl_m_Size_" + this.id).val(); e["barcodeid"] = this.id.split("_")[2]; e["colorid"] = i == null ? "" : i; e["sizeid"] = s == null ? "" : s; e["quantity"] = t.find("#txt_m_TotalQuantity").val(); e["price"] = t.find("#txt_m_Price").val(); e["description"] = ""; e["serial"] = t.find("#txt_m_Serial").val(); e["broken"] = false; if (n.find("#cbIsChangeQuantity").prop("checked")) { e["status"] = t.find("#ddl_m_Availability").val(); e["broken"] = t.find("#cb_d_Broken_" + this.id).prop("checked") } r.push(e) }); i["shopid"] = $("#userDefault").find("#ddl_s_Branch").val(); i["date"] = n.find("#" + t + "txt_m_OrderDate").val(); i["currenyid"] = $("#userDefault").find("#ddl_m_Currency").val(); if (n.find("#cbIsChangeQuantity").length < 1) { i["totalamount"] = n.find("#txt_m_TotalPrice").val().replace(/,/g, ""); i["PaymentAmount"] = n.find("#txt_m_PaymentAmount").val().replace(/,/g, "") } else { i["setPayment"] = n.find("#cbSetPayment").prop("checked") } i["description"] = n.find("#txt_m_Description").val(); i["invoicenumber"] = n.find("#txt_m_InvoiceNumber").val(); i["clientCode"] = n.find("#txt_s_Person").val(); if (n.find("#hd_s_Person").val() != undefined) e = n.find("#hd_s_Person").val(); i["customerid"] = e; i["issell"] = !n.find("#cb_d_Sale" + t).prop("checked"); i["ispreorder"] = n.find("#cb_d_PreOrder" + t).prop("checked"); var s = { header: i, itemDetails: r, counterId: $("#userDefault").find("#ddl_m_Counter").val(), orderHeaderId: n.find("#hi_orderHeaderId").val(), vat: n.find("#txt_vat").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(s), type: "Post", url: "Management/EditOrder", success: function (e) { if (!isAuthenticated(e)) return; if (e.alert != undefined) { SetInvoiceData(t, e); translate(e.alert); if (e.InvoiceNO != undefined) { n.find("#btn_Print").removeClass("invisible") } } else translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function EditVoucherFullAccount(e, t) { var n = $("#" + t); var r = $(e); var i = $("#editvoucher" + t); i.find("#txt_voucherAmount").val(r.parents("tr").find("[name=Debtor]").html() != "" ? r.parents("tr").find("[name=Debtor]").html().replace(/,/g, "") : r.parents("tr").find("[name=Creditor]").html().replace(/,/g, "")); i.find("#btn_editVoucherAmount").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (UpdateVoucherAmount(r.parents("tr").prop("id").replace("tr", ""), t)) { } }); i.dialog(open).dialog({ width: 400, modal: true }); localize() } function EditOrderFullAccount(e, t) { var n = $("#" + t); var r = $(e); var i = $("#editOrder" + t); i.find("#txtAmount").val(r.parents("tr").find("[name=Debtor]").html() != "" ? r.parents("tr").find("[name=Debtor]").html().replace(/,/g, "") : r.parents("tr").find("[name=Creditor]").html().replace(/,/g, "")).parent("li").removeClass("hidden"); i.find("#txtDate").val(r.parents("tr").find("[name=date]").attr("datedigit")).datepicker(); i.find("#btnEditAccount").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (UpdateOrderFullAccount(r.parents("tr").prop("id").replace("tr", ""), t)) { } }); i.dialog(open).dialog({ width: 400, modal: true }); localize() } function EditPaymentFullAccount(e, t) { var n = $("#" + t); var r = $(e); var i = $("#editOrder" + t); i.find("#txtAmount").parent("li").addClass("hidden"); i.find("#txtDate").val(r.parents("tr").find("[name=date]").attr("datedigit")).datepicker(); i.find("#btnEditAccount").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (UpdatePaymentFullAccount(r.parents("tr").prop("id").replace("tr", ""), t)) { } }); i.dialog(open).dialog({ width: 400, modal: true }); localize() } function EditExpenseFullAccount(e, t) { var n = $(e).parents("tr"); var r = n.find("#hd_categoryId").val(); var i = $("#" + t); var s = $("#editExpense" + t); s.find("#divExpenseCategoryAdd").html(""); i.find("#btn_saveExpense").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (validateAll(i.find("#dialogAddExpense"))) EditExpense(n.prop("id").replace("tr", ""), s.prop("id")) }); s.find("#divExpenseCategoryAdd").html(""); bindHierarchyData({ id: "divExpenseCategoryAdd", container: "editExpense" + t, table: "ExpenseCategory", canmodify: true, parentid: r, css: "selectsmall1 required validate" }); s.find("#txt_m_amount_add").val(n.find("[name=Debtor]").html().replace(/,/g, "")); s.find("#txt_m_description_add").val(n.find("#hd_description").val()); s.dialog({ autoOpen: true }) } function EditSalaryFullAccount(e, t) { var n = $(e).parents("tr"); var r = $("#editSalary" + t); r.find("#btn_save").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (validateAll($con.find("#editSalary" + t))) EditEmployeeSalary($dis.parents("tr").prop("id").replace("tr", ""), "editSalary" + t) }); bindItemsForSelectCombo({ async: false, methodname: "getEmployees", servicename: "Management", id: "ddl_m_employee_add", container: "editSalary" + t, headertext: "انتخاب کارمند" }); r.find("#ddl_m_employee_add").val(n.find("#hd_clientId").val()); r.find("#txt_m_fromDate_add").val(n.find("#hd_salaryFromDate").val()); r.find("#txt_m_toDate_add").val(n.find("#hd_salaryToDate").val()); r.find("#txt_m_fixSalary_add").val(n.find("#hd_fixSalary").val()); r.find("#txt_m_commission_add").val(n.find("#hd_commission").val()); r.find("#txt_salary_description_add").val(n.find("#hd_description").val()); r.find("#txt_m_fromDate_add").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#txt_m_toDate_add").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); r.dialog(open).dialog({ width: 500 }) } function EditSocialFullAccount(e, t) { var n = $(e).parents("tr"); var r = $("#editSocial" + t); r.find("#btn_saveSocial").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (validateAll($con.find("#editSocial" + t))) EditSocialSecurity($dis.parents("tr").prop("id").replace("tr", ""), "editSocial" + t) }); bindItemsForSelectCombo({ async: false, methodname: "getEmployees", servicename: "Management", id: "ddl_social_employee_add", container: "editSocial" + t, headertext: "انتخاب کارمند" }); if ($("#Month_Name_Add").html() == "") bindXmlDropDownData({ async: false, id: "Month_Name_Add", container: "editSocial" + t, path: "Counter/MonthTitle", canmodify: true, istext: false, headertext: "انتخاب ماه" }); r.find("#ddl_social_employee_add").val(n.find("#hd_clientId").val()); r.find("#txt_social_amount_add").val(n.find("[name=Debtor]").html().replace(/,/g, "")); r.find("#Month_Name_Add select").val(n.find("#hd_monthId").val()); r.find("#txt_social_description_add").val(n.find("#hd_description").val()); r.dialog(open).dialog({ width: 500 }) } function UpdateVoucherAmount(e, t) { $con = $("#editvoucher" + t); var n = { orderHeaderId: e, amount: $con.find("#txt_voucherAmount").val() }; $.ajax({ type: "POST", url: "Management/EditOrderFullAcount", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (e) { if (!isAuthenticated(e)) return; return e.isdone }, error: function (e) { alert(e.responseText) } }) } function UpdateOrderFullAccount(e, t) { $con = $("#editOrder" + t); var n = { orderHeaderId: e, amount: $con.find("#txtAmount").val(), date: $con.find("#txtDate").val() }; $.ajax({ type: "POST", url: "Management/EditOrderFullAcount", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (e) { if (!isAuthenticated(e)) return; alert(e.msg) }, error: function (e) { alert(e.responseText) } }) } function UpdatePaymentFullAccount(e, t) { $con = $("#editOrder" + t); var n = { orderHeaderId: e, date: $con.find("#txtDate").val() }; $.ajax({ type: "POST", url: "Management/EditPaymentFullAcount", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (e) { if (!isAuthenticated(e)) return; alert(e.msg) }, error: function (e) { alert(e.responseText) } }) } function UpdateExpenseFullAccount(e, t) { $con = $("#edit" + t); var n = { orderHeaderId: orderHeaderID, expenseCategory: getHierarchySelectedValue("divExpenseCategoryAdd", t), amount: $con.find("#txt_m_amount_add").val(), counterId: $("#userDefault").find("#ddl_m_Counter").val(), currencyId: $("#userDefault").find("#ddl_m_Currency").val(), description: $con.find("#txt_m_description_add").val(), shopId: $("#userDefault").find("#ddl_s_Branch").val() }; $.ajax({ type: "POST", url: "Management/EditExpenseFullAcount", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (e) { if (!isAuthenticated(e)) return; alert(e.msg) }, error: function (e) { alert(e.responseText) } }) } function ExpenseDetailsFullAccount(e, t) { var n = $("#" + t); var r = $("#expense" + t); var i = ""; var s = $(e).parents("tr"); i += "<tr id='" + s.prop("id") + "'>" + "<td name='description' width='90%'>" + "مبلغ " + s.find("[name=Debtor]").html().replace(/,/g, "") + " تومان " + s.find("[name=description]").find("span").html() + "</td>" + "<td name='delete' width='10%'><button id='a_Button' >حذف</button></td>" + "</tr>"; r.find("#expenseDetailList").html(i).parent().tableScroll({ height: 380, width: 750, flush: false }); r.find("[id=a_Button]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) if (DeleteExpense($(this), t)) $(e).parents("tr").remove(); else return }); r.dialog({ width: 800 }).dialog("open") } function VoucherDetailsFullAccount(orderHeaderId, container) { $con = $("#" + container); var $dialog = $("#voucherDetailsList" + container); $.ajax({ type: "POST", url: "Management/GetVoucherDetailsFullAccount", contentType: "application/json; charset=utf-8", data: "{orderHeaderId: '" + orderHeaderId + "'}", success: function (response) { if (!isAuthenticated(response)) return; jq = response; if (jq.msg != undefined && jq.msg == "empty") { $dialog.find("#DetailListVoucher").html(""); $dialog.dialog("close"); return } var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<tr id='tr" + val.OrderHeaderId + "'>" + "<td name='number' width='25%'>" + val.Number + "</td>" + "<td name='IsValid' width='20%'>" + "<span id='voucherStatus'>" + val.IsValid + "</span>&nbsp;&nbsp;&nbsp;<button id='btnConfirm'>تغییر وضعیت</button></td>" + "<td name='ExpieryDate' width='20%'><div id='ExpieryDate'>" + val.ExpieryDate + "</div></td>" + "<td name='Amount' width='20%'><div id='Amount'>" + val.Amount + "</div></td>" + "<td name='Edit' width='8%'><div><button id='btn_edit' >ویرایش</button></div></td>" + "<td name='Delete' width='7%'><div><button id='btn_delete' >حذف</button></div></td>" + "</tr>" } $dialog.find("#DetailListVoucher").html(ItemList).parent().tableScroll({ height: 380, width: 750, flush: false }); $dialog.find("[id=btnConfirm]").button({ icons: { primary: "ui-icon-check" }, text: false }).click(function () { ChangeVoucherStatus(this, container) }); $dialog.find("[id=btn_delete]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) DeleteVoucher(this, container); else return }); $dialog.find("[id=btn_edit]").button({ icons: { primary: "ui-icon-pencil" }, text: false }).click(function () { ClickDetailVoucher($(this).parents("tr").first(), container); $(this).parent("div").addClass("invisible") }); $dialog.dialog({ width: 800 }).dialog("open") }, error: function (e) { alert(e.responseText) } }) } function ClickDetailVoucher(e, t) { var n = $("#" + t); var r = $("#voucherDetailsList" + t); onRowClick(e); trid = e.prop("id"); if (e.hasClass("rowOnClick") && e.find("input:text").length < 2) { e.find("td[name=Amount]").append("<input type='text' id='Amount' class='inputText inputW100 ' value='" + e.find("div[id=Amount]").html() + "'/>"); e.find("div[id=Amount]").addClass("invisible"); e.find("td[name=ExpieryDate]").append("<input type='text' id='ExpieryDate' class='inputText inputW100 ' value='" + e.find("div[id=ExpieryDate]").html() + "'/>"); e.find("div[id=ExpieryDate]").addClass("invisible"); e.find("div[id=delete]").addClass("invisible"); e.find("td[name=Edit]").append("<div id='Edit'><a id='Edit_Button' href='#'>بروز </a></div>"); e.find("[id=Edit_Button]").click(function () { EditDetailVoucher(e, t) }).button(); $.each(r.find("tr[id*=tr]"), function () { if (!$(this).hasClass("rowOnClick")) { $(this).find("input[id=Amount]").remove(); $(this).find("input[id=ExpieryDate]").remove(); $(this).find("#Edit").remove(); $(this).find("div[id=delete]").removeClass("invisible"); $(this).find("div").removeClass("invisible") } }) } else { e.find("input:text[id!=txt_m_QuantityReturn]").remove(); e.find("select").remove(); e.find("Label[id=Label]").remove(); e.find("#Edit").remove(); e.find("div").removeClass("invisible") } } function EditDetailVoucher(e, t) { var n = $("#" + t); var r = { voucherNumber: e.find("td[name=number]").html(), amount: e.find("input[id=Amount]").val(), expieryDate: e.find("input[id=ExpieryDate]").val() }; $.ajax({ type: "POST", url: "Management/EditVoucherFullAccount", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (t) { if (!isAuthenticated(t)) return; if (t.isdone) { e.find("div[id=Amount]").html(e.find("input[id=Amount]").val()); e.find("div[id=ExpieryDate]").html(e.find("input[id=ExpieryDate]").val()) } e.find("input[id=Amount]").remove(); e.find("input[id=ExpieryDate]").remove(); e.find("#Edit").remove(); e.find("div[id=delete]").removeClass("invisible"); e.find("div").removeClass("invisible"); alert(t.msg) } }) } function EditAccount(e, t) { $con = $("#" + t); $dis = $(e) } function AcountDetails(e, t) { $con = $("#" + t); $dis = $(e); if ($dis.parents("tr").find("[name=counter]").html() != "") ListDetailPayment($dis.parents("tr").prop("id").replace("tr", ""), t); else SelectDetailInvoice($dis.parents("tr").prop("id").replace("tr", ""), "dialog" + t) } function FullAcountDetails(e, t) { $con = $("#" + t); $dis = $(e); $("#voucherDetailsList" + t + "," + "#DetailPaymentList" + t + "," + "#dialog" + t + "," + "#expense" + t).dialog().dialog("close"); if ($dis.parents("tr").attr("name") == "payment") ListDetailPayment($dis.parents("tr").prop("id").replace("tr", ""), t); else if ($dis.parents("tr").attr("name") == "order") SelectDetailInvoice($dis.parents("tr").prop("id").replace("tr", ""), "dialog" + t); else if ($dis.parents("tr").attr("name") == "voucher") VoucherDetailsFullAccount($dis.parents("tr").prop("id").replace("tr", ""), t); else if ($dis.parents("tr").attr("name") == "expense" || $dis.parents("tr").attr("name") == "salary" || $dis.parents("tr").attr("name") == "social") ExpenseDetailsFullAccount($dis, t) } function loadCustomerAcountReport(e, t, n) { sortid = "Date desc"; var r = $("#" + t); r.find("#hd_d_PersonId").val(e); if (n) { r.find("#moreFilter").slideUp("fast"); r.find(".toggle-more-filters").click(function () { $(this).toggleClass("open"); r.find("#moreFilter").slideToggle(function () { }) }); bindItemsForSelectCombo({ methodname: "GetComboItems", servicename: "XmlDropDown", headertext: "انتخاب بانک", id: "ddlBank", container: t }, { path: "Counter/BankTitle" }); ChangeCheckBoxGroupName("Check", t); r.find("#txtInvoiceDateStart").attr("id", "txtInvoiceDateStart" + t); r.find("#txtInvoiceDateEnd").attr("id", "txtInvoiceDateEnd" + t); r.find("#txtInvoiceDateStart" + t).datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, n) { $("#txtInvoiceDateEnd" + t).datepicker("option", "minDate", new JalaliDate(n["selectedYear"], n["selectedMonth"], n["selectedDay"])) } }); r.find("#txtInvoiceDateEnd" + t).datepicker({ changeMonth: true, changeYear: true }); r.find("#btnPrint").off().on("click", function () { getAcountList(t, { container: t, callbackmethod: getAcountList, fname: "", page_index: 0, build: buildAcountList, servicename: "Management", methodname: "GetInvoiceStatement", print: true }) }).button({ icons: { primary: "ui-icon-print" }, text: true }); r.find("#txtDueDateFrom").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#txtDueDateTo").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); r.find("#txtDueDateTo").datepicker({ changeMonth: true, changeYear: true }); bindHierarchyData({ id: "hr_s_Category", table: "category", container: t }); r.find("[id=btnSearch]").button({ icons: { primary: "ui-icon-search"} }).unbind("click").click(function () { sortid = "date desc"; getAcountList(t, { container: t, callbackmethod: getAcountList, fname: "", page_index: 0, build: buildAcountList, servicename: "Management", methodname: "GetInvoiceStatement", print: false }) }) } getAcountList(t, { container: t, callbackmethod: getAcountList, fname: "", page_index: 0, build: buildAcountList, servicename: "Management", methodname: "GetInvoiceStatement", print: false }); r.find("#PageSize").off().on("change", function () { getAcountList(t, { container: t, callbackmethod: getAcountList, fname: "", page_index: 0, build: buildAcountList, servicename: "Management", methodname: "GetInvoiceStatement", print: false }) }); r.find("#DetailPaymentList").dialog({ autoOpen: false }).dialog({ width: 750 }); r.find("#dialog").attr("id", "dialog" + t); r.find("#ddlSearchBy1 option[value='Code']").remove(); r.find("#ddlSearchBy1 option[value='Name']").remove() } function loadSupplierInvoiceList(e, t, n) { var r = $("#" + t); if (n) { r.find("#blCode").remove(); r.find("#hd_d_PersonId").val(e); r.find("#hd_d_IsClient").val(false); AccountFullAcc(t, n, { print: false, selectCase: "GetItemList", onLoad: true }) } } function loadCustomerInvoiceList(e, t, n) { var r = $("#" + t); if (n) { r.find("#blCode").remove(); r.find("#hd_d_PersonId").val(e); r.find("#hd_d_IsClient").val(true); AccountFullAcc(t, n, { print: false, selectCase: "GetItemList", onLoad: true }) } } function loadCustomerAccounting(e, t) { var n = $("#" + e); if (t) { n.find("#hd_d_IsClient").val(true); aComplete({ methodname: "GetCompletionListByCustomerName", servicename: "Management", id: "txt_customer", container: e, minlength: 2, autofocus: false, limit: 20, boxId: "txt_customer", fname: customerOnSelect }); AccountFullAcc(e, t, { print: false, selectCase: "GetItemList" }) } } function loadSupplierAccounting(e, t) { var n = $("#" + e); if (t) { n.find("#hd_d_IsClient").val(false); n.find("#lblClient").html("supplier"); aComplete({ methodname: "GetCompletionListBySupplierName", servicename: "Management", id: "txt_customer", container: e, minlength: 2, autofocus: false, limit: 20, boxId: "txt_customer", fname: customerOnSelect }); AccountFullAcc(e, t, { print: false, selectCase: "GetItemList" }) } } function loadCustomerOrderProfit(e, t) { var n = $("#" + e); if (t) { n.find("#hd_d_IsClient").val(true); aComplete({ methodname: "GetCompletionListByCustomerName", servicename: "Management", id: "txt_customer", container: e, minlength: 2, autofocus: false, limit: 20, boxId: "txt_customer", fname: customerOnSelect }); AccountFullAcc(e, t, { print: false, selectCase: "GetProfitList" }) } } function getInvoiceList(e) { var t = $("#" + e); var n = true; var r = t.find("#PageSize").val(); var i = 0; var s = 0; var o = "", u = "", a = "", f = "", l = "", c = "", h = "", p = "", d = "", v = "", m = "", g = "", y = "", b = "", w = ""; var E = t.find("#ddl_d_SearchBy1").val(); if (t.find("#moreFilter").is(":visible")) { if (E != "") { if (E == "Code") { u = t.find("#txtSearch1").val() } if (E == "Name") { o = t.find("#txtSearch1").val() } if (E == "EmployeeId") { a = t.find("#txtSearch1").val() } if (E == "EmployeeName") { f = t.find("#txtSearch1").val() } if (E == "Shop") { l = t.find("#txtSearch1").val() } } if (t.find("#txt_s_PriceFrom").length > 0) v = t.find("#txt_s_PriceFrom").val(); if (t.find("#txt_s_PriceTo").length > 0) m = t.find("#txt_s_PriceTo").val(); if (t.find("#Checkbox1" + e).prop("checked") && t.find("#Checkbox2" + e).prop("checked")) y = ""; else if (!t.find("#Checkbox1" + e).prop("checked") && t.find("#Checkbox2" + e).prop("checked")) y = false; else if (t.find("#Checkbox1" + e).prop("checked") && !t.find("#Checkbox2" + e).prop("checked")) y = true; if (t.find("#Checkbox3" + e).length > 0) b = t.find("#Checkbox3" + e).prop("checked"); if (t.find("#Checkbox4" + e).length > 0) w = t.find("#Checkbox4" + e).prop("checked") } var E = t.find("#ddl_d_SearchBy2").val(); if (E != "") { if (E == "InvoiceId") { c = t.find("#txtSearch2").val() } if (E == "ProductId") { h = t.find("#txtSearch2").val() } if (E == "ProductName") { p = t.find("#txtSearch2").val() } if (E == "Barcode") { d = t.find("#txtSearch2").val() } } g = getHierarchySelectedValue("hr_s_Category", e); var S = { skip: i, take: r, currentPage: s, first: n, sort: sortid, supplierid: t.find("#hd_d_PersonId").val(), IsClient: t.find("#hd_d_IsClient").val(), SupplierName: o, code: u, EmployeeId: a, EmployeeName: f, Shop: l, InvoiceId: c, ProductId: h, ProductName: p, InvoiceDateStart: t.find("#txt_s_InvoiceDateStart").length > 0 ? t.find("#txt_s_InvoiceDateStart").val() : "", Barcode: d, InvoiceDateEnd: t.find("#txt_s_InvoiceDateEnd").length > 0 ? t.find("#txt_s_InvoiceDateEnd").val() : "", PriceFrom: v, PriceTo: m, Order: y, PreOrder: b, Broken: w, CategoryId: g, shopid: $("#userDefault").find("#ddl_s_Branch").val(), counterid: $("#userDefault").find("#ddl_m_Counter").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(S), type: "Post", url: "Management/GetInvoiceList", success: function (r) { if (!isAuthenticated(r)) return; var i = InvoicegetOptionsFrom(r.count, e); t.find("#paging").pagination(r.count, i); InvoicepageselectCallback(0, r, e, n) }, error: function (e) { alert(e.responseText) } }) } function InvoicegetOptionsFrom(e, t) { var n = $("#" + t); var r = { callback: InvoicepageselectCallback }; n.find("input:text").each(function () { r[this.name] = this.className.match(/numeric/) ? parseInt(this.value) : this.value }); r.prev_show_always = false; r.next_show_always = false; if (e < n.find("#PageSize").val()) n.find("#PageSize").css("display", "none"); else { n.find("#PageSize").css("display", "inline") } r.items_per_page = n.find("#PageSize").val(); r.prev_text = "قبلی"; r.next_text = "بعدی"; r.container = t; return r } function buildInvoiceList(jq, container) { var $con = $("#" + container); jq = jq.results; var condialog = "dialog" + container; var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; var str = ""; if ($con.find("#hd_d_iscustomer").val() == "false") { str = val.Sell == false ? "خرید" : "مرجوعی" } else { str = val.Sell == true ? "فروش" : "مرجوعی" } ItemList += "<tr id='tr" + val.OrderHeaderId + "'>" + "<td width='14%' id='td" + val.OrderHeaderId + "' name='InvoiceNO' >" + val.InvoiceNO + "</td>" + "<td width='10%' name='Date' >" + val.Date + "</td>" + "<td width='10%' name='Shop' id='" + val.ShopId + "'>" + val.ShopName + "</td> " + "<td width='12%' name='Employee' id='" + val.EmployeeId + "'>" + val.EmployeeName + " " + val.EmployeeFamily + "</td> " + "<td width='12%' name='Clinet' id='" + val.Code + "'><div id='Name'>" + val.ClientName + " " + val.ClientFamily + "</div></td> " + "<td width='13%' name='Amount'><div id='Price'>" + val.Amount + " " + val.Currency + "</div></td> " + "<td width='9%' name='Sell'>" + str + "</td>" + "<td width='9%' name='PreOrder'>" + (val.PreOrder == false ? "فاکتور" : "<a id='a_PreOrder' href='javascript:SetInvoice(" + val.OrderHeaderId + ',"' + container + "\");'>پیش فاکتور </a>") + "</td>" + "<td width='11%' name='detail' id='" + val.OrderHeaderId + "'><div id='Detail'><button id='a_ButtonEdit'>ویرایش</button><button id='a_ButtonPrint'>چاپ</button><button id='a_Button' >جزئیات فاکتور</button></div></td>" + "</tr>" } $con.find("#InvoiceList").html(ItemList).parent().tableScroll({ height: 380, width: contentwidth, flush: false }); $con.find("[id=a_Button]").button({ icons: { primary: "ui-icon-plus" }, text: false }).click(function () { SelectDetailInvoice($(this).parents("td").prop("id"), condialog) }); $con.find("[id=a_ButtonEdit]").button({ icons: { primary: "ui-icon-pencil" }, text: false }).click(function () { ClickInvoice($(this).parents("tr").first(), container) }); $con.find("[id=a_ButtonPrint]").button({ icons: { primary: "ui-icon-print" }, text: false }).click(function () { getDataPrint($(this).parents("td").prop("id"), container) }) } function ClickInvoice(e, t) { var n = $("#" + t); onRowClick(e); if (e.hasClass("rowOnClick") && e.find("td[name=Amount] input").length < 1) { e.find("td[name=Amount]").append("<input type='text' class='inputText inputW136 ' value='" + e.find("td[name=Amount] div").html().split(" ")[0] + "'/><Label>" + e.find("td[name=Amount] div").html().split(" ")[1] + "</Label>"); e.find("div[id=Price]").addClass("invisible"); e.find("td[name=Clinet]").append("<input type='text' class='inputText inputW136 ' id='CustomerIntroducerCode' value='" + e.find("td[name=Clinet]").prop("id") + "'/><a id='a_IntroducerCode' href='#' ><span id='search' class='searchText'></span></a>"); e.find("div[id=Name]").addClass("invisible"); e.find("div[id=Detail]").addClass("invisible"); e.find("td[name=detail]").append("<div id='Edit'><button id='Edit_Button' >بروز</button></div>"); e.find("#Edit_Button").click(function () { EditHeaderInvoice(e, t) }).button(); n.find("#divdialogCustomer").dialog({ autoOpen: false }).dialog({ width: 600 }); n.find("#a_IntroducerCode").off().on("click", function () { opendialog({ container: "divdialogCustomer", containerpage: t }) }); $.each(n.find("tr[id*=tr]"), function () { if (!$(this).hasClass("rowOnClick")) { $(this).find("a[id=a_CustomerIntroducerCode]").remove(); $(this).find("input").remove(); $(this).find("span[id=search]").remove(); $(this).find("Label").remove(); $(this).find("div[id=Edit]").remove(); $(this).find("div").removeClass("invisible") } }) } else { e.find("a[id=a_CustomerIntroducerCode]").remove(); e.find("input").remove(); e.find("span[id=search]").remove(); e.find("Label").remove(); e.find("div[id=Edit]").remove(); e.find("div").removeClass("invisible") } } function EditHeaderInvoice(e, t) { var n = $("#" + t); $.ajax({ type: "POST", url: "Management/EditHeaderInvoice", contentType: "application/json; charset=utf-8", data: "{OrderHeaderId: '" + e.prop("id").replace("tr", "") + "',Code: '" + e.find("td[name=Clinet] input").val() + "',Amount: '" + e.find("td[name=Amount] input").val() + "'}", success: function (t) { if (!isAuthenticated(t)) return; if (t.isDone) { e.find("a[id=a_CustomerIntroducerCode]").remove(); e.find("span[id=search]").remove(); e.find("div[id=Edit]").remove(); e.find("div[id=Price]").html(e.find("td[name=Amount] input").val() + " " + e.find("td[name=Amount] Label").html()); e.find("div[id=Name]").html(t.msg); e.find("input").remove(); e.find("Label").remove(); e.find("div").removeClass("invisible") } else translate(t.msg) } }) } function InvoicepageselectCallback(e, t, n, r) { var i = $("#" + n); if (r) { buildInvoiceList(t, n) } else { r = false; var s = i.find("#PageSize").val(); var o = ""; var u = s; var a = e == 0 ? 0 : e * u; var f = "", l = "", c = "", h = "", p = "", d = "", v = "", m = "", g = ""; var y = i.find("#ddl_d_SearchBy1").val(); if (y != "") { if (y == "Code") { l = i.find("#txtSearch1").val() } if (y == "Name") { f = i.find("#txtSearch1").val() } if (y == "EmployeeId") { c = i.find("#txtSearch1").val() } if (y == "EmployeeName") { h = i.find("#txtSearch1").val() } if (y == "Shop") { p = i.find("#txtSearch1").val() } } var y = i.find("#ddl_d_SearchBy2").val(); if (y != "") { if (y == "InvoiceId") { d = i.find("#txtSearch2").val() } if (y == "ProductId") { v = i.find("#txtSearch2").val() } if (y == "ProductName") { m = i.find("#txtSearch2").val() } if (y == "Barcode") { g = i.find("#txtSearch2").val() } } var b = ""; if (i.find("#Checkbox1" + n).prop("checked") && i.find("#Checkbox2" + n).prop("checked")) b = ""; else if (!i.find("#Checkbox1" + n).prop("checked") && i.find("#Checkbox2" + n).prop("checked")) b = false; else if (i.find("#Checkbox1" + n).prop("checked") && !i.find("#Checkbox2" + n).prop("checked")) b = true; var w = { skip: a, take: u, currentPage: e, first: r, sort: sortid, supplierid: i.find("#hd_d_PersonId").val(), IsClient: i.find("#hd_d_IsClient").val(), SupplierName: f, code: l, EmployeeId: c, EmployeeName: h, Shop: p, InvoiceId: d, ProductId: v, ProductName: m, InvoiceDateStart: i.find("#txt_s_InvoiceDateStart").length > 0 ? i.find("#txt_s_InvoiceDateStart").val() : "", Barcode: g, InvoiceDateEnd: i.find("#txt_s_InvoiceDateEnd").length > 0 ? i.find("#txt_s_InvoiceDateEnd").val() : "", PriceFrom: i.find("#txt_s_PriceFrom").length > 0 ? i.find("#txt_s_PriceFrom").val() : "", PriceTo: i.find("#txt_s_PriceTo").length > 0 ? i.find("#txt_s_PriceTo").val() : "", Order: b, PreOrder: i.find("#Checkbox3" + n).length > 0 ? i.find("#Checkbox3" + n).prop("checked") : "", Broken: i.find("#Checkbox4" + n).length > 0 ? i.find("#Checkbox4" + n).prop("checked") : "", CategoryId: getHierarchySelectedValue("hr_s_Category", n), shopid: $("#userDefault").find("#ddl_s_Branch").val(), counterid: $("#userDefault").find("#ddl_m_Counter").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(w), type: "Post", url: "Management/GetInvoiceList", success: function (e) { if (!isAuthenticated(e)) return; buildInvoiceList(e, n) }, error: function (e) { alert(e.responseText) } }); return false } Sort(getInvoiceList, n) } function SetInvoice(e, t) { $.ajax({ type: "POST", url: "Management/preOrderChange", contentType: "application/json; charset=utf-8", data: "{orderHeaderId: '" + e + "'}", success: function (e) { if (!isAuthenticated(e)) return; if (e.isdone) getInvoiceList(t) } }) } function SelectDetailInvoice(id, container) { var $con = $("#" + container); $.ajax({ type: "POST", url: "Management/GetDetailInvoice", contentType: "application/json; charset=utf-8", data: "{id: '" + id + "'}", success: function (response) { if (!isAuthenticated(response)) return; jq = response; var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<tr id='tr" + val.OrderDetailId + "'>" + "<td name='name' id='" + val.BarcodeId + "' width='17%'><span class='cursor' name='subTab' menuName='a_InventoryList' id='" + val.BarcodeId + "'>" + (val.Barcode == null ? "" : val.Barcode + "_") + (val.Name == null ? "" : val.Name) + (val.Description == null ? "" : "_" + val.Description) + (val.ItemCode == null ? "" : "_" + val.ItemCode) + "</span></td>" + "<td name='Color' width='10%'><div id='Color'>" + (val.Color == null ? "" : val.Color) + "</div></td>" + "<td name='Size' width='10%'><div id='Size'>" + (val.Size == null ? "" : val.Size) + "</div></td>" + "<td name='Quantity' width='7%'><div id='Quantity'>" + (val.Quantity == null ? "" : val.Quantity) + "  " + (val.UnitType == null ? "" : val.UnitType) + "</div></td>" + "<td name='Price' width='10%'><div id='Price'>" + (val.Price == null ? "" : val.Price) + "</div></td>" + "<td name='TotalPrice' width='10%'><div id='TotalPrice'>" + val.Quantity * val.Price + "</div></td>" + "<td name='Serial' width='10%'><div id='Serial'>" + (val.Serial == null ? "" : val.Serial) + "</div></td>" + "<td name='Broken' width='16%'><div id='Broken'><input type='text' class='inputText inputW50' id='txt_m_QuantityReturn'  value='" + (val.Quantity == null ? "" : val.Quantity) + "'/>" + "<input type='checkbox' id='CheckboxBroken_" + val.OrderDetailId + "' /><label for='CheckboxBroken_" + val.OrderDetailId + "' style='width:50px; font-size:x-small; margin-left:2px;'>خراب</label>" + "<input type='checkbox' id='CheckboxReturn_" + val.OrderDetailId + "' /><label for='CheckboxReturn_" + val.OrderDetailId + "' style='width:50px;font-size:x-small;'>مرجوع</label></div></td>" + "<td id='delete' width='10%'><div class='unit' id='" + val.OrderDetailId + "' ><button id='btn_edit' >ویرایش</button><button id='btn_delete'  >حذف</button></div></td></tr>" } $con.find("#DetailListInvoice").html(ItemList).parent().tableScroll({ height: 380, width: 980, flush: false }); $con.find("[name=subTab]").unbind().click(function () { var e = $(this); createSubTab({ name: e.attr("menuName"), tabName: e.html(), id: e.attr("id") }) }); $con.find("[id=btn_delete]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) RemoveItemDetailInvoice($(this).parent().prop("id"), container); else return }); $con.find("[id=btn_edit]").button({ icons: { primary: "ui-icon-pencil" }, text: false }).click(function () { ClickDetailInvoice($(this).parents("tr").first(), container); $(this).parent("div").addClass("invisible") }); $con.find("[id=btn_Return]").unbind("click").click(function () { AddReturnInvoice(container) }).button(); $con.dialog({ width: 1e3 }) }, error: function (e) { alert(e.responseText) } }) } function ClickDetailInvoice(e, t) { var n = $("#" + t); onRowClick(e); trid = e.prop("id"); if (e.hasClass("rowOnClick") && e.find("input:text").length < 2) { e.find("td[name=Color]").append("<select   id='ddl_m_Color_" + trid + "' disabled='disabled' class='inputDiv selectSmall required validate-address' ></select>"); e.find("div[id=Color]").addClass("invisible"); e.find("td[name=Size]").append("<select   id='ddl_m_Size_" + trid + "' disabled='disabled' class='inputDiv selectSmall required validate-address' ></select>"); e.find("div[id=Size]").addClass("invisible"); e.find("td[name=Quantity]").append("<input type='text' class='inputText inputW50 ' value='" + e.find("div[id=Quantity]").html().split(" ")[0] + "'/><Label id='Label'>" + e.find("div[id=Quantity]").html().split(" ")[1] + "</Label>"); e.find("div[id=Quantity]").addClass("invisible"); e.find("td[name=Price]").append("<input type='text' class='inputText inputW50 ' value='" + e.find("div[id=Price]").html() + "'/>"); e.find("div[id=Price]").addClass("invisible"); e.find("td[name=TotalPrice]").append("<input type='text' class='inputText inputW50 ' value='" + e.find("div[id=TotalPrice]").html() + "'/>"); e.find("div[id=TotalPrice]").addClass("invisible"); e.find("td[name=Serial]").append("<input type='text' class='inputText inputW50 ' value='" + e.find("div[id=Serial]").html() + "'/>"); e.find("div[id=Serial]").addClass("invisible"); e.find("div[id=delete]").addClass("invisible"); e.find("td[id=delete]").append("<div id='Edit'><a id='Edit_Button' href='#'>بروز </a></div>"); e.find("div[id=Broken]").addClass("invisible"); e.find("td[name=Quantity] input,td[name=Price] input").change(function () { SumPriceDetail(e) }); e.find("[id=Edit_Button]").click(function () { EditDetailInvoice(e, t) }).button(); bindItemsForSelectCombo({ methodname: "GetColorListForEdit", servicename: "Management", id: "ddl_m_Color_" + trid, container: trid, headertext: " رنگ", setcolor: true }, { barcodeid: e.find("td[name=name]").prop("id"), orderDetailid: trid.replace("tr", "") }); e.find("#ddl_m_Color_" + trid).change(function () { SelectColorForOrderEdit(trid, e.find("td[name=name]").prop("id")) }); ajDropDown.done(function () { if (e.find("#ddl_m_Color_" + trid + " option").length < 1) bindItemsForSelectCombo({ methodname: "GetSizeListByBarcodeIdColorIdForEdit", servicename: "Management", id: "ddl_m_Size_" + trid, container: trid, headertext: " جزئیات" }, { barcodeid: e.find("td[name=name]").prop("id"), orderDetailid: trid.replace("tr", ""), colorid: "" }) }); $.each(n.find("tr[id*=tr]"), function () { if (!$(this).hasClass("rowOnClick")) { $(this).find("input:text[id!=txt_m_QuantityReturn]").remove(); $(this).find("select").remove(); $(this).find("Label[id=Label]").remove(); $(this).find("#Edit").remove(); $(this).find("div[id=Broken]").removeClass("invisible"); $(this).find("div").removeClass("invisible") } }) } else { e.find("input:text[id!=txt_m_QuantityReturn]").remove(); e.find("select").remove(); e.find("Label[id=Label]").remove(); e.find("#Edit").remove(); e.find("div").removeClass("invisible") } } function SumPriceDetail(e) { e.find("td[name=TotalPrice] input").val(e.find("td[name=Quantity] input").val() * e.find("td[name=Price] input").val()) } function SelectColorForOrderEdit(e, t) { bindItemsForSelectCombo({ methodname: "GetSizeListByBarcodeIdColorIdForEdit", servicename: "Management", id: "ddl_m_Size_" + e, container: e, headertext: " جزئیات" }, { barcodeid: t, orderDetailid: e.replace("tr", ""), colorid: $("#" + e).find("#ddl_m_Color_" + e).val() }) } function EditDetailInvoice(e, t) { var n = $("#" + t); $.ajax({ type: "POST", url: "Management/EditDetailInvoice", contentType: "application/json; charset=utf-8", data: "{OrderDetailId: '" + e.prop("id").replace("tr", "") + "',ColorId: '" + (e.find("td[name=Color] select").val() != null ? e.find("td[name=Color] select").val() : "") + "',SizeId: '" + (e.find("td[name=Size] select").val() != null ? e.find("td[name=Size] select").val() : "") + "',Quantity: '" + e.find("td[name=Quantity] input").val() + "',Amount: '" + e.find("td[name=Price] input").val() + "',Serial: '" + e.find("td[name=Serial] input").val() + "'}", success: function (e) { if (!isAuthenticated(e)) return; SelectDetailInvoice(e.orderHeaderId, t) } }) } function AddReturnInvoice(e) { var t = []; var n = true; $.each($("#" + e).find("tr[id*=tr]"), function () { var e = {}; if (($(this).find("input[id*=CheckboxReturn_]").prop("checked") || $(this).find("input[id*=CheckboxBroken_]").prop("checked")) && $(this).find("#txt_m_QuantityReturn").val() != "" && $(this).find("#txt_m_QuantityReturn").val() != "0") { e["orderDetailId"] = this.id.replace("tr", ""); e["isBroken"] = $(this).find("input[id*=CheckboxBroken_]").prop("checked"); e["quantity"] = $(this).find("#txt_m_QuantityReturn").val(); t.push(e); n = false } }); if (n) { alert("ابتدا تعداد کالا را نوشته، گزینه مرجوعی یا خراب را تیک زده سپس 'ثبت مرجوعی' را کلیک کنید."); return } DTO = { returnItems: t, shopId: $("#userDefault").find("#ddl_s_Branch").val(), counterId: $("#userDefault").find("#ddl_m_Counter").val(), date: $("#userDefault").find("#txt_s_Date").val() }, $.ajax({ type: "POST", url: "Management/ReturnOrder", contentType: "application/json; charset=utf-8", data: JSON.stringify(DTO), success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function RemoveItemDetailInvoice(e, t) { var n = $("#" + t); $.ajax({ type: "POST", url: "Management/DeleteDetailInvoice", contentType: "application/json; charset=utf-8", data: "{id: '" + e + "'}", success: function (t) { if (!isAuthenticated(t)) return; translate(t.msg); if (t.isdone) n.find("#tr" + e).remove() }, error: function (e) { alert(e.responseText) } }) } function loadSupplierWholesaleOrder(e, t, n) { loadOrder(e, t, GetItemOrderWholesale, true, false, n) } function loadCustomerWholesaleOrder(e, t, n) { loadOrder(e, t, GetItemOrderWholesale, true, true, n) } function AddOrderWholesale(e, t) { var n = $("#" + t); var r = []; var i = {}; $.each($("#" + t).find("tr[id*=tr]"), function () { var e = {}; e["barcodeid"] = this.id.split("_")[2]; var t = $(this); var n = []; $(this).find("input[name=quantity]").each(function () { if (this.value != "") { var e = {}; var r = {}; e = this.id.split("-"); r["colorid"] = e[0]; r["sizeid"] = e[1]; r["quantity"] = parseFloat(this.value * (t.find("[id*=ddl_m_measureunit]").val() != null ? t.find("[id*=ddl_m_measureunit]").val().split("_")[0] : 1)).toFixed(2); n.push(r) } }); if ($(this).find("#txt_m_TotalQuantity").val() == "0" || $(this).find("#txt_m_TotalQuantity").val() == undefined) return; e["quantity"] = $(this).find("#txt_m_TotalQuantity").val(); e["price"] = $(this).find("#txt_m_Price").val(); e["description"] = ""; e["serial"] = ""; e["broken"] = false; e["itemDetails"] = n; r.push(e) }); i["shopid"] = $("#userDefault").find("#ddl_s_Branch").val(); i["currenyid"] = $("#userDefault").find("#ddl_m_Currency").val(); i["date"] = $("#userDefault").find("#txt_s_Date").val(); i["totalamount"] = n.find("#txt_m_TotalPrice").val().replace(/,/g, ""); i["description"] = n.find("#txt_m_Description").val(); i["invoicenumber"] = n.find("#txt_m_InvoiceNumber").val(); i["PaymentAmount"] = n.find("#txt_m_PaymentAmount").val().replace(/,/g, ""); i["customerid"] = e; i["issell"] = !n.find("#cb_d_Sale" + t).prop("checked"); i["ispreorder"] = n.find("#cb_d_PreOrder" + t).prop("checked"); if (r != "") { var s = { header: i, itemDetails: r, counterId: $("#userDefault").find("#ddl_m_Counter").val(), vat: n.find("#txt_vat").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(s), type: "Post", url: "Management/AddOrderWholeSale", success: function (e) { if (!isAuthenticated(e)) return; if (e.alert != undefined) { SetInvoiceData(t, e); translate(e.alert); if (e.InvoiceNO != undefined) { n.find("#OrderList").html(""); n.find("#btn_Print").removeClass("invisible"); n.find("#btn_AddOrder").addClass("invisible"); n.find("#txt_m_InvoiceNumber").val(e.InvoiceNO) } } else translate(e) }, error: function (e) { alert(e.responseText) } }) } } function GetItemOrderWholesale($dis, container, barcode) { if (barcode == undefined) { var b = $dis.closest("tr").attr("id"); barcode = b.substring(2, b.length) } var $con = $("#" + container.replace("dialog", "")); var ItemList = ""; $.ajax({ type: "POST", data: "{barcode: '" + barcode + "'}", url: "Management/GetProduct", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; $con.find("#txt_s_ProductBarcode").val(""); if (response.length < 1) return; var count = $con.find("tr[id*='tr_" + container + "']").length; var List = typeof response == "string" ? eval("(" + response + ")") : response; var ItemList = ""; var val = List[0, 0]; var trid = "tr_" + container + "_" + val.barcodeid + "_" + count; ItemList += "<tr id='" + trid + "'>" + "<td width='3%' id='rownumber'></td>" + "<td width='11%'><a href='javascript:showQuantity(\"" + container + '","' + val.barcode + "\");'>" + val.name + " " + val.code + " " + val.barcode + "</a></td>" + "<td id='mesureunit' width='8%'>" + " <select   id='ddl_m_measureunit_" + trid + "' disabled='disabled' class='select95'></select>" + "</td>" + "<td id='Div_Product_Quantity_" + trid + "' width='43%' dir='rtl'></td>" + "<td width='11%'><input type='text'  class=' inputText inputW100 fontSize15' id='txt_m_Price' value='" + val.price + "'/></td>" + "<td width='6%'><input type='text'  class=' inputText inputW50 fontSize15' id='txt_m_TotalQuantity'  disabled='disabled' value='0'/></td>" + "<td width='13%'><input type='text'  class=' inputText inputW136 fontSize15 digit' id='txt_m_TotalItemPrice' disabled='disabled' /></td>" + "<td width='5%' id='delete'><button name='btn_Delete' >حذف</button></td></tr>"; $con.find("#OrderList").append(ItemList).parent().tableScroll({ height: 380, width: contentwidth, flush: false }); $con.find("#btn_Print").addClass("invisible"); $con.find("#btn_AddOrder").removeClass("invisible"); $con.find("[name=btn_Delete]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).unbind().click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) RemoveItemOrderElementWholesale($(this).parents("tr").attr("id"), container); else return }); if ($con.find("#wholeOrderList").html() == "") { $("#" + container).find("#Footer").addClass("invisible"); $("#" + container).find("#header").addClass("invisible") } else { $("#" + container).find("#Footer").removeClass("invisible"); $("#" + container).find("#header").removeClass("invisible") } var rownumber = 0; $.each($("#" + container).find("#OrderList").find("tr[id*=tr_]"), function () { rownumber++; $(this).find("[id=rownumber]").html(rownumber) }); $con.find("[id=txt_m_Price]").spinner({ step: 1e3, change: function () { SumWholesale(container) }, stop: function () { SumWholesale(container) } }); $("#" + trid).find("#txt_m_Price").bind("keydown", function (e) { if (e.keyCode == 40) { $("#" + trid).next().find("#txt_m_Price").focus().focus(function () { this.select() }) } if (e.keyCode == 38) { $("#" + trid).prev().find("#txt_m_Price").focus().focus(function () { this.select() }) } }); bindComboData({ id: "ddl_m_measureunit_" + trid, container: trid, isMeasureUnit: true }, val.measureUnits); $("#ddl_m_measureunit_" + trid).change(function () { SumWholesale(container) }); buildColorSizeTable(barcode, $("#userDefault").find("#ddl_s_Branch").val(), false, "GetItemDetailsByBarcodeAndShopIDNoQuantity", "Div_Product_Quantity_" + trid, trid); $con.find("#Footer").removeClass("invisible") }, error: function (e) { alert(e.responseText) } }) } function RemoveItemOrderElementWholesale(e, t) { $("#" + e).remove(); SumWholesale(e.split("_")[1]) } function getBarcodeListOrder(e, t) { var n = $("#" + e); var r = $("#" + t.container + e); var i = n.find("#txt_s_ProductBarcode").val(); if (i != "" && i != undefined) { t.fname(null, e, i); return } if (t.page_index > 0) { t.first = false } var s = { sort: sortid, barcode: n.find("#txt_s_ProductBarcode").val() == undefined ? "" : n.find("#txt_s_ProductBarcode").val(), name: n.find("#txt_s_ProductCode").val() == undefined ? "" : n.find("#txt_s_ProductCode").val(), code: "", price: "", categoryid: getHierarchySelectedValue("hr_s_Category", e), status: n.find("#ddl_m_Availability").val() == undefined ? "" : n.find("#ddl_m_Availability").val(), quantityfrom: "", quantityto: "", regdatefrom: "", regdateto: "", shopid: $("#userDefault").find("#ddl_s_Branch").val(), showOnline: n.find("#ddl_s_ShowOnline").val() == undefined ? "" : n.find("#ddl_s_ShowOnline").val(), selectData: "GetItemsList" }; t["DTO"] = s; pageselectCallback(0, t, { container: "dialog", fname: t.fname, pagingContainer: e, first: true, isOrder: true, isChangeQuantity: true }) } function buildBarcodeListOrder(jq, pageoption) { var $con = $("#" + pageoption.container); jq = jq.results; var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "category", width: "12%" }); lsth.push({ title: "itemName", sort: "Name", width: "35%" }); lsth.push({ title: "itemCode", sort: "ItemCode", width: "14%" }); lsth.push({ title: "count", sort: "Quantity", width: "10%" }); lsth.push({ title: "price", sort: "Regular", width: "15%" }); lsth.push({ title: "barcode", sort: "Barcode", width: "14%" }); var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; trBody[0] = { trId: val.BarcodeId }; trBody[1] = { html: val.Category, width: "12%" }; trBody[2] = { name: "name", html: val.Name, width: "35%" }; trBody[3] = { name: "code", html: val.ItemCode, width: "14%" }; trBody[4] = { name: "quantity", html: val.Quantity + " " + val.UnitType, width: "10%" }; trBody[5] = { html: val.Regular, props: { name: "price", klass: "digit", width: "15%"} }; trBody[6] = { name: "barcode", html: val.Barcode, width: "14%" }; lstb.push(trBody) } details = { rowClick: pageoption.fname }; table = { header: lsth, body: lstb, details: details, heigth: 300, width: 620, container: pageoption.container + pageoption.pagingContainer, divName: "BarcodeList", rowClickParams: { fname: GetItemOrder} }; buildTable(table) } function SelectBarcodeWholesale(e, t, n) { n.fname($(e).find("td[name=barcode]").html(), t) } function SumWholesale(e) { var t = 0; var n = $("#" + e); var r = 0; $.each(n.find("tr[id*=tr]"), function () { $(this).find("#txt_m_TotalQuantity").val(getTotalQuantity($(this).find("td[id*=Div_Product_Quantity_]").prop("id"), $(this).prop("id")) * ($(this).find("[id*=ddl_m_measureunit]").val() != null ? $(this).find("[id*=ddl_m_measureunit]").val().split("_")[0] : 1)); var e = $(this).find("#txt_m_TotalQuantity").val() * $(this).find("#txt_m_Price").val(); $(this).find("#txt_m_TotalItemPrice").val(e); $(this).find("#txt_m_TotalItemPrice").attr("price", e); t += $(this).find("#txt_m_TotalItemPrice").attr("price") * 1; r++; $(this).find("[id=rownumber]").html(r) }); if (r <= 0) { $("#" + e).find("#Footer").addClass("invisible"); $("#" + e).find("#header").addClass("invisible") } else { $("#" + e).find("#Footer").removeClass("invisible"); $("#" + e).find("#header").removeClass("invisible") } n.find("#txt_m_TotalPrice").val(t); if (!$.browser.msie) { $(".digit").digits() } } function loadAccountDetails(e, t, n) { AccountDetails(e, t) } function AccountDetails(e, t) { var n = $("#" + t); n.find("#clearSale").html("خرید خالص"); n.find("#clearAmount").html("مبلغ برداشتی خالص"); n.find("#countSale").html("تعداد خرید"); n.find("#sumSale").html("جمع خرید"); n.find("#btnNewVoucher").button().unbind("click").click(function () { AddVoucher(e, t) }); DTO = { shopid: $("#userDefault").find("#ddl_s_Branch").val(), Scoup: "", clientid: e, employeeid: "", dateFrom: "", dateTo: "", isSale: "", clientCode: "" }; $.ajax({ type: "POST", url: "Management/GetAccountDetailsShop", contentType: "application/json; charset=utf-8", data: JSON.stringify(DTO), success: function (e) { if (!isAuthenticated(e)) return; n.find("#txt_d_Sale").val(e.BuyAmount * 1 - e.SellAmount * 1); n.find("#txt_d_PaymentSale").val(e.ReceivedCash * 1 + e.ReceivedCheque * 1 + e.ReceivedVoucher * 1 - (e.PaidCash * 1 + e.PaidCheque * 1 + e.paidVoucher * 1)); n.find("#txt_d_BalanceTotal").val(e.BuyAmount * 1 - e.SellAmount * 1 - (e.ReceivedCash * 1 + e.ReceivedCheque * 1 + e.ReceivedVoucher * 1 - (e.PaidCash * 1 + e.PaidCheque * 1 + e.paidVoucher * 1))); n.find("#txt_d_SaleTotal").val(e.BuyAmount); n.find("#txt_d_Return").val(e.SellAmount); n.find("#txt_d_TotalPayment").val(e.PaidCash * 1 + e.PaidCheque * 1 + e.paidVoucher * 1); n.find("#txt_d_TotalReceive").val(e.ReceivedCash * 1 + e.ReceivedCheque * 1 + e.ReceivedVoucher * 1); n.find("#txt_d_ChequePeyment").val(e.PaidCheque); n.find("#txt_d_ChequeReceive").val(e.ReceivedCheque); n.find("#txt_d_CashPayment").val(e.PaidCash); n.find("#txt_d_CashReceive").val(e.ReceivedCash); n.find("#txt_d_TotalOff").val(e.OffSale * 1 - e.BuyAmount * 1); n.find("#txt_d_BuyQuantity").val(e.BuyQuantity); n.find("#txt_d_SellQuantity").val(e.SellQuantity); n.find("#txt_d_NetQuantity").val(e.BuyQuantity * 1 - e.SellQuantity * 1) }, error: function (e) { alert(e.responseText) } }) } function loadAccountDetailsSupplier(e, t, n) { AccountDetailsSupplier(e, t) } function AccountDetailsSupplier(e, t) { var n = $("#" + t); DTO = { shopid: $("#userDefault").find("#ddl_s_Branch").val(), Scoup: "", clientid: e, employeeid: "", dateFrom: "", dateTo: "", isSale: "", clientCode: "" }; $.ajax({ type: "POST", url: "Management/GetAccountDetailsShop", contentType: "application/json; charset=utf-8", data: JSON.stringify(DTO), success: function (e) { if (!isAuthenticated(e)) return; n.find("#txt_d_Sale").val(e.SellAmount * 1 - e.BuyAmount * 1); n.find("#txt_d_PaymentSale").val(e.PaidCash * 1 + e.PaidCheque * 1 + e.paidVoucher * 1 - (e.ReceivedCash * 1 + e.ReceivedCheque * 1 + e.ReceivedVoucher * 1)); n.find("#txt_d_BalanceTotal").val(e.SellAmount * 1 - e.BuyAmount * 1 - (e.PaidCash * 1 + e.PaidCheque * 1 + e.paidVoucher * 1 - (e.ReceivedCash * 1 + e.ReceivedCheque * 1 + e.ReceivedVoucher * 1))); n.find("#txt_d_SaleTotal").val(e.SellAmount); n.find("#txt_d_Return").val(e.BuyAmount); n.find("#txt_d_TotalPayment").val(e.PaidCash * 1 + e.PaidCheque * 1 + e.paidVoucher * 1); n.find("#txt_d_TotalReceive").val(e.ReceivedCash * 1 + e.ReceivedCheque * 1 + e.ReceivedVoucher * 1); n.find("#txt_d_ChequePeyment").val(e.PaidCheque); n.find("#txt_d_ChequeReceive").val(e.ReceivedCheque); n.find("#txt_d_CashPayment").val(e.PaidCash); n.find("#txt_d_CashReceive").val(e.ReceivedCash); n.find("#txt_d_TotalOff").val(e.OffBuy * 1 - e.SellAmount * 1); n.find("#txt_d_profit").val(e.profit); n.find("#txt_d_BuyQuantity").val(e.BuyQuantity); n.find("#txt_d_SellQuantity").val(e.SellQuantity); n.find("#txt_d_NetQuantity").val(e.BuyQuantity * 1 - e.SellQuantity * 1) }, error: function (e) { alert(e.responseText) } }) } function loadAllListSMS(e, t) { sortid = "Date Desc"; if (t) { var n = $("#" + e); getSMSList({ container: e }); n.find("#txt_s_SendDateFrom").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { n.find("#txt_s_SendDateTo").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); bindItemsForSelectCombo({ servicename: "Management", methodname: "GetSmsTitles", headertext: "انتخاب موضوع", id: "ddl_s_Title", container: e }); aComplete({ methodname: "GetCompletionListByCustomerName", servicename: "Management", id: "txt_customerSms", container: e, minlength: 2, autofocus: false, limit: 20, boxId: "txt_customerSms", fname: customerOnSelect }); n.find("#txt_s_SendDateTo").datepicker({ changeMonth: true, changeYear: true }); n.find("#div_customerSms").removeClass("invisible"); n.find("#PageSize").off().on("change", function () { getSMSList({ container: e }) }); n.find("#btn_Search").button({ icons: { primary: "ui-icon-search"} }).unbind("click").click(function () { getSMSList({ container: e }) }); n.find("#btn_checkStatus").button().unbind("click").click(function () { checkSmsStatus({ container: e }) }); n.find("#btn_resendSms").button().unbind("click").click(function () { resendSms(e) }) } } function loadListSMS(e, t, n) { sortid = "Date Desc"; if (n) { var r = $("#" + t); getSMSList({ container: t, id: e }); r.find("#txt_s_SendDateFrom").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { r.find("#txt_s_SendDateTo").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); bindItemsForSelectCombo({ servicename: "Management", methodname: "GetSmsTitles", headertext: "انتخاب موضوع", id: "ddl_s_Title", container: t }); r.find("#div_customerSms").addClass("invisible"); r.find("#txt_s_SendDateTo").datepicker({ changeMonth: true, changeYear: true }); r.find("#btn_resendSms").button().unbind("click").click(function () { resendSms(t) }); r.find("#PageSize").off().on("change", function () { getSMSList({ container: t, id: e }) }); r.find("#btn_Search").button({ icons: { primary: "ui-icon-search"} }).unbind("click").click(function () { getSMSList({ container: t, id: e }) }); r.find("#btn_checkStatus").button().unbind("click").click(function () { checkSmsStatus({ container: t, id: e }) }) } } function resendSms(e) { var t = $("#" + e); var n = []; t.find("#SMSList").find("input:checkbox").each(function () { if (this.checked == true) n.push($(this).parents("tr").attr("id").replace("tr", "")) }); var r = { messageId: n }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(r), type: "Post", url: "Management/ResendSms", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function getSMSList(e) { var t = $("#" + e.container); var n = true; var r = t.find("#PageSize").val(); var i = 0; var s = 0; var o = { skip: i, take: r, currentPage: s, first: n, sort: sortid, id: e.id != undefined ? e.id : "", title: t.find("#ddl_s_Title").val(), body: t.find("#txt_s_Body").val(), datefrom: t.find("#txt_s_SendDateFrom").val(), dateto: t.find("#txt_s_SendDateTo").val(), status: t.find("#txt_smsStatus").val(), mobile: t.find("#txt_mobileSms").val(), customerCode: t.find("#txt_customerSms").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(o), type: "Post", url: "Management/GetListSMS", success: function (r) { if (!isAuthenticated(r)) return; var i = getSMSListgetOptionsFrom(r.count, e); t.find("#paging").pagination(r.count, i); getSMSListpageselectCallback(0, r, e, n) }, error: function (e) { alert(e.responseText) } }) } function checkSmsStatus(e) { var t = $("#" + e.container); var n = { id: e.id != undefined ? e.id : "", title: t.find("#ddl_s_Title").val(), body: t.find("#txt_s_Body").val(), datefrom: t.find("#txt_s_SendDateFrom").val(), dateto: t.find("#txt_s_SendDateTo").val(), status: t.find("#txt_smsStatus").val(), mobile: t.find("#txt_mobileSms").val(), customerCode: t.find("#txt_customerSms").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(n), type: "Post", url: "Management/CheckSmsStatus", success: function (t) { if (!isAuthenticated(t)) return; getSMSList({ container: e.container, id: e.id }) }, error: function (e) { alert(e.responseText) } }) } function getSMSListgetOptionsFrom(e, t) { var n = $("#" + t.container); var r = { callback: getSMSListpageselectCallback }; n.find("input:text").each(function () { r[this.name] = this.className.match(/numeric/) ? parseInt(this.value) : this.value }); r.prev_show_always = false; r.next_show_always = false; if (e < n.find("#PageSize").val()) n.find("#PageSize").css("display", "none"); else { n.find("#PageSize").css("display", "inline") } r.items_per_page = n.find("#PageSize").val(); r.prev_text = "قبلی"; r.next_text = "بعدی"; r.container = t; return r } function buildgetSMSList(jq, pageoption) { var $con = $("#" + pageoption.container); jq = jq.results; var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; if (List != null) { for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<tr id='tr" + val.MessageId + "'>" + "<td width='10%' date='" + val.Date + "' class='dateLong'></td>" + "<td width='10%'>" + val.Title + "</td>" + "<td width='25%'>" + val.Body + "</td>" + "<td width='5%'>" + val.Length + "</td>" + "<td width='10%'>" + val.Number + "</td>" + "<td width='10%'>" + val.Name + " " + val.Family + "</td>" + "<td width='10%'>" + val.cName + " " + val.cFamily + "</td>" + "<td width='15%' style='background-color:" + (val.Status == "SentToMobile" ? "#B9F43E" : "#ED6912") + ";'><span>" + val.Status + "</span></td>" + "<td width='5%'><input type='checkbox' name='selectsms'></input></td>" + "</tr>" } } $con.find("#SMSList").html(ItemList).parent().tableScroll({ height: 380, width: contentwidth, flush: false }) } function getSMSListpageselectCallback(e, t, n, r) { var i = $("#" + n.container); if (r) { buildgetSMSList(t, n) } else { r = false; var s = i.find("#PageSize").val(); var o = ""; var u = s; var a = e == 0 ? 0 : e * u; var f = { skip: a, take: u, currentPage: e, first: r, sort: sortid, id: n.id != undefined ? n.id : "", title: i.find("#ddl_s_Title").val(), body: i.find("#txt_s_Body").val(), datefrom: i.find("#txt_s_SendDateFrom").val(), dateto: i.find("#txt_s_SendDateTo").val(), status: i.find("#txt_smsStatus").val(), mobile: i.find("#txt_mobileSms").val(), customerCode: i.find("#txt_customerSms").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(f), type: "Post", url: "Management/GetListSMS", success: function (e) { if (!isAuthenticated(e)) return; buildgetSMSList(e, n) }, error: function (e) { alert(e.responseText) } }); return false } Sort(getSMSList, n) } function loadSellChart(e, t) { if (t) { loadChart(t, e, true, { onLoad: true }) } } function loadBuyChart(e, t) { if (t) { loadChart(t, e, false, { onLoad: true }) } } function loadCustomerChart(e, t, n) { var r = $("#" + t); if (n) { r.find("#hd_d_PersonId").val(e); loadChart(n, t, true, { onLoad: true }) } } function loadChart(e, t, n, r) { function l(e, t) { var n = $("#" + e); var r = "", i = "", s = "", o = "", u = "", a = "", f = "", l = "", c = ""; var h = "", p = "", d = ""; if (n.find("#moreFilter").is(":visible")) { var v = n.find("#ddl_d_SearchBy1").val(); if (v != "") { if (v == "Code") { i = n.find("#txtSearch1").val() } if (v == "Name") { r = n.find("#txtSearch1").val() } if (v == "EmployeeId") { s = n.find("#txtSearch1").val() } if (v == "EmployeeName") { o = n.find("#txtSearch1").val() } if (v == "Shop") { u = n.find("#txtSearch1").val() } } var v = n.find("#ddl_d_SearchBy2").val(); if (v != "") { if (v == "InvoiceId") { a = n.find("#txtSearch2").val() } if (v == "ProductId") { f = n.find("#txtSearch2").val() } if (v == "ProductName") { l = n.find("#txtSearch2").val() } if (v == "Barcode") { c = n.find("#txtSearch2").val() } } h = n.find("#txt_s_PriceFrom").val(); p = n.find("#txt_s_PriceTo").val(); d = getHierarchySelectedValue("hr_s_Category", e) } var m = ""; if (n.find("#Checkbox1" + e).prop("checked") && n.find("#Checkbox2" + e).prop("checked")) m = ""; else if (!n.find("#Checkbox1" + e).prop("checked") && n.find("#Checkbox2" + e).prop("checked")) m = false; else if (n.find("#Checkbox1" + e).prop("checked") && !n.find("#Checkbox2" + e).prop("checked")) m = true; var g = { Datetype: n.find("#ddl_d_GroupBy").val(), supplierid: n.find("#hd_d_PersonId").val(), IsClient: t, SupplierName: r, code: i, EmployeeId: s, EmployeeName: o, Shop: u, InvoiceId: a, ProductId: f, ProductName: l, Barcode: c, InvoiceDateStart: n.find("#txt_s_InvoiceMonthStart").val() + "/" + n.find("#txt_s_InvoiceDayStart").val(), InvoiceDateEnd: n.find("#txt_s_InvoiceMonthEnd").val() + "/" + n.find("#txt_s_InvoiceDayEnd").val(), InvoiceYearStart: n.find("#txt_s_InvoiceYearStart").val(), InvoiceYearEnd: n.find("#txt_s_InvoiceYearEnd").val(), PriceFrom: h, PriceTo: p, Order: m, PreOrder: n.find("#Checkbox3" + e).length > 0 ? n.find("#Checkbox3" + e).prop("checked") : "", Broken: n.find("#Checkbox4" + e).length > 0 ? n.find("#Checkbox4" + e).prop("checked") : "", CategoryId: d, shopid: $("#userDefault").find("#ddl_s_Branch").val(), counterid: $("#userDefault").find("#ddl_m_Counter").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(g), type: "Post", url: "Management/GetSaleChart", success: function (e) { var t = [7, 6, 9, 14, 18, 21, 25, 26, 23, 18, 13, 9]; if (!isAuthenticated(e)) return; if (e != null) { var r = n.find("#ddl_d_DisplayBy").val(); var i = "right"; var s = []; var o = []; var u = []; var a = []; if (e.name == "Month") o = PERSIAN_MONTHS; else if (e.name == "Season") o = ["بهار", "تابستان", "پاییز", "زمستان"]; $.each(e.data, function () { u.push(this.amount); if (e.name != "Month" && e.name != "Season" && e.name != "Week" && e.name != "Day") { o.push(this.name) } if (e.name == "Year") { o = this.name } a.push(this.quantity); var t = { name: this.name + " مبلغ", type: "column", data: this.amount }; var r = { name: this.name + " تعداد", type: "spline", yAxis: 1, data: this.quantity }; if (n.find("#ddl_d_DisplayBy").val() == "Amount") s.push(t); else if (n.find("#ddl_d_DisplayBy").val() == "Count") s.push(r); else { s.push(t); s.push(r) } }); if (s.length > 0) { n.find("#Div_SaleChart").highcharts({ title: { text: " ", x: -20 }, credits: { enabled: false }, colors: ["#058DC7", "#50B432", "#ED561B", "#DDDF00", "#24CBE5", "#64E572", "#FF9655", "#FFF263", "#6AF9C4"], chart: { backgroundColor: { linearGradient: { x1: 0, y1: 0, x2: 1, y2: 1 }, stops: [[0, "rgb(255, 255, 255)"], [1, "rgb(240, 240, 255)"]] }, plotBackgroundColor: "rgba(255, 255, 255, .9)", plotShadow: true, plotBorderWidth: 1 }, yAxis: [{ labels: { style: { color: "#89A54E"} }, title: { text: "مبلغ", style: { color: "#89A54E"}} }, { title: { text: "تعداد", style: { color: "#4572A7"} }, labels: { style: { color: "#4572A7"} }, opposite: true}], xAxis: { categories: o, labels: { rotation: -35, align: "right", style: { fontSize: "13px", fontFamily: "Verdana, sans-serif"}} }, series: s }) } else { $.plot(n.find("#Div_SaleChart"), [[0, 0]], { xaxis: { tickDecimals: "number" }, yaxes: [{ min: 0 }, { alignTicksWithAxis: i == "right" ? 1 : null, position: i}], legend: { position: "sw"} }) } } else { $.plot(n.find("#Div_SaleChart"), [[0, 0]], { bars: { show: false, barWidth: .5 }, xaxis: { tickDecimals: "number"} }) } }, error: function (e) { alert(e.responseText) } }); return false } var i = $("#" + t); if (e) { i.find("#moreFilter").slideUp("fast"); i.find(".toggle-more-filters").click(function () { $(this).toggleClass("open"); i.find("#moreFilter").slideToggle(function () { }) }); ChangeCheckBoxGroupName("Check", t); var s = " <option value=''>روز </option>", o = "<option value=''>ماه </option>", u = " <option value=''>سال </option>"; var a = new Date; a = a.getFullYear() * 1 - 621 + 1; for (var f = 1; f < 32; f++) { s += " <option value='" + f + "'>" + f + "</option>"; if (f < 13) o += " <option value='" + f + "'>" + f + "</option>" } for (var f = 1388; f < a; f++) { u += " <option value='" + f + "'>" + f + "</option>" } i.find("#txt_s_InvoiceDayStart").html(s); i.find("#txt_s_InvoiceDayStart").val("1"); i.find("#txt_s_InvoiceMonthStart").html(o); i.find("#txt_s_InvoiceMonthStart").val("1"); i.find("#txt_s_InvoiceYearStart").html(u); i.find("#txt_s_InvoiceYearStart").val("1388"); i.find("#txt_s_InvoiceDayEnd").html(s); i.find("#txt_s_InvoiceDayEnd").val("29"); i.find("#txt_s_InvoiceMonthEnd").html(o); i.find("#txt_s_InvoiceMonthEnd").val("12"); i.find("#txt_s_InvoiceYearEnd").html(u); i.find("#txt_s_InvoiceYearEnd").val(a * 1 - 1); i.find("#ddl_d_GroupBy").val("Month"); bindHierarchyData({ id: "hr_s_Category", table: "category", container: t }); i.find("#btnSearch").button({ icons: { primary: "ui-icon-search"} }).unbind("click").click(function () { l(t, n) }); if (r.onLoad) { l(t, n) } } } function GetSMSLenght(e) { var t = $("#" + e); var n = 0; t.find("#txt_m_Body li").each(function () { if ($(this).attr("char") != undefined && $(this).attr("char") != "") n += $(this).attr("char") * 1; else n += $(this).find("a").html().length * 1 + 1 }); t.find("#txt_m_Page").val(parseInt(parseInt(n) / 70) + 1); t.find("#txt_m_Count").val(Math.abs(70 - n % 70)) } function sendEmailSms(e) { var t = $("#" + e); t.find("#moreFilter").slideUp("fast"); t.find(".toggle-more-filters").click(function () { $(this).toggleClass("open"); t.find("#moreFilter").slideToggle(function () { }) }); bindXmlDropDownData({ id: "ddl_s_Title", container: e, path: "Customer/smsTitle", canmodify: true, headertext: "انتخاب موضوع", async: false, css: "selectsmall1 required validate" }); $container = t.find("#CustomerForSMSContent"); bindHierarchyData({ id: "divCustomerForSMSAddress", container: e, table: "address" }); bindHierarchyData({ id: "div_Category", container: e, table: "Category" }); t.find("#SearchBy").val("Name"); t.find("#SendAll").button({ icons: { primary: "ui-icon-disk"} }); t.find("#SendSelected").button({ icons: { primary: "ui-icon-disk"} }); t.find("#txt_m_Body").keydown(function () { GetSMSLenght(e) }); t.find("#ddl_TitleSMS").html(t.find("#ddl_s_Title select").html()); t.find("#txt_LastDateSMSFrom").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, n) { t.find("#txt_LastDateSMSTo").datepicker("option", "minDate", new JalaliDate(n["selectedYear"], n["selectedMonth"], n["selectedDay"])) } }); t.find("#txt_LastDateSMSTo").datepicker({ changeMonth: true, changeYear: true }); t.find("#txt_s_PaymenytLastFrom").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, n) { t.find("#txt_s_PaymenytLastTo").datepicker("option", "minDate", new JalaliDate(n["selectedYear"], n["selectedMonth"], n["selectedDay"])) } }); t.find("#txt_s_PaymenytLastTo").datepicker({ changeMonth: true, changeYear: true }); t.find("#CustomerForSMSSearchRegDateStart").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, n) { t.find("#CustomerForSMSSearchRegDateEnd").datepicker("option", "minDate", new JalaliDate(n["selectedYear"], n["selectedMonth"], n["selectedDay"])) } }); t.find("#CustomerForSMSSearchRegDateEnd").datepicker({ changeMonth: true, changeYear: true }); t.find("#txt_s_BuytLastFrom").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, n) { t.find("#txt_s_BuytLastTo").datepicker("option", "minDate", new JalaliDate(n["selectedYear"], n["selectedMonth"], n["selectedDay"])) } }); t.find("#txt_s_BuytLastTo").datepicker({ changeMonth: true, changeYear: true }); t.find("#divdialogCustomerForSMS").dialog({ autoOpen: false }).dialog({ width: 600 }); t.find("#PageSize").off().on("change", function () { getCustomerForSMSList({ container: e }) }); t.find("#divslider").unbind("click").click(function () { sliderClick("divCustomerForSMSsearch"); sliderClick("moreFilter") }); t.find("#CustomerForSMSAdvanceSearchbt").button({ icons: { primary: "ui-icon-search"} }).unbind("click").click(function () { sortid = "AccountId desc"; getCustomerForSMSList({ container: e }) }); t.find("#ddl_s_Shop").html($("#ddl_s_Branch").html()).val(""); var n = ""; t.find("#txt_m_Body").sortable(); t.find("#btn_editContent").button({ text: false, icons: { primary: "ui-icon-refresh"} }).click(function () { t.find("#btn_editContent").addClass("invisible"); n.html(t.find("#txt_content").val()); GetSMSLenght(e) }); bindItemsForSelectCombo({ async: false, methodname: "getEmployees", servicename: "Management", id: "ddl_registerer", container: e, headertext: "انتخاب کارمند", selectedindex: 0 }); t.find("#btn_regDate, #btn_address, #btn_product, #btn_shop, #btn_category, #btn_subject, #btn_registerer," + " #btn_lastSentDate, #lastBuyDate").button({ text: false, icons: { primary: "ui-icon-circle-check"} }).click(function () { var e; if ($(this).text().indexOf("شامل") != "-1") { e = { label: "به جز", icons: { primary: "ui-icon-circle-minus"} }; $(this).parent().removeClass("frog").addClass("red") } else { e = { label: "شامل", icons: { primary: "ui-icon-circle-check"} }; $(this).parent().removeClass("red").addClass("frog") } $(this).button("option", e) }).parent().addClass("frog") } function loadSendEmail(e, t) { if (t) { sendEmailSms(e); $con = $("#" + e); $con.find("#SendAll").unbind("click").click(function () { if (validateAll($("#divSmsSubject"))) if (confirm("Are you Sure?!")) { SendEmailForAll({ container: e }) } }); $con.find("#SendSelected").unbind("click").click(function () { if (validateAll($("#divSmsSubject"))) if (confirm("Are you Sure?!")) { SendEmailForSelected(e) } }); $con.find("#emailBody").html("<textarea class='editor' name='text1'>" + "</textarea>"); $(".editor").tinymce({ script_url: "jscripts/tiny_mce/tiny_mce.js", width: "100%", height: "500px", directionality: "rtl", theme: "advanced", verify_html: false, plugins: "pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template,wordcount,advlist,autosave", theme_advanced_buttons1: "save,newdocument,|,bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,styleselect,formatselect,fontselect,fontsizeselect", theme_advanced_buttons2: "cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,image,cleanup,help,code,|,insertdate,inserttime,preview,|,forecolor,backcolor", theme_advanced_buttons3: "tablecontrols,|,hr,removeformat,visualaid,|,sub,sup,|,charmap,emotions,iespell,media,advhr,|,print,|,ltr,rtl,|,fullscreen", theme_advanced_buttons4: "insertlayer,moveforward,movebackward,absolute,|,styleprops,|,cite,abbr,acronym,del,ins,attribs,|,visualchars,nonbreaking,template,pagebreak,restoredraft,codehighlighting,netadvimage", theme_advanced_toolbar_location: "top", theme_advanced_toolbar_align: "right", theme_advanced_statusbar_location: "bottom", theme_advanced_resizing: false, content_css: "../../Scripts/tinymce/css/content.css", convert_urls: false }); $con.find("#ulSmsItems li,#li_text").bind("click", function () { $con.find("[name=text1]").append("<span>%" + $(this).attr("name") + "%</span>"); if ($(this).attr("id") == "li_text") { $con.find("#txt_m_Body").append("<li style='margin:3px;' name='" + $(this).attr("name") + "' class='ui-state-default ui-corner-top' ><a name='content' href='#' class='ui-tabs-anchor' >" + $con.find("#txt_content").val() + "</a> <span name='smsItems' class='ui-icon ui-icon-close'>Remove Tab</span></li>"); $con.find("#txt_m_Body").find("a[name='content']").unbind("click").click(function () { selectedTxt = SelectContent(this, e); $con.find("#btn_editContent").removeClass("invisible") }) } else $con.find("#txt_m_Body").append("<li style='margin:5px;' char='" + $(this).attr("char") + "' name='" + $(this).attr("name") + "' class='ui-state-default ui-corner-top' ><a href='#' class='ui-tabs-anchor' >" + $(this).find("a").html() + "</a> <span name='smsItems' class='ui-icon ui-icon-close'>Remove Tab</span></li>"); $con.find("span[name='smsItems']").off().on("click", function () { $(this).parent("li").remove(); GetSMSLenght(e) }) }).attr("style", "margin:3px;") } } function loadSendSMS(e, t) { if (t) { sendEmailSms(e); var n = $("#" + e); n.find("#SendAll").unbind("click").click(function () { if (validateAll($("#divSmsSubject"))) if (confirm("Are you Sure?!")) { SendMessageForAll({ container: e }) } }); n.find("#SendSelected").unbind("click").click(function () { if (validateAll($("#divSmsSubject"))) if (confirm("Are you Sure?!")) { SendMessageForSelected(e) } }); n.find("#btn_showCredit").button().unbind("click").click(function () { getCredit() }); n.find("#ulSmsItems li,#li_text").draggable({ cursor: "move", revert: true }).attr("style", "margin:3px;"); n.find("#txt_m_Body").droppable({ accept: $("#ulSmsItems li,#li_text"), drop: function (t, r) { if (r.draggable.attr("id") == "li_text") { n.find("#txt_m_Body").append("<li style='margin:3px;' name='" + r.draggable.attr("name") + "' class='ui-state-default ui-corner-top' ><a name='content' href='#' class='ui-tabs-anchor' >" + n.find("#txt_content").val() + "</a> <span name='smsItems' class='ui-icon ui-icon-close'>Remove Tab</span></li>"); n.find("#txt_m_Body").find("a[name='content']").unbind("click").click(function () { selectedTxt = SelectContent(this, e); n.find("#btn_editContent").removeClass("invisible") }) } else n.find("#txt_m_Body").append("<li style='margin:5px;' char='" + r.draggable.attr("char") + "' name='" + r.draggable.attr("name") + "' class='ui-state-default ui-corner-top' ><a href='#' class='ui-tabs-anchor' >" + r.draggable.find("a").html() + "</a> <span name='smsItems' class='ui-icon ui-icon-close'>Remove Tab</span></li>"); GetSMSLenght(e); n.find("span[name='smsItems']").off().on("click", function () { $(this).parent("li").remove(); GetSMSLenght(e) }) } }) } } function getCredit() { $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", type: "Post", url: "Management/GetCredit", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function SelectContent(e, t) { $con = $("#" + t); $dis = $(e); $con.find("#txt_content").val($dis.html()); return $dis } function getCustomerForSMSList(e) { var t = $("#" + e.container); var n = true; var r = t.find("#PageSize").val(); var i = 0; var s = 0; var o = "", u = "", a = "", f = "", l = "", c = "", h = "", p = "", d = "", v = ""; var m = t.find("#SearchBy").val(); if (m == "Code") { o = t.find("#CustomerForSMStxtSearch").val() } else if (m == "Email") { v = t.find("#CustomerForSMStxtSearch").val() } else if (m == "Name") { u = t.find("#CustomerForSMStxtSearch").val() } else if (m == "RegName") { a = t.find("#CustomerForSMStxtSearch").val() } else if (m == "IntroducerName") { f = t.find("#CustomerForSMStxtSearch").val() } else if (m == "Mobile") { l = t.find("#CustomerForSMStxtSearch").val() } else if (m == "Phone") { c = t.find("#CustomerForSMStxtSearch").val() } var g = t.find("#ddl_d_SearchByProduct").val(); if (g == "Barcode") { h = t.find("#txt_s_Product").val() } else if (g == "Name") { p = t.find("#txt_s_Product").val() } else if (g == "Code") { d = t.find("#txt_s_Product").val() } var y = { skip: i, take: r, currentPage: s, first: n, sort: t.find("#ddl_s_Sort").val() + " " + t.find("#ddl_s_Sorting").val(), code: o, namefamily: u, introducer: f, registerername: a, Mobile: l, Phone: c, agefrom: t.find("#CustomerForSMSSearchAgeStart").val(), ageto: t.find("#CustomerForSMSSearchAgeEnd").val(), regdatefrom: t.find("#CustomerForSMSSearchRegDateStart").val(), regdateto: t.find("#CustomerForSMSSearchRegDateEnd").val(), gender: t.find("#ddl_s_Gender").val(), shopId: t.find("#ddl_s_Shop").val(), LastDateSMSFrom: t.find("#txt_LastDateSMSFrom").val(), LastDateSMSTo: t.find("#txt_LastDateSMSTo").val(), subjectsms: t.find("#ddl_TitleSMS").val(), AddressId: getHierarchySelectedValue("divCustomerForSMSAddress", e.container), barcode: h, productname: p, productcode: d, categoryid: getHierarchySelectedValue("div_Category", e.container), PaymenytLastFrom: t.find("#txt_s_PaymenytLastFrom").val(), PaymenytLastTo: t.find("#txt_s_PaymenytLastTo").val(), PaymentAmountFrom: t.find("#txt_s_PaymentAmountFrom").val(), PaymentAmountTo: t.find("#txt_s_PaymentAmountTo").val(), BuyAmountFrom: t.find("#txt_s_BuyAmountFrom").val(), BuyAmountTo: t.find("#txt_s_BuyAmountTo").val(), BuyIntroducerFrom: t.find("#txt_s_BuyIntroducerFrom").val(), BuyIntroducerTo: t.find("#txt_s_BuyIntroducerTo").val(), DebtFrom: t.find("#txt_s_DebtFrom").val(), DebtTo: t.find("#txt_s_DebtTo").val(), VocherBuyFrom: t.find("#txt_s_VocherBuyFrom").val(), VocherBuyTo: t.find("#txt_s_VocherBuyTo").val(), ChequeNotFrom: t.find("#txt_s_ChequeNotFrom").val(), ChequeNotTo: t.find("#txt_s_ChequeNotTo").val(), BuyLastFrom: t.find("#txt_s_BuytLastFrom").val(), BuyLastTo: t.find("#txt_s_BuytLastTo").val(), regDate: t.find("#btn_regDate").text().indexOf("شامل") != "-1" ? true : false, address: t.find("#btn_address").text().indexOf("شامل") != "-1" ? true : false, product: t.find("#btn_product").text().indexOf("شامل") != "-1" ? true : false, shop: t.find("#btn_shop").text().indexOf("شامل") != "-1" ? true : false, category: t.find("#btn_category").text().indexOf("شامل") != "-1" ? true : false, subject: t.find("#btn_subject").text().indexOf("شامل") != "-1" ? true : false, registerer: t.find("#btn_registerer").text().indexOf("شامل") != "-1" ? true : false, lastSentDate: t.find("#btn_lastSentDate").text().indexOf("شامل") != "-1" ? true : false, lastBuy: t.find("#lastBuyDate").text().indexOf("شامل") != "-1" ? true : false, registererId: t.find("#ddl_registerer").val(), email: v }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(y), type: "Post", url: "Management/GetCustomerForSMSList", success: function (r) { if (!isAuthenticated(r)) return; var i = CustomerForSMSgetOptionsFrom(r.count, e); t.find("#paging").pagination(r.count, i); CustomerForSMSpageselectCallback(0, r, e, n) }, error: function (e) { alert(e.responseText) } }) } function CustomerForSMSgetOptionsFrom(e, t) { var n = $("#" + t.container); var r = { callback: CustomerForSMSpageselectCallback }; n.find("input:text").each(function () { r[this.name] = this.className.match(/numeric/) ? parseInt(this.value) : this.value }); r.prev_show_always = false; r.next_show_always = false; if (e < n.find("#PageSize").val()) n.find("#PageSize").css("display", "none"); else { n.find("#PageSize").css("display", "inline") } r.items_per_page = n.find("#PageSize").val(); r.prev_text = "قبلی"; r.next_text = "بعدی"; r.container = t; return r } function buildCustomerForSMSList(jq, pageoption) { var $con = $("#" + pageoption.container); jq = jq.results; var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; var gender = val.Gender == true ? "آقای" : "خانم"; var introducerName = val.introducerName == null ? "" : val.introducerName; ItemList += "<tr id='tr" + val.AccountId + "'>" + "<td><ul class=''>" + "<li class='line formControl'>" + "<div class=' unit size1of5'>" + "<label class='labelPadding '>" + "مشتری  " + val.Code + " : </label><span class='cursor' name='subTab' menuName='a_CustomerList' id='" + val.AccountId + "'>" + gender + " " + val.Name + " " + val.Family + "</span> <input type='hidden' id='hd_customeramily' value='" + val.Family + "' />" + "</div>" + "<div class=' unit size1of5'>" + "<label > معرف " + (val.introducerCode == null ? "" : val.introducerCode) + " : </label><label class=''>" + (val.introducerId == null ? "" : "<span class='cursor' name='subTab' menuName='a_CustomerList' id='" + val.introducerId + "'>") + (val.introducerName == null ? "" : val.introducerName) + "  " + (val.introducerFamily == null ? "" : val.introducerFamily) + (val.introducerId == null ? "" : "</span>") + "</label>" + "</div>" + "<div class=' unit size1of6'>" + "<label > ثبت نام کننده : </label><label >" + (val.regFamily != null ? val.regName + "  " + val.regFamily : "") + "</label>" + "</div>" + "<div class=' unit size1of7'>" + "<label >سن : </label><label >" + val.age + "</label>" + "</div>" + "<div class=' unit size1of7'>" + "<label >تاریخ ثبت نام : </label><label class=' label100'><span date='" + val.regdate + "' class='date'>" + val.regdate + "</span></label>" + "</div>" + "<div class=' unit size1of7'>" + (val.Email != null ? "<input type='checkbox' id='email" + val.AccountId + "' name='email' email='" + val.Email + "' /><label name='email' for='email" + val.AccountId + "'>" + val.Email + "</label>" : "") + "</div>" + "</li><br/>" + "<li class='line formControl''>" + "<div class=' unit size1of6'>" + "<label class='labelPadding'>خرید خالص : </label><label><span class='digit'>" + val.NetBuy + "</span> تومان</label>" + "</div>" + "<div class=' unit size1of6'>" + "<label >پرداختی خالص : </label><label><span class='digit'>" + val.NetPayment + "</span> تومان</label>" + "</div>" + "<div class=' unit size1of6'>" + "<label>چکهای پرداختی : </label><label><span class='digit'>" + val.ReceivedCheque + "</span> تومان</label>" + "</div>" + "<div class=' unit size1of6'>" + "<label>چکهای پاس نشده : </label><label><span class='digit'>" + val.ChequeNotPassed + "</span> تومان</label>" + "</div>" + "<div class=' unit size1of6'>" + "<label >بدهی کل : </label><label><span class='digit'>" + (val.NetBuy * 1 - val.NetPayment * 1) + "</span> تومان</label>" + "</div>" + "<div class=' unit size1of6'><label class='unit label15'>همراه :</label><ul class=' unit '> "; for (var j = 0; j < val.Mobile.length; j++) { var num = val.Mobile[0, j]; ItemList += "<li>" + "<input type='checkbox' name='mobileNum' id='cb_d_Mobile_" + num + "' ><label name='CellNumber' for='cb_d_Mobile_" + num + "'>" + num + "</label>" + "</li>" } ItemList += "</ul></div></li><br/>" + "<li class='line formControl''>" + "<div class=' unit size1of6'>" + "<label>موجودی کارت خرید : </label><label><span class='digit'>" + val.VoucherPower + "</span> تومان</label>" + "</div>" + "<div class=' unit size1of6'>" + "<label>پرداختی کارت خرید : </label><label><span class='digit'>" + (val.paidVoucher * 1 - val.ReceivedVoucher * 1) + "</span> تومان</label>" + "</div>" + "<div class=' unit size1of6'>" + "<label class='labelPadding'>آخرین خرید : </label><label>" + (val.LastBuy != null ? "<span class='date' date='" + val.LastBuy + "'>" + val.LastBuy + "</span>" : "") + "</label>" + "</div>" + "<div class=' unit size1of6'>" + "<label >آخرین برداشت  : </label><label>" + (val.LastPayment != null ? "<span class='date' date='" + val.LastPayment + "'>" + val.LastPayment + "</span>" : "") + "</label>" + "</div>" + "<div class=' unit size1of6'>" + "<label> خرید معرفی شده ها : </label><label><span class='digit'>" + val.BuyIntroducer + "</span> تومان</label>" + "</div>" + "<div class=' unit size1of6'>" + "<label>  واریزی معرفی شده ها : </label><label><span class='digit'>" + val.PaymentIntroducer + "</span> تومان</label>" + "</div>" + "</li>" + "</ul></td></tr>" } $con.find("#CustomerForSMSList").html(ItemList).parent().tableScroll({ height: 380, width: contentwidth, flush: false }); $con.find("input[name='mobileNum']").button(); $con.find("input[name='email']").button(); $con.find("tr[id*=tr]").dblclick(function () { }); $con.find("[name=subTab]").unbind().click(function () { var e = $(this); createSubTab({ name: e.attr("menuName"), tabName: e.html(), id: e.attr("id") }) }); if (pageoption.container == "divdialogCustomerForSMS") $con.dialog("open") } function CustomerForSMSpageselectCallback(e, t, n, r) { var i = $("#" + n.container); if (r) { buildCustomerForSMSList(t, n) } else { r = false; var s = i.find("#PageSize").val(); var o = ""; var u = s; var a = e == 0 ? 0 : e * u; var f = "", l = "", c = "", h = "", p = "", d = "", v = "", m = "", g = "", y = ""; var b = i.find("#SearchBy").val(); if (b == "Code") { f = i.find("#CustomerForSMStxtSearch").val() } else if (b == "Name") { l = i.find("#CustomerForSMStxtSearch").val() } else if (b == "Email") { y = i.find("#CustomerForSMStxtSearch").val() } else if (b == "RegName") { c = i.find("#CustomerForSMStxtSearch").val() } else if (b == "IntroducerName") { h = i.find("#CustomerForSMStxtSearch").val() } else if (b == "Mobile") { p = i.find("#CustomerForSMStxtSearch").val() } else if (b == "Phone") { d = i.find("#CustomerForSMStxtSearch").val() } var w = i.find("#ddl_d_SearchByProduct").val(); if (w == "Barcode") { v = i.find("#txt_s_Product").val() } else if (w == "Name") { m = i.find("#txt_s_Product").val() } else if (w == "Code") { g = i.find("#txt_s_Product").val() } var E = { skip: a, take: u, currentPage: e, first: r, sort: i.find("#ddl_s_Sort").val() + " " + i.find("#ddl_s_Sorting").val(), code: f, namefamily: l, introducer: h, registerername: c, Mobile: p, Phone: d, agefrom: i.find("#CustomerForSMSSearchAgeStart").val(), ageto: i.find("#CustomerForSMSSearchAgeEnd").val(), regdatefrom: i.find("#CustomerForSMSSearchRegDateStart").val(), regdateto: i.find("#CustomerForSMSSearchRegDateEnd").val(), gender: i.find("#ddl_s_Gender").val(), shopId: i.find("#ddl_s_Shop").val(), LastDateSMSFrom: i.find("#txt_LastDateSMSFrom").val(), LastDateSMSTo: i.find("#txt_LastDateSMSTo").val(), subjectsms: i.find("#ddl_TitleSMS").val(), AddressId: getHierarchySelectedValue("divCustomerForSMSAddress", n.container), barcode: v, productname: m, productcode: g, categoryid: getHierarchySelectedValue("div_Category", n.container), PaymenytLastFrom: i.find("#txt_s_PaymenytLastFrom").val(), PaymenytLastTo: i.find("#txt_s_PaymenytLastTo").val(), PaymentAmountFrom: i.find("#txt_s_PaymentAmountFrom").val(), PaymentAmountTo: i.find("#txt_s_PaymentAmountTo").val(), BuyAmountFrom: i.find("#txt_s_BuyAmountFrom").val(), BuyAmountTo: i.find("#txt_s_BuyAmountTo").val(), BuyIntroducerFrom: i.find("#txt_s_BuyIntroducerFrom").val(), BuyIntroducerTo: i.find("#txt_s_BuyIntroducerTo").val(), DebtFrom: i.find("#txt_s_DebtFrom").val(), DebtTo: i.find("#txt_s_DebtTo").val(), VocherBuyFrom: i.find("#txt_s_VocherBuyFrom").val(), VocherBuyTo: i.find("#txt_s_VocherBuyTo").val(), ChequeNotFrom: i.find("#txt_s_ChequeNotFrom").val(), ChequeNotTo: i.find("#txt_s_ChequeNotTo").val(), BuyLastFrom: i.find("#txt_s_BuytLastFrom").val(), BuyLastTo: i.find("#txt_s_BuytLastTo").val(), regDate: i.find("#btn_regDate").text().indexOf("شامل") != "-1" ? true : false, address: i.find("#btn_address").text().indexOf("شامل") != "-1" ? true : false, product: i.find("#btn_product").text().indexOf("شامل") != "-1" ? true : false, shop: i.find("#btn_shop").text().indexOf("شامل") != "-1" ? true : false, category: i.find("#btn_category").text().indexOf("شامل") != "-1" ? true : false, subject: i.find("#btn_subject").text().indexOf("شامل") != "-1" ? true : false, registerer: i.find("#btn_registerer").text().indexOf("شامل") != "-1" ? true : false, lastSentDate: i.find("#btn_lastSentDate").text().indexOf("شامل") != "-1" ? true : false, lastBuy: i.find("#lastBuyDate").text().indexOf("شامل") != "-1" ? true : false, registererId: i.find("#ddl_registerer").val(), email: y }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(E), type: "Post", url: "Management/GetCustomerForSMSList", success: function (e) { if (!isAuthenticated(e)) return; buildCustomerForSMSList(e, n) }, error: function (e) { alert(e.responseText) } }); return false } Sort(getCustomerForSMSList, n) } function SendMessageForSelected(e) { var t = $("#" + e); var n = []; var r = ""; t.find("ul[id*=txt_m_Body] li").each(function () { if ($(this).attr("name") == "name") r += "<%name%>"; else if ($(this).attr("name") == "family") r += "<%family%>"; else if ($(this).attr("name") == "amount") r += "<%amount%>"; else if ($(this).attr("name") == "voucherAmount") r += "<%voucherAmount%>"; else if ($(this).attr("name") == "text") r += $(this).find("a[name=content]").html(); else if ($(this).attr("name") == "title") r += "<%title%>" }); if ($(this).find("input[id*='cb_d_Mobile_']:checked").length > 0) { t.find("tr[id*=tr]").each(function () { var e = {}; var t = []; $(this).find("input[id*='cb_d_Mobile_']:checked").each(function () { if (!$(this).attr("checked")) t.push($(this).prop("id").split("_")[3]) }); e["listNumber"] = t; e["personid"] = $(this).prop("id").replace("tr", ""); e["family"] = $(this).find("label[name='Customername']").prop("id"); e["sex"] = $(this).find("label[name='Customername']").html().split(" ")[0]; n.push(e) }) } else { t.find("tr[id*=tr]").each(function () { var e = {}; var t = []; $(this).find("input[id*='cb_d_Mobile_']").each(function () { if (!$(this).prop("checked")) t.push($(this).prop("id").split("_")[3]) }); if (t.length > 0) { e["listNumber"] = t; e["personid"] = $(this).prop("id").replace("tr", ""); e["family"] = $(this).find("[id='hd_customeramily']").val(); e["sex"] = $(this).find("span[id='" + e["personid"] + "']").html().split(" ")[0]; n.push(e) } }) } if (n.length == 0) { translate("selectCustomers"); return } var i = { header: n, messageBody: r, messageHeader: "", Setname: false, title: t.find("#ddl_s_Title select").val(), paging: t.find("#txt_m_Page").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(i), type: "Post", url: "Management/SendSMSForSelected", success: function (e) { if (!isAuthenticated(e)) return; translate(e) }, error: function (e) { alert(e.responseText) } }); return false } function SendMessageForAll(e) { var t = $("#" + e.container); if (t.find("#CustomerForSMSList").html() == "") { translate("selectCustomers"); return } var n = true; var r = t.find("#PageSize").val(); var i = 0; var s = 0; var o = "", u = "", a = "", f = "", l = "", c = "", h = "", p = "", d = "", v = "", m = ""; t.find("ul[id*=txt_m_Body] li").each(function () { if ($(this).prop("name") == "name") m += "<%name%>"; else if ($(this).attr("name") == "family") m += "<%family%>"; else if ($(this).attr("name") == "amount") m += "<%amount%>"; else if ($(this).attr("name") == "voucherAmount") m += "<%voucherAmount%>"; else if ($(this).attr("name") == "text") m += $(this).find("a[name=content]").html(); else if ($(this).attr("name") == "title") m += "<%title%>" }); var g = t.find("#SearchBy").val(); if (g == "Code") { o = t.find("#CustomerForSMStxtSearch").val() } else if (g == "Name") { u = t.find("#CustomerForSMStxtSearch").val() } else if (g == "Email") { d = t.find("#CustomerForSMStxtSearch").val() } else if (g == "RegName") { a = t.find("#CustomerForSMStxtSearch").val() } else if (g == "IntroducerName") { f = t.find("#CustomerForSMStxtSearch").val() } else if (g == "Mobile") { l = t.find("#CustomerForSMStxtSearch").val() } else if (g == "Phone") { c = t.find("#CustomerForSMStxtSearch").val() } var y = t.find("#ddl_d_SearchByProduct").val(); if (g == "Barcode") { h = t.find("#txt_s_Product").val() } else if (y == "Name") { p = t.find("#txt_s_Product").val() } else if (y == "Code") { v = t.find("#txt_s_Product").val() } var b = { skip: i, take: r, currentPage: s, first: n, sort: t.find("#ddl_s_Sort").val() + " " + t.find("#ddl_s_Sorting").val(), code: o, namefamily: u, introducer: f, registerername: a, Mobile: l, Phone: c, agefrom: t.find("#CustomerForSMSSearchAgeStart").val(), ageto: t.find("#CustomerForSMSSearchAgeEnd").val(), regdatefrom: t.find("#CustomerForSMSSearchRegDateStart").val(), regdateto: t.find("#CustomerForSMSSearchRegDateEnd").val(), gender: t.find("#ddl_s_Gender").val(), shopId: t.find("#ddl_s_Shop").val(), LastDateSMSFrom: t.find("#txt_LastDateSMSFrom").val(), LastDateSMSTo: t.find("#txt_LastDateSMSTo").val(), subjectsms: t.find("#ddl_TitleSMS").val(), AddressId: getHierarchySelectedValue("divCustomerForSMSAddress", e.container), barcode: h, productname: p, productcode: v, categoryid: getHierarchySelectedValue("div_Category", e.container), PaymenytLastFrom: t.find("#txt_s_PaymenytLastFrom").val(), PaymenytLastTo: t.find("#txt_s_PaymenytLastTo").val(), PaymentAmountFrom: t.find("#txt_s_PaymentAmountFrom").val(), PaymentAmountTo: t.find("#txt_s_PaymentAmountTo").val(), BuyAmountFrom: t.find("#txt_s_BuyAmountFrom").val(), BuyAmountTo: t.find("#txt_s_BuyAmountTo").val(), BuyIntroducerFrom: t.find("#txt_s_BuyIntroducerFrom").val(), BuyIntroducerTo: t.find("#txt_s_BuyIntroducerTo").val(), DebtFrom: t.find("#txt_s_DebtFrom").val(), DebtTo: t.find("#txt_s_DebtTo").val(), VocherBuyFrom: t.find("#txt_s_VocherBuyFrom").val(), VocherBuyTo: t.find("#txt_s_VocherBuyTo").val(), ChequeNotFrom: t.find("#txt_s_ChequeNotFrom").val(), ChequeNotTo: t.find("#txt_s_ChequeNotTo").val(), BuyLastFrom: t.find("#txt_s_BuytLastFrom").val(), BuyLastTo: t.find("#txt_s_BuytLastTo").val(), messageBody: m, messageHeader: "", Setname: false, title: t.find("#ddl_s_Title select").val(), paging: t.find("#txt_m_Page").val(), regDate: t.find("#btn_regDate").text().indexOf("شامل") != "-1" ? true : false, address: t.find("#btn_address").text().indexOf("شامل") != "-1" ? true : false, product: t.find("#btn_product").text().indexOf("شامل") != "-1" ? true : false, shop: t.find("#btn_shop").text().indexOf("شامل") != "-1" ? true : false, category: t.find("#btn_category").text().indexOf("شامل") != "-1" ? true : false, subject: t.find("#btn_subject").text().indexOf("شامل") != "-1" ? true : false, registerer: t.find("#btn_registerer").text().indexOf("شامل") != "-1" ? true : false, lastSentDate: t.find("#btn_lastSentDate").text().indexOf("شامل") != "-1" ? true : false, lastBuy: t.find("#lastBuyDate").text().indexOf("شامل") != "-1" ? true : false, registererId: t.find("#ddl_registerer").val(), email: d }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(b), type: "Post", url: "Management/SendSMSForAll", success: function (e) { if (!isAuthenticated(e)) return; translate(e) }, error: function (e) { alert(e.responseText) } }) } function SendEmailForSelected(e) { var t = $("#" + e); var n = []; var r = t.find("[name='text1']").val(); var i = ""; t.find("ul[id*=txt_m_Body] li").each(function () { if ($(this).attr("name") == "name") i += "<%name%>"; else if ($(this).attr("name") == "family") i += "<%family%>"; else if ($(this).attr("name") == "amount") i += "<%amount%>"; else if ($(this).attr("name") == "voucherAmount") i += "<%voucherAmount%>"; else if ($(this).attr("name") == "text") i += $(this).find("a[name=content]").html(); else if ($(this).attr("name") == "title") i += "<%title%>" }); if ($(this).find("input[name='email']:checked").length > 0) { t.find("tr[id*=tr]").each(function () { var e = {}; var t = []; $(this).find("input[id*='cb_d_Mobile_']:checked").each(function () { if (!$(this).attr("checked")) t.push($(this).prop("id").split("_")[3]) }); e["listNumber"] = t; e["personid"] = $(this).prop("id").replace("tr", ""); e["family"] = $(this).find("label[name='Customername']").prop("id"); e["sex"] = $(this).find("label[name='Customername']").html().split(" ")[0]; n.push(e) }) } else { t.find("tr[id*=tr]").each(function () { var e = {}; var t = []; $(this).find("input[name='email']").each(function () { if (!$(this).prop("checked")) t.push($(this).attr("email")) }); if (t.length > 0) { e["listNumber"] = t; e["personid"] = $(this).prop("id").replace("tr", ""); e["family"] = $(this).find("[id='hd_customeramily']").val(); e["sex"] = $(this).find("span[id='" + e["personid"] + "']").html().split(" ")[0]; n.push(e) } }) } if (n.length == 0) { translate("selectCustomers"); return } var s = { header: n, messageBody: r, messageHeader: i, Setname: false, title: t.find("#ddl_s_Title select").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(s), type: "Post", url: "Management/SendEmailForSelected", success: function (e) { if (!isAuthenticated(e)) return; translate(e) }, error: function (e) { alert(e.responseText) } }); return false } function SendEmailForAll(e) { var t = $("#" + e.container); if (t.find("#CustomerForSMSList").html() == "") { translate("selectCustomers"); return } var n = true; var r = t.find("#PageSize").val(); var i = 0; var s = 0; var o = "", u = "", a = "", f = "", l = "", c = "", h = "", p = "", d = "", v = "", m = ""; t.find("ul[id*=txt_m_Body] li").each(function () { if ($(this).prop("name") == "name") m += "<%name%>"; else if ($(this).attr("name") == "family") m += "<%family%>"; else if ($(this).attr("name") == "amount") m += "<%amount%>"; else if ($(this).attr("name") == "voucherAmount") m += "<%voucherAmount%>"; else if ($(this).attr("name") == "text") m += $(this).find("a[name=content]").html(); else if ($(this).attr("name") == "title") m += "<%title%>" }); var g = t.find("#SearchBy").val(); if (g == "Code") { o = t.find("#CustomerForSMStxtSearch").val() } else if (g == "Name") { u = t.find("#CustomerForSMStxtSearch").val() } else if (g == "RegName") { a = t.find("#CustomerForSMStxtSearch").val() } else if (g == "IntroducerName") { f = t.find("#CustomerForSMStxtSearch").val() } else if (g == "Mobile") { l = t.find("#CustomerForSMStxtSearch").val() } else if (g == "Phone") { c = t.find("#CustomerForSMStxtSearch").val() } var y = t.find("#ddl_d_SearchByProduct").val(); if (g == "Barcode") { h = t.find("#txt_s_Product").val() } else if (y == "Name") { p = t.find("#txt_s_Product").val() } else if (y == "Code") { v = t.find("#txt_s_Product").val() } else if (y == "Email") { d = t.find("#txt_s_Product").val() } var b = { skip: i, take: r, currentPage: s, first: n, sort: t.find("#ddl_s_Sort").val() + " " + t.find("#ddl_s_Sorting").val(), code: o, namefamily: u, introducer: f, registerername: a, Mobile: l, Phone: c, agefrom: t.find("#CustomerForSMSSearchAgeStart").val(), ageto: t.find("#CustomerForSMSSearchAgeEnd").val(), regdatefrom: t.find("#CustomerForSMSSearchRegDateStart").val(), regdateto: t.find("#CustomerForSMSSearchRegDateEnd").val(), gender: t.find("#ddl_s_Gender").val(), shopId: t.find("#ddl_s_Shop").val(), LastDateSMSFrom: t.find("#txt_LastDateSMSFrom").val(), LastDateSMSTo: t.find("#txt_LastDateSMSTo").val(), subjectsms: t.find("#ddl_TitleSMS").val(), AddressId: getHierarchySelectedValue("divCustomerForSMSAddress", e.container), barcode: h, productname: p, productcode: v, categoryid: getHierarchySelectedValue("div_Category", e.container), PaymenytLastFrom: t.find("#txt_s_PaymenytLastFrom").val(), PaymenytLastTo: t.find("#txt_s_PaymenytLastTo").val(), PaymentAmountFrom: t.find("#txt_s_PaymentAmountFrom").val(), PaymentAmountTo: t.find("#txt_s_PaymentAmountTo").val(), BuyAmountFrom: t.find("#txt_s_BuyAmountFrom").val(), BuyAmountTo: t.find("#txt_s_BuyAmountTo").val(), BuyIntroducerFrom: t.find("#txt_s_BuyIntroducerFrom").val(), BuyIntroducerTo: t.find("#txt_s_BuyIntroducerTo").val(), DebtFrom: t.find("#txt_s_DebtFrom").val(), DebtTo: t.find("#txt_s_DebtTo").val(), VocherBuyFrom: t.find("#txt_s_VocherBuyFrom").val(), VocherBuyTo: t.find("#txt_s_VocherBuyTo").val(), ChequeNotFrom: t.find("#txt_s_ChequeNotFrom").val(), ChequeNotTo: t.find("#txt_s_ChequeNotTo").val(), BuyLastFrom: t.find("#txt_s_BuytLastFrom").val(), BuyLastTo: t.find("#txt_s_BuytLastTo").val(), messageBody: m, messageHeader: "", Setname: false, title: t.find("#ddl_s_Title select").val(), paging: "", regDate: t.find("#btn_regDate").text().indexOf("شامل") != "-1" ? true : false, address: t.find("#btn_address").text().indexOf("شامل") != "-1" ? true : false, product: t.find("#btn_product").text().indexOf("شامل") != "-1" ? true : false, shop: t.find("#btn_shop").text().indexOf("شامل") != "-1" ? true : false, category: t.find("#btn_category").text().indexOf("شامل") != "-1" ? true : false, subject: t.find("#btn_subject").text().indexOf("شامل") != "-1" ? true : false, registerer: t.find("#btn_registerer").text().indexOf("شامل") != "-1" ? true : false, lastSentDate: t.find("#btn_lastSentDate").text().indexOf("شامل") != "-1" ? true : false, lastBuy: t.find("#lastBuyDate").text().indexOf("شامل") != "-1" ? true : false, registererId: t.find("#ddl_registerer").val(), email: d }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(b), type: "Post", url: "Management/SendEmailForAll", success: function (e) { if (!isAuthenticated(e)) return; translate(e) }, error: function (e) { alert(e.responseText) } }) } function loadAddApplication(e, t) { var n = $("#" + e); if (t) { n.find("#txt_dateStart").attr("id", e + "txt_dateStart"); n.find("#txt_expieryDate").attr("id", e + "txt_expieryDate"); n.find("#" + e + "txt_dateStart").datepicker({ changeMonth: true, changeYear: true, onClose: function () { validateAll($("#" + e)) }, onSelect: function (t, n) { $("#" + e + "txt_expieryDate").datepicker("option", "minDate", new JalaliDate(n["selectedYear"], n["selectedMonth"], n["selectedDay"])) } }); n.find("#" + e + "txt_expieryDate").datepicker({ changeMonth: true, changeYear: true, onClose: function () { validateAll($("#" + e)) } }); getAllRoles(e); n.find("#addApplication").button({ icons: { primary: "ui-icon-plus" }, text: true }).unbind("click").bind("click", function (t) { if (validateAll(n)) addApplication(e) }) } } function loadBuyApplication(e, t) { var n = $("#" + e); if (t) { localize(); n.find("#txt_expieryDate").datepicker({ changeMonth: true, changeYear: true }); n.find("#buyApplication").button({ icons: { primary: "ui-icon-plus" }, text: true }).unbind("click").bind("click", function (t) { if (validateAll(n)) buyApplication(e) }) } } function loadHelp(e, t) { var n = $("#" + e); if (t) { n.find(".editor").jqte() } } function getAllRoles(container) { var $con = $("#" + container); $.ajax({ type: "POST", url: "Management/getRoleParentAll", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; var role = typeof response == "string" ? eval("(" + response + ")") : response; var roleItem = ""; for (var j = 0; j < role.length; j++) { var val = role[0, j]; roleItem += " <h3><a href='#' >" + val.description + "</a></h3><div id='div_" + val.roleid + "'></div>" } $con.find("#divRolesAccordion").html(roleItem); $con.find("#divRolesAccordion").accordion({ heightStyle: "content", collapsible: true, active: false, activate: function (e, t) { if (t.newPanel.length > 0 && t.newPanel.html().length < 1) getallroleChild(t.newPanel.prop("id").replace("div_", ""), container) } }); $con.find("#roleList").html(roleItem).parent().tableScroll({ height: 380, width: contentwidth, flush: false }) }, error: function (e) { } }) } function getallroleChild(pid, container) { var $con = $("#" + container); $.ajax({ type: "POST", url: "Management/getRoleListAll", contentType: "application/json; charset=utf-8", data: "{parentid: '" + pid + "'}", success: function (response) { if (!isAuthenticated(response)) return; var role = typeof response == "string" ? eval("(" + response + ")") : response; var roleItem = ""; roleItem = "<div><table class='table line'>" + "<tbody id='roleList'>"; for (var j = 0; j < role.length; j++) { var val = role[0, j]; roleItem += "<tr>" + "<td id='" + container + "' ><input type='checkbox' " + "   /> </td> <td id='" + val.rolename + "' name='rolename'>" + val.description + "</td> </tr>" } roleItem += "</tbody></table></div>"; $con.find("#div_" + pid).html(roleItem); $con.find("#divRolesAccordion").accordion({ collapsible: true, heightStyle: "content" }) }, error: function (e) { } }) } function addApplication(e) { var t = $("#" + e); var n = []; t.find("#divRolesAccordion").find("input:checkbox").each(function () { if (this.checked == true) n.push($(this).parents("tr").find("[name=rolename]").attr("id")) }); var r = { username: t.find("#txt_appUser").val(), pass: t.find("#txt_appPass").val(), appName: t.find("#txt_appname").val(), branchlimit: t.find("#txt_shoplimit").val(), counterlimit: t.find("#txt_accountlimit").val(), employeelimit: t.find("#txt_employeelimit").val(), expierydate: t.find("#" + e + "txt_expieryDate").val(), roles: n, smscredit: t.find("#txt_smslimit").val(), smsnumber: t.find("#txt_smsNumber").val(), startdate: t.find("#" + e + "txt_dateStart").val() }; $.ajax({ type: "POST", url: "Management/AddUser", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e) } }) } function buyApplication(e) { var t = $("#" + e); var n = { userName: t.find("#txt_userName").val(), amount: t.find("#txt_amount").val(), branchLimit: t.find("#txt_branchLimit").val(), employeeLimit: t.find("#txt_employeeLimit").val(), extraBranchPrice: t.find("#txt_extraBranchPrice").val(), extraEmployeePrice: t.find("#txt_extraEmployeePrice").val(), membershipPrice: t.find("#txt_membershipPrice").val(), smsLimit: t.find("#txt_smsLimit").val(), smsRate: t.find("#txt_smsRate").val(), expieryDate: t.find("#txt_expieryDate").val(), name: t.find("#txt_name").val(), family: t.find("#txt_family").val(), email: t.find("#txt_email").val(), mobile: t.find("#txt_mobile").val(), password: t.find("#txt_password").val() }; $.ajax({ type: "POST", url: "Management/BuyApplication", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e) } }) } function loadApplicationList(e, t) { var n = $("#" + e); if (t) { getAcountList(e, { container: e, callbackmethod: getApplicationList, fname: "", page_index: 0, build: buildApplicationList, servicename: "Management", methodname: "GetApplicationList", print: true }); n.find("#btnRefreshApplist").button({ icons: { primary: "ui-icon-refresh" }, text: false }).unbind("click").bind("click", function (t) { getAcountList(e, { container: e, callbackmethod: getApplicationList, fname: "", page_index: 0, build: buildApplicationList, servicename: "Management", methodname: "GetApplicationList", print: true }) }) } } function buildApplicationList(jq, pageoption) { var $con = $("#" + pageoption.pagingContainer); jq = jq; var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "appName", sort: "AppName", width: "20%" }); lsth.push({ title: "shoplimit", sort: "shoplimit", width: "20%" }); lsth.push({ title: "dateStart", sort: "StartingDate", width: "20%" }); lsth.push({ title: "status", sort: "IsActive", width: "16%" }); lsth.push({ title: "expieryDate", sort: "ExpieryDate", width: "20%" }); lsth.push({ title: "deleteBtn", width: "4%" }); var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; trBody[0] = { trId: val.ApplicationId }; trBody[1] = { name: "appname", html: val.AppName, width: "20%" }; trBody[2] = { name: "shoplimit", html: val.ShopLimit, width: "20%" }; trBody[3] = { name: "datestart", html: val.StartingDate, props: { date: val.StartingDate, width: "20%", klass: "date"} }; trBody[4] = { name: "status", html: val.IsActive, width: "16%" }; trBody[5] = { name: "expierydate", html: val.ExpieryDate, props: { date: val.ExpieryDate, width: "20%", klass: "date"} }; lstb.push(trBody) } details = { deleteFunction: RemoveApplicationElement, rowClick: ClickApplicationList }; table = { header: lsth, body: lstb, details: details, heigth: 300, container: pageoption.pagingContainer, divName: "divApplicationList" }; buildTable(table) } function ClickApplicationList(e, t) { var n = $("#" + t); var r = e.attr("id").replace("tr", ""); if (r != undefined) createSubTab({ name: "a_ApplicationList", tabName: e.find("[name=appname]").html(), id: r }); else { createSubTab({ name: "a_ApplicationList", row: e }) } onRowClick(e) } function RemoveApplicationElement(e, t) { var n = $("#" + t); var r = { appId: e.attr("id").replace("tr", "") }; $.ajax({ type: "POST", url: "Management/", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (e) { }, error: function (e) { alert(e) } }) } function getApplicationList(e, t) { var n = $("#" + e); pageselectCallback(0, t, { container: "", fname: t.fname, pagingContainer: e, first: true, isOrder: true }) } function loadEditApplication(e, t, n) { if (n) { var r = $("#" + t); r.find("#txt_dateStart").datepicker({ changeMonth: true, changeYear: true, onClose: function () { validateAll($("#" + t)) } }); r.find("#txt_expieryDate").datepicker({ changeMonth: true, changeYear: true, onClose: function () { validateAll($("#" + t)) } }); getEditApplication(e, t); r.find("#addApplication").unbind().click(function () { editApplication(e, t) }).button({ icons: { primary: "ui-icon-disk" }, text: true }) } } function getEditApplication(e, t) { var n = $("#" + t); var r = { appId: e }; $.ajax({ type: "POST", url: "Management/GetApplicationDetails", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (e) { var t = e[0]; n.find("#txt_appname").val(t.AppName); n.find("#txt_shoplimit").val(t.ShopLimit); n.find("#txt_accountlimit").val(t.AccountLimit); n.find("#txt_employeelimit").val(t.EmployeeLimit); n.find("#ddl_status").val(t.IsActive); n.find("#txt_dateStart").val(t.StartingDate); n.find("#txt_expieryDate").val(t.ExpieryDate); n.find("#txt_smslimit").val(t.SmsCredit); n.find("#txt_smsNumber").val(t.SmsNumber) }, error: function (e) { alert(e) } }) } function editApplication(e, t) { var n = $("#" + t); var r = { appId: e, appName: n.find("#txt_appname").val(), shopLimit: n.find("#txt_shoplimit").val(), accountLimit: n.find("#txt_accountlimit").val(), employeeLimit: n.find("#txt_employeelimit").val(), status: n.find("#ddl_status").val(), dateStart: n.find("#txt_dateStart").val(), expieryDate: n.find("#txt_expieryDate").val(), smsLimit: n.find("#txt_smslimit").val(), smsNumber: n.find("#txt_smsNumber").val() }; $.ajax({ type: "POST", url: "Management/EditApplication", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e) } }) } function loadEditApplicationRoles(e, t, n) { if (n) { var r = $("#" + t); getrole(0, e, t) } } function loadSetting(e, t) { var n = $("#" + e); if (t) { GetSetting(e); n.find("#btnEditSetting").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (validateAll($("#" + e))) UpdateSetting(e) }) } } function GetSetting(e) { var t = $("#" + e); $.ajax({ type: "POST", url: "Management/GetSetting", contentType: "application/json; charset=utf-8", success: function (n) { if (!isAuthenticated(n)) return; if (n.isDone) { var r = n.result; bindItemsForSelectCombo({ methodname: "getEmployees", servicename: "Management", id: "ddl_m_Employee", container: e, headertext: "انتخاب کارمند", selectedvalue: r.EmployeeId }); bindItemsForSelectCombo({ servicename: "Management", methodname: "getCounterNameForUser", headertext: "انتخاب صندوق", id: "ddl_m_Counter", container: e, selectedvalue: r.CounterId }); bindItemsForSelectCombo({ methodname: "getFiscalPeriod", servicename: "Management", id: "ddl_FiscalPeriod", container: e, headertext: "انتخاب دوره مالی", selectedvalue: r.CurrentFiscalPeriodId }); t.find("#lbl_AppName").html(r.AppName); t.find("#lbl_StartingDate").html(r.StartingDate); t.find("#lbl_StartingDate").attr("date", r.StartingDate); t.find("#lbl_ExpieryDate").html(r.ExpieryDate); t.find("#lbl_ExpieryDate").attr("date", r.ExpieryDate); t.find("#lbl_ShopLimit").html(r.ShopLimit); t.find("#lbl_SmsCredit").html(r.SmsCredit); t.find("#txt_m_Host").val(r.Host); t.find("#txt_m_EmailPass").val(r.EmailPass); t.find("#ddl_m_Language").val(r.Language); t.find("#txt_m_PaymentPassword").val(r.PaymentPassword); t.find("#txt_m_PaymentUserName").val(r.PaymentUserName); t.find("#txt_m_Port").val(r.Port); t.find("#txt_m_Email").val(r.Email); t.find("#txt_m_SmsNumber").val(r.SmsNumber); t.find("#txt_m_SmsPass").val(r.SmsPass); t.find("#txt_Sms_SmsUser").val(r.SmsUser); t.find("#txt_m_TerminalId").val(r.TerminalId); t.find("#txt_m_OnlineHost").val(r.OnlineHost); t.find("#txt_m_DeliveryExpense").val(r.DeliveryExpense) } }, error: function (e) { alert(e.responseText) } }) } function UpdateSetting(e) { var t = $("#" + e); var n = { employeeId: t.find("#ddl_m_Employee").val(), counterId: t.find("#ddl_m_Counter").val(), host: t.find("#txt_m_Host").val(), emailPass: t.find("#txt_m_EmailPass").val(), language: t.find("#ddl_m_Language").val(), paymentPassword: t.find("#txt_m_PaymentPassword").val(), paymentUserName: t.find("#txt_m_PaymentUserName").val(), port: t.find("#txt_m_Port").val(), email: t.find("#txt_m_Email").val(), smsNumber: t.find("#txt_m_SmsNumber").val(), smsPass: t.find("#txt_m_SmsPass").val(), smsUser: t.find("#txt_Sms_SmsUser").val(), terminalId: t.find("#txt_m_TerminalId").val(), paymentUserName: t.find("#txt_m_PaymentUserName").val(), onlineHost: t.find("#txt_m_OnlineHost").val(), deliveryExpense: t.find("#txt_m_DeliveryExpense").val(), FiscalPeriodId: t.find("#ddl_FiscalPeriod").val() }; $.ajax({ type: "POST", url: "Management/UpdateSetting", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function loadNewSalary(e, t) { var n = $("#" + e); n.find("#dialogAddSalary").removeClass("invisible"); bindItemsForSelectCombo({ async: false, methodname: "getEmployees", servicename: "Management", id: "ddl_m_employee_add", container: e, headertext: "انتخاب کارمند" }); n.find("#btn_save").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (validateAll($("#" + e))) AddEmployeeSalary("dialogAddAccounting") }); n.find("#txt_m_fromDate_add").attr("id", e + "txt_m_fromDate_add"); n.find("#txt_m_toDate_add").attr("id", e + "txt_m_toDate_add"); n.find("#" + e + "txt_m_fromDate_add").datepicker({ changeMonth: true, changeYear: true, onClose: function () { validateAll($("#" + e)) }, onSelect: function (t, n) { $("#" + e + "txt_m_toDate_add").datepicker("option", "minDate", new JalaliDate(n["selectedYear"], n["selectedMonth"], n["selectedDay"])) } }); n.find("#" + e + "txt_m_toDate_add").datepicker({ changeMonth: true, changeYear: true, onClose: function () { validateAll($("#" + e)) } }) } function loadNewSocialSecurity(e, t) { var n = $("#" + e); n.find("#dialogAddSocial").removeClass("invisible"); bindItemsForSelectCombo({ async: false, methodname: "getEmployees", servicename: "Management", id: "ddl_social_employee_add", container: e, headertext: "انتخاب کارمند" }); bindXmlDropDownData({ async: false, id: "Month_Name_Add", container: e, path: "Counter/MonthTitle", canmodify: true, istext: false, headertext: "انتخاب ماه", css: "selectsmall required validate" }); n.find("#btn_save").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (validateAll(n)) AddSocialSecurity("dialogAddSocial") }) } function loadNewExpense(e, t) { var n = $("#" + e); n.find("#dialogAddExpense").removeClass("invisible"); bindHierarchyData({ id: "divExpenseCategoryAdd", container: "dialogAddExpense", table: "ExpenseCategory", canmodify: true, css: "selectsmall1 required validate" }); n.find("#btn_save").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (validateAll($("#dialogAddExpense"))) AddExpense("dialogAddExpense") }) } function loadEmployeeSalary(e, t) { var n = $("#" + e); sortid = "OrderHeaderId desc"; if (t) { n.find("#moreFilter").slideUp("fast"); n.find(".toggle-more-filters").click(function () { $(this).toggleClass("open"); n.find("#divBasic").toggleClass("hidden"); n.find("#moreFilter").removeClass("invisible"); n.find("#moreFilter").slideToggle(function () { }) }); n.find("#txt_m_fromDate").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#txt_m_toDate").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); n.find("#PageSize").off().on("change", function () { GetEmployeeSalaryList({ container: e }) }); n.find("#txt_m_toDate").datepicker({ changeMonth: true, changeYear: true }); n.find("#txt_m_fromDate_add").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#txt_m_toDate_add").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); bindItemsForSelectCombo({ async: false, methodname: "getEmployees", servicename: "Management", id: "ddl_m_employee", container: e, headertext: "انتخاب کارمند", selectedindex: 0 }); GetEmployeeSalaryList({ container: e }); n.find("#EmployeeAdvanceSearchbt").button({ icons: { primary: "ui-icon-search"} }).unbind().click(function () { GetEmployeeSalaryList({ container: e }) }); n.find("#btn_new").button({ icons: { primary: "ui-icon-plusthick"} }).unbind().click(function () { $("#dialogAddSalary").find("input, select").val(""); $("#dialogAddSalary").find("#btn_save").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (validateAll(n.find("#dialogAddSalary"))) AddEmployeeSalary("dialogAddSalary") }); bindItemsForSelectCombo({ async: false, methodname: "getEmployees", servicename: "Management", id: "ddl_m_employee_add", container: e, headertext: "انتخاب کارمند" }); $("#dialogAddSalary").dialog(open).dialog({ width: 500, modal: true }) }) } } function loadSocialSecurity(e, t) { var n = $("#" + e); sortid = "OrderHeaderId desc"; if (t) { n.find("#moreFilter").slideUp("fast", function () { GetSocialSecurityList({ container: e }) }); n.find(".toggle-more-filters").click(function () { $(this).toggleClass("open"); n.find("#divBasic").toggleClass("hidden"); n.find("#moreFilter").removeClass("invisible"); n.find("#moreFilter").slideToggle(function () { }) }); n.find("#txt_m_fromDate").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#txt_m_toDate").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); n.find("#PageSize").off().on("change", function () { GetSocialSecurityList({ container: e }) }); n.find("#txt_m_toDate").datepicker({ changeMonth: true, changeYear: true }); bindItemsForSelectCombo({ async: false, methodname: "getEmployees", servicename: "Management", id: "ddl_m_employee", container: e, headertext: "انتخاب کارمند", selectedindex: 0 }); bindXmlDropDownData({ id: "Month_Name", container: e, path: "Counter/MonthTitle", canmodify: false, istext: false, headertext: "انتخاب ماه" }); bindXmlDropDownData({ async: false, id: "Month_Name_Add", container: e, path: "Counter/MonthTitle", canmodify: true, istext: false, headertext: "انتخاب ماه" }); n.find("#SocialAdvanceSearchbt").button({ icons: { primary: "ui-icon-search"} }).unbind().click(function () { GetSocialSecurityList({ container: e }) }); n.find("#btn_new").button({ icons: { primary: "ui-icon-plusthick"} }).unbind().click(function () { $("#dialogAddSocial").find("input, select").val(""); $("#dialogAddSocial").find("#btn_save").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (validateAll(n.find("#dialogAddSocial"))) AddSocialSecurity("dialogAddSocial") }); bindItemsForSelectCombo({ async: false, methodname: "getEmployees", servicename: "Management", id: "ddl_social_employee_add", container: e, headertext: "انتخاب کارمند" }); $("#dialogAddSocial").dialog(open).dialog({ width: 500 }) }) } } function loadExpense(e, t) { var n = $("#" + e); sortid = "OrderHeaderId desc"; if (t) { n.find("#moreFilter").slideUp("fast", function () { GetExpenseList({ container: e }) }); n.find(".toggle-more-filters").click(function () { $(this).toggleClass("open"); n.find("#divBasic").toggleClass("hidden"); n.find("#moreFilter").removeClass("invisible"); n.find("#moreFilter").slideToggle(function () { }) }); n.find("#txt_m_fromDate").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#txt_m_toDate").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); n.find("#PageSize").off().on("change", function () { GetExpenseList({ container: e }) }); n.find("#txt_m_toDate").datepicker({ changeMonth: true, changeYear: true }); bindHierarchyData({ id: "divExpenseCategory", container: e, table: "ExpenseCategory", canmodify: false }); n.find("#btn_search").button({ icons: { primary: "ui-icon-search"} }).unbind().click(function () { GetExpenseList({ container: e }) }); n.find("#ExpenseAdvanceSearchbt").button({ icons: { primary: "ui-icon-search"} }).unbind().click(function () { GetExpenseList({ container: e }) }); n.find("#btn_new").button({ icons: { primary: "ui-icon-plusthick"} }).unbind().click(function () { $("#dialogAddExpense").find("input, select").val(""); $("#dialogAddExpense").find("#btn_save").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (validateAll(n.find("#dialogAddExpense"))) AddExpense("dialogAddExpense") }); bindHierarchyData({ id: "divExpenseCategoryAdd", container: "dialogAddExpense", table: "ExpenseCategory", canmodify: true, css: "selectsmall1 required validate" }); $("#dialogAddExpense").dialog(open).dialog({ width: 500 }) }) } } function loadTotalExpense(e, t) { var n = $("#" + e); if (t) { bindItemsForSelectCombo({ async: false, methodname: "getEmployees", servicename: "Management", id: "ddlEmployee", container: e, headertext: "انتخاب کارمند", selectedindex: 0 }); n.find("[id=txtDateFrom]").datepicker({ changeMonth: true, changeYear: true }); n.find("[id=txtDateTo]").datepicker({ changeMonth: true, changeYear: true }); n.find("[id=btn_search]").button({ icons: { primary: "ui-icon-search"} }).unbind().click(function () { GetTotalExpenses(n.find("[id=ddlEmployee]").val(), n.find("[id=txtDateFrom]").val(), n.find("[id=txtDateTo]").val(), $("[id=userDefault]").find("[id=ddl_s_Branch]").val(), e) }) } } function GetTotalExpenses(e, t, n, r, i) { var s = $("#" + i); var o = { registererId: e, dateFrom: t, dateTo: n, shopId: r }; $.ajax({ type: "POST", data: JSON.stringify(o), url: "Management/GetTotalExpenses", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; if (e.isDone) { s.find("[id=txtTotalExpense]").val(e.totalExpense); s.find("[id=txtTotalSocialSecurity]").val(e.totalSocialSecurity); s.find("[id=txtTotalEmployeeSalary]").val(e.totalSalary); s.find("[id=txtTotalSale]").val(e.totalSale); s.find("[id=txtTotalBuy]").val(e.totalBuy); s.find("[id=txtTotalReceive]").val(e.totalReceiveCash * 1 + e.totalReceiveCheque * 1 + e.totalReceiveVoucher * 1); s.find("[id=txtTotalPay]").val(e.totalPayCash * 1 + e.totalPayCheque * 1 + e.totalPayVoucher * 1); s.find("[id=txtTotalAmount]").val(e.totalExpense * 1 + e.totalSocialSecurity * 1 + e.totalSalary * 1); s.find("[id=txtTotalClearSale]").val(e.totalSale * 1 - e.totalBuy * 1); s.find("[id=txtTotalClearReceive]").val(s.find("[id=txtTotalReceive]").val() * 1 - s.find("[id=txtTotalPay]").val() * 1); s.find("[id=txtNetProfit]").val(s.find("[id=txtTotalClearSale]").val() * 1 - s.find("[id=txtTotalAmount]").val() * 1) } else translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function AddEmployeeSalary(e) { var t = $("#" + e); var n = { employeeId: t.find("#ddl_m_employee_add").val(), fromDate: t.find("#" + e + "txt_m_fromDate_add").val(), toDate: t.find("#" + e + "txt_m_toDate_add").val(), fixSalary: t.find("#txt_m_fixSalary_add").val(), commission: t.find("#txt_m_commission_add").val(), counterId: $("#userDefault").find("#ddl_m_Counter").val(), currencyId: $("#userDefault").find("#ddl_m_Currency").val(), description: t.find("#txt_salary_description_add").val(), shopId: $("#userDefault").find("#ddl_s_Branch").val(), date: $("#userDefault").find("#txt_s_Date").val() }; $.ajax({ type: "POST", data: JSON.stringify(n), url: "Management/AddEmployeeSalary", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function AddSocialSecurity(e) { var t = $("#" + e); var n = { employeeId: t.find("#ddl_social_employee_add").val(), month: t.find("#Month_Name_Add option:selected").val(), amount: t.find("#txt_social_amount_add").val(), counterId: $("#userDefault").find("#ddl_m_Counter").val(), currencyId: $("#userDefault").find("#ddl_m_Currency").val(), description: t.find("#txt_social_description_add").val(), shopId: $("#userDefault").find("#ddl_s_Branch").val(), date: $("#userDefault").find("#txt_s_Date").val() }; $.ajax({ type: "POST", data: JSON.stringify(n), url: "Management/AddSocialSecurity", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; alert("اطلاعات ثبت شد.") }, error: function (e) { alert(e.responseText) } }) } function AddExpense(e) { var t = $("#" + e); var n = { expenseCategoryId: getHierarchySelectedValue("divExpenseCategoryAdd", e), amount: t.find("#txt_m_amount_add").val(), counterId: $("#userDefault").find("#ddl_m_Counter").val(), currencyId: $("#userDefault").find("#ddl_m_Currency").val(), description: t.find("#txt_m_description_add").val(), shopId: $("#userDefault").find("#ddl_s_Branch").val(), date: $("#userDefault").find("#txt_s_Date").val() }; $.ajax({ type: "POST", data: JSON.stringify(n), url: "Management/AddExpense", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; alert("اطلاعات ثبت شد.") }, error: function (e) { alert(e.responseText) } }) } function GetEmployeeSalaryList(e) { var t = $("#" + e.container); var n = true; var r = t.find("#PageSize").val(); var i = 0; var s = 0; var o = "", u = "", a = ""; if (!t.find("#moreFilter").is(":visible")) { var f = t.find("#ddl_m_searchBy").val(); if (f == "employee") { o = t.find("#EmployeetxtSearch").val() } if (f == "confirmer") { u = t.find("#EmployeetxtSearch").val() } if (f == "registerer") { a = t.find("#EmployeetxtSearch").val() } var l = { skip: i, take: r, currentPage: s, first: n, sort: sortid, employeeId: 0, employee: o, confirmer: u, registerer: a, counterId: $("#userDefault").find("#ddl_m_Counter").val(), fixSalaryFrom: "", fixSalaryTo: "", dateFrom: "", dateTo: "", isConfirmed: "", description: ""} } else var l = { skip: i, take: r, currentPage: s, first: n, sort: sortid, employeeId: t.find("#ddl_m_employee").val() != "" ? t.find("#ddl_m_employee").val() : 0, employee: "", confirmer: t.find("#txt_m_confirmer").val(), registerer: t.find("#txt_m_registerer").val(), counterId: $("#userDefault").find("#ddl_m_Counter").val(), fixSalaryFrom: t.find("#txt_m_fixSalaryFrom").val(), fixSalaryTo: t.find("#txt_m_fixSalaryTo").val(), dateFrom: t.find("#txt_m_fromDate").val(), dateTo: t.find("#txt_m_toDate").val(), isConfirmed: t.find("#ddl_m_status").val(), description: t.find("#txt_m_description").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(l), type: "Post", url: "Management/GetEmployeeSalaryList", success: function (r) { if (!isAuthenticated(r)) return; e["count"] = r.count; e["callBackName"] = employeepageselectCallback; var i = getPageOptions(e); t.find("#paging").pagination(r.count, i); employeepageselectCallback(0, r, e, n) }, error: function (e) { alert(e.responseText) } }) } function GetSocialSecurityList(e) { var t = $("#" + e.container); var n = true; var r = t.find("#PageSize").val(); var i = 0; var s = 0; var o = "", u = "", a = ""; if (!t.find("#moreFilter").is(":visible")) { var f = t.find("#ddl_m_searchBy").val(); if (f == "employee") { o = t.find("#EmployeetxtSearch").val() } if (f == "confirmer") { u = t.find("#EmployeetxtSearch").val() } if (f == "registerer") { a = t.find("#EmployeetxtSearch").val() } var l = { skip: i, take: r, currentPage: s, first: n, sort: sortid, employeeId: "", employee: o, confirmer: u, registerer: a, counterId: $("#userDefault").find("#ddl_m_Counter").val(), amountFrom: "", amountTo: "", dateFrom: "", dateTo: "", isConfirmed: "", description: "", month: ""} } else var l = { skip: i, take: r, currentPage: s, first: n, sort: sortid, employeeId: t.find("#ddl_m_employee").val() != "" ? t.find("#ddl_m_employee").val() : "", employee: "", confirmer: t.find("#txt_m_confirmer").val(), registerer: t.find("#txt_m_registerer").val(), counterId: $("#userDefault").find("#ddl_m_Counter").val(), amountFrom: t.find("#txt_m_amountFrom").val(), amountTo: t.find("#txt_m_amountTo").val(), dateFrom: t.find("#txt_m_fromDate").val(), dateTo: t.find("#txt_m_toDate").val(), isConfirmed: t.find("#ddl_m_status").val(), description: t.find("#txt_m_description").val(), month: t.find("#Month_Name option:selected").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(l), type: "Post", url: "Management/GetSocialSecurityList", success: function (r) { if (!isAuthenticated(r)) return; e["count"] = r.count; e["callBackName"] = socialsecuritypageselectCallback; var i = getPageOptions(e); t.find("#paging").pagination(r.count, i); socialsecuritypageselectCallback(0, r, e, n) }, error: function (e) { alert(e.responseText) } }) } function GetExpenseList(e) { var t = $("#" + e.container); var n = true; var r = t.find("#PageSize").val(); var i = 0; var s = 0; var o = "", u = ""; if (!t.find("#moreFilter").is(":visible")) { var a = t.find("#ddl_m_searchBy").val(); if (a == "confirmer") { o = t.find("#ExpensetxtSearch").val() } if (a == "registerer") { u = t.find("#ExpensetxtSearch").val() } var f = { skip: i, take: r, currentPage: s, first: n, sort: sortid, expenseCategory: "", amountFrom: "", amountTo: "", confirmer: o, registerer: u, counterId: $("#userDefault").find("#ddl_m_Counter").val(), dateFrom: "", dateTo: "", isConfirmed: "", description: ""} } else var f = { skip: i, take: r, currentPage: s, first: n, sort: sortid, expenseCategory: getHierarchySelectedValue("divExpenseCategory", e.container), amountFrom: t.find("#txt_m_AmountFrom").val(), amountTo: t.find("#txt_m_AmountTo").val(), dateFrom: t.find("#txt_m_fromDate").val(), dateTo: t.find("#txt_m_toDate").val(), registerer: t.find("#txt_m_registerer").val(), isConfirmed: t.find("#ddl_m_status").val(), counterId: $("#userDefault").find("#ddl_m_Counter").val(), description: t.find("#txt_m_description").val(), confirmer: t.find("#txt_m_confirmer").val() }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(f), type: "Post", url: "Management/GetExpenseList", success: function (r) { if (!isAuthenticated(r)) return; e["count"] = r.count; e["callBackName"] = expensepageselectCallback; var i = getPageOptions(e); t.find("#paging").pagination(r.count, i); expensepageselectCallback(0, r, e, n) }, error: function (e) { alert(e.responseText) } }) } function buildEmployeeSalaryList(jq, pageoption) { var $con = $("#" + pageoption.container); total = jq; jq = jq.results; var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<tr id='tr" + val.OrderHeaderId + "'>" + "<td width='13%' id = 'td" + val.ClientId + "' name = 'employee'>" + val.EmployeeName + "</td>" + "<td width='10%' name = 'fixsalary'>" + "<span>" + val.FixSalary + "</span>" + " " + val.Currency + "</td> " + "<td width='8%' name = 'comission'>" + "<span>" + val.Commission + "</span>" + " " + val.Currency + "</td>" + "<td width='8%' name = 'fromDate'>" + val.FromDate + "</td>" + "<td width='8%' name = 'toDate'>" + val.ToDate + "</td>" + "<td width='8%' name = 'date'>" + val.Date + "</td>" + "<td width='8%' name = 'registerer'>" + val.RegistererName + "</td>" + "<td  width='5%'name = 'shop'>" + val.shop + "</td>" + "<td width='5%' name = 'counter'>" + val.counter + "</td>" + "<td width='10%' name = 'Description'>" + val.Description + "</td>" + "<td  width='8%'name = 'confirmer'>" + (val.ConfirmerName != null ? val.ConfirmerName : "<button id='btnSalaryConfirm'>تایید</button>") + "</td>" + "<td width='6%' id='edit'><button id='btnEditSalary'>ویرایش</button></td>" + "<td width='3%' id='delete'><button id='btnDeleteSalary'>حذف</button></td>" + "</tr>" } $con.find("#SalaryList").html(ItemList).parent().tableScroll({ height: 380, width: contentwidth, flush: false }); $con.find("#txtTotalSalary").html(total.sumSalary); $con.find("#txtTotalCommision").html(total.sumComission); $con.find("#txtTotalRecieve").html(total.sumSalary * 1 + total.sumComission * 1); $con.find("[id=btnSalaryConfirm]").button({ icons: { primary: "ui-icon-check" }, text: false }).unbind().click(function () { ConfirmSalary($(this).parents("tr").prop("id").replace("tr", ""), pageoption.container, $(this)) }); $con.find("[id=btnEditSalary]").button({ icons: { primary: "ui-icon-pencil" }, text: false }).unbind().click(function () { var e = $(this); bindItemsForSelectCombo({ async: false, methodname: "getEmployees", servicename: "Management", id: "ddl_m_employee_add", container: pageoption.container, headertext: "انتخاب کارمند" }); $("#dialogAddSalary").find("#btn_save").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (validateAll($con.find("#dialogAddSalary"))) EditEmployeeSalary(e.parents("tr").prop("id").replace("tr", ""), "dialogAddSalary") }); $("#dialogAddSalary").dialog(open).dialog({ width: 500 }); BindItemsForEditSalary($(this).parents("tr"), "dialogAddSalary") }); $con.find("[id=btnDeleteSalary]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).unbind().click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) DeleteSalary($(this).parents("tr").prop("id").replace("tr", ""), pageoption.container, this); else return }) } function buildSocialSecurityList(jq, pageoption) { var $con = $("#" + pageoption.container); total = jq; jq = jq.results; var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<tr id='tr" + val.OrderHeaderId + "'>" + "<td width='15%' id = 'td" + val.ClientId + "' name = 'employee'>" + val.EmployeeName + "</td>" + "<td width='10%' name = 'amount'>" + "<span>" + val.Amount + "</span>" + " " + val.Currency + "</td> " + "<td width='8%' name = 'month' id = '" + val.MonthId + "'>" + val.Month + "</td>" + "<td width='8%' name = 'date'>" + val.Date + "</td>" + "<td width='10%' name = 'registerer'>" + val.RegistererName + "</td>" + "<td width='8%' name = 'shop'>" + val.shop + "</td>" + "<td width='5%' name = 'counter'>" + val.counter + "</td>" + "<td width='12%' name = 'Description'>" + val.Description + "</td>" + "<td width='8%' name = 'confirmer'>" + (val.ConfirmerName != null ? val.ConfirmerName : "<button id='btnSocialConfirm'>تایید</button>") + "</td>" + "<td width='8%' id='edit'><button id='btnEditSocial'>ویرایش</button></td>" + "<td width='8%' id='delete'><button id='btnDeleteSocial'>حذف</button></td>" + "</tr>" } $con.find("#SocialList").html(ItemList).parent().tableScroll({ height: 380, width: contentwidth, flush: false }); $con.find("#txtTotalAmount").html(total.sumAmount); $con.find("[id=btnSocialConfirm]").button({ icons: { primary: "ui-icon-check" }, text: false }).unbind().click(function () { ConfirmSocialSecurity($(this).parents("tr").prop("id").replace("tr", ""), pageoption.container, $(this)) }); $con.find("[id=btnEditSocial]").button({ icons: { primary: "ui-icon-pencil" }, text: false }).unbind().click(function () { var e = $(this); bindItemsForSelectCombo({ async: false, methodname: "getEmployees", servicename: "Management", id: "ddl_social_employee_add", container: pageoption.container, headertext: "انتخاب کارمند" }); $("#dialogAddSocial").find("#btn_save").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (validateAll($con.find("#dialogAddSocial"))) EditSocialSecurity(e.parents("tr").prop("id").replace("tr", ""), "dialogAddSocial") }); $("#dialogAddSocial").dialog(open).dialog({ width: 500 }); BindItemsForEditSocial($(this).parents("tr"), "dialogAddSocial") }); $con.find("[id=btnDeleteSocial]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).unbind().click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) DeleteSocial($(this).parents("tr").prop("id").replace("tr", ""), pageoption.container, this); else return }) } function buildExpenseList(jq, pageoption) { var $con = $("#" + pageoption.container); var table = {}; var lstb = []; var lsth = []; if (jq.sumAmount != undefined) $con.find("#sumAmount").val(jq.sumAmount); jq = jq.results; lsth.push({ title: "گروه هزینه", sort: "ac_Expense.ac_ExpenseCategory.Expense", width: "12%" }); lsth.push({ title: "مبلغ", sort: "Amount", footer: $con.find("#sumAmount").val(), width: "12%" }); lsth.push({ title: "تاریخ ثبت", sort: "Date", width: "10%" }); lsth.push({ title: "توسط", sort: "p_Person.Family", width: "12%" }); lsth.push({ title: "شعبه", sort: "inv_Shop.Name", width: "10%" }); lsth.push({ title: "صندوق", sort: "ac_Expense.ac_Counter.Code", width: "10%" }); lsth.push({ title: "توضیحات", sort: "Description", width: "14%" }); lsth.push({ title: "تائید", sort: "ac_Expense.p_Person.Family", width: "10%" }); lsth.push({ title: "ویرایش/حذف", width: "10%" }); var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; trBody[0] = { trId: val.OrderHeaderId }; trBody[1] = { name: "expenseCategory", id: val.ExpenseCategoryId, html: val.ExpenseCategory, width: "12%" }; trBody[2] = { name: "amount", html: "<span>" + val.Amount + "</span>" + " " + val.Currency, width: "12%" }; trBody[3] = { name: "date", html: val.Date, width: "10%" }; trBody[4] = { name: "registerer", html: val.RegistererName, width: "12%" }; trBody[5] = { name: "shop", html: val.shop, width: "10%" }; trBody[6] = { name: "counter", html: val.counter, width: "10%" }; trBody[7] = { name: "Description", html: val.Description, tooltip: 5, width: "14%" }; trBody[8] = { name: "confirmer", html: val.ConfirmerName != null ? val.ConfirmerName : "<button id='btnConfirm'>تایید</button>", width: "10%" }; lstb.push(trBody) } var details = { editFunction: BindItemsForEditExpense, deleteFunction: DeleteExpense, confirmFunction: ConfirmExpense }; table = { header: lsth, body: lstb, details: details, container: pageoption.container, hasFooter: true, divName: "expenseTable" }; buildTable(table) } function BindItemsForEditSalary(e, t) { var n = $("#" + t); n.find("#ddl_m_employee_add").val(e.find("[name=employee]").prop("id").replace("td", "")); n.find("#txt_m_fromDate_add").val(e.find("[name=fromDate]").html()); n.find("#txt_m_toDate_add").val(e.find("[name=toDate]").html()); n.find("#txt_m_fixSalary_add").val(e.find("[name=fixsalary]").find("span").html()); n.find("#txt_m_commission_add").val(e.find("[name=comission]").find("span").html()); n.find("#txt_salary_description_add").val(e.find("[name=Description]").html()) } function BindItemsForEditSocial(e, t) { var n = $("#" + t); n.find("#ddl_social_employee_add").val(e.find("[name=employee]").prop("id").replace("td", "")); n.find("#txt_social_amount_add").val(e.find("[name=amount]").find("span").html()); n.find("#Month_Name_Add select").val(e.find("[name='month']").prop("id")); n.find("#txt_social_description_add").val(e.find("[name=Description]").html()) } function BindItemsForEditExpense(e, t) { $("#dialogAddExpense").dialog().dialog("destroy"); var n = $(e).parents("tr"); var r = n.find("[name='expenseCategory']").prop("id"); var i = $("#" + t); i.find("#divExpenseCategoryAdd").html(""); i.find("#btn_save").button({ icons: { primary: "ui-icon-disk"} }).unbind().click(function () { if (validateAll(i.find("#dialogAddExpense"))) EditExpense(n.prop("id").replace("tr", ""), "dialogAddExpense") }); i.find("#divExpenseCategoryAdd").html(""); bindHierarchyData({ id: "divExpenseCategoryAdd", container: t, table: "ExpenseCategory", canmodify: true, parentid: r, css: "selectsmall1 required validate" }); i.find("#txt_m_amount_add").val(n.find("[name=amount]").find("span").html()); i.find("#txt_m_description_add").val(n.find("[name=Description]").prop("title")); i.find("#dialogAddExpense").dialog({ autoOpen: true }) } function EditEmployeeSalary(e, t) { $con = $("#" + t); var n = { orderHeaderId: e, employeeId: $con.find("#ddl_m_employee_add").val(), fromDate: $con.find("#txt_m_fromDate_add").val(), toDate: $con.find("#txt_m_toDate_add").val(), fixSalary: $con.find("#txt_m_fixSalary_add").val(), commission: $con.find("#txt_m_commission_add").val(), counterId: $("#userDefault").find("#ddl_m_Counter").val(), currencyId: $("#userDefault").find("#ddl_m_Currency").val(), description: $con.find("#txt_salary_description_add").val(), shopId: $("#userDefault").find("#ddl_s_Branch").val() }; $.ajax({ type: "POST", url: "Management/EditSalary", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function EditSocialSecurity(e, t) { $con = $("#" + t); var n = { orderHeaderId: e, employeeId: $con.find("#ddl_social_employee_add").val(), month: $con.find("#Month_Name_Add option:selected").val(), amount: $con.find("#txt_social_amount_add").val(), counterId: $("#userDefault").find("#ddl_m_Counter").val(), currencyId: $("#userDefault").find("#ddl_m_Currency").val(), description: $con.find("#txt_social_description_add").val(), shopId: $("#userDefault").find("#ddl_s_Branch").val() }; $.ajax({ type: "POST", url: "Management/EditSocialSecurity", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (e) { if (!isAuthenticated(e)) return }, error: function (e) { alert(e.responseText) } }) } function EditExpense(e, t) { $con = $("#" + t); var n = { orderHeaderId: e, expenseCategory: getHierarchySelectedValue("divExpenseCategoryAdd", t), amount: $con.find("#txt_m_amount_add").val(), counterId: $("#userDefault").find("#ddl_m_Counter").val(), currencyId: $("#userDefault").find("#ddl_m_Currency").val(), description: $con.find("#txt_m_description_add").val(), shopId: $("#userDefault").find("#ddl_s_Branch").val() }; $.ajax({ type: "POST", url: "Management/EditExpense", contentType: "application/json; charset=utf-8", data: JSON.stringify(n), success: function (e) { if (!isAuthenticated(e)) return }, error: function (e) { alert(e.responseText) } }) } function ConfirmSalary(e, t, n) { var r = $("#" + t); var i = { orderHeaderId: e }; $.ajax({ type: "POST", url: "Management/ConfirmSalary", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (e) { if (!isAuthenticated(e)) return; if (e != null && e.isDone == true) { var t = n.parent(); t.html(e.name + " " + e.family + " " + e.code) } else translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function ConfirmSocialSecurity(e, t, n) { var r = $("#" + t); var i = { orderHeaderId: e }; $.ajax({ type: "POST", url: "Management/ConfirmSocialSecurity", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (e) { if (!isAuthenticated(e)) return; if (e != null && e.isDone == true) { var t = n.parent(); t.html(e.name + " " + e.family + " " + e.code) } else translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function ConfirmExpense(e, t) { var n = $("#" + t); var r = $(e); var i = { orderHeaderId: r.parents("tr").prop("id").replace("tr", "") }; $.ajax({ type: "POST", url: "Management/ConfirmExpense", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (e) { if (!isAuthenticated(e)) return; if (e != null && e.isDone == true) { var t = r.parent(); t.html(e.name + " " + e.family) } else translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function DeleteSalary(e, t, n) { var r = $("#" + t); var i = { orderHeaderId: e }; $.ajax({ type: "POST", url: "Management/DeleteSalary", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (e) { if (!isAuthenticated(e)) return; if (e != null && e.isDone == true) { $(n).parents("tr").remove() } translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function DeleteSocial(e, t, n) { var r = $("#" + t); var i = { orderHeaderId: e }; $.ajax({ type: "POST", url: "Management/DeleteSocial", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (e) { if (!isAuthenticated(e)) return; if (e != null && e.isDone == true) { $(n).parents("tr").remove() } translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function DeleteExpense(e, t) { var n = $("#" + t); var r = $(e); var i = { orderHeaderId: r.parents("tr").prop("id").replace("tr", "") }; $.ajax({ type: "POST", url: "Management/DeleteExpense", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (e) { if (!isAuthenticated(e)) return; if (e != null && e.isDone == true) { r.parents("tr").remove(); return true } translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function loadAccountDetailsShopSale(e, t) { if (t) { var n = $("#" + e); n.find("#clearSale").html("فروش خالص"); n.find("#clearAmount").html("مبلغ واریزی خالص"); n.find("#countSale").html("تعداد فروش"); n.find("#sumSale").html("جمع فروش"); n.find("#divdialogCustomer").dialog({ autoOpen: false }).dialog({ width: 600 }); n.find("#ddl_s_Scoup").val("day"); n.find("#txt_s_DateStart").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#txt_s_DateEnd").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); n.find("#txt_s_DateEnd").datepicker({ changeMonth: true, changeYear: true }); n.find("#a_CustomerIntroducerCode").off().on("click", function () { opendialog({ container: "divdialogCustomer", containerpage: e }) }); n.find("#btnSearch").button({ icons: { primary: "ui-icon-search"} }).off().on("click", function () { AccountDetailsShop(e, true) }) } AccountDetailsShop(e, true) } function loadAccountDetailsShopBuy(e, t) { if (t) { var n = $("#" + e); n.find("#clearSale").html("خرید خالص"); n.find("#clearAmount").html("مبلغ برداشتی خالص"); n.find("#countSale").html("تعداد خرید"); n.find("#sumSale").html("جمع خرید"); n.find("#divdialogCustomer").dialog({ autoOpen: false }).dialog({ width: 600 }); n.find("#ddl_s_Scoup").val("day"); n.find("#txt_s_DateStart").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#txt_s_DateEnd").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); n.find("#txt_s_DateEnd").datepicker({ changeMonth: true, changeYear: true }); n.find("#btnSearch").button({ icons: { primary: "ui-icon-search"} }).off().on("click", function () { AccountDetailsShop(e, false) }); n.find("#a_CustomerIntroducerCode").off().on("click", function () { opendialog({ container: "divdialogCustomer", containerpage: e }) }) } AccountDetailsShop(e, false) } function AccountDetailsShop(e, t) { var n = $("#" + e); DTO = { shopid: $("#userDefault").find("#ddl_s_Branch").val(), Scoup: n.find("#ddl_s_Scoup").val(), clientid: "", employeeid: n.find("#txt_s_Supplier").val(), dateFrom: n.find("#txt_s_DateStart").val(), dateTo: n.find("#txt_s_DateEnd").val(), isSale: t, clientCode: n.find("#CustomerIntroducerCode").val() }; $.ajax({ type: "POST", url: "Management/GetAccountDetailsShop", contentType: "application/json; charset=utf-8", data: JSON.stringify(DTO), success: function (e) { if (!isAuthenticated(e)) return; if (t) { n.find("#txt_d_Sale").val(e.BuyAmount * 1 - e.SellAmount * 1); n.find("#txt_d_PaymentSale").val(e.ReceivedCash * 1 + e.ReceivedCheque * 1 + e.ReceivedVoucher * 1 - (e.PaidCash * 1 + e.PaidCheque * 1 + e.paidVoucher * 1)); n.find("#txt_d_BalanceTotal").val(e.BuyAmount * 1 - e.SellAmount * 1 - (e.ReceivedCash * 1 + e.ReceivedCheque * 1 + e.ReceivedVoucher * 1 - (e.PaidCash * 1 + e.PaidCheque * 1 + e.paidVoucher * 1))); n.find("#txt_d_SaleTotal").val(e.BuyAmount); n.find("#txt_d_Return").val(e.SellAmount); n.find("#txt_d_TotalPayment").val(e.PaidCash * 1 + e.PaidCheque * 1 + e.paidVoucher * 1); n.find("#txt_d_TotalReceive").val(e.ReceivedCash * 1 + e.ReceivedCheque * 1 + e.ReceivedVoucher * 1); n.find("#txt_d_ChequePeyment").val(e.PaidCheque); n.find("#txt_d_ChequeReceive").val(e.ReceivedCheque); n.find("#txt_d_CashPayment").val(e.PaidCash); n.find("#txt_d_CashReceive").val(e.ReceivedCash); n.find("#txt_d_TotalOff").val(e.OffSale * 1 - e.BuyAmount * 1); n.find("#txt_d_profit").val(e.profit); n.find("#txt_d_BuyQuantity").val(e.BuyQuantity); n.find("#txt_d_SellQuantity").val(e.SellQuantity); n.find("#txt_d_NetQuantity").val(e.BuyQuantity * 1 - e.SellQuantity * 1) } else if (!t) { n.find("#txt_d_Sale").val(e.SellAmount * 1 - e.BuyAmount * 1); n.find("#txt_d_PaymentSale").val(e.PaidCash * 1 + e.PaidCheque * 1 + e.paidVoucher * 1 - (e.ReceivedCash * 1 + e.ReceivedCheque * 1 + e.ReceivedVoucher * 1)); n.find("#txt_d_BalanceTotal").val(e.SellAmount * 1 - e.BuyAmount * 1 - (e.PaidCash * 1 + e.PaidCheque * 1 + e.paidVoucher * 1 - (e.ReceivedCash * 1 + e.ReceivedCheque * 1 + e.ReceivedVoucher * 1))); n.find("#txt_d_SaleTotal").val(e.SellAmount); n.find("#txt_d_Return").val(e.BuyAmount); n.find("#txt_d_TotalPayment").val(e.PaidCash * 1 + e.PaidCheque * 1 + e.paidVoucher * 1); n.find("#txt_d_TotalReceive").val(e.ReceivedCash * 1 + e.ReceivedCheque * 1 + e.ReceivedVoucher * 1); n.find("#txt_d_ChequePeyment").val(e.PaidCheque); n.find("#txt_d_ChequeReceive").val(e.ReceivedCheque); n.find("#txt_d_CashPayment").val(e.PaidCash); n.find("#txt_d_CashReceive").val(e.ReceivedCash); n.find("#txt_d_TotalOff").val(e.OffBuy * 1 - e.SellAmount * 1); n.find("#txt_d_profit").val(e.profit); n.find("#txt_d_BuyQuantity").val(e.BuyQuantity); n.find("#txt_d_SellQuantity").val(e.SellQuantity); n.find("#txt_d_NetQuantity").val(e.BuyQuantity * 1 - e.SellQuantity * 1) } }, error: function (e) { alert(e.responseText) } }) } function loadAddAccounting(e, t) { var n = $("#" + e); if (t) { n.find("#tbl_Accounting").tableScroll({ height: 300, width: contentwidth, flush: false }); for (var r = 1; r <= 5; r++) { AddRowTblAccounting(e, null, +n.find("#hi_cRow").val()); n.find("#hi_cRow").val(+n.find("#hi_cRow").val() + 1) } var r = 1; $.each($("#" + e).find("#AccountingList tr  .trc"), function () { $(this).find("[id*=lb]").text(r); r++ }); n.find("#btn_AddNewRow").off().on("click", function () { AddRowTblAccounting(e, null, +n.find("#hi_cRow").val()); n.find("#hi_cRow").val(+n.find("#hi_cRow").val() + 1); var t = 1; $.each($("#" + e).find("#AccountingList tr"), function () { if ($(this).hasClass("trc")) { $(this).find("[id*=lb]").text(t); t++ } }) }); n.find("#btn_TemporarySaveAccounting").off().on("click", function () { n.find("#isper").val(false); SavedNewAccountings = true; if (n.find("#spDeptor").html() - -1 * +n.find("#spCreditor").html() != 0) { alert("notBalance") } else { n.find("#frm_Accounting").submit() } n.find("#countRow").val(n.find("#AccountingList").children().length) }).button({ icons: { primary: "ui-icon-disk" }, text: true }); n.find("#btn_PermanentSaveAccounting").off().on("click", function () { n.find("#isper").val(true); SavedNewAccountings = true; if (n.find("#spDeptor").html() - (-1 * +n.find("#spCreditor").html() != 0)) { alert("notBalance") } else { n.find("#frm_Accounting").submit() } }).button({ icons: { primary: "ui-icon-disk" }, text: true }); n.find("#btn_Print").off().on("click", function () { PrintAddedAccountDetails(e, n.find("#hi_AddedOrderHeaderId").val()) }).button({ icons: { primary: "ui-icon-print" }, text: true }); n.find("#Frm_Tshop").ajaxForm({ data: { ShopId: $("#userDefault").find("#ddl_s_Branch").val(), CurrencyRateId: $("#userDefault").find("#ddl_m_Currency").val(), CounterId: $("#userDefault").find("#ddl_m_Counter").val(), date: $("#userDefault").find("#txt_s_Date").val(), isper: isper }, success: function (e) { alert(e.msg); n.find("#hi_AddedOrderHeaderId").val(e.orderHeaderId) }, complete: function (e) { } }); n.find("#txt_AccountingDescription").blur(function () { var e = n.find("#hi_cRow").val(); for (var t = 1; t <= e; t++) { n.find("#txt_description" + t).val($(this).val()) } }); localize() } } function AddRowTblAccounting(e, t, n) { var r = $("#" + e); var i = n + 1; var s = "<tr class='trc' id='" + i + "' style='border-bottom-style: solid; border-width: 0px 0px 3px 0px; border-color: #C0C0C0'> <td width='4%'>" + " <label id='lb" + i + "'></label>" + "<input type='hidden' id='hi_AccountId" + i + "' name='hi_AccountId" + i + "'  />" + "</td>" + "<td width='90%'>" + " <table> <tr>  <td width='6%'>" + "<input type='text' id='txt_code" + i + "' name='txt_code" + i + "' placeholder='code' class='inputW136  '/></td>" + "  <td width='18%'><input type='text' id='txt_title" + i + "' name='txt_title" + i + "' placeholder='account'  style='width: 100%'/> </td>" + "  <td width='3%'><input type='text' placeholder='debtor' name='txt_deptor" + i + "' id='txt_deptor" + i + "' class='inputW136 digit'/></td> " + " <td width='4%'><input type='text' placeholder='creditor' name='txt_creditor" + i + "' id='txt_creditor" + i + "' class='inputW136 digit' /></td> </tr>" + "<tr >" + "<td colspan='4'>" + "<div > <span title='شرح'></span>" + "<input type='text' placeholder='description'  id='txt_description" + i + "' name='txt_description" + i + "'  style='width:95% '/>" + "</div></td>" + "</tr> </table></td>" + "<td id='delete'><span title='حذف' name='delete' class='cursor ui-icon ui-icon-closethick'  width= '90%' height='95%'></span></td>" + "</tr>"; r.find("#AccountingList").append(s).parent().tableScroll({ height: 300, width: contentwidth, flush: false }); aComplete({ methodname: "GetCompletionListByAccountName", servicename: "Management", id: "txt_title" + i, boxId: "txt_code" + i, container: e, minlength: 2, autofocus: false, limit: 20, fname: OpeningAccountOnSelect }); r.find("#txt_deptor" + i).blur(function (t) { totalDebtCreditOpeningAccount(e) }); r.find("#txt_creditor" + i).blur(function (t) { totalDebtCreditOpeningAccount(e) }); r.find("#txt_deptor" + i).spinner({ step: 1e3, change: function () { totalDebtCreditOpeningAccount(e) }, stop: function () { totalDebtCreditOpeningAccount(e) } }); r.find("#txt_creditor" + i).spinner({ step: 1e3, change: function () { totalDebtCreditOpeningAccount(e) }, stop: function () { totalDebtCreditOpeningAccount(e) } }); var o = "lb" + i; r.find("#" + o).text(i); r.find("[id=delete]").unbind().bind("click", function () { if (confirm("آیا از حذف مطمئن هستید؟")) { var t = $(this).parents("tr").first().prop("id"); $("#" + t).remove(); var n = 1; $.each($("#" + e).find("#AccountingList tr "), function () { if ($(this).find("[id*=lb]").length > 0) { $(this).find("[id*=lb]").text(n); n++ } }) } else return }); localize() } function PrintAddedAccountDetails(e, t) { var n = $("#" + e); if (n.find("#Div_Print").html().length < 10) { n.find("#Div_Print").load("Report/PrintAccount.htm", function () { getAccountPrint(t, e) }) } else getAccountPrint(t, e) } function getAccountPrint(e, t) { var n = $("#" + t); var r = { id: e }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(r), type: "Post", url: "Management/GetAccountById", success: function (e) { if (!isAuthenticated(e)) return; if (e.isdone) { SetAccountData(t, e); Popup(n.find("#Div_Print").html()) } else alert("noData") }, error: function (e) { alert(e.responseText) } }) } function SetAccountData(e, t) { var n = $("#" + e); var r = t.accountDetail; var i = ""; for (var s = 0; s < r.length; s++) { var o = r[s]; if (o.IsDept) i += "<tr><td align='Center'>" + (s * 1 + 1) + "</td>" + "<td align='Right'  nowrap='nowrap'><h6>" + o.Code + "</h6></td>" + "<td align='Center' nowrap='nowrap'><h6>" + o.Name + "</h6></td>" + "<td align='Center' nowrap='nowrap'></td>" + "<td align='Center' nowrap='nowrap'>" + o.Amount + "</td>" + "<td align='Center' nowrap='nowrap'></td></tr>"; else i += "<tr><td align='Center'>" + (s * 1 + 1) + "</td>" + "<td align='Right'  nowrap='nowrap'><h6>" + o.Code + "</h6></td>" + "<td align='Center' nowrap='nowrap'><h6>" + o.Name + "</h6></td>" + "<td align='Center' nowrap='nowrap'></td>" + "<td align='Center' nowrap='nowrap'></td>" + "<td align='Center' nowrap='nowrap'>" + o.Amount + "</td></tr>" } i += "<tr><td align='Center' style='border-bottom:hidden; border-right:hidden;' nowrap='nowrap' colspan='3' dir='ltr' align='left'></td>" + "<td align='Center' nowrap='nowrap'  align='left'><h6>جمع صفحه</h6></td>" + "<td align='Center' nowrap='nowrap'>" + t.Amount + "</td>" + "<td align='Center' nowrap='nowrap'>" + t.Amount + "</td></tr>"; i += "<tr><td align='Center' nowrap='nowrap'  style='border-bottom:hidden;border-right:hidden;' colspan='3' dir='ltr' align='left'></td>" + "<td align='Center' nowrap='nowrap' align='left'><h6> جمع کل </h6></td>" + "<td align='Center' nowrap='nowrap'>" + t.Amount + "</td>" + "<td align='Center' nowrap='nowrap'>" + t.Amount + "</td></tr>"; n.find("#LInvoiceNo").html(t.InvoiceNO); n.find("#LDate").html(t.Date); n.find("#Ldescription").html(t.Description); n.find("#DetailAccountList").html(i) } function AccountOnSelect(e, t, n, r) { var i = $("#" + n); var s = r.replace("txt_title", "txt_code"); i.find(s).val(t.item.value) } function loadDisplayAccounts(e, t) { var n = $("#" + e); InvoiceListload(e, t); sortid = "ac_OrderHeader.OrderHeaderId desc"; if (t) { n.find("[id=btnSearch]").button({ icons: { primary: "ui-icon-search"} }).unbind("click").click(function () { sortid = "ac_OrderHeader.OrderHeaderId desc"; getFullAccountingList(e, { container: e, callbackmethod: getFullAccountingList, fname: "", page_index: 0, build: buildAcountsList, servicename: "Management", methodname: "GetFullAccountList", print: false }) }); bindHierarchyData({ id: "hr_acc_category", table: "account", container: e, styleclass: "PagingSelect " }); aComplete({ methodname: "GetCompletionListByAccountName", servicename: "Management", id: "txt_Accounting", boxId: "lb_AccountingName", container: e, minlength: 2, autofocus: false, limit: 20, fname: AccountListOnSelect }); n.find("#txt_AccListDateStart").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#txt_AccListDateEnd").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); n.find("#txt_AccListDateEnd").datepicker({ changeMonth: true, changeYear: true }); getFullAccountingList(e, { container: e, callbackmethod: getFullAccountingList, fname: "", page_index: 0, build: buildAcountsList, servicename: "Management", methodname: "GetFullAccountList", print: false }); n.find("#btnPrint").die().live("click", function () { PrintAccountingDetails(e, "daybookPrint") }).button({ icons: { primary: "ui-icon-print" }, text: true }) } } function PrintAccountingDetails(e, t) { var n = $("#" + e); if (n.find("#Div_Print").html().length < 10) { n.find("#Div_Print").load("Report/PrintAccounting.htm", function () { getAccountingPrint(e, t) }) } else getAccountingPrint(e, t) } function getAccountingPrint(e, t) { var n = $("#" + e); var r = { sort: sortid, shopid: $("#userDefault").find("#ddl_s_Branch").val(), accCode: n.find("#txt_Accounting").val(), AccountingDateStart: n.find("#txt_AccListDateStart").val(), AccountingDateEnd: n.find("#txt_AccListDateEnd").val(), accountId: getHierarchySelectedValue("hr_acc_category", e) == null ? n.find("#hd_d_PersonId").val() : getHierarchySelectedValue("hr_acc_category", e), description: n.find("#txt_description").val(), invoiceNo: n.find("#txt_invoiceNumber").val(), documentNumber: n.find("#txt_documentNumber").val(), isPrint: t }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(r), type: "Post", url: "Management/GetFullAccountList", success: function (t) { if (!isAuthenticated(t)) return; if (t.isdone) { SetAccountinglistData(e, t); Popup(n.find("#Div_Print").html()) } else alert("noData") }, error: function (e) { alert(e.responseText) } }) } function SetAccountinglistData(e, t) { var n = $("#" + e); var r = ""; var i = 0; var s = 0; var o = 0; var u = 0; n.find("#lb_DateRange").html("از تاریخ" + "&nbsp;&nbsp;" + ToPersianDate(t.DateStart) + "&nbsp;&nbsp;" + "تا تاریخ" + "&nbsp;&nbsp;" + ToPersianDate(t.DateEnd)); for (var a = 0; a < t.results.length; a++) { var f = t.results[a]; var l = true; var c = ""; for (var h = 0; h < f.length; h++) { var p = f[h]; c = p.Description; var d = p.Date; var v = ToPersianDateDigitYearRight(d); var m = v.split("/"); if (p.IsDept) { r += "<tr>" + "<td width='5%' style='border-top: hidden;border-bottom: hidden;'>" + (l ? p.InvoiceNO : "&nbsp;") + "</td>" + "<td width='5%' style='border-top: hidden;border-bottom: hidden;'><table  style='font-family: tahoma; font-size: small; width: 100%; height: 100%; margin-left: auto;margin-right: auto; border-bottom: hidden;' cellspacing='0px' cellpadding='0px' width='100%'>" + " <tr><td width='50%'  style='border-top: hidden;border-bottom: hidden;text-align:center;'>" + v[3] + "</td>" + "<td width='50%'  style='border-top: hidden;border-bottom: hidden;text-align:center;'>" + v[2] + "</td></tr></table>" + "</td>" + "<td width='60%' style='border-top: hidden;border-bottom: hidden;' >" + p.title + "</td>" + "<td width='10%' style='border-top: hidden;border-bottom: hidden;' >" + p.AccountDetailId + "</td>" + "<td width='10%' style='border-top: hidden;border-bottom: hidden;'>" + p.Amount + "</td>" + "<td width='10%' style='border-top: hidden;border-bottom: hidden;'>&nbsp;</td>" + "</tr>" } else { r += "<tr>" + "<td width='5%' style='border-top: hidden;border-bottom: hidden;'>" + (l ? p.InvoiceNO : "&nbsp;") + "</td>" + "<td width='5%' style='border-top: hidden;border-bottom: hidden;'><table  style='font-family: tahoma; font-size: small; width: 100%; height: 100%; margin-left: auto;margin-right: auto; border-bottom: hidden;' cellspacing='0px' cellpadding='0px' width='100%'>" + " <tr><td width='50%'  style='border-top: hidden;border-bottom: hidden;text-align:center;'>" + v[3] + "</td>" + "<td width='50%'  style='border-top: hidden;border-bottom: hidden;text-align:center;'>" + v[2] + "</td></tr></table>" + "</td>" + "<td width='60%' style='border-top: hidden;border-bottom: hidden;' >" + ("&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" + p.title) + "</td>" + "<td width='10%' style='border-top: hidden;border-bottom: hidden;' >" + p.AccountDetailId + "</td>" + "<td width='10%' style='border-top: hidden;border-bottom: hidden;'>&nbsp;</td>" + "<td width='10%' style='border-top: hidden;border-bottom: hidden;'>" + p.Amount + "</td>" + "</tr>" } l = false } r += "<tr>" + "<td width='5%' style='border-top: hidden;border-bottom: hidden;'>&nbsp;</td>" + "<td width='5%' style='border-top: hidden;border-bottom: hidden;'>&nbsp;" + "</td>" + "<td width='60%' style='border-top: hidden' >" + (c != "" ? c : "&nbsp;") + "</td>" + "<td width='10%' style='border-top: hidden;border-bottom: hidden;' >&nbsp;</td>" + "<td width='10%' style='border-top: hidden;border-bottom: hidden;'>&nbsp;</td>" + "<td width='10%' style='border-top: hidden;border-bottom: hidden;'>&nbsp;</td>" + "</tr>" } r += "<tr>" + "<td colspan='3' style='border-right: hidden;border-bottom: hidden;'>" + ToPersianDate(t.DateNow) + "</td>" + "<td width='10%' >جمع صفحه</td>" + "<td width='10%' >" + t.sumDebtor + "</td>" + "<td width='10%' >" + t.sumCreditor + "</td>" + "</tr>"; r += "<tr>" + "<td colspan='3' style='border-right: hidden;border-bottom: hidden;border-top: hidden;'></td>" + "<td width='10%' >جمع کل</td>" + "<td width='10%' >" + t.sumDebtor + "</td>" + "<td width='10%' >" + t.sumCreditor + "</td>" + "</tr>"; n.find("#DetailAccountList").html(r) } function AccountListOnSelect(e, t, n) { var r = $("#" + n); r.find("#txt_Accounting").val(t.item.value); r.find("#lb_AccountingName").text(t.item.label) } function getFullAccountingList(e, t) { var n = $("#" + e); var r = { sort: sortid, shopid: $("#userDefault").find("#ddl_s_Branch").val(), accCode: n.find("#txt_Accounting").val(), AccountingDateStart: n.find("#txt_AccListDateStart").val(), AccountingDateEnd: n.find("#txt_AccListDateEnd").val(), accountId: getHierarchySelectedValue("hr_acc_category", e), description: n.find("#txt_description").val(), invoiceNo: n.find("#txt_invoiceNumber").val(), documentNumber: n.find("#txt_documentNumber").val(), isPrint: "daybook" }; t["DTO"] = r; pageselectCallback(0, t, { container: "", fname: t.fname, pagingContainer: e, first: true, isOrder: true }) } function buildAcountsList(jq, container) { var $con = $("#" + container.pagingContainer); var table = {}; var lstb = []; var lsth = []; var details = {}; $con.find("#divFooter").removeClass("invisible"); lsth.push({ title: "documentNumber", sort: "AccountDetailId", width: "7%" }); lsth.push({ title: "invoiceNumber", sort: "ac_OrderHeader.InvoiceNO", width: "8%" }); lsth.push({ title: "registerDate", sort: "ac_OrderHeader.Date", width: "10%" }); lsth.push({ title: "accountCode", sort: "ac_Account.Code", width: "5%" }); lsth.push({ title: "account", sort: "ac_Account.Name", width: "20%" }); lsth.push({ title: "debtorAmount", sort: "IsDept", width: "10%" }); lsth.push({ title: "creditorAmount", width: "10%" }); lsth.push({ title: "balanceAmount", sort: "Amount", width: "10%" }); lsth.push({ title: "registerer", sort: "ac_OrderHeader.p_Employee.p_Person.Name", width: "10%" }); lsth.push({ title: "confirmer", sort: "ac_OrderHeader.p_Employee1.p_Person.Name", width: "10%" }); var List = typeof jq.results == "string" ? eval("(" + jq.results + ")") : jq.results; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; if (!container.params.print) trBody[0] = { trId: val.AccountDetailId }; trBody[1] = { name: "accountId", html: val.AccountDetailId, width: "7%" }; trBody[2] = { name: "name", html: val.InvoiceNO, width: "8%" }; trBody[3] = { props: { datedigit: ToPersianDateDigitYearRight(val.Date), date: val.Date, name: "date", width: "10%", klass: "dateLong"} }; trBody[4] = { name: "accountCode", html: val.Code, width: "5%" }; trBody[5] = { name: "account", html: val.title + " " + val.Description, width: "20%" }; trBody[6] = { html: val.IsDept == true ? val.Amount : "", props: { name: "Debtor", klass: "digit", style: "font-size:1em;", width: "10%"} }; trBody[7] = { html: val.IsDept != true ? val.Amount : "", props: { name: "Creditor", klass: "digit", style: "font-size:1em;", width: "10%"} }; trBody[8] = { html: val.balance, props: { name: "Balance", klass: "digit", style: "font-size:1em;", width: "10%"} }; trBody[9] = { name: "NameFamily", html: val.Name + " " + val.Family, width: "10%" }; trBody[10] = { name: "confirmer", html: val.confirmer, width: "10%" }; lstb.push(trBody) } $con.find("#spDeptor").html(jq.sumDebtor); $con.find("#spCreditor").html(jq.sumCreditor); $con.find("#spBalance").html(Math.round(jq.sumDebtor * 1 - jq.sumCreditor * 1, 1)); $con.find("#spNotPassedCheque").html(jq.sumNotPassed); $con.find("#spNetBalance").html(Math.round(jq.sumDebtor * 1 - jq.sumCreditor * 1 - jq.sumNotPassed * 1, 1)); if (container.params.print) { table = { header: lsth, body: lstb, details: { rowClick: AccountRowOnSelect }, heigth: 300, container: container.pagingContainer, divName: "Div_Print", hasFooter: false }; buildPrintTable(table); container.params.print = false } else { table = { header: lsth, body: lstb, details: { rowClick: AccountRowOnSelect }, heigth: 300, container: container.pagingContainer, divName: "acountReportlist", hasFooter: false }; buildTable(table) } } function AccountRowOnSelect(e, t) { var n = $("#" + t); createSubTab({ row: e, name: "a_DisplayAccounts" }); onRowClick(e) } function loadAccountingEdit(e, t, n) { var r = $("#" + t); var i = { AccountDetailId: e }; DisplayAccountInfo(t, i, "GetAccountInfo"); r.find("[id=btn_SearchAccounting]").button({ icons: { primary: "ui-icon-search"} }).unbind("click").click(function () { i = { OrderHeaderId: r.find("#txt_OrderHeaderId").val(), InvoiceNum: r.find("#txt_InvoiceNum").val() }; DisplayAccountInfo(t, i, "GetAccountInfoSearch2") }); r.find("#frm_Accounting").ajaxForm({ data: { ShopId: $("#userDefault").find("#ddl_s_Branch").val(), CurrencyRateId: $("#userDefault").find("#ddl_m_Currency").val(), CounterId: $("#userDefault").find("#ddl_m_Counter").val(), date: $("#userDefault").find("#txt_s_Date").val(), isper: isper }, success: function (e) { alert(e.msg) }, complete: function (e) { } }); r.find("#btn_TemporarySaveAccounting").off().on("click", function () { isper = false; r.find("#countRow").val(r.find("#AccountingList").children().length) }).button({ icons: {}, text: true }); r.find("#btn_PermanentSaveAccounting").off().on("click", function () { isper = true; r.find("#countRow").val(r.find("#AccountingList").children().length) }).button({ icons: {}, text: true }); r.find("#btn_Print").off().on("click", function () { PrintAddedAccountDetails(t, r.find("#txt_OrderHeaderId").val()) }).button({ icons: { primary: "ui-icon-print" }, text: true }) } function DisplayAccountInfo(e, t, n) { var r = $("#" + e); r.find("#AccountingList").parents("form").append('<input type="hidden" id="countRow" name="countRow" />'); r.find("#countRow").val(r.find("#AccountingList").children().length); r.find("#txt_AccountingDate").datepicker({ changeMonth: true, changeYear: true }); $.ajax({ url: "Management/" + n, data: JSON.stringify(t), dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (t) { if (t.isdone) { var n = 1; r.find("#txt_AccountingDescription").val(t.Description); r.find("#txt_AccountingDate").val(ToPersianDateDigitYearRight(t.Date)); r.find("#txt_PersonName").val(t.Name + " " + t.Family); r.find("#txt_ShopName").val(t.ShopName); r.find("#txt_OrderHeaderId").val(t.OrderHeaderId); r.find("#txt_InvoiceNum").val(t.InvoiceNO); r.find("#AccountingList").html(""); for (var i = 0; i < t.orderDetailes.length; i++) { var n = +r.find("#hi_cRow").val() + 1; var s = t.orderDetailes[i]; AddRowTblAccounting(e, null, +r.find("#hi_cRow").val()); if (s != undefined) { r.find("#hi_AccountId" + n).val(s.AccountDetailId); r.find("#txt_code" + n).val(s.Code); r.find("#txt_title" + n).val(s.title); r.find("#txt_deptor" + n).val(s.IsDept == true ? s.Amount : ""); r.find("#txt_creditor" + n).val(s.IsDept == false ? s.Amount : ""); r.find("#txt_description" + n).val(s.Description) } r.find("#hi_cRow").val(+r.find("#hi_cRow").val() + 1) } if (SavedNewAccountings && +rownumber / 2 - 1 < 5) { var o = 5 - (+rownumber / 2 - 1); for (var i = 0; i < o; i++) { AddRowTblAccounting(e) } } } else { alert("please enter orderdetailId or Invoicenumber ") } } }) } function loadAddBank(e, t) { var n = $("#" + e); if (t) { sortid = "ac_OrderHeader.OrderHeaderId desc"; n.find("[id=AddBank]").button({ icons: { primary: "ui-icon-disk"} }).unbind("click").click(function () { AddBankAccount(e); getBankList(e, { container: e, callbackmethod: getCounterList, fname: "", page_index: 0, build: buildBankList, servicename: "Management", methodname: "GetBankList", print: false }) }); n.find("[id=UpdateBank]").button({ icons: { primary: "ui-icon-disk"} }).unbind("click").click(function () { UpdateBankAccount(e) }); getBankList(e, { container: e, callbackmethod: getBankList, fname: "", page_index: 0, build: buildBankList, servicename: "Management", methodname: "GetBankList", print: false }) } } function AddBankAccount(e) { var t = $("#" + e); var n = { name: t.find("#BankName").val() }; $.ajax({ url: "Management/AddBankAccount", data: JSON.stringify(n), dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (e) { if (e.isdone) { alert(e.msg) } else { alert("please enter Bank name ") } } }) } function UpdateBankAccount(e) { var t = $("#" + e); var n = { name: t.find("#BankName").val(), AccId: t.find("#hi_SelectedBankAccId").val() }; $.ajax({ url: "Management/UpdateBankAccount", data: JSON.stringify(n), dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (t) { if (t.isDone) { alert(t.msg); getBankList(e, { container: e, callbackmethod: getBankList, fname: "", page_index: 0, build: buildBankList, servicename: "Management", methodname: "GetBankList", print: false }) } else { alert("please enter Bank name ") } } }) } function getBankList(e, t) { var n = $("#" + e); pageselectCallback(0, t, { container: "", noPaging: true, fname: t.fname, pagingContainer: e, first: true, isOrder: false }) } function buildBankList(jq, container) { var $con = $("#" + container.pagingContainer); var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "code", width: "46%" }); lsth.push({ title: "bankName", width: "50%" }); if (!container.params.print) { lsth.push({ title: "deleteKey", width: "4%" }) } var List = typeof jq.results == "string" ? eval("(" + jq.results + ")") : jq.results; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; if (!container.params.print) trBody[0] = { trId: val.AccountId }; trBody[1] = { props: { name: "name", width: "46%", code: val.Code }, html: val.Code }; trBody[2] = { props: { id: val.AccountId, name: "BankName", width: "50%" }, html: val.Name }; lstb.push(trBody) } table = { header: lsth, body: lstb, details: { deleteFunction: RemoveBankElement, rowClick: clickBank }, heigth: 300, container: container.pagingContainer, divName: "BankList" }; buildTable(table) } function RemoveBankElement(e, t) { var n = $("#" + t); $.ajax({ type: "POST", url: "Management/DeleteBank", contentType: "application/json; charset=utf-8", data: "{accountId: '" + e + "'}", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg); if (e.isDone) getCounterList(t, { container: t, callbackmethod: GetBankList, fname: "", page_index: 0, build: buildBankList, servicename: "Management", methodname: "getBankList", print: false }) }, error: function (e) { alert(e.responseText) } }) } function clickBank(e, t) { var n = $("#" + t); var r = e.closest("tr").attr("id"); var i = r.substring(2, r.length); n.find("#BankName").val(e.find("#" + i).html()); n.find("#hi_SelectedBankAccId").val(i); onRowClick(e) } function loadRecievedDocument(e, t) { var n = $("#" + e); sortid = "DueDate desc"; if (t) { n.find("#ddl_Currency").html($("#userDefault").find("#ddl_m_Currency").html()).find("option:eq(1)").prop("selected", "selected"); n.find("#txt_checkDate").datepicker().datepicker("setDate", new Date).datepicker(); if (n.find("select[id*=ddl_m_Bank_]").length > 1) n.find("#ddl_Banks").html(n.find("select[id*=ddl_m_Bank_]").first().html()).val(""); else bindItemsForSelectCombo({ methodname: "GetComboItems", servicename: "XmlDropDown", headertext: "انتخاب بانک", id: "ddl_Banks", container: e }, { path: "Counter/BankTitle" }); bindItemsForSelectCombo({ data: { ParentName: "bankReceivedDocument" }, methodname: "GetAccountNameWithParentId", servicename: "Management", headertext: "انتخاب حساب دریافتنی", id: "ddl_recievableAccount", container: e }); aComplete({ methodname: "GetCompletionPersonCurrentAccount", servicename: "Management", id: "txt_currentAccountPerson", boxId: "lb_currentAccPersonCode", container: e, minlength: 2, autofocus: false, limit: 20, fname: currAccPersonOnSelect }); n.find("#btn_Add_Payment").off().on("click", function () { }).button({ icons: { primary: "ui-icon-disk" }, text: true }); n.find("[id=btn_currentcheque]").button({ icons: {} }).unbind("click").click(function () { if (n.find("#dialogCurrStatus").length > 0) { n.find("#dialogCurrStatus").attr("id", "dialogCurrStatus" + e) } var t = $("#dialogCurrStatus" + e); t.dialog(open).dialog({ width: 500 }); bindItemsForSelectCombo({ data: { ParentName: "bankReceivedDocument" }, methodname: "GetAccountNameWithParentId", servicename: "Management", headertext: "انتخاب حساب دریافتنی", id: "ddl_accontRecievedBank", container: "dialogCurrStatus" + e }) }); n.find("[id=btn_passedcheque]").button({ icons: {} }).unbind("click").click(function () { if (n.find("#dialogpassStatus").length > 0) { n.find("#dialogpassStatus").attr("id", "dialogpassStatus" + e) } var t = "dialogpassStatus" + e; var r = $("#" + t); r.dialog(open).dialog({ width: 500 }); var i = $("#dialogpassStatus" + e); bindItemsForSelectCombo({ data: { ParentName: "currentAccount" }, methodname: "GetchildAccountNameWithParentName", servicename: "Management", headertext: "انتخاب حساب دریافتنی", id: "ddl_RecievableAccPass", container: t }) }); n.find("[id=btn_returncheque]").button({ icons: {} }).unbind("click").click(function () { if (n.find("#dialogReturnStatus").length > 0) { n.find("#dialogReturnStatus").attr("id", "dialogReturnStatus" + e) } var t = $("#dialogReturnStatus" + e); t.dialog(open).dialog({ width: 500 }) }); n.find("[id=btn_givecheque]").button({ icons: {} }).unbind("click").click(function () { if (n.find("#dialogGiveStatus").length > 0) { n.find("#dialogGiveStatus").attr("id", "dialogGiveStatus" + e) } var t = $("#dialogGiveStatus" + e); t.dialog(open).dialog({ width: 500 }); aComplete({ methodname: "GetCompletionPersonCurrentAccount", servicename: "Management", id: "txt_curAccountPersonRec", boxId: "lb_curAccountPersonRec", container: "dialogGiveStatus" + e, minlength: 2, autofocus: false, limit: 20, fname: curAccPersonRecieveOnSelect }) }); n.find("[id=btn_saveRetStatus]").button({ icons: {} }).unbind("click").click(function () { changeChequeStatus("return", e) }); n.find("[id=btn_savecurrStatus]").button({ icons: {} }).unbind("click").click(function () { changeChequeStatus("current", e) }); n.find("[id=btn_savePassStatus]").button({ icons: {} }).unbind("click").click(function () { changeChequeStatus("pass", e) }); n.find("[id=btn_saveGiveStatus]").button({ icons: {} }).unbind("click").click(function () { changeChequeStatus("give", e) }); n.find("#frm_RecievedCheck").ajaxForm({ data: { ShopId: $("#userDefault").find("#ddl_s_Branch").val(), CounterId: $("#userDefault").find("#ddl_m_Counter").val(), isper: isper }, success: function (t) { getchequeList(e, { container: e, callbackmethod: getchequeList, fname: "", page_index: 0, build: buildchequeList, servicename: "Management", methodname: "GetRecievedcheque", print: false }) }, complete: function (e) { } }) } getchequeList(e, { container: e, callbackmethod: getchequeList, fname: "", page_index: 0, build: buildchequeList, servicename: "Management", methodname: "GetRecievedcheque", print: false }) } function changeChequeStatus(e, t) { var n = $("#" + t); var r = n.find("#hi_SelectedchequeAccDetailId").val(); if (e == "current") { var i = $("#dialogCurrStatus" + t); var s = { type: e, accdetailId: r, recievableAcc: i.find("#ddl_accontRecievedBank").val(), personCode: null, description: i.find("#txt_commentChangeStatus").val()} } if (e == "pass") { var i = $("#dialogpassStatus" + t); var s = { type: e, accdetailId: r, recievableAcc: i.find("#ddl_RecievableAccPass").val(), personCode: null, description: i.find("#txt_commentChangeStatusPass").val()} } if (e == "give") { var i = $("#dialogGiveStatus" + t); var s = { type: e, accdetailId: r, recievableAcc: null, personCode: i.find("#txt_curAccountPersonRec").val(), description: i.find("#txt_commentChangeStatusGive").val()} } if (e == "return") { var i = $("#dialogReturnStatus" + t); var s = { type: e, accdetailId: r, recievableAcc: null, personCode: null, description: i.find("#txt_commentChangeStatusRet").val()} } $.ajax({ type: "POST", url: "Management/ChangeChequeStatus", contentType: "application/json; charset=utf-8", data: JSON.stringify(s), success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg); if (e.isdone) getchequeList(t, { container: t, callbackmethod: getchequeList, fname: "", page_index: 0, build: buildchequeList, servicename: "Management", methodname: "GetRecievedcheque", print: false }) }, error: function (e) { alert(e.responseText) } }) } function getchequeList(e, t) { var n = $("#" + e); var r = []; r = { sort: sortid, ShopId: $("#userDefault").find("#ddl_s_Branch").val(), CounterId: $("#userDefault").find("#ddl_m_Counter").val() }; t["DTO"] = r; pageselectCallback(0, t, { container: "", fname: t.fname, pagingContainer: e, first: true, isOrder: true }) } function buildchequeList(jq, container) { var $con = $("#" + container.pagingContainer); var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "dueDate", sort: "", width: "8%" }); lsth.push({ title: "chequeSerial", sort: "Serial", width: "10%" }); lsth.push({ title: "payerAccount", sort: "ac_AccountDetail.ac_Account.Name", width: "20%" }); lsth.push({ title: "description", sort: "ac_AccountDetail.Description", width: "40%" }); lsth.push({ title: "amount", sort: "ac_AccountDetail.Amount", width: "10%" }); lsth.push({ title: "status", sort: "Status", width: "8%" }); if (!container.params.print) { lsth.push({ title: "deleteKey", width: "4%" }) } var List = typeof jq.results == "string" ? eval("(" + jq.results + ")") : jq.results; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; if (!container.params.print) trBody[0] = { trId: val.AccountDetailId }; trBody[1] = { props: { date: val.DueDate, name: "date", width: "8%", klass: "date" }, html: val.DueDate }; trBody[2] = { name: "Serial", html: val.Serial, width: "10%" }; trBody[3] = { name: "reciever", html: val.issuer, width: "20%" }; trBody[4] = { name: "Description", html: val.reciever + "" + val.Description, width: "40%" }; trBody[5] = { name: "amount", html: val.amount, width: "10%" }; var st = ""; if (val.Status == 1) st = "دریافتنی"; if (val.Status == 2) st = "در جریان"; if (val.Status == 3) st = "وصولی"; if (val.Status == 4) st = "واگذارده"; if (val.Status == 5) st = "برگشتی"; trBody[6] = { name: "Status", html: st, width: "8%" }; lstb.push(trBody) } table = { header: lsth, body: lstb, details: { deleteFunction: RemoveCheque, rowClick: clickcheque }, heigth: 300, container: container.pagingContainer, divName: "chequeList" }; buildTable(table) } function RemoveCheque(e, t) { var n = $("#" + t); var r = { accDetailId: e, isRecieved: true }; $.ajax({ type: "POST", url: "Management/DeleteCheque", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg); if (e.isdone) getchequeList(t, { container: t, callbackmethod: getchequeList, fname: "", page_index: 0, build: buildchequeList, servicename: "Management", methodname: "GetRecievedcheque", print: false }) }, error: function (e) { alert(e.responseText) } }) } function clickcheque(e, t) { var n = e.parents("tbody"); $("#" + t).find("#chequeList  table  tr").removeClass("ui-state-error"); e.addClass("ui-state-error"); var r = $("#" + t); var i = e.closest("tr").attr("id"); var s = i.substring(2, i.length); r.find("#hi_SelectedchequeAccDetailId").val(s); onRowClick(e) } function currAccPersonOnSelect(e, t, n, r) { var i = $("#" + n); i.find("#lb_currentAccPersonName").html(t.item.label); i.find("#txt_currentAccountPerson").val(t.item.value); i.find("#hi_currentAccPeraccId").val(t.item.id) } function curAccPersonRecieveOnSelect(e, t, n, r) { var i = $("#" + n); i.find("#lb_curAccountPersonRec").html(t.item.label); i.find("#txt_curAccountPersonRec").val(t.item.value); i.find("#hi_curAccPeraccIdRec").val(t.item.id) } function currAccountRecivable(e, t, n, r) { var i = $("#" + n); i.find("#lb_recievableAccountName").html(t.item.label); i.find("#txt_recievableAccount").val(t.item.value) } function loadPaidDocument(e, t) { var n = $("#" + e); if (t) { sortid = "DueDate desc"; n.find("#txt_checkDate").datepicker().datepicker("setDate", new Date).datepicker(); bindItemsForSelectCombo({ data: { ParentName: "bankPaidDocument" }, methodname: "GetChildAccountNameWithParent", servicename: "Management", headertext: "انتخاب حساب پرداختنی", id: "ddl_accountPaidBanks", container: e }); n.find("[id=btn_addRow]").unbind("click").click(function () { AddRowTblPaidDocument(e) }); for (var r = 0; r < 3; r++) { AddRowTblPaidDocument(e) } getPaidchequeList(e, { container: e, callbackmethod: getPaidchequeList, fname: "", page_index: 0, build: buildPaidchequeList, servicename: "Management", methodname: "GetPaidcheque", print: false }); n.find("#btn_Add_Payment").off().on("click", function () { }).button({ icons: { primary: "ui-icon-disk" }, text: true }); n.find("#frm_PaidCheck").ajaxForm({ data: { ShopId: $("#userDefault").find("#ddl_s_Branch").val(), CounterId: $("#userDefault").find("#ddl_m_Counter").val(), currencyId: $("#userDefault").find("#ddl_m_Currency").val(), countRow: n.find("#chequePaidList").children().length, isper: isper }, success: function (t) { $("#hi_SelectedchequeAccDetailId").val("0"); getPaidchequeList(e, { container: e, callbackmethod: getPaidchequeList, fname: "", page_index: 0, build: buildPaidchequeList, servicename: "Management", methodname: "GetPaidcheque", print: false }) }, complete: function (e) { } }) } } function AddRowTblPaidDocument(e, t) { var n = $("#" + e); var r = n.find("#chequePaidList").children().length; var i = r; var s = "<tr id='" + i + "' > <td width='3%'>" + " <label id='lb'></label>" + "<input type='hidden' id='hi_AccDetailId' name='hi_AccDetailId' />" + "</td>" + "<td width='6%'>" + "<input type='text' id='PersonAccCode' name='PersonAccCode' placeholder='accountCode' class=' inputText inputW136'/>" + "</td>" + "<td width='6%'>" + "<input type='text' id='txt_PersonAcc' name='txt_PersonAcc' placeholder='account' class=' inputText inputW136 validate'/>" + "</td>" + "<td width='40%'>" + " <input type='text'  name='txt_comment' id='txt_comment' placeholder='description' style='width: 100%'/>" + "</td>" + "<td width='3%'>" + " <input type='text' name='txt_amount' placeholder='amount' class=' inputW80 digit'/>" + "</td>" + " <td width='3%'>" + "<select class='selectMedium' name='ddl_Currency'>" + " </select>" + "</td>" + "<td width='3%'>" + " <span title='حذف' id='delete' name='delete' class='cursor ui-icon ui-icon-closethick'></span>" + "</td> </tr>"; $("#lb_" + i).text(r); n.find("#chequePaidList").append(s).parent().tableScroll({ height: 300, width: contentwidth, flush: false }); PaidDocumentControlesID(e, t); n.find("[id=delete]").unbind().click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) { var n = $(this).parents("tr").first().prop("id"); $("#" + n).remove(); PaidDocumentControlesID(e, t) } else return }); localize() } function PaidDocumentControlesID(e, t) { var n = $("#" + e); var r = 1; var i = 1; $.each($("#" + e).find("#chequePaidList tr"), function () { $(this).attr("id", r); $(this).find("[id*=hi_AccDetailId]").attr("name", "hi_AccDetailId" + r); $(this).find("[id*=hi_AccDetailId]").attr("id", "hi_AccDetailId" + r); $(this).find("[id*=PersonAccCode]").attr("name", "PersonAccCode" + r); $(this).find("[id*=PersonAccCode]").attr("id", "PersonAccCode" + r); $(this).find("input[name*=txt_PersonAcc]").attr("name", "txt_PersonAcc" + r); $(this).find("input[name*=txt_PersonAcc]").attr("id", "txt_PersonAcc" + r); $(this).find("input[name*=txt_comment]").attr("name", "txt_comment" + r); $(this).find("input[name*=txt_comment]").attr("id", "txt_comment" + r); $(this).find("[id*=lb]").attr("name", "lb_" + r); $(this).find("[id*=lb]").attr("id", "lb_" + r); if ($(this).find("[id*=lb]").length > 0) { $("#lb_" + r).text(i); i++ } aComplete({ methodname: "GetCompletionPersonCurrentAccount", servicename: "Management", id: "txt_PersonAcc" + r, boxId: "PersonAccCode" + r, container: e, minlength: 2, autofocus: false, limit: 20, fname: currPaidAccOnSelect }); $(this).find("input[name*=txt_amount]").attr("name", "txt_amount" + r); $(this).find("input[name*=txt_amount]").attr("id", "txt_amount" + r); var n = "ddl_Currency" + r; $(this).find("[name*=ddl_Currency]").attr("name", n); $(this).find("[name=" + n + "]").html($("#userDefault").find("#ddl_m_Currency").html()).find("option:eq(1)").prop("selected", "selected"); if (t != null && t != "undefined") { $(this).find("#" + "PersonAccCode" + r).val(t.Code); $(this).find("#" + "txt_PersonAcc" + r).val(t.Name); $(this).find("#" + "txt_comment" + r).val(t.Description); $(this).find("#" + "txt_amount" + r).val(t.Amount); $(this).find("#" + "ddl_Currency" + r).val(t.CurrencyRateId); $(this).find("#" + "hi_AccDetailId" + r).val(t.AccountDetailId) } r++ }) } function currPaidAccOnSelect(e, t, n, r) { var i = $("#" + n); var s = r.replace("txt_PersonAcc", "txtPersonAccCode"); i.find(s).val(t.item.value); i.find(r).val(t.item.label) } function getPaidchequeList(e, t) { var n = $("#" + e); var r = []; r = { sort: sortid, ShopId: $("#userDefault").find("#ddl_s_Branch").val(), CounterId: $("#userDefault").find("#ddl_m_Counter").val() }; t["DTO"] = r; pageselectCallback(0, t, { container: "", fname: t.fname, pagingContainer: e, first: true, isOrder: true }) } function buildPaidchequeList(jq, container) { var $con = $("#" + container.pagingContainer); var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "dueDate", sort: "DueDate", width: "8%" }); lsth.push({ title: "chequeSerial", sort: "Serial", width: "7%" }); lsth.push({ title: "chequeReciever", sort: "ac_AccountDetail.ac_Account.Name", width: "33%" }); lsth.push({ title: "description", sort: "ac_AccountDetail.Description", width: "30%" }); lsth.push({ title: "amount", sort: "ac_AccountDetail.Amount", width: "10%" }); lsth.push({ title: "status", sort: "Status", width: "8%" }); if (!container.params.print) { lsth.push({ title: "deleteKey", width: "4%" }) } var List = typeof jq.results == "string" ? eval("(" + jq.results + ")") : jq.results; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; if (!container.params.print) trBody[0] = { trId: val.AccountDetailId }; trBody[1] = { props: { date: val.DueDate, name: "date", width: "8%", klass: "date" }, html: val.DueDate }; trBody[2] = { name: "Serial", html: val.Serial, width: "7%" }; trBody[3] = { name: "reciever", html: val.reciever + " " + val.issuer, width: "33%" }; trBody[4] = { name: "Description", html: val.Description, width: "30%" }; trBody[5] = { name: "amount", html: val.amount, width: "10%" }; var st = ""; if (val.pass) st = "پاس شده"; else st = "پاس نشده"; trBody[6] = { name: "Status", html: st, width: "8%" }; lstb.push(trBody) } table = { header: lsth, body: lstb, details: { deleteFunction: RemovePaidCheque, rowClick: clickPaidcheque }, heigth: 300, container: container.pagingContainer, divName: "chequeList" }; buildTable(table) } function RemovePaidCheque(e, t) { var n = $("#" + t); var r = { accDetailId: e, isRecieved: false }; $.ajax({ type: "POST", url: "Management/DeleteCheque", contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg); if (e.isdone) getPaidchequeList(t, { container: t, callbackmethod: getPaidchequeList, fname: "", page_index: 0, build: buildPaidchequeList, servicename: "Management", methodname: "GetPaidcheque", print: false }) }, error: function (e) { alert(e.responseText) } }) } function clickPaidcheque(e, t) { var n = e.parents("tbody"); var r = $("#" + t); var i = e.closest("tr").attr("id"); var s = i.substring(2, i.length); if (!e.hasClass("ui-state-error")) { $("#" + t).find("#chequeList  table  tr").removeClass("ui-state-error"); e.addClass("ui-state-error"); r.find("#hi_SelectedchequeAccDetailId").val(s); r.find("#chequePaidList").html(""); r.find("#txt_serial").val(""); r.find("#txt_checkDate").val(""); r.find("#ddl_accountPaidBanks").val(""); r.find("#txt_comment").val(""); $.ajax({ type: "POST", url: "Management/GetPaidDocumentInfo", contentType: "application/json; charset=utf-8", data: "{accDetailId: '" + s + "'}", success: function (e) { if (e.isdone) { r.find("#txt_serial").val(e.serial); r.find("#txt_checkDate").val(ToPersianDateDigitYearRight(e.DueDate)); r.find("#ddl_accountPaidBanks").val(e.PayableAcc); r.find("#txt_comment").val(e.Description); r.find("#chk_isPassed").attr("checked", e.passed); r.find("#chequePaidList").html(""); for (var n = 0; n < e.accdetails.length; n++) { AddRowTblPaidDocument(t, e.accdetails[n]) } } else { r.find("#hi_SelectedchequeAccDetailId").val("0"); for (var n = 0; n < 3; n++) { AddRowTblPaidDocument(t) } alert(e.msg) } }, error: function (e) { alert(e.responseText) } }) } else { r.find("#chequePaidList").html(""); for (var o = 0; o < 3; o++) { AddRowTblPaidDocument(t) } $("#" + t).find("#chequeList  table  tr").removeClass("ui-state-error"); e.removeClass("ui-state-error"); r.find("#hi_SelectedchequeAccDetailId").val("0") } onRowClick(e) } function loadOpeningAccount(e, t) { var n = $("#" + e); if (t) { GetAccount(e); n.find("#btn_AddNewRow").off().on("click", function () { AddRowTblOpeningAccount(e, null, +n.find("#hi_cRow").val()); n.find("#hi_cRow").val(+n.find("#hi_cRow").val() + 1); var t = 1; $.each($("#" + e).find("#AccountingList tr .trc"), function () { $(this).find("[id*=lb]").text(t); t++ }) }); n.find("#btn_TemporarySaveAccounting").off().on("click", function () { n.find("#isper").val(false) }).button({ icons: { primary: "ui-icon-disk" }, text: true }); n.find("#btn_PermanentSaveAccounting").off().on("click", function () { n.find("#isper").val(true) }).button({ icons: { primary: "ui-icon-disk" }, text: true }) } n.find("#frm_OpeningAccounting").ajaxForm({ data: { ShopId: $("#userDefault").find("#ddl_s_Branch").val(), CurrencyRateId: $("#userDefault").find("#ddl_m_Currency").val(), CounterId: $("#userDefault").find("#ddl_m_Counter").val(), date: $("#userDefault").find("#txt_s_Date").val() }, success: function (e) { }, complete: function (e) { } }) } function GetAccount(e) { var t = $("#" + e); var n = { level: 3 }; $.ajax({ url: "Management/GetAccountwithlevel", data: JSON.stringify(n), dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (n) { if (n.isdone) { var r = t.find("#AccountingList").children().length; for (var i = 0; i < n.results.length; i++) { if (i < 10) AddRowTblOpeningAccount(e, n.results[i], r); r++ } t.find("#AccountingList").parent().tableScroll({ height: 300, width: contentwidth, flush: false }) } else { alert(n.msg) } } }) } function AddRowTblOpeningAccount(e, t, n) { var r = $("#" + e); var i = n + 1; var s = "<tr  class='trc' id='" + i + "' style='border-bottom-style: solid; border-width: 0px 0px 3px 0px; border-color: #C0C0C0'> <td width='6%'>" + " <label id='lb" + i + "'></label>" + "<input type='hidden' id='hi_AccountId" + i + "' name='hi_AccountId" + i + "'  />" + "</td>" + "<td >" + " <table> <tr>  <td width='5%'>" + "<input type='text' id='txt_code" + i + "' name='txt_code" + i + "' placeholder='accountCode'/> </td>" + " <td width='4%'> <input type='text' id='txt_title" + i + "' name='txt_title" + i + "' placeholder='account'/></td>" + "  <td width='11%'><input type='text' placeholder='count' name='txt_Amount" + i + "' id='txt_Amount" + i + "' class='inputW70'/></td>" + "  <td width='6%'><input type='text' placeholder='price' name='txt_price" + i + "' id='txt_price" + i + "'/></td>" + " <td width='10%'><select name='ddl_Branch" + i + "'  id='ddl_Branch" + i + "'></select></td>" + "  <td width='6%'><input type='text' placeholder='debtor' name='txt_deptor" + i + "' id='txt_deptor" + i + "'/></td>" + " <td width='6%'><input type='text' placeholder='creditor' name='txt_creditor" + i + "' id='txt_creditor" + i + "'/></td>" + "</tr>" + "<tr >" + "<td colspan='7'>" + " <span title='شرح'></span>" + "<input type='text' placeholder='description'  width='100%' id='txt_description" + i + "' name='txt_description" + i + "'  style='width:95%'/>" + "</td>" + "</tr> </table></td>" + "<td width='6%'>" + "  <span title='حذف' id='delete' name='delete' class='cursor ui-icon ui-icon-closethick' ></span>" + "</td> " + "</tr>"; r.find("#AccountingList").append(s); r.find("#hi_cRow").val(i); aComplete({ methodname: "GetCompletionListByAccountName", servicename: "Management", id: "txt_title" + i, boxId: "txt_code" + i, container: e, minlength: 2, autofocus: false, limit: 20, fname: OpeningAccountOnSelect }); if (t != null) { r.find("#hi_AccountId" + i).val(t.AccountId); r.find("#txt_code" + i).val(t.Code); r.find("#txt_title" + i).val(t.Name) } var o = "lb" + i; r.find("#" + o).text(i); r.find("#ddl_Branch" + i).html($("#userDefault").find("#ddl_s_Branch").html()).val(""); r.find("#txt_Amount" + i).val("0"); r.find("#txt_Amount" + i).spinner({ step: 1e3, change: function () { var t = $(this)[0].id.replace("txt_Amount", ""); var n = $(this).val(); var s = r.find("#txt_price" + i).val(); if (n != "" && s != "") { r.find("#txt_deptor" + t).val(n * s) } totalDebtCreditOpeningAccount(e) }, stop: function () { var t = $(this)[0].id.replace("txt_Amount", ""); var n = $(this).val(); var s = r.find("#txt_price" + i).val(); if (n != "" && s != "") { r.find("#txt_deptor" + t).val(n * s) } totalDebtCreditOpeningAccount(e) } }); r.find("#txt_Amount" + i).blur(function (t) { if (t.keyCode == 40) { r.next().find("#txt_Amount" + i).focus().focus(function () { this.select() }) } if (t.keyCode == 38) { r.prev().find("#txt_Amount" + i).focus().focus(function () { this.select() }) } var n = $(this)[0].id.replace("txt_Amount", ""); var s = $(this).val(); var o = r.find("#txt_price" + i).val(); if (s != "" && o != "") { r.find("#txt_deptor" + n).val(s * o) } totalDebtCreditOpeningAccount(e) }); r.find("#txt_price" + i).blur(function (t) { if (t.keyCode == 40) { r.next().find("#txt_price" + i).focus().focus(function () { this.select() }) } if (t.keyCode == 38) { r.prev().find("#txt_price" + i).focus().focus(function () { this.select() }) } var n = $(this)[0].id.replace("txt_price", ""); var s = r.find("#txt_Amount" + i).val(); var o = $(this).val(); if (s != "" && o != "") { r.find("#txt_deptor" + n).val(s * o) } totalDebtCreditOpeningAccount(e) }); r.find("#txt_deptor" + i).blur(function (t) { totalDebtCreditOpeningAccount(e) }); r.find("#txt_creditor" + i).blur(function (t) { totalDebtCreditOpeningAccount(e) }); r.find("[id=delete]").unbind().click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) { var t = $(this).parents("tr").first().prop("id"); $("#" + t).remove(); var n = 1; $.each($("#" + e).find("#AccountingList tr"), function () { if ($(this).find("[id*=lb]").length > 0) { $(this).find("[id*=lb]").text(n); n++ } }); totalDebtCreditOpeningAccount(e) } else return }); localize() } function OpeningAccountOnSelect(e, t, n, r) { var i = $("#" + n); var s = r.replace("txt_title", "txt_code"); i.find(s).val(t.item.value); i.find(r).val(t.item.label) } function totalDebtCreditOpeningAccount(e) { var t = $("#" + e); var n = 0; var r = 0; var i = t.find("#hi_cRow").val(); for (var s = 0; s <= i; s++) { if (t.find("[name=txt_deptor" + s + "]").length > 0) { n += +t.find("[name=txt_deptor" + s + "]").val() } if (t.find("[name=txt_creditor" + s + "]").length > 0) { r += +t.find("[name=txt_creditor" + s + "]").val() } } t.find("#spCreditor").html(r); t.find("#spDeptor").html(n) } function loadTransferProductList(e, t) { sortid = "TransferItemId desc"; if (t) { var n = $("#" + e); n.find("#btnSearchTransferProducts").off().on("click", function () { getTransferProductsList(e, { container: e, callbackmethod: getTransferProductsList, fname: "", page_index: 0, build: buildTransferProductsList, servicename: "Transfer", methodname: "GetTransferProductsList", print: false }) }).button({ icons: { primary: "ui-icon-search"} }); getTransferProductsList(e, { container: e, callbackmethod: getTransferProductsList, fname: "", page_index: 0, build: buildTransferProductsList, servicename: "Management", methodname: "GetTransferProductsList", print: false }); n.find("#div_dialog_TransferProducts").attr("id", "div_dialog_TransferProducts" + e).dialog({ autoOpen: false }).dialog({ width: 750 }) } } function getTransferProductsList(e, t) { var n = $("#" + e); var r = true; var i = n.find("#PageSize").val(); var s = 0; var o = 0; var u = "", a = "", f = "", l = ""; var c = n.find("#ddl_d_SearchBy").val(); if (c == "Barcode") { u = n.find("#txt_s_TransferProducts").val() } if (c == "Name") { a = n.find("#txt_s_TransferProducts").val() } if (c == "Code") { f = n.find("#txt_s_TransferProducts").val() } if (c == "Price") { l = n.find("#txt_s_TransferProducts").val() } var h = { skip: s, take: i, currentPage: o, first: r, sort: sortid, barcode: u, name: a, code: f, price: l, quantityfrom: "", quantityto: "", regdatefrom: "", regdateto: "", shopid: $("#userDefault").find("#ddl_s_Branch").val() }; t["DTO"] = h; t.servicename = "Management"; pageselectCallback(0, t, { container: "", fname: t.fname, pagingContainer: e, first: true, isOrder: false }) } function buildTransferProductsList(jq, container) { var $con = $("#" + container.pagingContainer); var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "date", sort: "Date", width: "20%" }); lsth.push({ title: "fromBranch", sort: "inv_Shop.ShopId", width: "20%" }); lsth.push({ title: "toBranch", sort: "inv_Shop1.ShopId", width: "20%" }); lsth.push({ title: "senderName", sort: "p_Person.AccountId", width: "20%" }); lsth.push({ title: "recieverName", sort: "p_Person1.AccountId", footer: jq.sumDebtor, width: "16%" }); if (!container.params.print) { lsth.push({ title: "details", width: "4%" }) } var List = typeof jq.results == "string" ? eval("(" + jq.results + ")") : jq.results; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; if (!container.params.print) trBody[0] = { trId: val.TransferItemId, trName: val.detail }; trBody[1] = { props: { date: val.Date, name: "date", width: "20%", klass: "dateLong" }, html: val.Date }; trBody[2] = { name: "fromBranch", html: val.ShopFromName, width: "20%" }; trBody[3] = { name: "toBranch", html: val.ShopToName, width: "20%" }; trBody[4] = { name: "senderName", html: val.sendername + "  " + val.senderfamily, width: "20%" }; trBody[5] = { name: "recieverName", html: val.receivername != null && val.receiverfamily != null ? val.receivername + " " + val.receiverfamily : "<button id='btnConfirm'>تایید</button>", width: "16%" }; lstb.push(trBody) } table = { header: lsth, body: lstb, details: { detailsFunction: SelectDetailTransferProducts, confirmFunction: ConfirmTransferProducts }, heigth: 300, container: container.pagingContainer, divName: "TransferProductsList" }; buildTable(table) } function ClickTransferProducts(e) { } function SelectDetailTransferProducts(dis, container) { var $con = $("#div_dialog_TransferProducts" + container); id = $(dis).parents("tr").prop("id").replace("tr", ""); $.ajax({ url: "Management/GetDetailTransferProducts", data: "{id: '" + id + "'}", dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; jq = response; var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<tr id='tr" + val.ItemDetailId + "'>" + "<td width='30%' name='name'>" + val.Barcode + "_" + val.Name + "_" + val.ItemCode + "</td>" + "<td width='15%' name='Size'>" + val.Size + "</td>" + "<td width='15%' name='Color'>" + val.Color + "</td>" + "<td width='20%' name='Quantity'>" + val.Quantity + "  " + val.UnitType + "</td>" + "<td name='" + val.TransferItemId + "' width='20%' id='delete'><button id='a_Button'>حذف</button></td></tr>" } $con.find("#DetailListTransferProducts").html(ItemList).parent().tableScroll({ height: 380, width: 700, flush: false }); $con.find("[id=a_Button]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) RemoveItemDetailTransferProducts($(this).parents("tr").attr("id").replace("tr", ""), $(this).parents("td").attr("name"), container); else return }); $con.find("#btn_PrintBarcode").button({ icons: { primary: "ui-icon-print" }, text: true }).click(function () { buildPrintBarcode({ result: jq, container: container, hasQuantity: true }) }); $con.find("tr[id*=tr]").dblclick(function () { }); $con.dialog("open") }, error: function (e) { alert(e.responseText) } }) } function RemoveItemDetailTransferProducts(e, t, n) { var r = $("#div_dialog_TransferProducts" + n); $.ajax({ url: "Management/DeleteDetailTransferProducts", data: "{id: '" + e + "',TransferId:'" + t + "'}", dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (t) { if (!isAuthenticated(t)) return; if (t.isDone) r.find("#tr" + e).remove(); translate(t.msg) }, error: function (e) { alert(e.responseText) } }) } function ConfirmTransferProducts(e, t) { var n = $("#" + t); $.ajax({ url: "Management/ConfirmTransferProducts", data: "{id: '" + $(e).parent().parent().prop("id").replace("tr", "") + "'}", dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; translate(e); getTransferProductsList(t, { container: t, callbackmethod: getTransferProductsList, fname: "", page_index: 0, build: buildTransferProductsList, servicename: "Transfer", methodname: "GetTransferProductsList", print: false }) }, error: function (e) { alert(e.responseText) } }) } function loadTransferProducts(e, t) { sortid = "BarcodeId desc"; if (t) { var n = $("#" + e); n.find("#dialog").attr("id", "dialog" + e); bindItemsForSelectCombo({ methodname: "getAvailablity", servicename: "Management", id: "ddl_m_Availability", container: e, headertext: "وضعیت کالا", selectedindex: 1 }); n.find("#txt_s_ProductCode,#txt_s_ProductBarcode").bind("keydown", function (t) { if (t.keyCode == 13 || t.keyCode == 9) { getBarcodeListOrder(e, { container: "dialog", callbackmethod: getBarcodeListOrder, fname: GetItemTransferProducts, page_index: 0, build: buildBarcodeListOrder, servicename: "Inventory", methodname: "GetItemsList" }) } }); aComplete({ methodname: "GetCompletionListByItemName", servicename: "AtuoComplete", id: "txt_s_ProductCode", container: e, minlength: 2, autofocus: false, limit: 10, boxId: "txt_s_ProductCode" }, { Status: "ddl_m_Availability" }); n.find("#btn_AddTransferProducts").button({ icons: { primary: "ui-icon-transferthick-e-w"} }); bindItemsForSelectCombo({ methodname: "getShopName", servicename: "Management", id: "ddl_m_Branch", container: e, headertext: "انتخاب شعبه " }); n.find("#DialogBarcode").dialog({ autoOpen: false }).dialog({ width: 750 }); n.find("#dialog_ItemQuantity").dialog({ autoOpen: false }); bindHierarchyData({ id: "hr_s_Category", container: e, styleclass: "PagingSelect selectMedium", table: "category" }); n.find("#btn_SearchProduct").button({ icons: { primary: "ui-icon-search"} }).off().on("click", function () { getBarcodeListOrder(e, { container: "dialog", callbackmethod: getBarcodeListOrder, fname: GetItemTransferProducts, page_index: 0, build: buildBarcodeListOrder, servicename: "Management", methodname: "GetItemsList" }) }).button(); n.find("#btn_AddTransferProducts").off().on("click", function () { if (validateAll(n.find("#div_ToCounter")) && n.find("#OrderList").html() != "") AddTransferProducts(e) }).button({ icons: { primary: "ui-icon-transferthick-e-w" }, text: true }); n.find("#OrderList").parent().tableScroll({ height: 380, width: contentwidth, flush: false }) } } function AddTransferProducts(e) { var t = $("#" + e); var n = []; var r = {}; $.each($("#" + e).find("tr[id*=tr]"), function () { var e = {}; e["barcodeid"] = this.id.split("_")[2]; var t = []; $(this).find("input[name=quantity]").each(function () { if (this.value != "") { var e = {}; var n = {}; e = this.id.split("-"); n["ColorID"] = e[0]; n["SizeID"] = e[1]; n["Quantity"] = this.value; t.push(n) } }); e["itemDetails"] = t; n.push(e) }); r["shopidTo"] = t.find("#ddl_m_Branch").val(); r["date"] = $("#userDefault").find("#txt_s_Date").val(); r["shopidFrom"] = $("#userDefault").find("#ddl_s_Branch").val(); r["description"] = t.find("#txt_m_Description").val(); var i = { header: r, itemDetails: n }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(i), type: "Post", url: "Management/AddTransferProducts", success: function (e) { if (!isAuthenticated(e)) return; translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function GetItemTransferProducts($dis, container, barcode) { var $con = $("#" + container); if (barcode == undefined) { var b = $dis.closest("tr").attr("id"); barcode = b.substring(2, b.length) } var ItemList = ""; var DTO = { barcode: barcode, shopId: $("#userDefault").find("#ddl_s_Branch").val(), isReturn: false }; $.ajax({ url: "Management/GetProductForOrderByBarcode", data: JSON.stringify(DTO), dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; $con.find("#txt_s_ProductBarcode").val(""); var count = $con.find("tr[id*='tr_" + container + "']").length; var List = typeof response == "string" ? eval("(" + response + ")") : response; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trid = "tr_" + container + "_" + val.barcodeid + "_" + count; ItemList += "<tr id='" + trid + "'>" + "<td width='20%'><a href='javascript:showQuantity(\"" + container + '","' + val.barcode + "\");'>" + val.name + " " + val.code + " " + val.barcode + "</a></td>" + "<td width='10%' id='mesureunit'>" + " <select   id='ddl_m_measureunit_" + trid + "' disabled='disabled' class='select95'></select>" + "</td>" + "<td width='10%'><input type='text'  class=' inputText inputW50 ' id='txt_m_TotalQuantity'  disabled='disabled' value='0'/></td>" + "<td width='50%' id='Div_Product_Quantity_" + trid + "' dir='rtl'></td>" + "<td width='10%' id='delete'><button id='btn_deleteProduct'>حذف</button></td></tr>" } $con.find("#OrderList").append(ItemList).parent().tableScroll({ height: 380, width: contentwidth, flush: false }); $con.find("[id=btn_deleteProduct]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).unbind().bind("click", function () { if (confirm("آیا از حذف مطمئن هستید؟")) RemoveItemOrderElementTransferProducts($(this).parents("tr").attr("id"), container); else return }); buildColorSizeTable(barcode, $("#userDefault").find("#ddl_s_Branch").val(), false, "GetItemDetailsByBarcodeAndShopIDNoQuantity", "Div_Product_Quantity_" + trid, trid); bindComboData({ id: "ddl_m_measureunit_" + trid, container: trid, isMeasureUnit: true }, val.measureUnits); $("#ddl_m_measureunit_" + trid).change(function () { SumTransferProducts(trid, container) }) }, error: function (e) { alert(e.responseText) } }) } function RemoveItemOrderElementTransferProducts(e, t) { $("#" + e).remove(); SumTransferProducts(e, t) } function SumTransferProducts(e, t) { $("#" + e).find("#txt_m_TotalQuantity").val(getTotalQuantity(e, t) * ($("#" + e).find("[id*=ddl_m_measureunit]").val() != null ? $("#" + e).find("[id*=ddl_m_measureunit]").val().split("_")[0] : 1)) } function loadProfitAndLossReport(e, t) { var n = $("#" + e); if (t) { GetProfitAndLossReports(e); $("#ddl_ProfitLossReportType").unbind("change").bind("change", function (t) { GetProfitAndLossReports(e) }); n.find("#btn_Print").off().on("click", function () { PrintProfitAndLossDetails(e) }).button({ icons: { primary: "ui-icon-print" }, text: true }) } } function GetProfitAndLossReports(e) { var t = $("#" + e); var n = t.find("#ddl_ProfitLossReportType").children(":selected").attr("id"); if (n == null) selectedReportType = 2; var r = { id: n }; var i = ""; t.find("#ProfitAndLossReport").html(""); $.ajax({ url: "Management/GetProfitAndLoss", data: JSON.stringify(r), dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e.result)) return; for (var n = 0; n < e.result.length; n++) { var r = e.result[n]; var s = 0; if (r.GroupType == 4 || r.GroupType == 5) { if (r.balance > 0) s = "(" + r.balance + ")"; else s = -1 * r.balance } else { if (r.GroupType != 0) { if (r.balance > 0) s = "(" + -1 * r.balance + ")"; else s = -1 * r.balance } else s = r.balance } i += "<tr>" + "<td width='20%'>" + r.Name + "</td>" + "<td width='20%' >" + s + "</td>" + "<td width='20%' ></td>" + "<td width='10%' ></td>" + "<td width='20%' ></td>" + "</tr>" } if (t.find("#td_CurrentPhaseEndProfit").text() == "") t.find("#td_CurrentPhaseEndProfit").html("<span>PeriodEndProfit</span>" + ToPersianDateDigitYearRight(e.endDate)); t.find("#ProfitAndLossReport").html(i).parent().tableScroll({ height: 380, width: contentwidth, flush: false }) }, error: function (e) { alert(e.responseText) } }) } function PrintProfitAndLossDetails(e) { var t = $("#" + e); if (t.find("#Div_Print").html().length < 10) { t.find("#Div_Print").load("Report/PrintProfitAndLoss.htm", function () { getProfitAndLossPrint(e) }) } else getProfitAndLossPrint(e) } function getProfitAndLossPrint(e) { var t = $("#" + e); var n = { id: t.find("#ddl_ProfitLossReportType").children(":selected").attr("id") }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(n), type: "Post", url: "Management/GetProfitAndLoss", success: function (n) { if (!isAuthenticated(n)) return; if (n.isdone) { SetProftitAndLossData(e, n); Popup(t.find("#Div_Print").html()) } else alert("noData") }, error: function (e) { alert(e.responseText) } }) } function SetProftitAndLossData(e, t) { var n = $("#" + e); var r = ""; var i = 0; var s = 0; for (var o = 0; o < t.result.length; o++) { var u = t.result[o]; if (u.Code != 0) { if (u.balance < 0) { if (o + 2 == t.result.length) r += "<tr  >" + "<td width='20%' style='  border-top: hidden; width: 20%;' >" + u.Code + "</td>" + "<td width='40%' style=' border-top: hidden; width: 40%;'>" + u.Name + "</td>" + "<td width='10%' style='  border-top: hidden; width: 10%;'>" + -1 * u.balance + "</td>" + "<td width='10%' style=' border-top: hidden; width: 10%;'>&nbsp;</td>" + "</tr>"; else r += "<tr  >" + "<td width='20%' style='border-bottom: hidden; border-top: hidden; width: 20%;' >" + u.Code + "</td>" + "<td width='40%' style='border-bottom: hidden; border-top: hidden; width: 40%;'>" + u.Name + "</td>" + "<td width='10%' style='border-bottom: hidden; border-top: hidden; width: 10%;'>" + -1 * u.balance + "</td>" + "<td width='10%' style='border-bottom: hidden; border-top: hidden; width: 10%;'>&nbsp;</td>" + "</tr>"; i += -1 * u.balance } else { if (o + 2 == t.result.length) r += "<tr  >" + "<td width='20%' style=' border-top: hidden; width: 20%;'>" + u.Code + "</td>" + "<td width='40%'style='  border-top: hidden; width: 40%;'>" + u.Name + "</td>" + "<td width='10%' style=' border-top: hidden; width: 10%;'>&nbsp;</td>" + "<td width='10%' style='  border-top: hidden; width: 10%;' >" + u.balance + "</td>" + "</tr>"; else r += "<tr  >" + "<td width='20%' style='border-bottom: hidden; border-top: hidden; width: 20%;'>" + u.Code + "</td>" + "<td width='40%'style='border-bottom: hidden; border-top: hidden; width: 40%;'>" + u.Name + "</td>" + "<td width='10%' style='border-bottom: hidden; border-top: hidden; width: 10%;'>&nbsp;</td>" + "<td width='10%' style='border-bottom: hidden;  border-top: hidden; width: 10%;' >" + u.balance + "</td>" + "</tr>"; s += u.balance } } } r += "<tr  >" + "<td colspan='2'  style='border-bottom: hidden; border-left: hidden; border-right: hidden; width: 20%;'><table width='100%'><tr><td width='60%' style='direction:ltr;'>" + t.Date + "</td><td width='40%' style='direction:ltr;'>جمع کل</td></tr></table></td>" + "<td width='10%' >" + i + "</td>" + "<td width='10%'  >" + s + "</td>" + "</tr>"; if (s > i) r += "<tr  >" + "<td colspan='2' style='border-bottom: hidden; border-left: hidden; border-right: hidden; border-top: hidden; width: 20%; direction:ltr;'>زیان ویژه دوره عملکرد</td>" + "<td width='10%' >&nbsp;</td>" + "<td width='10%' >" + (s - i) + "</td>" + "</tr>"; else if (s < i) r += "<tr  >" + "<td colspan='2' style='border-bottom: hidden; border-left: hidden; border-right: hidden; border-top: hidden; width: 20%; direction:ltr;'>سود ویژه دوره عملکرد</td>" + "<td width='10%' >" + (i - s) + "</td>" + "<td width='10%' style='border-left: hidden;' ></td>" + "</tr>"; else r += "<tr  >" + "<td colspan='2' style='border-bottom: hidden; border-left: hidden; border-right: hidden; border-top: hidden; width: 20%; direction:ltr;'>سود ویژه دوره عملکرد</td>" + "<td width='10%'  >0</td>" + "<td width='10%' style='border-left: hidden; border-bottom:hidden;' >&nbsp;</td>" + "</tr>"; n.find("#ProfitLossList").html(r) } function loadBalanceSheet(e, t) { var n = $("#" + e); GetBalanceSheetReports(e); if (t) { $("#ddl_BalanceSheetReportType").unbind("change").bind("change", function (t) { GetBalanceSheetReports(e) }); n.find("#btn_Print").off().on("click", function () { PrintBalanceSheetDetails(e) }).button({ icons: { primary: "ui-icon-print" }, text: true }) } } function GetBalanceSheetReports(e) { var t = $("#" + e); var n = t.find("#ddl_BalanceSheetReportType").children(":selected").attr("id"); if (n == null) selectedReportType = 2; var r = { id: n }; var i = ""; var s = ""; t.find("#BalanceSheetReport").html(""); $.ajax({ url: "Management/GetBalanceSheet", data: JSON.stringify(r), dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (e) { var n = 0; for (var r = 0; r < e.resultFinance.length; r++) { var o = e.resultFinance[r]; var u = 0; if (o.balance < 0) u = "(" + -1 * o.balance + ")"; else u = o.balance; i += "<tr>" + "<td width='50%'>" + o.Name + "</td>" + "<td width='21%' >" + u + "</td>" + "<td width='21%' ></td>" + "<td width='8%' ></td>" + "</tr>" } for (var r = 0; r < e.resultDebtAndFund.length; r++) { var o = e.resultDebtAndFund[r]; var a = 0; if (o.balance < 0) a = "(" + -1 * o.balance + ")"; else a = o.balance; s += "<tr>" + "<td width='50%' >" + o.Name + "</td>" + "<td width='21%' >" + a + "</td>" + "<td width='21%' ></td>" + "<td width='8%' ></td>" + "</tr>" } if (e.resultFinance.length > e.resultDebtAndFund.length) { for (var r = 0; r < e.resultFinance.length - e.resultDebtAndFund.length; r++) { s += "<tr>" + "<td width='50%' >" + "&nbsp" + "</td>" + "<td width='21%' >" + "" + "</td>" + "<td width='21%' ></td>" + "<td width='8%' ></td>" + "</tr>" } } if (e.resultFinance.length < e.resultDebtAndFund.length) { for (var r = 0; r < e.resultDebtAndFund.length - e.resultFinance.length; r++) { i += "<tr>" + "<td width='50%'>" + "&nbsp" + "</td>" + "<td width='21%' >" + "" + "</td>" + "<td width='21%' ></td>" + "<td width='8%' ></td>" + "</tr>" } } if (t.find("#td_ActualOpEndBalanceSheet").text() == "") { t.find("#td_ActualOpEndBalanceSheet").html("<span>ActualOpEndBalanceSheet</span>" + ToPersianDateDigitYearRight(e.endDate)); t.find("#td_ActualOpEndBalanceSheetDebt").html("<span>ActualOpEndBalanceSheet</span>" + ToPersianDateDigitYearRight(e.endDate)) } t.find("#BalanceSheetFinanceReport").html(i).parent().tableScroll({ height: 380, width: contentwidth / 2, flush: false }); t.find("#BalanceSheetDebtAndFundReport").html(s).parent().tableScroll({ height: 380, width: contentwidth / 2, flush: false }) }, error: function (e) { alert(e.responseText) } }) } function PrintBalanceSheetDetails(e) { var t = $("#" + e); if (t.find("#Div_Print").html().length < 10) { t.find("#Div_Print").load("Report/PrintBalanceSheet.htm", function () { getBalanceSheetPrint(e) }) } else getBalanceSheetPrint(e) } function getBalanceSheetPrint(e) { var t = $("#" + e); var n = { id: t.find("#ddl_BalanceSheetReportType").children(":selected").attr("id") }; $.ajax({ contentType: "application/json; charset=utf-8", dataType: "json", data: JSON.stringify(n), type: "Post", url: "Management/GetBalanceSheet", success: function (n) { if (!isAuthenticated(n)) return; if (n.isdone) { SetBalanceSheetData(e, n); Popup(t.find("#Div_Print").html()) } else alert("noData") }, error: function (e) { alert(e.responseText) } }) } function SetBalanceSheetData(e, t) { var n = $("#" + e); var r = ""; var i = 0; var s = 0; var o = 0; var u = 0; if (t.resultFinance.length > t.resultDebtAndFund.length) u = t.resultFinance.length; else u = t.resultDebtAndFund.length; for (var a = 0; a < u; a++) { var f = t.resultFinance[a]; var l = t.resultDebtAndFund[a]; if (f != undefined && f.AccountId == 0) i = f.balance; if (l != undefined && l.AccountId == 0) s = l.balance; if (l != undefined && l.AccountId == -1) o = l.balance; if (a + 2 == u) { if (f != undefined && l != undefined) r += "<tr>" + "<td width='30%' style='  border-top: hidden;' >" + (f != undefined && f.AccountId != 0 ? f.Name : "&nbsp;") + "</td>" + "<td width='20%' style='border-top: hidden;' >" + (f.balance != undefined && f.AccountId != 0 ? f.balance : "&nbsp;") + "</td>" + "<td width='30%' style='border-top: hidden;'>" + (l != undefined && l.AccountId != 0 ? l.Name : "&nbsp;") + "</td>" + "<td width='20%' style='border-top: hidden;'>" + (l != undefined && l.AccountId != 0 ? l.balance : "&nbsp;") + "</td>" + "</tr>" } else { if (f != undefined && l != undefined) r += "<tr  >" + "<td width='30%' style='  border-top: hidden;border-bottom: hidden;' >" + (f != undefined && f.AccountId != 0 ? f.Name : "&nbsp;") + "</td>" + "<td width='20%' style=' border-top: hidden;border-bottom: hidden;'>" + (f.balance != undefined && f.AccountId != 0 ? f.balance : "&nbsp;") + "</td>" + "<td width='30%' style='  border-top: hidden;border-bottom: hidden;'>" + (l != undefined && l.AccountId != 0 ? l.Name : "&nbsp;") + "</td>" + "<td width='20%' style='  border-top: hidden;border-bottom: hidden;'>" + (l != undefined && l.AccountId != 0 ? l.balance : "&nbsp;") + "</td>" + "</tr>" } } r += "<tr>" + "<td width='30%' style='border-bottom: hidden;border-right: hidden;border-left: hidden;' >" + ToPersianDate(new Date) + "</td>" + "<td width='20%' >" + i + "</td>" + "<td width='30%' style='border-bottom: hidden;border-left: hidden;border-right: hidden;'></td>" + "<td width='20%' >" + s + "</td></tr>"; r += "<tr>" + "<td width='30%' style='border-bottom: hidden;border-top: hidden;border-right: hidden;border-left: hidden;' ></td>" + "<td width='20%' style='border-bottom: hidden;border-top: hidden;border-right: hidden;border-left: hidden;'></td>" + "<td width='30%' style='border-bottom: hidden;border-top: hidden;border-right: hidden;border-left: hidden;direction:rtl;text-align:left;'>زیان :</td>" + "<td width='20%' style='border-bottom: hidden;border-top: hidden;border-right: hidden;border-left: hidden;'>" + o + "</td></tr>"; n.find("#BalanceSheetList").html(r) } function loadFiscalPeriod(e, t) { var n = $("#" + e); if (t) { n.find("#txt_dateStart").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { n.find("#txt_endingDate").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])); n.find("#txt_ClosingDate").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); n.find("#txt_endingDate").datepicker({ changeMonth: true, changeYear: true }); n.find("#txt_ClosingDate").datepicker({ changeMonth: true, changeYear: true }); n.find("#Frm_FiscalPeriod").ajaxForm({ success: function (t) { getFiscalPeriodList(e, { container: e, callbackmethod: getBankList, fname: "", page_index: 0, build: buildFiscalPeriodList, servicename: "Management", methodname: "GetFiscalPeriodList", print: false }); n.find("#hi_SelectedFiscalPeriodId").val(""); alert(t.msg) }, complete: function (e) { n.find("#hi_SelectedFiscalPeriodId").val("") }, error: function (e) { n.find("#hi_SelectedFiscalPeriodId").val("") } }); getFiscalPeriodList(e, { container: e, callbackmethod: getBankList, fname: "", page_index: 0, build: buildFiscalPeriodList, servicename: "Management", methodname: "GetFiscalPeriodList", print: false }); localize() } } function getFiscalPeriodList(e, t) { var n = $("#" + e); pageselectCallback(0, t, { container: "", noPaging: true, fname: t.fname, pagingContainer: e, first: true, isOrder: false }) } function buildFiscalPeriodList(jq, container) { var $con = $("#" + container.pagingContainer); var table = {}; var lstb = []; var lsth = []; var details = {}; lsth.push({ title: "FiscalPeriodName", width: "20%" }); lsth.push({ title: "dateStart", width: "20%" }); lsth.push({ title: "endingDate", width: "20%" }); lsth.push({ title: "ClosingDate", width: "20%" }); if (!container.params.print) { lsth.push({ title: "deleteKey", width: "4%" }) } var List = typeof jq.results == "string" ? eval("(" + jq.results + ")") : jq.results; var ItemList = ""; if (List != null) for (var i = 0; i < List.length; i++) { var val = List[0, i]; var trBody = {}; if (!container.params.print) trBody[0] = { trId: val.FiscalPeriodId }; trBody[1] = { name: "FiscalPeriodName", html: val.Name + "<input type='hidden' id='hi_dateStart' value='" + val.StartingDate + "'/>" + "<input type='hidden' id='hi_EndingDate' value='" + val.EndingDate + "'/>" + "<input type='hidden' id='hi_ClosingDate' value='" + val.ClosingDate + "'/>", width: "20%" }; trBody[2] = { props: { date: val.StartingDate, name: "dateStart", width: "20%", klass: "date" }, html: val.StartingDate }; trBody[3] = { props: { date: val.EndingDate, name: "endingDate", width: "20%", klass: "date" }, html: val.EndingDate }; trBody[4] = { props: { date: val.ClosingDate, name: "ClosingDate", width: "20%", klass: "date" }, html: val.ClosingDate }; lstb.push(trBody) } table = { header: lsth, body: lstb, details: { deleteFunction: RemoveFiscalPeriod, rowClick: ClickFiscalPeriod }, heigth: 300, container: container.pagingContainer, divName: "FiscalPeriodList" }; buildTable(table) } function RemoveFiscalPeriod(e, t) { var n = { fiscalPeriodId: e }; var r = ""; $con.find("#ProfitAndLossReport").html(""); $.ajax({ url: "Management/RemoveFiscalPeriod", data: JSON.stringify(n), dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (e) { getFiscalPeriodList(t, { container: t, callbackmethod: getBankList, fname: "", page_index: 0, build: buildFiscalPeriodList, servicename: "Management", methodname: "GetFiscalPeriodList", print: false }); alert(e.msg) }, error: function (e) { alert(e.responseText) } }) } function ClickFiscalPeriod(e, t) { var n = $("#" + t); var r = e.closest("tr").attr("id"); var i = r.substring(2, r.length); n.find("#txt_FiscalPeriodName").val($("#" + r).find("[name=FiscalPeriodName]").text()); n.find("#txt_dateStart").val(ToPersianDateDigitYearRight($("#" + r).find("#hi_dateStart").val())); n.find("#txt_endingDate").val(ToPersianDateDigitYearRight($("#" + r).find("#hi_EndingDate").val())); n.find("#txt_ClosingDate").val(ToPersianDateDigitYearRight($("#" + r).find("#hi_ClosingDate").val())); if (!e.hasClass("ui-state-error")) { $("#" + t).find("#FiscalPeriodList  table  tr").removeClass("ui-state-error"); e.addClass("ui-state-error"); n.find("#hi_SelectedFiscalPeriodId").val(i) } else { $("#" + t).find("#FiscalPeriodList  table  tr").removeClass("ui-state-error"); e.removeClass("ui-state-error"); n.find("#hi_SelectedFiscalPeriodId").val("") } onRowClick(e) } function loadInventorySetting(e, t) { var n = $("#" + e); var r = true; var i = true; n.find("#divInventoryAccordion").accordion({ heightStyle: "content", collapsible: true, active: false, activate: function (t, s) { if (s.newPanel.prop("id") == "Color" && n.find("#ddl_m_Color option").length < 1) { bindItemsForSelectCombo({ methodname: "GetColorSystem", servicename: "Management", headertext: "انتخاب رنگ", id: "ddl_m_Color", container: e, setcolor: true }); getListColorSystem(e); n.find("#btn_SubmitColor").button({ icons: { primary: "ui-icon-disk" }, text: true }).die().live("click", function () { if (validateAll(n.find("#Color"))) addColor(e) }); n.find("#btn_EditColor").button({ icons: { primary: "ui-icon-disk" }, text: true }).die().live("click", function () { if (validateAll(n.find("#Color")) && n.find("#selectedColorId").val() != "") editColor(n.find("#selectedColorId").val(), e) }) } if (s.newPanel.prop("id") == "Measure" && r) { bindHierarchyData({ id: "hr_m_MeasureUnit", container: e, canmodify: true, table: "MeasureUnit", css: "selectsmall1" }); r = false } if (s.newPanel.prop("id") == "Size" && i) { getListSize(e); bindItemsForSelectCombo({ methodname: "GetPaternSizeList", servicename: "Management", id: "ddl_m_Size", container: e, headertext: "انتخاب جزئیات " }); n.find("#btn_AddPaternSize_Submit").button({ icons: { primary: "ui-icon-disk" }, text: true }).unbind("click").bind("click", function () { if (validateAll(n.find("#ParentSizeDiv"))) AddPaternSize(e) }); n.find("#btn_AddSize_Submit").button({ icons: { primary: "ui-icon-disk" }, text: true }).unbind("click").bind("click", function () { if (validateAll(n.find("#divAdvanceSize"))) AddSize(e) }); n.find("#btn_EditSize_Submit").button({ icons: { primary: "ui-icon-pencil" }, text: true }).unbind("click").bind("click", function () { if (validateAll(n.find("#divAdvanceSize")) && n.find("#selectedSizeId").val() != "") editSize(n.find("#selectedSizeId").val(), e) }); i = false } } }); localize() } function AddSize(e) { var t = $("#" + e); $.ajax({ url: "Management/AddSize", data: "{size:'" + t.find("#txt_m_Size").val() + "',parentsizeid:'" + t.find("#ddl_m_Size").val() + "'}", dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (t) { if (!isAuthenticated(t)) return; if (t.isdone) getListSize(e); translate(t.msg) }, error: function (e) { alert(e.responseText) } }) } function editSize(e, t) { var n = $("#" + t); $.ajax({ url: "Management/EditSize", data: "{sizeid:'" + e + "', size:'" + n.find("#txt_m_Size").val() + "',parentsizeid:'" + n.find("#ddl_m_Size").val() + "'}", dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; if (e.isdone) { getListSize(t); n.find("#ddl_m_Size").val(0); n.find("#txt_m_Size").val("") } translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function ClickSize(e, t) { var n = $("#" + t); n.find("#ddl_m_Size").val(e.find("td[id*=td]").prop("id").replace("td", "")); n.find("#txt_m_Size").val(e.find("td[name=Size]").html() == "null" ? "" : e.find("td[name=Size]").html()); n.find("#selectedSizeId").val(e.prop("id").replace("tr", "")) } function RemoveSizeElement(e, t) { var n = $("#" + t); $.ajax({ url: "Management/DeleteSize", data: "{sizeid:'" + e + "'}", dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; getListSize(t); translate(e) }, error: function (e) { alert(e.responseText) } }) } function AddPaternSize(e) { var t = $("#" + e); $.ajax({ url: "Management/AddParentSize", data: "{size:'" + t.find("#txt_m_ParentSize").val() + "'}", dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (t) { if (!isAuthenticated(t)) return; bindItemsForSelectCombo({ methodname: "GetPaternSizeList", servicename: "InventorySetting", id: "ddl_m_Size", container: e, headertext: "انتخاب جزئیات" }); getListSize(e); translate(t.msg) }, error: function (e) { alert(e.responseText) } }) } function getListColorSystem(container) { var $con = $("#" + container); $.ajax({ url: "Management/GetListColor", dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; var List = typeof response == "string" ? eval("(" + response + ")") : response; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<tr id='tr" + val.ColorId + "'>" + "<td width='20%' style='background-color: " + val.Color + ";'></td>" + "<td width='35%' name='name'>" + val.Color + "</td>" + "<td width='35%' name='translate'>" + val.ColorTranslate + "</td>" + "<td id='delete' width='10%'><button id='a_Button'>حذف</button></td></tr>" } $con.find("#ListColor").html(ItemList).parent().tableScroll({ height: 380, flush: false }); $con.find("[id=a_Button]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) RemoveColorElement($(this).parents("tr").prop("id").replace("tr", ""), container); else return }); $con.find("tr[id*=tr]").find("td:not([id=delete])").click(function () { ClickColor($(this).parent("tr"), container) }).addClass("cursor"); $con.find("#divInventoryAccordion").accordion({ collapsible: true, heightStyle: "content" }) }, error: function (e) { alert(e.responseText) } }) } function ClickColor(e, t) { var n = $("#" + t); n.find("#ddl_m_Color").val(e.find("td[name=name]").html()); n.find("#selectedColorId").val(e.prop("id").replace("tr", "")); n.find("#txt_m_Translate").val(e.find("td[name=translate]").html() == "null" ? "" : e.find("td[name=translate]").html()) } function addColor(e) { var t = $("#" + e); $.ajax({ url: "Management/AddColor", data: "{color:'" + t.find("#ddl_m_Color").val() + "',translate:'" + t.find("#txt_m_Translate").val() + "'}", dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (t) { if (!isAuthenticated(t)) return; if (t.isdone) getListColorSystem(e); translate(t.msg) }, error: function (e) { alert(e.responseText) } }) } function editColor(e, t) { var n = $("#" + t); $.ajax({ url: "Management/EditColor", data: "{colorid:'" + e + "',color:'" + n.find("#ddl_m_Color").val() + "',translate:'" + n.find("#txt_m_Translate").val() + "'}", dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; if (e.isdone) { getListColorSystem(t); n.find("#txt_m_Translate").val(""); n.find("#ddl_m_Color").val(0) } translate(e.msg) }, error: function (e) { alert(e.responseText) } }) } function getListSize(container) { var $con = $("#" + container); $.ajax({ url: "Management/GetListSize", dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; var List = typeof response == "string" ? eval("(" + response + ")") : response; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; if (val.ParentSizeId != null && val.ParentSizeId != 0) ItemList += "<tr id='tr" + val.SizeId + "'>" + "<td width='45%' name='Parent' id='td" + val.ParentSizeId + "'>" + val.ParentSize + "</td>" + "<td width='45%' name='Size'>" + val.Size + "</td>" + "<td width='10%' id='delete'><button id='a_Button'>حذف</button></td></tr>"; else ItemList += "<tr id='tr" + val.SizeId + "'>" + "<td width='45%' name='Parent' id='td" + val.SizeId + "'>" + val.Size + "</td>" + "<td width='45%' name='Size'></td>" + "<td width='10%' id='delete'><button id='a_Button'>حذف</button></td></tr>" } $con.find("#ListSize").html(ItemList).parent().tableScroll({ height: 380, flush: false }); $con.find("[id=a_Button]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).click(function () { if (confirm("آیا از حذف مطمئن هستید؟")) RemoveSizeElement($(this).parents("tr").prop("id").replace("tr", ""), container); else return }); $con.find("tr[id*=tr]").find("td:not([id=delete])").click(function () { ClickSize($(this).parent("tr"), container) }).addClass("cursor"); $con.find("#divInventoryAccordion").accordion({ collapsible: true, heightStyle: "content" }) }, error: function (e) { alert(e.responseText) } }) } function loadInventoryReportList(e, t) { sortid = "BarcodeId desc"; if (t) { var n = $("#" + e); bindHierarchyData({ id: "hr_s_Category", table: "category", container: e, styleclass: "PagingSelect " }); bindItemsForSelectCombo({ methodname: "getAvailablity", servicename: "Management", id: "ddl_s_Availability", container: e, headertext: "وضعیت کالا", selectedindex: 1 }); getBarcodeReportList(e); n.find("#divslider").unbind("click").click(function () { sliderClick("divInventorysearch"); sliderClick("InventoryAdvanceSearch") }); n.find("#btnSearchInventory").unbind("click").click(function () { getBarcodeReportList(e) }).button({ icons: { primary: "ui-icon-search"} }); n.find("#PageSize").unbind("change").change(function () { getBarcodeReportList(e) }); n.find("#InventoryAdvanceSearchbt").unbind("click").click(function () { getBarcodeReportList(e) }).button(); n.find("#regdateFrom").datepicker({ changeMonth: true, changeYear: true, onSelect: function (e, t) { $("#regdateTo").datepicker("option", "minDate", new JalaliDate(t["selectedYear"], t["selectedMonth"], t["selectedDay"])) } }); n.find("#regdateTo").datepicker({ changeMonth: true, changeYear: true }) } } function getBarcodeReportList(e) { var t = $("#" + e); var n = true; var r = t.find("#PageSize").val(); var i = 0; var s = 0; var o = "", u = "", a = "", f = ""; if (t.find("#divBarcodesearch").is(":visible")) { var l = t.find("#ddl_d_SearchBy").val(); if (l == "Barcode") { o = t.find("#txt_s_Inventory").val() } if (l == "Name") { u = t.find("#txt_s_Inventory").val() } if (l == "Code") { a = t.find("#txt_s_Inventory").val() } if (l == "Price") { f = t.find("#txt_s_Inventory").val() } var c = { skip: i, take: r, currentPage: s, first: n, sort: sortid, barcode: o, name: u, code: a, price: f, categoryid: getHierarchySelectedValue("hr_s_Category", e), status: t.find("#ddl_s_Availability").val(), quantityfrom: t.find("#quantityFrom").val(), quantityto: t.find("#quantityTo").val(), regdatefrom: t.find("#regdateFrom").val(), regdateto: t.find("#regdateTo").val(), shopid: $("#userDefault").find("#ddl_s_Branch").val(), showOnline: t.find("#ddl_s_ShowOnline").val() == undefined ? "" : t.find("#ddl_s_ShowOnline").val(), selectData: "getBarcodeReportList"} } else { var c = { skip: i, take: r, currentPage: s, first: n, sort: sortid, barcode: o, name: u, code: a, price: f, categoryid: getHierarchySelectedValue("hr_s_Category", e), status: t.find("#ddl_s_Availability").val(), quantityfrom: t.find("#quantityFrom").val(), quantityto: t.find("#quantityTo").val(), regdatefrom: t.find("#regdateFrom").val(), regdateto: t.find("#regdateTo").val(), shopid: $("#userDefault").find("#ddl_s_Branch").val(), showOnline: t.find("#ddl_s_ShowOnline").val() == undefined ? "" : t.find("#ddl_s_ShowOnline").val(), selectData: "getBarcodeReportList"} } $.ajax({ url: "Management/GetItemsList", data: JSON.stringify(c), dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (r) { if (!isAuthenticated(r)) return; var i = InventoryReportgetOptionsFrom(r.count, e); t.find("#paging").pagination(r.count, i); InventoryReportpageselectCallback(0, r, e, n) }, error: function (e) { alert(e.responseText) } }) } function InventoryReportgetOptionsFrom(e, t) { var n = $("#" + t); var r = { callback: InventoryReportpageselectCallback }; n.find("input:text").each(function () { r[this.name] = this.className.match(/numeric/) ? parseInt(this.value) : this.value }); r.prev_show_always = false; r.next_show_always = false; if (e < n.find("#PageSize").val()) n.find("#PageSize").css("display", "none"); else { n.find("#PageSize").css("display", "inline") } r.items_per_page = n.find("#PageSize").val(); r.prev_text = "قبلی"; r.next_text = "بعدی"; r.container = t; return r } function InventoryReportpageselectCallback(e, t, n, r) { var i = $("#" + n); var s = "", o = "", u = "", a = ""; if (r) { buildBarcodeReportList(t, n) } else { r = false; var f = i.find("#PageSize").val(); var l = ""; var c = f; var h = e == 0 ? 0 : e * c; if (i.find("#divBarcodesearch").is(":visible")) { var p = i.find("#ddl_d_SearchBy").val(); if (p == "Barcode") { s = i.find("#txt_s_Inventory").val() } if (p == "Name") { o = i.find("#txt_s_Inventory").val() } if (p == "Code") { u = i.find("#txt_s_Inventory").val() } if (p == "Price") { a = i.find("#txt_s_Inventory").val() } var d = { skip: h, take: c, currentPage: e, first: r, sort: sortid, barcode: s, name: o, code: u, price: a, categoryid: getHierarchySelectedValue("hr_s_Category", n), status: i.find("#ddl_s_Availability").val(), quantityfrom: "", quantityto: "", regdatefrom: "", regdateto: "", shopid: $("#userDefault").find("#ddl_s_Branch").val(), showOnline: i.find("#ddl_s_ShowOnline").val() == undefined ? "" : i.find("#ddl_s_ShowOnline").val(), selectData: "getBarcodeReportList"} } else { var d = { skip: h, take: c, currentPage: e, first: r, sort: sortid, barcode: s, name: o, code: u, price: a, categoryid: getHierarchySelectedValue("hr_s_Category", n), status: i.find("#ddl_s_Availability").val(), quantityfrom: "", quantityto: "", regdatefrom: "", regdateto: "", shopid: $("#userDefault").find("#ddl_s_Branch").val(), showOnline: i.find("#ddl_s_ShowOnline").val() == undefined ? "" : i.find("#ddl_s_ShowOnline").val(), selectData: "getBarcodeReportList"} } $.ajax({ url: "Management/GetItemsList", data: JSON.stringify(d), dataType: "json", type: "POST", contentType: "application/json; charset=utf-8", success: function (e) { if (!isAuthenticated(e)) return; buildBarcodeReportList(e, n) }, error: function (e) { alert(e.responseText) } }); return false } Sort(getBarcodeReportList, n) } function buildBarcodeReportList(jq, container) { var $con = $("#" + container); if (jq.results != undefined) { var sumQuantity = jq.sumQuantity; var sumPrice = jq.sumPrice; jq = jq.results; var List = typeof jq == "string" ? eval("(" + jq + ")") : jq; var ItemList = ""; for (var i = 0; i < List.length; i++) { var val = List[0, i]; ItemList += "<tr id='tr" + val.BarcodeId + "'>" + "<td name='barcode' width='7%'>" + val.Barcode + "</td>" + "<td name='code' width='5%'>" + val.ItemCode + "</td>" + "<td name='name' width='7%'>" + val.Name + "</td> " + "<td name='price' width='5%'>" + val.Regular + "</td> " + "<td width='5%'>" + val.Status + "</td>" + "<td width='5%'>" + val.Category + "</td>" + "<td width='5%'>" + val.BuyQuantity + " " + val.UnitType + "</td>" + "<td width='5%'>" + val.AverageBuyPrice + "</td>" + "<td width='6%'>" + val.SellQuantity + " " + val.UnitType + "</td>" + "<td width='5%'>" + val.AverageSellPrice + "</td>" + "<td width='5%'>" + val.TotalAvailableQuantity + " " + val.UnitType + "</td>" + "<td width='5%'>" + val.TotalBrokenQuantity + " " + val.UnitType + "</td>" + "<td width='6%'>" + Math.round(val.BuyQuantity * val.AverageBuyPrice * 100) / 100 + "</td>" + "<td width='6%'>" + Math.round(val.SellQuantity * val.AverageSellPrice * 100) / 100 + "</td>" + "<td width='6%'>" + Math.round((val.SellQuantity * val.AverageSellPrice - val.BuyQuantity * val.AverageBuyPrice) * 100) / 100 + "</td>" + "<td width='5%'>" + (val.SellQuantity > 0 ? Math.round((val.AverageSellPrice - val.AverageBuyPrice) * 1 * 100) / 100 : 0) + "</td>" + "<td width='5%'>" + (val.SellQuantity > 0 ? Math.round((val.AverageSellPrice - val.AverageBuyPrice) / val.AverageBuyPrice * 100 * 100) / 100 : 0) + "</td>" + "<td width='7%'>" + "سود روز:" + "<br/>" + (val.SellQuantity > 0 ? Math.round(val.AveSellPerDay * 100 - (val.AverageSellPrice - val.AverageBuyPrice)) / 100 : 0) + "<br/>" + "فروش روز:" + "<br/>" + Math.round(val.AveSellPerDay * 100) / 100 + "<br/>" + "تاریخ اتمام:" + "<br/>" + (val.SellQuantity > 0 ? val.ItemFinishDate : "<span>unknown</span>") + "<br/>" + "</td>" + "</tr>" } if (sumQuantity != undefined) { $con.find("#divFooter").removeClass("invisible") } $con.find("#spTotalValue").html(sumPrice); $con.find("#spTotalQuantity").html(sumQuantity); $con.find("#BarcodeList").html(ItemList).parent().tableScroll({ height: 380, width: contentwidth, flush: false }); $con.find("tr[id*=tr]").find("td").click(function () { ClickKardex($(this).parent("tr"), container) }).addClass("cursor") } else $con.find("#BarcodeList").parent().tableScroll({ height: 380, width: contentwidth, flush: false }) } function ClickKardex(e, t) { createSubTab({ row: e, name: "a_InventoryReportList" }); onRowClick(e) } function loadProductProperties(e, t) { var n = $("#" + e); if (t) { n.find("#treeDemo").attr("id", "treeDemo" + e); var r = "treeDemo" + e; $.fn.zTree.init(n.find("#" + r), Propertysetting); PropertyzTree = $.fn.zTree.getZTreeObj(r); n.find("#btn_Refresh").off().on("click", function () { $.fn.zTree.init(n.find("#" + r), Propertysetting); PropertyzTree = $.fn.zTree.getZTreeObj(r) }); n.find("#btn_saveProperty").off().on("click", function () { }).button({ icons: { primary: "ui-icon-disk" }, text: true }); n.find("#frm_Property").ajaxForm({ success: function (e) { if (e.isdone) { if (e.isEdit) { PropertyEditTreeNode(e.name, e.isCheck, e.id) } else { var t = { name: e.name, id: e.id, isChecked: e.isCheck }; propertyaddNewTreeNode(t) } } else alert(e.msg) }, complete: function (e) { } }) } localize() } function PropertygetFont(e, t) { return t.font ? t.font : {} } function PropertyonAsyncSuccess(e, t, n, r) { var i = "frm_Property"; var s = $("#" + i); s.find(".zTreeDemoBackground li:even").css("background-color", "#FFFFFF"); s.find(".zTreeDemoBackground li:odd").css("background-color", "#E6F2FF") } function PropertybeforeDrag(e, t) { for (var n = 0, r = t.length; n < r; n++) { if (t[n].drag === false) { return false } } return true } function propertyOnDrop(e, t, n, r, i) { var s = []; for (var o = 0; o < n.length; o++) { s[o] = n[o].id } var u = []; var a; if (r) { if (r.children == undefined) if (r.getParentNode() != null) { a = r.getParentNode().children; $.each(a, function () { u.push(this.id) }) } else { var f = PropertyzTree.getNodesByFilter(filterzTree); $.each(f, function () { u.push(this.id) }) } else { a = r.children; $.each(a, function () { u.push(this.id) }) } } else { var f = PropertyzTree.getNodesByFilter(filterzTree); $.each(f, function () { u.push(this.id) }) } var l = { TableName: "property", TargetId: r == null ? null : i == "inner" ? r.id : r.getParentNode() == null ? null : r.getParentNode().id, treeNodes: s, children: u }; $.ajax({ type: "POST", async: false, url: "Management/TreeDaragDrop", contentType: "application/json; charset=utf-8", data: JSON.stringify(l), success: function (e) { if (e.isdone) alert(e.msg) }, error: function (e) { alert(e.responseText) } }) } function propertyonClick(e, t, n) { var r = "frm_Property"; var i = $("#" + r); i.find("#hi_isEdit").val(true); i.find("#hi_SelectedParentCatId").val(n.id); GetPropertyForEdit(n.id); i.find("#btn_saveProperty").button({ icons: { primary: "ui-icon-disk" }, text: true, label: "edit" }); localize() } function propertybeforeRemove(e, t) { var n = "frm_Property"; var r = $("#" + n); var i = false; if (confirm("Confirm delete node '" + t.name + "' it?")) { var s = t.id; var o = { TableName: "property", id: s }; $.ajax({ type: "POST", async: false, url: "Management/DeleteTree", contentType: "application/json; charset=utf-8", data: JSON.stringify(o), success: function (e) { i = e.isdone; r.find("#hi_isEdit").val(true); r.find("#hi_SelectedParentCatId").val(t.id); GetPropertyForEdit(t.id); r.find("#btn_saveProperty").button({ icons: { primary: "ui-icon-disk" }, text: true, label: "add" }) }, error: function (e) { alert(e.responseText) } }) } return i } function propertybeforeEditName(e, t, n, r) { var i = "frm_Property"; var s = $("#" + i); s.find("#hi_isEdit").val(true); s.find("#hi_SelectedParentCatId").val(t.id); GetPropertyForEdit(t.id); PropertyzTree.selectNode(t); return false } function propertyonRename(e, t, n, r) { var i = "frm_Property"; var s = $("#" + i); s.find("#hi_isEdit").val(true); s.find("#hi_SelectedParentCatId").val(n.id); GetPropertyForEdit(n.id) } function PropertyremoveHoverDom(e, t) { var n = "frm_Property"; var r = $("#" + n); r.find("#addBtn_" + t.tId).unbind().remove() } function PropertyaddHoverDom(e, t) { var n = "frm_Property"; var r = $("#" + n); var i = r.find("#" + t.tId + "_span"); if (t.editNameFlag || r.find("#addBtn_" + t.tId).length > 0) return; var s = "<span class='button add' id='addBtn_" + t.tId + "' title='add node' onfocus='this.blur();'></span>"; i.after(s); var o = r.find("#addBtn_" + t.tId); if (o) o.bind("click", function () { r.find("#btn_saveProperty").button({ icons: { primary: "ui-icon-disk" }, text: true, label: "add" }); localize(); r.find("#hi_isEdit").val(false); r.find("#hi_SelectedParentCatId").val(t.id); r.find("#txt_name").val(""); r.find("#txt_translated").val(""); r.find("#chk_ShowInProperty").attr("checked", false); r.find("#chk_ShowInMenu").attr("checked", false); r.find("#chk_ShowInFilter").attr("checked", false); PropertyzTree.selectNode(t); return false }) } function propertyonDblClick(e, t, n) { var r = "frm_Property"; var i = $("#" + r); i.find("#hi_isEdit").val(false); i.find("#hi_SelectedParentCatId").val("0"); i.find("#txt_name").val(""); i.find("#txt_translated").val(""); i.find("#chk_ShowInProperty").attr("checked", false); i.find("#chk_ShowInMenu").attr("checked", false); i.find("#chk_ShowInFilter").attr("checked", false); i.find("#btn_saveProperty").button({ icons: { primary: "ui-icon-disk" }, text: true, label: "addroot" }); PropertyzTree.cancelSelectedNode(n); localize() } function PropertyEditTreeNode(e, t, n) { var r = PropertyzTree.getSelectedNodes()[0]; r.name = e; r.isChecked = t; PropertyzTree.updateNode(r) } function propertyaddNewTreeNode(e) { if (PropertyzTree.getSelectedNodes()[0] && $("#hi_SelectedParentCatId").val() != "0" && $("#hi_SelectedParentCatId").val() != "") { $("#hi_SelectedParentCatId").val(PropertyzTree.getSelectedNodes()[0].id); e.checked = PropertyzTree.getSelectedNodes()[0].checked; PropertyzTree.addNodes(PropertyzTree.getSelectedNodes()[0], e) } else { PropertyzTree.addNodes(null, e) } } function propertyonCheck(e, t, n) { var r = n.id; var i = { tableName: "property", Id: r, show: n.isChecked }; $.ajax({ type: "POST", async: false, url: "Management/ChangeshowTreeNodeRec", contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (e) { if (e.isdone) { alert(e.msg) } }, error: function (e) { alert(e.responseText) } }) } function GetPropertyForEdit(e) { var t = { TableName: "Property", Id: e }; var n = "div_Details"; var r = $("#" + n); $.ajax({ type: "POST", async: false, url: "Management/getTreeItem", contentType: "application/json; charset=utf-8", data: JSON.stringify(t), success: function (e) { var t = e.ShowOnline != null ? e.ShowOnline : false; $("#txt_name").val(e.Property); $("#txt_translated").val(e.TranslatedProperty); $("#hi_SelectedParentCatId").val(e.PropertyId); $("#chk_ShowInProperty").attr("checked", e.ShowInProperty); $("#chk_ShowInMenu").attr("checked", e.ShowInMenu); $("#chk_ShowInFilter").attr("checked", e.ShowInFilter) }, error: function (e) { alert(e.responseText) } }) } function getAllProperties(barcodeid, dialog, container) { var $con = $("#" + container); var DTO = { barcodeid: barcodeid, propertyId: getHierarchySelectedValue("divProperty", container) }; $.ajax({ type: "POST", data: JSON.stringify(DTO), url: "Management/getAllPropertys", contentType: "application/json; charset=utf-8", success: function (response) { if (!isAuthenticated(response)) return; var table = "<table class='table' ><tbody>"; var group = typeof response.properties == "string" ? eval("(" + response.properties + ")") : response.properties; for (var j = 0; j < group.length; j++) { var val = group[0, j]; table += "<tr ><td style=' font-weight: bold; background-color: #CCFFCC' colspan='4'>" + val.Property + "</td></tr>"; var Properties = typeof val.properties == "string" ? eval("(" + val.properties + ")") : val.properties; for (var p = 0; p < Properties.length; p++) { var val = Properties[0, p]; var subProperty = ""; for (var sp = 0; sp < val.properties.length; sp++) { var sval = val.properties[0, sp]; subProperty += "<tr><td><input type='checkbox' " + ($.inArray(sval.PropertyId, response.propertyIds) != -1 ? "checked" : "") + " value='" + sval.PropertyId + "' />" + sval.Property + " , " + sval.TranslatedProperty + "</td></tr>" } table += "<tr  id='tr" + val.PropertyId + "'><td>" + val.Property + "</td>" + "<td>" + "<table  propertyId='" + val.PropertyId + "'><tbody>" + subProperty + "</tbody ></table></td>" + "<td><input property  placeholder='property' />" + "</td><td><input main placeholder='main' />" + "</td></tr>" } } table += "</tbody></table>"; $con.find("#itemProperty").html(table); $con.find("#itemProperty").tableScroll({ height: 380, width: contentwidth, flush: false }); $con.find("[id=btnDelete]").button({}); $con.find("[id=btnDelete]").button({ icons: { primary: "ui-icon-closethick" }, text: false }).unbind().click(function () { var e = this; if (confirm("آیا از حذف مطمئن هستید؟")) deleteProperty($(this).attr("propId"), barcodeid, container + "dialogAddProperty", container); else return }) }, error: function (e) { alert(e.responseText) } }) } var ajDropDown; var sortid; var pass1; var profile; var currentprofile; var sarg; var cout_tr = 1; var $container; var textin; var ajgetListCategory; var datefrom = ""; var buyfrom = ""; var selfrom = ""; var employeeid; var ajHierarchy; var menuItems; var dir; var contentwidth; var timeout = 0; $(document).ready(function (e) { e("head").find("#leftStyle").prop("disabled", true); e("#userDefault").find("#txt_s_Date").datepicker().datepicker("setDate", new Date).datepicker(); var t = e("#signin-form"); userLogin("signin-form"); e("#forgotPass").unbind("click").bind("click", function (t) { e("#forgot-form").toggle(); e("#signin-form").toggle() }); e("#btnForgotPassword").button().unbind("click").bind("click", function (e) { loginPasswordForgot() }); e("#signin-form").find("#btn_Submit").button().unbind("click").bind("click", function (e) { userLogin("signin-form") }); e("#ddl_m_Language").unbind("change").bind("change", function (e) { masterLocalize(); localize() }); e("#signin-form").find("#password").bind("keypress", function (t) { var n = t.keyCode ? t.keyCode : t.which; if (n == 13 && !e("#signin-form").find("#btn_Submit").is(":focus")) { e("#signin-form").find("#btn_Submit").focus() } }); e("#divslider").unbind("click").live("click", function (t) { var n = e(this).parent(".ui-tabs-panel"); sliderClick("divBasic"); sliderClick("moreFilter") }); contentwidth = e(window).width() - 85; e("#a_help").unbind("click").bind("click", function () { getHelp() }); if (e.browser.msie) { alert("برای مشاهده بهتر از " + "\n Browser Chrome " + " یا " + " FireFox \n" + "استفاده کنید" + ".") } }); $(document).on("propertychange keyup input paste", "input.data_field", function () { var e = $(this).val().length ? 1 : 0; $(this).nextAll(".icon_clear").first().stop().fadeTo(100, e) }).on("click", ".icon_clear", function () { $(this).delay(300).fadeTo(100, 0).prevAll(".data_field").first().val("") }); $(document).on("error", function () { translate("error") }); $(document).ajaxStart(function () { $("#spinner").toggleClass("invisible").toggle(); window.clearInterval(timeout) }); $(document).ajaxStop(function () { timeout = setInterval(function () { resetApp() }, 18e4); $("#spinner").removeClass("ui-state-active").toggleClass("invisible").toggle(); SetHeight(); tableStyle(); localize(); replaceNull(); $("table").find(".digit").digits() }); window.onresize = function (e) { SetHeight() }; var resizeTimer; var CategoryzTree; var Categorysetting = { view: { addHoverDom: CategoryaddHoverDom, removeHoverDom: CategoryremoveHoverDom, fontCss: CategorygetFont, nameIsHTML: true }, edit: { enable: true, showRenameBtn: false }, check: { enable: true }, data: { simpleData: { enable: true }, key: { checked: "isChecked"} }, async: { enable: true, url: "Hierarchy/GetTreeData", autoParam: ["id", "name"], otherParam: { name: "categories"} }, callback: { beforeDrag: CategorybeforeDrag, onClick: categoryonClick, onAsyncSuccess: CategoryonAsyncSuccess, onCheck: categoryonCheck, onRename: categoryonRename, beforeRemove: categorybeforeRemove, beforeEditName: categorybeforeEditName, onDblClick: categoryonDblClick, onDrop: categoryOnDrop} }; var onlineMenuzTree; var OnlineMenusetting = { view: { addHoverDom: OnlineMenuaddHoverDom, removeHoverDom: OnlineMenuremoveHoverDom, fontCss: onlineMenugetFont, nameIsHTML: true }, edit: { enable: true, showRenameBtn: false }, check: { enable: true }, data: { simpleData: { enable: true }, key: { checked: "isChecked"} }, async: { enable: true, url: "Hierarchy/GetTreeData", autoParam: ["id", "name"], otherParam: { name: "Menu"} }, callback: { beforeDrag: OnlineMenubeforeDrag, onClick: onlineMenuClick, onAsyncSuccess: onlineMenuonAsyncSuccess, onCheck: OnlineMenuonCheck, onRename: OnlineMenuonRename, beforeRemove: OnlineMenubeforeRemove, beforeEditName: OnlineMenubeforeEditName, onDblClick: OnlineMenuonDblClick, onDrop: OnlineMenuOnDrop} }; var zTree; var setting = { view: { addHoverDom: AccoountaddHoverDom, removeHoverDom: AccountremoveHoverDom, fontCss: AccountgetFont, nameIsHTML: true }, edit: { enable: true, showRenameBtn: false }, data: { simpleData: { enable: true} }, async: { enable: true, url: "Hierarchy/GetTreeData", autoParam: ["id", "name"], otherParam: { name: "registerAccount"} }, callback: { onDblClick: AccountonDblClick, onClick: AccountonClick, beforeDrag: AccountbeforeDrag, onAsyncSuccess: AccountonAsyncSuccess, onRename: AccountonRename, beforeRemove: AccountbeforeRemove, beforeEditName: AccountbeforeEditName, onDrop: AccountOnDrop} }; var RolezTree; var Rolesetting = { view: { fontCss: RolegetFont, nameIsHTML: true }, edit: { enable: true, showRenameBtn: false, showRemoveBtn: false }, check: { enable: true, chkDisabledInherit: true }, data: { simpleData: { enable: true }, key: { checked: "isChecked"} }, async: { enable: true, url: "Management/getRoleList", autoParam: ["id", "name"] }, callback: { onAsyncSuccess: RoleonAsyncSuccess, onCheck: RoleonCheck} }; var isper; var SavedNewAccountings; var PropertyzTree; var Propertysetting = { view: { addHoverDom: PropertyaddHoverDom, removeHoverDom: PropertyremoveHoverDom, fontCss: PropertygetFont, nameIsHTML: true }, edit: { enable: true, showRenameBtn: false }, check: { enable: true }, data: { simpleData: { enable: true }, key: { checked: "isChecked"} }, async: { enable: true, url: "Hierarchy/GetTreeData", autoParam: ["id", "name"], otherParam: { name: "Properties"} }, callback: { beforeDrag: PropertybeforeDrag, onClick: propertyonClick, onAsyncSuccess: PropertyonAsyncSuccess, onCheck: propertyonCheck, onRename: propertyonRename, beforeRemove: propertybeforeRemove, beforeEditName: propertybeforeEditName, onDblClick: propertyonDblClick, onDrop: propertyOnDrop} };
